---
title: "**DrosEU Phenotyping Working Group Updates **"
author: "by Esra Durmaz Mitchell & Envel Kerdaffrec"
date: "Last updated: `r format(Sys.Date())`"
output: 
  html_document:
    keep_md: true
    toc: true
    toc_depth: 5
    toc_float: true
    theme: yeti  
---


# Phenotyping effort


**Collaborative phenotyping effort of European _Drosophila melanogaster_ populations**  

In 2017, DrosEU consortium has decided to make a collaborative phenotyping effort of European _Drosophila melanogaster_ populations at the Groningen meeting. 

The call was made with approximate numbers of populations, lines, etc. and under predefined criteria (finish within a year, reps, blocks, etc) and participating labs have indicated which traits they are willing to phenotype. 

## Sampling Locations

```{r libraries, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(ggpubr)
library(hrbrthemes)
library(qwraps2)
library(afex)
library(Hmisc)
library(knitr)
library(cowplot)
library(ggrepel)
library(DT)
library(data.table)
library(MetBrewer)
```


Nine sampling locations were chosen based on genomic data and these locations covered a wide range of latitude (~20°) and longitude (~40°) across the continent (see table below). From each location, 15 to 20 isofemale lines were established in corresponding labs at the sampling location and the isofemale lines were centrally maintained by Élio Sucena  at Instituto Gulbenkian de Ciência (IGC), Lisbon, Portugal. A total of 173 isofemale lines were used in this study. 

```{r droseu_coord, echo=FALSE, message=FALSE}
droseu_coord <- read.csv("InfoTables/DrosEU_Coordinates.csv")
droseu_coord <- data.frame(droseu_coord %>%
  add_column(Collector = c("Jorge Vieira", "Josefa Gonzalez", "Mads Schou", "John Parsch & Amanda Glaser-Schmitt","Andrea Betancourt","Maaria Kankare","Iryna Kozeretska","Banu Onder","Elena Pasyukova")))
```

```{r echo=FALSE, message=FALSE}
knitr::kable(droseu_coord, align = "llcccl", caption = 'Table X. Sampling locations, coordinates and collectors, sorted by increasing latitude')
```

```{css, echo = FALSE}
caption {
      color: black;
      font-weight: bold;
      font-size: 1.0em;
    }
```


```{r echo=FALSE}
knitr::include_graphics("InfoTables/samples_map_2-1.png")
```

```{r panmix_theme, echo=FALSE, message=FALSE}
panmix_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black",), axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16, colour = "black"), axis.text.y = element_text(size = 16, colour = "black"),axis.title.y = element_text(size = 16))
```

```{r droseu_labs, echo=FALSE, message=FALSE}
droseu_labs <- data.frame(read.csv("InfoTables/DrosEU_Labs.csv"))
```

## Contributors (phenotyping)

Contributed labs are `r unique(droseu_labs$PI)` and detailed list below :

```{r echo=FALSE}
knitr::kable(droseu_labs, allign = "llll", caption = "Table X. Contributed labs and traits, sorted by trait") 
```

```{r echo=FALSE, message=FALSE}
cities <- read.csv("InfoTables/DrosEU_cities.csv")
```


```{r echo=FALSE}
knitr::include_graphics("InfoTables/research_groups_map-1.png")
```


## Contributors (analyses)

_tbd_

# Methods

## Wolbachia _work in progress_

Sucena, Pasyukova, Kapun, Viera and Kozeretska Labs have genotyped the isofemale lines for Wolbachia using different methods and some discrepancies were observed, mainly due to the sensitivity differences in protocols -- we are working on it. 

Tables below were made using Sucena Lab's results. 

```{r wolbachia-data, echo=FALSE, message=FALSE}
droseu_wol <- data.frame(read.csv("InfoTables/DrosEU_wolbachia_2021.csv"))
```

```{r, echo=FALSE}
DT::datatable(droseu_wol, options = list(pageLength = 10))
```

```{r Wol_Freqs, echo=FALSE}
Wol_Freqs <- data.frame(unique(droseu_wol$Population))

Wol_Pops <- c((AK_freq <- nrow(droseu_wol %>% filter(Population=="AK") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "AK")) * 100), 
  (GI_freq <- nrow(droseu_wol %>% filter(Population=="GI") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "GI")) * 100), 
  (KA_freq <- nrow(droseu_wol %>% filter(Population=="KA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "KA")) * 100), 
  (MA_freq <- nrow(droseu_wol %>% filter(Population=="MA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "MA")) * 100), 
  (MU_freq <- nrow(droseu_wol %>% filter(Population=="MU") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "MU")) * 100), 
  (RE_freq <- nrow(droseu_wol %>% filter(Population=="RE") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "RE")) * 100),
  (UM_freq <- nrow(droseu_wol %>% filter(Population=="UM") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "UM")) * 100),
  (VA_freq <- nrow(droseu_wol %>% filter(Population=="VA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "VA")) * 100),
  (YE_freq <- nrow(droseu_wol %>% filter(Population=="YE") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "YE")) * 100))

pop_freqs <- cbind(unique(droseu_wol$Country), Wol_Freqs, Wol_Pops)

cols <- c("Country", "Population", "Wolbachia_Freq")
wolbachia_pop_freqs <- setnames(pop_freqs, cols)

```

```{r wolbachia_pop_freqs}
wolbachia_pop_freqs # Wolbachia frequency by country and population abbreviation 
```

## Diets

```{r droseu_diets, echo=FALSE, message=FALSE}
droseu_diets <- data.frame(read.csv("InfoTables/DrosEU_Diets_Feb22.csv"))
```

```{r, echo=FALSE}
DT::datatable(droseu_diets, options = list(pageLength = 10))
```


## Inversion Frequencies _work in progress_
_need to do a few more PCRs, will add them here soon_

## Traits 

_Contributors and methods for experiments_

### Viability
##### Gibert, Grath, Hoedjes, Schmidt, Stamenkovic-Radak and Zwaan Labs


3-5 day old adults (at least 25 pairs) are allowed to lay eggs en masse. Yeast is provided to stimulate egg laying (for at least 2 hours). Eggs are collected, and 40 are placed in each vial. Viability is calculated per vial, as the percentage of individuals that emerged from the 40 eggs.

Schmidt Lab : Females were allowed to lay eggs in vials and total number of eggs were recorded. Viability is calculated as the percentage of individuals that emerged from total number of eggs, per vial.

### Developmental time

#### Egg-to-pupa developmental time
##### Schmidt Lab


#### Egg-to-adult developmental time
##### Gibert, Grath, Hoedjes, Schmidt, Stamenkovic-Radak and Zwaan Labs


Developmental time is scored as both the egg-to-pupa and egg-to-adult development time. Both were scored twice a day, when the chamber lights are turned on and two hours before they are turned off. In order to measure the egg-to-pupa developmental time, the spot where a pupa is found is marked with a permanent marker to keep track of which pupae have emerged in each day. The egg-to-adult developmental time is estimated by counting all emerged adults from the vial, and by sexing them.


### Dry weight
##### Colinet, Hoedjes and Onder Labs

At day 7 after emergence, flies are killed by snap freezing them in liquid nitrogen, by putting them at -20ºC or by putting them into an ethyl acetate solution and stored at -20ºC. Then they are sexed and placed into 96 wells plates, and placed in an oven set at 60-70 °C, for at least 3 days. At this point flies can be stored at room temperature using a protective cover. If this is the case, the day before measurements are made dry flies are again placed for 24h in the oven (60-70 °C) to ensure material is well dehydrated. Flies are then placed on a small piece of aluminium foil for direct weight measurement on microbalance (accuracy 1µg).


### Thorax length
##### Kozeretska, Posnien, Ritchie and Schmidt Labs

Five to seven days old flies are placed onto a double-sided sticky tape attached to a microscope slide and a picture of the thorax taken using a digital camera connected to a dissecting microscope. The same magnification and resolution is always used to increase reproducibility, and a scale bar inserted on each photo to allow transforming pixels into µm units. Thorax length is defined as the distance from the anterior margin of the thorax to the posterior tip of the scutellum and it is measured using the “Straight Line” in ImageJ/Fiji.


### Wing area
##### Onder, Posnien, Ritchie and Stamenkovic-Radak Labs

Both the left and right wings of five to seven days old flies (10 flies per sex per replicate) are removed and placed into a drop of Entellan®Merck, Hoyer’s Medium, sticked to a double-side sticky tape, or taped directly to the slide. Pictures of the wing preparations are taken using a digital camera connected to a dissecting microscope. The same magnification and resolution is always used to increase reproducibility. A scale bar is placed on each photo to allow transforming pixels into µm units. Manual measurements of wing length and wing area are performed using the “Straight Line” and “Polygon Selection” tools, respectively of ImageJ/Fiji (10.1371/journal.pone.0000007).


### Fecundity
##### Billeter and Fricke Labs

For each isofemale line, 10 males and 10 females are placed together in single-sex groups and allowed to mature for five days. Then, they are placed together (5-7 pairs), and mating interactions observed to ensure successful mating (at least 10 min copulation duration) to ensure that we have five successfully mated females. After a successful mating, males are discarded and females allowed to oviposit alone for 48 hours, moved to another vial, and allowed to oviposit for four days, and again moved to another vial and allowed to oviposit for two days to check that of egg-laying stopped. Vials are incubated until all offspring is born. Individuals are then frozen and the offspring counted.


### Lifespan
##### Flatt, Parsch and Pasyukova Labs

Line level lifespan: Ten flies per sex/line are placed in each vial. The age at death will be scored when changing the food, at least three times a week. Five replicates are used.

Population level lifespan: Flies are kept in 1L demography cages (5 flies per line/sex for each population). The age at death will be scored when changing the food, at least three times a week. Ten replicates were performed.


### Cold-shock mortality
##### Gonzalez, Kozeretska and Vieira Labs

Batches of 15-20 seven days old flies are placed for 18 hours in an empty vial immersed in an ice-water slurry box placed at a 4°C room for 18 hours. Then the vials are removed to a bench in a 25°C room and mortality scored 24 hours later.


### Chill-coma recovery time
##### Vieira and Mensch Labs

Sexed flies are placed in an empty vial immersed in an ice-water slurry box placed at a 4°C room in the morning. Six hours later, flies are removed from the tube to individual wells of 24 well plates while being kept on ice. A timer is started once the plate is moved from the ice to a bench in a 25°C room. Each fly is checked by eye for recovery for a maximum of 60 minutes. Flies that are able to stand on their legs are considered recovered and the CCRT (in seconds) recorded.


### Heat-shock mortality
##### Parsch and Vieira Labs

Batches of 15-20 seven days old flies are placed in empty vials inside a 37ºC incubator and mortality checked for 7 hours every 30 minutes.


### Diapause
##### Bergland, Flatt and Schlotterer Labs

In order to induce diapause, two hour old 'phenotypic virgins' (pharate or melanized with meconium visible) female flies are exposed to 12°C and 10:14 light/dark hours for 3 weeks, using an incubator that allows temperature tracking. Vials are changed once per week. After three weeks under diapause conditions, flies are frozen at -80C until dissection. Both ovaries will be examined and classified according to the following simplified 'classification': 1) < stage 10: diapause; 2) stage 10-13: intermediate; 3) stage 14: non-diapause.


- Standard diapause conditions: 12°C at 10:14 hrs L:D (under these conditions we might expect around 50% dipause frequency)
- duration of exposure: 3 weeks
- assays will be done in incubators (Percival or Memmert); temperature conditions will be tracked using data loggers / iButtons
- Try to have haphazard standardization; similar conditions coupled with consistent tracking of temperature (multiple iButtons, for example)
- We will use egg lays in bottles to be able to collect more flies for the assay (approx. 1-2 bottles per line)
- Larval density will be controlled (approximately) prior to assays: we will do this by letting a fixed number of (approx. 10-20) females (housed together with 5-10 males) oviposit over night (fixed time window) - how many females and the duration of egg laying might need to be adjusted a bit depending on the fertility of the lines (to be determined when lines are being amplified prior to assays)
- The Bergland and Flatt labs will standardize their fly food according to the Gulbenkian recipe (in terms of amounts / proportions); Manolis from the Schlötterer lab will not standardize the food and use their local diet; importantly, flies for the assays will not be exposed to any (additional) live yeast (i.e., the diet will contain liophilized yeast but no live yeast sprinkled on top).
- From the bottles we will collect upon eclosion 'phenotypic virgins' (=pharate adults or melanized with meconium visible), approx. within 2 hours after eclosion
- Flies will be kept in vials for assay (15-20 flies in the same vial to account for mortality); we aim to measure a minimum of 10 females per line (from approx. 10-15 lines x 10 populations, yielding about 1000-1500 flies for dissections in total)
- The food in the assays will be changed once per week
- To keep the workload and effort manageable the assays will be performed in 2-3 blocks (optimally only 2) over time: e.g., from each population we will measure a subset of all lines (e.g., 5-7 lines, i.e. 1/2 or 1/3 of all lines) in each of the 2-3 blocks. 
- After 3 weeks under diapause conditions, flies will either be dissected or kept frozen until dissection (dry, at -80C; can be stored for a few months) 
- We will adopt a simplified diapause 'classification':
- Stage 10 will be defined as the checkpoint
- < Stage 10: diapause
- Stage 10-13: intermediate
- Stage 14: non-diapause
- We will examine both ovaries.


### Circadian eclosion timing
##### Wegener Lab

The eclosion rhythmicity has been measured in outcrossed Munich, Akaa, Gimenells, Uman, Mauternbach, Karensminde, Valday, Yesiloz and Recarei strains at:

1) LD14:10 @ 29°C, flies raised at 29°C

2) DD 29°C after LD14:10 entrainment, flies raised at 29°C

3) LD14:10 @ 18°C, flies raised at 18°C

4) DD 18°C after LD14:10 entrainment, flies raised at 18°C

### Locomotor activity
##### Tauber Lab

The locomotor activity of the flies (males only) was measured using the DAM2 Drosophila monitors (Trikinetics Inc., Waltham, MA). Flies were 1-3 days old. Single flies were placed in glass tubes (10 cm × 0.5 cm) that were filled with 2 cm sugar/agar medium. The monitors were placed in light chambers driven by LED,  in an incubator at 24°C, ~30% humidity. The flies were entrained to a light-dark cycle (LD 12:12) for 5d and then allowed to free-run for 10 d in constant darkness (DD). The activity data were processed into 30 min bins, and four different variables were analysed. These included the circadian period, and the phase, which were analyzed using the FFT NLLS algorithm available at the BioDare2 server (https://biodare2.ed.ac.uk/). The other two variables, level of activity and the nocturnal/diurnal ratio were analyzed by a custom-made R script.
 

### Starvation resistance
##### Gonzalez, Onder and Pasyukova Labs

Batches of 10 sexed flies are transferred to glass vials filled with 5 mL of 2% agar for starvation 3-7 days after eclosion. The age at death will be scored every 8 hours.

### Pigmentation
##### Abbott, Gibert and Schmidt Labs

Abbott and Gibert Labs : For each line, 10 females, 13-15 days old, either alive or stored in 95% ethanol, are air dried and placed on their left side, and pictures taken using a dissecting microscope. Images are then analysed in ImageJ 1.46r, using the Area Fraction measurement in the Analyze menu. Area Fraction measures the percentage of pixels in a selected area that have been highlighted in red using the Threshold tool. This gives an estimate of the percentage of dark pigmentation on the three terminal tergites of the abdomen (4, 5 and 6). 

Schmidt Lab : The last three tergites were scored according to David et al. 1990.  

### Parasitoid resistance 
##### Hrcek Lab

The resistance of the lines to parasitoids will be measured using _Leptopilina boulard_. 

## Data reformatting 

MasterSheets 

All data files are reformatted as so called _Master Sheets_, in which the data structure is the same for all the sub-data sets and all details/edits logged in a README sheet. 

```{r README_example, echo=FALSE}
headers <- c("Supervisor/PI", "Diet", "Batch", "Population", "Line", "Sex", "ReplicateVial", "TraitValue") 

descriptions <- c("Lab identifier", "Either standardized _S_ or non-standardized _NS_ ", "From 1 to n" , "Population identifier in abbreviated form (i.e. _AK_)", "Line identifier (i.e. _MU1_)", "Either female (F) or male (M)", "Replicate identifier (from 1 to n)", "Trait value in x units")

README_example <- data.table(Headers =  headers, Descriptions = descriptions)
```

```{r echo=FALSE, message=FALSE}
knitr::kable(README_example, align = "ll", caption = 'Table X. Filling in the data spreadsheet and header description')
```

```{r MS_example, echo=FALSE}
MS_example <- data.table(read.csv("Data/MasterSheets_Feb22_git/VIA_MasterSheet_Feb22.csv"))
```

```{r, echo=FALSE}
DT::datatable(MS_example, options = list(pageLength = 10)) 
```

All proportion data has been arcsin transformed prior to the analyses. For others, please see the residual plots after linear models and let us know if you think the trait data set need transformation. 

## Data check

For each trait and lab, we ran counts for sex, population, line and replicate vial (if applicable). If we could spot anything suspicious or unusual (typos, shifts, etc.), I have contacted you already. Please let me know if there is anything that you have spotted and we missed. Thanks! 

# Results : Examples & Directories & Legends {#anchor}

### Tables 

Here is an example code for tables (egg-to-adult viability). The very same code is used for other traits (either with or without _Batch_) by filtering the data at supervisor, batch, population and/or line levels (and also for sex, if applicable). 

```{r descriptive_stats, eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}

## First defined standard error and coefficient of variation

std_err <- function(x) sd(x)/sqrt(length(x))
coef_var <- function(x) sd(x)/mean(x)
estimate_mode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}
```

```{r, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}

# Then compute descriptive statistics (mean, median, minimum, maximum, standard error, coefficient of variation and mode) at the defined levels (line with batch information example below) : 

table_Via_Line_wbatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Line_wbatch.csv", row.names = T)

```

Tables for descriptive statistics at population and line levels can be found in the trait directory, under the file name **__table_TraitAbbreviation_Level_BatchInfo.csv__**  (_i.e. Viability/table_Via_Line_wobatch.csv_)

### Figures

Data range is calculated with `#r min()` and `#r max()` functions for each trait.

y-axis on the figures is scaled by the minimum (`#r min_trait`) and maximum (`#r max_trait`) values in the full data set for a given trait. 

The very same ggplot theme has been used all across the document, called _droseu_theme_

```{r droseu_theme, eval=FALSE, echo=TRUE}
myColors <- met.brewer("Johnson", 9)
names(myColors) <- as.factor(c("AK", "GI", "KA", "MA", "MU", "RE", "UM", "VA", "YE"))
colScale <- scale_fill_manual(name = "Population", values = myColors)

droseu_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black",),  axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16),axis.text.y = element_text(size = 16),axis.title.y = element_text(size = 16), colScale)

p_TraitAbbreviation_Lab + ylim(c(min_trait, max_trait)) + droseu_theme + colScale
```

```{r, echo=FALSE}
## Need to run this in the background
myColors <- met.brewer("Johnson", 9)
names(myColors) <- as.factor(c("AK", "GI", "KA", "MA", "MU", "RE", "UM", "VA", "YE"))
colScale <- scale_fill_manual(name = "Population", values = myColors)

droseu_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black",),  axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16),axis.text.y = element_text(size = 16),axis.title.y = element_text(size = 16))
```

Here is an example code for figures (egg-to-adult viabiliy, Gibert Lab). The very same code is used to generate plots for other contributing labs and traits (either for _Batch_ or _Population_) by filtering the data at supervisor level (for females and males separately, if applicable). 

```{r plot_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}

p_Via_Gibert <- ggplot(data = filter(droseu$via, Supervisor.PI=='Gibert')), 
                       #subsets for supervisor
                       aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) +
                        #define x- and y-axis and fill
                       geom_boxplot(outlier.shape = NA, notch=FALSE) +  #boxplot
                       labs(title="p_Via_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + 
                      ylim(c(min_Via, max_Via)) + 
                      droseu_theme #y-axis limits, axis labels and droseu_theme

pdf(file="Viability/p_Via_Gibert.pdf",width=8, height=5)

p_Via_Gibert

invisible(dev.off())
```


### Linear Models

Here is an example code for linear models (egg-to-adult development time, males, Gibert Lab). The very same code is used for other contributing labs and traits by filtering the data at supervisor level (for females and males separately, if applicable), adding or removing factors if they cause convergence problems or singularity (i.e. if only one replicate vial has been phenotyped per line and/or population and/or batch, the lowest level [ _replicate_vial_  in this example] has been dropped from given model). 

```{r lmer_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
DT_A_M_lmer_Gibert <- lmer(DT_EggAdult ~ Population + 
                             #Population (fixed)
                             (1|Line:Population) + 
                             #Line (random) is nested in Population (fixed)
                             (1|Batch) +
                             #Batch is a random effect 
                             (1|ReplicateVial : Line),
                            #Replicate vial (random) is nested in Line (random)
                           data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Gibert",]) 
                            #Filter by Lab in development time, males data 
capture.output(summary(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert_sum.txt") #save output summary 
capture.output(anova(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert.txt") #save anova output 

```

```{r tukey_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
#need to put in tukey example here 
```

```{r anova_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
anova(DT_A_M_lmer_Gibert) #print anova output
```

```{r summary_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
summary(DT_A_M_lmer_Gibert) #print model output summary 
```


Here is an example code for linear models for geography (altitude, dry weight, males, Onder Lab). The very same code is used for other contributing labs and traits by filtering the data at supervisor level (for females and males separately, if applicable), adding or removing factors if they cause convergence problems or singularity (i.e. if only one replicate vial has been phenotyped per line and/or population and/or batch, the lowest level [ _replicate_vial_  in this example] has been dropped from given model) and also for latitude and longitude. 

```{r genography_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
DW_M_lmer_Alt_Onder <- lmer(DW_micrograms ~ Altitude + (1|Population) + (1|Population:Line), data = d_DW_M[d_DW_M$Supervisor.PI == "Onder",])
capture.output(summary(DW_M_lmer_Alt_Onder),file = "DryWeight/DW_M_lmer_Alt_Onder_sum.txt")
capture.output(anova(DW_M_lmer_Alt_Onder),file = "DryWeight/DW_M_lmer_Alt_Onder.txt")
```


### Survival Models

Here is an example code for survival analyses (starvation resistance, females, Gonzalez Lab). The very same code is used for other contributing labs and traits by filtering the data at supervisor level and sex. Please note that the level "replicate_vial" has been dropped from all survival analyses, as it clogs the models due to the volume of data.

```{r coxme_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
SR_F_coxme_Gonzalez <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Population/Line) , data = filter(d_SR_surv, Supervisor.PI == "Gonzalez", Sex == "F"))
capture.output(summary(SR_F_coxme_Gonzalez), file = "Starvation/SR_F_coxme_Gonzalez_sum.txt")
capture.output(anova(SR_F_coxme_Gonzalez), file = "Starvation/SR_F_coxme_Gonzalez.txt")

```

All analyses outputs can be found in the trait directory (Analyses/Trait), under the file names  **__TraitAbbreviation_Function_Output.txt__** . The analyses at the lab level can be found in the same trait directory, under _by_lab_ folders (_i.e. LinearModelsPop/DevelopmentTime/by_lab_txt_output/DT_A_M_Gibert_lmer_pop_anova.txt_)

### Meta Analyses

Please refer to the .pdf file below ( _README_META.pdf_ ) for details. 

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/README_META.pdf")
```

### Generalized Dissimilarity Model (GDM)

We used the WorldClim database (www.worldclim.org) which includes 19 bioclimatic variables, monthly precipitation, minimum, maximum and average monthly temperature, wind, vapor and solar radiation. Those variables that are identified as important in the model are shown in table 1 (_Refer to Results V_).

__Generalized dissimilarity model__

The generalized dissimilarity model here after GDM is a matrix regression technique (Ferrier et al., 2007) to analyze and predict primarily beta diversity patterns. However, it was shown that GDM could be used to explore relationship between morphological traits variation and environmental variation (Thomassen et al., 2010; Baldassarre et al., 2013).

In GDM we use matrix correlation among biotic and environmental dissimilarity plus geographic distance between sample sites to predict biotic dissimilarity across landscape. One of the advantages of GDM is that it can fit nonlinear relationship of variables by the help of I-spline function. GDM consists of two steps; in the first step using all pairwise combinations of sampling sites, it fits dissimilarities in predictor variables (environmental variables) to dissimilarities in response variables (phenotypic variables). In this step all environmental predictors with sum of I-spline coefficients of zero were removed then the remaining environmental data were permuted and introduced in the random order to the model. GDM were fitted with these permuted data, and the result of deviance explained by this model compared with deviance explained by GDM fitted to unpermuted data. Predictors importance is calculated based on the difference in deviance explained between permuted model and unpermuted model. In this step backward elimination could be used so that less important predictors were dropped from the model (Ferrier et al., 2007). In the final step, using the result of above procedures spatial prediction of response variables pattern across the entire range of study areas were made. 

For each response variable we ran four different models. Ful model that includes environmental and geographic distance as predictor variables. To examine possible correlation between geographic distance and environmental dissimilarity, we ran two additional models each selecting only one of them (geographic distance and environmental dissimilarity) as predator variables. We also ran a random model to compare with fitted models to make sure null hypothesis were not rejected randomly. To run random model, we produced random values of environmental variables for each location and as we have few locations, we produced 100000 random models. Then we used mean deviance explained by these random models and compared them with full, environment and geographic distance models. If the difference between deviance explained by random model were lower than any other three models, we consider the relationship of response variables with predictor variables not random (Thomassen et al., 2010; Baldassarre et al., 2013). 


**Reading the data, tables and model outputs in R**
```{r load_Rdas, include=TRUE}
droseu <- readRDS("Data/droseu_master_list_2022-05-02.rds")
lmers_anova <- readRDS("LinearModelsPop/all_lmers_pop_anova_list.rds")
glmers_anova <- readRDS("LinearModelsPop/all_glmers_pop_anova_list.rds")
lmers_tukey <- readRDS("LinearModelsPop/all_lmers_pop_tukey_list.rds")
lmers_sum <- readRDS("LinearModelsPop/all_lmers_pop_summary_list.rds")
table_line_wbatch <- readRDS("DescriptiveStatistics/all_table_Line_wbatch.rds")
table_line_wobatch <- readRDS("DescriptiveStatistics/all_table_Line_wobatch.rds")
table_pop_wbatch <- readRDS("DescriptiveStatistics/all_table_Pop_wbatch.rds")
table_pop_wobatch <- readRDS("DescriptiveStatistics/all_table_Pop_wobatch.rds")
coxme_anova <- readRDS("SurvivalAnalyses/all_coxmes_pop_anova_list.rds")
coxme_sum <- readRDS("SurvivalAnalyses/all_coxmes_pop_summary_list.rds")
```


**_Please note that "Plots and Linear Models by Lab" are presented in alphabetical order._** 

# Results : Linear Models  {#anchor}

## Overview 

Here is a summary table with p-values for all the analyses below. p-value adjustments are only made on meta analyses (Bonferroni correction for n = 20 traits). 

```{r, echo=FALSE}
pval_table <- read.csv("InfoTables/models_metas_pvalues_summary_table.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_table, options = list(pageLength = 25)) %>% formatRound(5:9, 4)
```

```{r}
knitr::include_graphics("LabCorrelations/lab_correlation_line_pearson.pdf")
```

```{r}
knitr::include_graphics("LabCorrelations/lab_correlation_pop_pearson.pdf")
```

```{r}
knitr::include_graphics("LabCorrelations/lab_correlation_pop_spearman.pdf")
```

## Viability

```{r include=FALSE}
dir.create(file.path("Viability"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Gibert Lab : Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Patricia Gibert

Grath Lab : Ingo Müller, Sonja Grath

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Schmidt Lab : Ozan Kiratli, Yonatan Babore, Liam Forsythe, Paul Schmidt

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

Zwaan Lab : Joost van den Heuvel, Bas Zwaan


```{r}
str(droseu$via)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$Via, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$Via, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$Via, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$Via, options = list(pageLength = 10)) %>% formatRound(3:10, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r min_max_Via, echo=TRUE}
min_Via <- min(droseu$via$ProportionEggtoAdultSurvival)
max_Via <- max(droseu$via$ProportionEggtoAdultSurvival)
```

y-axis is scaled by the minimum (`r min_Via`) and maximum (`r max_Via`) values in the full data set.

```{r p_Via_all, echo=FALSE}
p_Via_all <- ggplot(data = droseu$via, aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_Via_all", x="Population", y = "ProportionEggtoAdultSurvival") + 
  ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_all
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_all.pdf",width=8, height=5)
p_Via_all
invisible(dev.off())
```

#### Gibert Lab

```{r}
lmers_anova$Via_Gibert_lmer_pop
```

```{r}
lmers_sum$Via_Gibert_lmer_pop
```

```{r p_Via_Gibert, echo=FALSE}
p_Via_Gibert <- ggplot(data = filter(droseu$via, Supervisor.PI == "Gibert"), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via)) + droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_Gibert
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Gibert.pdf",width=8, height=5)
p_Via_Gibert
invisible(dev.off())
```

```{r p_Via_pop_Gibert, echo=FALSE, message=FALSE, warning=FALSE}
p_Via_pop_Gibert <- ggplot(data = filter(droseu$via, Supervisor.PI == "Gibert"), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population))+geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via)) + geom_text(data = lmers_tukey$Via_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Via_pop_Gibert
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
pdf(file="Viability/p_Via_pop_Gibert.pdf",width=8, height=5)
p_Via_pop_Gibert
invisible(dev.off())
```

#### Grath Lab

```{r}
lmers_anova$Via_Grath_lmer_pop
```

```{r}
lmers_sum$Via_Grath_lmer_pop
```

```{r p_Via_Grath, include=FALSE}
p_Via_Grath <- ggplot(data = filter(droseu$via, Supervisor.PI == "Grath"), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Grath", x="Population", y = "ProportionEggtoAdultSurvival")+ ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_Grath
```

```{r include=FALSE}
pdf(file="Viability/p_Via_Grath.pdf",width=8, height=5)
p_Via_Grath 
invisible(dev.off())
```

```{r, include=FALSE}
p_Via_pop_Grath <- ggplot(data = filter(droseu$via, Supervisor.PI == "Grath"), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Grath", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ geom_text(data = lmers_tukey$Via_Grath_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale

```

```{r echo=FALSE}
p_Via_pop_Grath
```

```{r include=FALSE}
pdf(file="Viability/p_Via_pop_Grath.pdf",width=8, height=5)
p_Via_pop_Grath
invisible(dev.off())
```

#### Hoedjes Lab

```{r}
lmers_anova$Via_Hoedjes_lmer_pop
```

```{r}
lmers_sum$Via_Hoedjes_lmer_pop
```

```{r p_Via_Hoedjes, include=FALSE}
p_Via_Hoedjes <- ggplot(data = filter(droseu$via, Supervisor.PI == "Hoedjes"), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Hoedjes", x="Population", y = "ProportionEggtoAdultSurvival")+ ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_Hoedjes
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Hoedjes.pdf",width=8, height=5)
p_Via_Hoedjes
invisible(dev.off())
```

```{r p_Via_pop_Hoedjes, include=FALSE}
p_Via_pop_Hoedjes <- ggplot(data = filter(droseu$via, Supervisor.PI=='Hoedjes'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Hoedjes", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+  geom_text(data = lmers_tukey$Via_Hoedjes_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale

```

```{r echo=FALSE}
p_Via_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_pop_Hoedjes.pdf",width=8, height=5)
p_Via_pop_Hoedjes
invisible(dev.off())
```

#### Schmidt Lab

```{r}
lmers_anova$Via_Schmidt_lm_pop
```

```{r}
lmers_sum$Via_Schmidt_lm_pop
```

```{r p_Via_Schmidt, include=FALSE}
p_Via_Schmidt <- ggplot(data = filter(droseu$via, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Schmidt", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_Schmidt
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Schmidt.pdf",width=8, height=5)
p_Via_Schmidt
invisible(dev.off())
```

```{r include=FALSE}
p_Via_pop_Schmidt <- ggplot(data = filter(droseu$via, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) +geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Schmidt", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+   geom_text(data = lmers_tukey$Via_Schmidt_lm_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r}
p_Via_pop_Schmidt
```

```{r p_Via_pop_Schmidt, include=FALSE}
pdf(file="Viability/p_Via_pop_Schmidt.pdf",width=8, height=5)
p_Via_pop_Schmidt
invisible(dev.off())
```

#### Stamenkovic-Radak Lab

```{r}
lmers_anova$Via_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$Via_StamenkovicRadak_lmer_pop
```

```{r p_Via_StamenkovicRadak, include=FALSE}
p_Via_StamenkovicRadak <- ggplot(data = filter(droseu$via,Supervisor.PI=='StamenkovicRadak'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_StamenkovicRadak", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_StamenkovicRadak
```

```{r , include=FALSE}
pdf(file="Viability/p_Via_StamenkovicRadak.pdf",width=8, height=5)
p_Via_StamenkovicRadak
invisible(dev.off())
```

```{r p_Via_pop_StamenkovicRadak, include=FALSE}
p_Via_pop_StamenkovicRadak <- ggplot(data = filter(droseu$via,Supervisor.PI=='StamenkovicRadak'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_StamenkovicRadak", x="Population", y = "ProportionEggtoAdultSurvival")  + ylim(c(min_Via, max_Via))+ geom_text(data = lmers_tukey$Via_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Via_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_pop_StamenkovicRadak.pdf",width=8, height=5)
p_Via_pop_StamenkovicRadak
invisible(dev.off())
```

#### Zwaan Lab

```{r}
lmers_anova$Via_Zwaan_lmer_pop
```

```{r}
lmers_sum$Via_Zwaan_lmer_pop
```

```{r p_Via_Zwaan, include=FALSE}
p_Via_Zwaan <- ggplot(data = filter(droseu$via,Supervisor.PI=='Zwaan'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Zwaan", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Via_Zwaan
```

```{r include=FALSE}
pdf(file="Viability/p_Via_Zwaan.pdf",width=8, height=5)
p_Via_Zwaan
invisible(dev.off())
```

```{r p_Via_pop_Zwaan, include=FALSE}
p_Via_pop_Zwaan <- ggplot(data = filter(droseu$via,Supervisor.PI=='Zwaan'), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Zwaan", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+  geom_text(data = lmers_tukey$Via_Zwaan_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Via_pop_Zwaan
```

```{r include=FALSE}
pdf(file="Viability/p_Via_pop_Zwaan.pdf",width=8, height=5)
p_Via_pop_Zwaan
invisible(dev.off())
```

### Linear Models / Residuals 

#### Gibert Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Gibert_lmer_pop_qq_plot_residuals.png")

```

#### Grath Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Grath_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Grath_lmer_pop_qq_plot_residuals.png")
```

#### Hoedjes Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Hoedjes_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Hoedjes_lmer_pop_qq_plot_residuals.png")
```

#### Schmidt Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Schmidt_lm_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Schmidt_lm_pop_qq_plot_residuals.png")
```

#### Stamenkovic-Radak Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

#### Zwaan Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Zwaan_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Viability/by_lab_models_residuals/Via_Zwaan_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r  intersect_Via, echo=FALSE}
intersect_Via_line  <- Reduce(intersect, list(droseu$via$Line[droseu$via$Supervisor.PI == "Gibert"],
                                         droseu$via$Line[droseu$via$Supervisor.PI == "Grath"],
                                         droseu$via$Line[droseu$via$Supervisor.PI == "Hoedjes"],
                                         droseu$via$Line[droseu$via$Supervisor.PI == "Schmidt"],
                                         droseu$via$Line[droseu$via$Supervisor.PI == "StamenkovicRadak"],
                                         droseu$via$Line[droseu$via$Supervisor.PI == "Zwaan"]))

write(intersect_Via_line, file ="Viability/Via_int_line.txt", sep = "\t")

intersect_Via_pop  <- Reduce(intersect, list(droseu$via$Population[droseu$via$Supervisor.PI == "Gibert"],
                                         droseu$via$Population[droseu$via$Supervisor.PI == "Grath"],
                                         droseu$via$Population[droseu$via$Supervisor.PI == "Hoedjes"],
                                         droseu$via$Population[droseu$via$Supervisor.PI == "Schmidt"],
                                         droseu$via$Population[droseu$via$Supervisor.PI == "StamenkovicRadak"],
                                         droseu$via$Population[droseu$via$Supervisor.PI == "Zwaan"]))

write(intersect_Via_pop, file ="Viability/Via_int_pop.txt", sep = "\t")

```

There are `r length(intersect_Via_pop) ` populations and `r length(intersect_Via_line) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Viability/Via_NA_lmer_lab_correlations.png")
```

## Developmental time

```{r include=FALSE}
dir.create(file.path("DevelopmentTime"), showWarnings = FALSE)
```

### Egg-to-pupa developmental time

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

#### Contributors  

Schmidt Lab : Paul Schmidt

#### Data Reformatting

```{r}
str(droseu$dtp) 
```

#### Descriptive Statistics

```{r}
# Note that the trait has been phenotyped only in Schmidt lab and in one batch.
```

Descriptive statistics at the line level :  
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$DT_P, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

Descriptive statistics at the population level: 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$DT_P, options = list(pageLength = 10))  %>% formatRound(3:10, 3)
```


#### Plots and Linear Models by Lab

```{r min_max_DT_P, echo=TRUE}
min_DT_P <- min(droseu$dtp$DT_EggPupa)
max_DT_P <- max(droseu$dtp$DT_EggPupa)
```

y-axis is scaled by the minimum (`r min_DT_P`) and maximum (`r max_DT_P`) values in the full data set. 

##### Schmidt Lab
```{r}
lmers_anova$DT_P_Schmidt_lmer_pop
```

```{r}
lmers_sum$DT_P_Schmidt_lmer_pop
```

```{r p_DT_P_Schmidt, echo=FALSE, message= FALSE, warning=FALSE}
p_DT_P_Schmidt <- ggplot(data = filter(droseu$dtp, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=DT_EggPupa, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_P_Schmidt", x="Population", y = "DT_EggPupa") + ylim(c(min_DT_P, max_DT_P))+   geom_text(data = lmers_tukey$DT_P_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r}
p_DT_P_Schmidt
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_P_Schmidt.pdf",width=8, height=5)
p_DT_P_Schmidt
invisible(dev.off())
```

### Egg-to-adult developmental time

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

#### Contributors  

Gibert Lab : Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Patricia Gibert

Grath Lab : Ingo Müller, Sonja Grath

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Schmidt Lab : Ozan Kiratli, Yonatan Babore, Liam Forsythe, Paul Schmidt

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

Zwaan Lab : Joost van den Heuvel, Bas Zwaan

#### Data Reformatting


```{r d_DT_A}
str(droseu$dta) 
```

#### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$DT_A, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$DT_A, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$DT_A, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$DT_A, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

#### Plots and Linear Models by Lab

##### Overview 

```{r min_max_DT_A, echo=TRUE}
min_DT_A <- min(droseu$dta$DT_EggAdult)
max_DT_A <- max(droseu$dta$DT_EggAdult)
```
  
y-axis is scaled by the minimum (`r min_DT_A`) and maximum (`r max_DT_A`) values in the full data set. 

```{r p_DT_A_F_all, message=FALSE, warning=FALSE, echo=FALSE}
p_DT_A_F_all <- ggplot(data = filter(droseu$dta, Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_all", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_all
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_all.pdf",width=8, height=5)
p_DT_A_F_all
invisible(dev.off())
```

```{r p_DT_A_M_all, message=FALSE, warning=FALSE, echo=FALSE}
p_DT_A_M_all <- ggplot(data =  filter(droseu$dta, Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_all", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_M_all
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_all.pdf",width=8, height=5)
p_DT_A_M_all
invisible(dev.off())
```

##### Gibert Lab

```{r}
lmers_anova$DT_A_F_Gibert_lmer_pop
```

```{r}
lmers_sum$DT_A_F_Gibert_lmer_pop
```

```{r}
lmers_anova$DT_A_M_Gibert_lmer_pop
```

```{r}
lmers_sum$DT_A_M_Gibert_lmer_pop
```

```{r p_DT_A_F_Gibert, include=FALSE}
p_DT_A_F_Gibert <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Gibert" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_Gibert", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_Gibert
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Gibert.pdf",width=8, height=5)
p_DT_A_F_Gibert
invisible(dev.off())
```

```{r p_DT_A_F_pop_Gibert, echo=FALSE}
p_DT_A_F_pop_Gibert <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Gibert" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_pop_Gibert", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+   geom_text(data = lmers_tukey$DT_A_F_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r, echo=FALSE}
p_DT_A_F_pop_Gibert
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Gibert.pdf",width=8, height=5)
p_DT_A_F_pop_Gibert
invisible(dev.off())
```

```{r p_DT_A_M_Gibert, echo=FALSE}
p_DT_A_M_Gibert <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Gibert" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_Gibert", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r, echo=FALSE}
p_DT_A_M_Gibert
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Gibert.pdf",width=8, height=5)
p_DT_A_M_Gibert
invisible(dev.off())
```

```{r p_DT_A_M_pop_Gibert, include=FALSE}

p_DT_A_M_pop_Gibert <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Gibert" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_pop_Gibert", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+  geom_text(data = lmers_tukey$DT_A_M_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale

```

```{r echo=FALSE}
p_DT_A_M_pop_Gibert
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Gibert.pdf",width=8, height=5)
p_DT_A_M_pop_Gibert
invisible(dev.off())
```

##### Grath Lab
```{r}
lmers_anova$DT_A_F_Grath_lmer_pop
```

```{r}
lmers_sum$DT_A_F_Grath_lmer_pop
```

```{r}
lmers_anova$DT_A_M_Grath_lmer_pop
```

```{r}
lmers_sum$DT_A_M_Grath_lmer_pop
```

```{r p_DT_A_F_Grath, include=FALSE}
p_DT_A_F_Grath <- ggplot(data = filter(droseu$dta, Sex =="F", Supervisor.PI=='Grath'), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
invisible(dev.off())
```

```{r echo=FALSE}
p_DT_A_F_Grath
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Grath.pdf",width=8, height=5)
p_DT_A_F_Grath
invisible(dev.off())
```

```{r p_DT_A_F_pop_Grath, include=FALSE}
p_DT_A_F_pop_Grath <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Grath" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_pop_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_F_Grath_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_F_pop_Grath
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Grath.pdf",width=8, height=5)
p_DT_A_F_pop_Grath
invisible(dev.off())
```

```{r p_DT_A_M_Grath, include=FALSE}

p_DT_A_M_Grath <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Grath" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)

```

```{r echo=FALSE}
p_DT_A_M_Grath
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Grath.pdf",width=8, height=5)
p_DT_A_M_Grath
invisible(dev.off())
```

```{r p_DT_A_M_pop_Grath,  include=FALSE}
p_DT_A_M_pop_Grath <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Grath" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_pop_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_M_Grath_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_M_pop_Grath
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Grath.pdf",width=8, height=5)
p_DT_A_M_pop_Grath
invisible(dev.off())
```

##### Hoedjes Lab

```{r}
lmers_anova$DT_A_F_Hoedjes_lmer_pop
```

```{r}
lmers_sum$DT_A_F_Hoedjes_lmer_pop
```

```{r}
lmers_anova$DT_A_M_Hoedjes_lmer_pop
```

```{r}
lmers_sum$DT_A_M_Hoedjes_lmer_pop
```

```{r p_DT_A_F_Hoedjes, include=FALSE}
p_DT_A_F_Hoedjes <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Hoedjes" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_Hoedjes", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_Hoedjes
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Hoedjes.pdf",width=8, height=5)
p_DT_A_F_Hoedjes
invisible(dev.off())
```

```{r p_DT_A_F_pop_Hoedjes, include=FALSE}
p_DT_A_F_pop_Hoedjes <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Hoedjes" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_DT_A_F_pop_Hoedjes", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_F_Hoedjes_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_F_pop_Hoedjes
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Hoedjes.pdf",width=8, height=5)
p_DT_A_F_pop_Hoedjes
invisible(dev.off())
```

```{r p_DT_A_M_Hoedjes, include=FALSE}
p_DT_A_M_Hoedjes <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Hoedjes" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_Hoedjes", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_M_Hoedjes
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Hoedjes.pdf",width=8, height=5)
p_DT_A_M_Hoedjes
invisible(dev.off())
```


```{r p_DT_A_M_pop_Hoedjes, include=FALSE}
p_DT_A_M_pop_Hoedjes <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Hoedjes" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_DT_A_M_pop_Hoedjes", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_M_Hoedjes_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_M_pop_Hoedjes
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Hoedjes.pdf",width=8, height=5)
p_DT_A_M_pop_Hoedjes
invisible(dev.off())
```

##### Schmidt Lab

```{r}
lmers_anova$DT_A_F_Schmidt_lmer_pop
```

```{r}
lmers_sum$DT_A_F_Schmidt_lmer_pop
```

```{r}
lmers_anova$DT_A_M_Schmidt_lmer_pop
```

```{r}
lmers_sum$DT_A_M_Schmidt_lmer_pop
```

```{r p_DT_A_F_Schmidt, include=FALSE}
p_DT_A_F_Schmidt <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Schmidt" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_Schmidt
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Schmidt.pdf",width=8, height=5)
p_DT_A_F_Schmidt
invisible(dev.off())
```

```{r p_DT_A_F_pop_Schmidt, include=FALSE}
p_DT_A_F_pop_Schmidt <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Schmidt" & Sex == "F"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_pop_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+geom_text(data = lmers_tukey$DT_A_F_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale

```

```{r echo=FALSE}
p_DT_A_F_pop_Schmidt
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Schmidt.pdf",width=8, height=5)
p_DT_A_F_pop_Schmidt
invisible(dev.off())
```

```{r p_DT_A_M_Schmidt, include=FALSE}
p_DT_A_M_Schmidt <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Schmidt" & Sex == "M"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_M_Schmidt
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Schmidt.pdf",width=8, height=5)
p_DT_A_M_Schmidt
invisible(dev.off())
```


```{r p_DT_A_M_pop_Schmidt, include=FALSE}
p_DT_A_M_pop_Schmidt <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Schmidt" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_pop_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+geom_text(data = lmers_tukey$DT_A_M_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale

```

```{r echo=FALSE}
p_DT_A_M_pop_Schmidt
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Schmidt.pdf",width=8, height=5)
p_DT_A_M_pop_Schmidt
invisible(dev.off())
```

##### Stamenkovic-Radak Lab

```{r}
lmers_anova$DT_A_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$DT_A_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_anova$DT_A_M_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$DT_A_M_StamenkovicRadak_lmer_pop
```

```{r p_DT_A_F_StamenkovicRadak,  include=FALSE}
p_DT_A_F_StamenkovicRadak <- ggplot(data = filter(droseu$dta,Supervisor.PI=="StamenkovicRadak" & Sex == "F"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_StamenkovicRadak
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_F_StamenkovicRadak
invisible(dev.off())
```

```{r p_DT_A_F_pop_StamenkovicRadak,  include=FALSE}
p_DT_A_F_pop_StamenkovicRadak <- ggplot(data = filter(droseu$dta,Supervisor.PI=="StamenkovicRadak" & Sex == "F"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_pop_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_F_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_F_pop_StamenkovicRadak
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_F_pop_StamenkovicRadak
invisible(dev.off())
```

```{r p_DT_A_M_StamenkovicRadak,  include=FALSE}
p_DT_A_M_StamenkovicRadak <- ggplot(data = filter(droseu$dta,Supervisor.PI=="StamenkovicRadak" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_M_StamenkovicRadak
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_M_StamenkovicRadak
invisible(dev.off())
```

```{r p_DT_A_M_pop_StamenkovicRadak,  include=FALSE}
p_DT_A_M_pop_StamenkovicRadak <- ggplot(data = filter(droseu$dta,Supervisor.PI=="StamenkovicRadak" & Sex == "M"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_pop_StamenkovicRadak", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ geom_text(data = lmers_tukey$DT_A_M_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_M_pop_StamenkovicRadak
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_M_pop_StamenkovicRadak
invisible(dev.off())
```

##### Zwaan Lab

```{r}
lmers_anova$DT_A_F_Zwaan_lmer_pop
```

```{r}
lmers_sum$DT_A_F_Zwaan_lmer_pop
```

```{r}
lmers_anova$DT_A_M_Zwaan_lmer_pop
```

```{r}
lmers_sum$DT_A_M_Zwaan_lmer_pop
```

```{r p_DT_A_F_Zwaan,  include=FALSE}
p_DT_A_F_Zwaan <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Zwaan" & Sex == "F"),  aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_F_Zwaan
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Zwaan.pdf",width=8, height=5)
p_DT_A_F_Zwaan
invisible(dev.off())
```

```{r p_DT_A_F_pop_Zwaan,  include=FALSE}
p_DT_A_F_pop_Zwaan <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Zwaan" & Sex == "F"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_pop_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+geom_text(data = lmers_tukey$DT_A_F_Zwaan_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_F_pop_Zwaan
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Zwaan.pdf",width=8, height=5)
p_DT_A_F_pop_Zwaan
invisible(dev.off())
```

```{r p_DT_A_M_Zwaan,  include=FALSE}
p_DT_A_M_Zwaan <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Zwaan" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DT_A_M_Zwaan
```

```{r  include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Zwaan.pdf",width=8, height=5)
p_DT_A_M_Zwaan
invisible(dev.off())
```

```{r p_DT_A_M_pop_Zwaan,  include=FALSE}
p_DT_A_M_pop_Zwaan <- ggplot(data = filter(droseu$dta,Supervisor.PI=="Zwaan" & Sex == "M"), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_pop_Zwaan", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+geom_text(data = lmers_tukey$DT_A_M_Zwaan_lmer_pop$letters, aes(x = Population, label = cld), y=Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DT_A_M_pop_Zwaan
```

```{r include=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Zwaan.pdf",width=8, height=5)
p_DT_A_M_pop_Zwaan
dev.off
```

#### Linear Models / Residuals

##### Gibert Lab
_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Gibert_lmer_pop_qq_plot_residuals.png")
```


_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Gibert_lmer_pop_qq_plot_residuals.png")
```

##### Grath Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Grath_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Grath_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Grath_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Grath_lmer_pop_qq_plot_residuals.png")
```

##### Hoedjes Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Hoedjes_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Hoedjes_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Hoedjes_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Hoedjes_lmer_pop_qq_plot_residuals.png")
```

##### Schmidt Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Schmidt_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Schmidt_lmer_pop_qq_plot_residuals.png")
```

##### Stamenkovic-Radak Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

##### Zwaan Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Zwaan_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_F_Zwaan_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Zwaan_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DevelopmentTime/by_lab_models_residuals/DT_A_M_Zwaan_lmer_pop_qq_plot_residuals.png")
```

#### Lab correlations

```{r include=FALSE}
intersect_Line_DT_A  <- Reduce(intersect, list(droseu$dta$Line[droseu$dta$Supervisor.PI == "Gibert"],
                                          droseu$dta$Line[droseu$dta$Supervisor.PI == "Grath"],
                                          droseu$dta$Line[droseu$dta$Supervisor.PI == "Hoedjes"],
                                          droseu$dta$Line[droseu$dta$Supervisor.PI == "Schmidt"],
                                          droseu$dta$Line[droseu$dta$Supervisor.PI == "StamenkovicRadak"],
                                          droseu$dta$Line[droseu$dta$Supervisor.PI == "Zwaan"]))
write(intersect_Line_DT_A, file ="DevelopmentTime/intersect_Line_DT_A.txt", sep = "\t")

intersect_Pop_DT_A  <- Reduce(intersect, list(droseu$dta$Population[droseu$dta$Supervisor.PI == "Gibert"],
                                          droseu$dta$Population[droseu$dta$Supervisor.PI == "Grath"],
                                          droseu$dta$Population[droseu$dta$Supervisor.PI == "Hoedjes"],
                                          droseu$dta$Population[droseu$dta$Supervisor.PI == "Schmidt"],
                                          droseu$dta$Population[droseu$dta$Supervisor.PI == "StamenkovicRadak"],
                                          droseu$dta$Population[droseu$dta$Supervisor.PI == "Zwaan"]))
write(intersect_Pop_DT_A, file ="DevelopmentTime/intersect_Pop_DT_A.txt", sep = "\t")

```

There are `r length(intersect_Pop_DT_A) ` populations and `r length(intersect_Line_DT_A) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/DevelopmentTime/DT_A_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/DevelopmentTime/DT_A_M_lmer_lab_correlations.png")
```

## Dry weight

```{r include=FALSE}
dir.create(file.path("DryWeight"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Colinet Lab : Sapho-Lou Marti , Hervé Colinet

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Onder Lab : Seda Coskun, Senel Selin Senkal, Dogus Can, Banu Sebnem Onder

### Data Reformatting

```{r}
str(droseu$dw)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r table_DW_Line_wobatch, echo=FALSE}
DT::datatable(table_line_wbatch$DW, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$DW, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$DW, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$DW, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab

#### Overview 

```{r min_max_DW}
min_DW <- min(droseu$dw$DW_micrograms)
max_DW <- max(droseu$dw$DW_micrograms)
```

y-axis is scaled by the minimum (`r min_DW`) and maximum (`r max_DW`) values in the full data set. 

```{r p_DW_F_all, include=FALSE}
p_DW_F_all <- ggplot(data = filter(droseu$dw, Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_all", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_F_all
```

```{r include=FALSE}
pdf(file="DryWeight/p_DW_F_all.pdf",width=8, height=5)
p_DW_F_all
invisible(dev.off())
```

```{r p_DW_M_all, include=FALSE}
p_DW_M_all <- ggplot(data = filter(droseu$dw, Sex == "M"), aes(x=Population_Lat, y=DW_micrograms, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_all", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_M_all
```

```{r include=FALSE}
pdf(file="DryWeight/p_DW_M_all.pdf",width=8, height=5)
p_DW_M_all
invisible(dev.off())
```

#### Colinet Lab

```{r}
lmers_anova$DW_F_Colinet_lmer_pop
```

```{r}
lmers_sum$DW_F_Colinet_lmer_pop
```

```{r}
lmers_anova$DW_M_Colinet_lmer_pop
```

```{r}
lmers_sum$DW_M_Colinet_lmer_pop
```

```{r p_DW_F_Colinet, include=FALSE}
p_DW_F_Colinet <- ggplot(data = filter(droseu$dw,Supervisor.PI=="Colinet" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_F_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Colinet.pdf",width=8, height=5)
p_DW_F_Colinet
invisible(dev.off())
```


```{r p_DW_F_pop_Colinet, include=FALSE}
p_DW_F_pop_Colinet <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Colinet" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_F_Colinet_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_F_pop_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Colinet.pdf",width=8, height=5)
p_DW_F_pop_Colinet
invisible(dev.off())
```

```{r p_DW_M_Colinet, include=FALSE}
p_DW_M_Colinet <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Colinet" & Sex == "M"),aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_M_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Colinet.pdf",width=8, height=5)
p_DW_M_Colinet
invisible(dev.off())
```

```{r p_DW_M_pop_Colinet, include=FALSE}
p_DW_M_pop_Colinet <- ggplot(data = filter(droseu$dw,Supervisor.PI=="Colinet" & Sex == "M"), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_M_Colinet_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_M_pop_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Colinet.pdf",width=8, height=5)
p_DW_M_pop_Colinet
invisible(dev.off())
```

#### Hoedjes Lab 

```{r}
lmers_anova$DW_F_Hoedjes_lmer_pop
```

```{r}
lmers_sum$DW_F_Hoedjes_lmer_pop
```

```{r}
lmers_anova$DW_M_Hoedjes_lmer_pop
```

```{r}
lmers_sum$DW_M_Hoedjes_lmer_pop
```

```{r p_DW_F_Hoedjes, include=FALSE}
p_DW_F_Hoedjes <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Hoedjes" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_F_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Hoedjes.pdf",width=8, height=5)
p_DW_F_Hoedjes
invisible(dev.off())
```


```{r p_DW_F_pop_Hoedjes, include=FALSE}
p_DW_F_pop_Hoedjes <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Hoedjes" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_F_Hoedjes_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_F_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Hoedjes.pdf",width=8, height=5)
p_DW_F_pop_Hoedjes
invisible(dev.off())
```

```{r p_DW_M_Hoedjes, include=FALSE}
p_DW_M_Hoedjes <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Hoedjes" & Sex == "M"),aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Hoedjes", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_M_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Hoedjes.pdf",width=8, height=5)
p_DW_M_Hoedjes
invisible(dev.off())
```

```{r p_DW_M_pop_Hoedjes, include=FALSE}
p_DW_M_pop_Hoedjes <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Hoedjes" & Sex == "M"), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_M_Hoedjes_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_M_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Hoedjes.pdf",width=8, height=5)
p_DW_M_pop_Hoedjes
invisible(dev.off())
```

#### Onder Lab

```{r}
lmers_anova$DW_F_Onder_lmer_pop
```

```{r}
lmers_sum$DW_F_Onder_lmer_pop
```

```{r}
lmers_anova$DW_M_Onder_lmer_pop
```

```{r}
lmers_sum$DW_M_Onder_lmer_pop
```


```{r p_DW_F_Onder, include=FALSE}
p_DW_F_Onder <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Onder", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_F_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Onder.pdf",width=8, height=5)
p_DW_F_Onder
invisible(dev.off())
```


```{r p_DW_F_pop_Onder, include=FALSE}
p_DW_F_pop_Onder <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Onder", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_F_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_F_pop_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Onder.pdf",width=8, height=5)
p_DW_F_pop_Onder
invisible(dev.off())
```

```{r p_DW_M_Onder, include=FALSE}
p_DW_M_Onder <- ggplot(data = filter(droseu$dw, Supervisor.PI=="Onder" & Sex == "M"), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Onder", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_DW_M_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Onder.pdf",width=8, height=5)
p_DW_M_Onder
invisible(dev.off())
```

```{r p_DW_M_pop_Onder, include=FALSE}
p_DW_M_pop_Onder <- ggplot(data =  filter(droseu$dw, Supervisor.PI=="Onder" & Sex == "M"),aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Onder", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+geom_text(data = lmers_tukey$DW_M_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_DW_M_pop_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Onder.pdf",width=8, height=5)
p_DW_M_pop_Onder
invisible(dev.off())
```

### Linear Models / Residuals

#### Colinet Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Colinet_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Colinet_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Colinet_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Colinet_lmer_pop_qq_plot_residuals.png")
```

#### Hoedjes Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Hoedjes_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Hoedjes_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Hoedjes_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Hoedjes_lmer_pop_qq_plot_residuals.png")
```

#### Onder Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_F_Onder_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/DryWeight/by_lab_models_residuals/DW_M_Onder_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_DW, include=FALSE}
intersect_Line_DW  <- Reduce(intersect, list(droseu$dw$Line[droseu$dw$Supervisor.PI == "Colinet"],
                                        droseu$dw$Line[droseu$dw$Supervisor.PI == "Hoedjes"],
                                        droseu$dw$Line[droseu$dw$Supervisor.PI == "Onder"]))

write(intersect_Line_DW, file ="DryWeight/intersect_Line_DW.txt", sep = "\t")

intersect_Pop_DW  <- Reduce(intersect, list(droseu$dw$Population[droseu$dw$Supervisor.PI == "Colinet"],
                                        droseu$dw$Population[droseu$dw$Supervisor.PI == "Hoedjes"],
                                        droseu$dw$Population[droseu$dw$Supervisor.PI == "Onder"]))

write(intersect_Pop_DW, file ="DryWeight/intersect_Pop_DW.txt", sep = "\t")

```

There are `r length(intersect_Pop_DW) ` populations and `r length(intersect_Line_DW) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/DryWeight/DW_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/DryWeight/DW_M_lmer_lab_correlations.png")
```

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some sometimes
```

## Thorax length

```{r include=FALSE}
dir.create(file.path("ThoraxLength"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Kozeretska Lab : Svitlana Serga, Alexandra Protsenko, Oleksandr Maistrenko, Iryna Kozeretska

Posnien Lab : Micael Reis, Lennart Hüper

Ritchie Lab : Megan Mcgunnigle, Nicola  Cook, Teresa Abaurrea, Michael Ritchie

Schmidt Lab : Amy Goldfischer, Paul Schmidt

### Data Reformatting

```{r}
str(droseu$tl)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$TL, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$TL, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$TL, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$TL, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_TL <- min(droseu$tl$TL_micrometers)
max_TL <- max(droseu$tl$TL_micrometers)
```

y-axis is scaled by the minimum (`r min_TL`) and maximum (`r max_TL`) values in the full data set. 

```{r p_TL_F, echo=FALSE}
p_TL_F <- ggplot(data = filter(droseu$tl, Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_F
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F.pdf",width=8, height=5)
p_TL_F 
invisible(dev.off())
```

```{r p_TL_M, echo=FALSE}
p_TL_M <- ggplot(data = filter(droseu$tl, Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_M
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M.pdf",width=8, height=5)
p_TL_M
invisible(dev.off())
```

#### Kozeretska Lab

```{r}
lmers_anova$TL_F_Kozeretska_lmer_pop
```

```{r}
lmers_sum$TL_F_Kozeretska_lmer_pop
```

```{r}
lmers_anova$TL_M_Kozeretska_lmer_pop
```

```{r}
lmers_sum$TL_M_Kozeretska_lmer_pop
```

```{r p_TL_F_Kozeretska, echo=FALSE}
p_TL_F_Kozeretska <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Kozeretska" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_F_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Kozeretska.pdf",width=8, height=5)
p_TL_F_Kozeretska
invisible(dev.off())
```

```{r p_TL_F_pop_Kozeretska, echo=FALSE}
p_TL_F_pop_Kozeretska <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Kozeretska" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_F_Kozeretska_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_F_pop_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Kozeretska.pdf",width=8, height=5)
p_TL_F_pop_Kozeretska
invisible(dev.off())
```

```{r p_TL_M_Kozeretska, echo=FALSE}
p_TL_M_Kozeretska <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Kozeretska" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_M_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Kozeretska.pdf",width=8, height=5)
p_TL_M_Kozeretska
invisible(dev.off())
```

```{r p_TL_M_pop_Kozeretska, include=FALSE}
p_TL_M_pop_Kozeretska <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Kozeretska" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+geom_text(data = lmers_tukey$TL_M_Kozeretska_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1)+ droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_M_pop_Kozeretska
```

```{r include=FALSE}
pdf(file="ThoraxLength/p_TL_M_pop_Kozeretska.pdf",width=8, height=5)
p_TL_M_pop_Kozeretska
invisible(dev.off())
```

#### Posnien Lab 

```{r}
lmers_anova$TL_F_Posnien_lmer_pop
```

```{r}
lmers_sum$TL_F_Posnien_lmer_pop
```

```{r}
lmers_anova$TL_M_Posnien_lmer_pop
```

```{r}
lmers_sum$TL_M_Posnien_lmer_pop
```

```{r p_TL_F_Posnien, echo=FALSE}
p_TL_F_Posnien <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Posnien", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_F_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Posnien.pdf",width=8, height=5)
p_TL_F_Posnien
invisible(dev.off())
```

```{r p_TL_F_pop_Posnien, echo=FALSE}
p_TL_F_pop_Posnien <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Posnien", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_F_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_F_pop_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Posnien.pdf",width=8, height=5)
p_TL_F_pop_Posnien
invisible(dev.off())
```

```{r p_TL_M_Posnien, echo=FALSE}
p_TL_M_Posnien <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Posnien", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_M_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Posnien.pdf",width=8, height=5)
p_TL_M_Posnien
invisible(dev.off())
```

```{r p_TL_M_pop_Posnien, echo=FALSE}
p_TL_M_pop_Posnien <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Posnien", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_M_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_M_pop_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_pop_Posnien.pdf",width=8, height=5)
p_TL_M_pop_Posnien
invisible(dev.off())
```

#### Ritchie Lab

```{r}
lmers_anova$TL_F_Ritchie_lmer_pop
```

```{r}
lmers_sum$TL_F_Ritchie_lmer_pop
```

```{r}
lmers_anova$TL_M_Ritchie_lmer_pop
```

```{r}
lmers_sum$TL_M_Ritchie_lmer_pop
```

```{r p_TL_F_Ritchie, echo=FALSE}
p_TL_F_Ritchie <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Ritchie" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Ritchie", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_F_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Ritchie.pdf",width=8, height=5)
p_TL_F_Ritchie
invisible(dev.off())
```

```{r p_TL_F_pop_Ritchie, echo=FALSE}
p_TL_F_pop_Ritchie <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Ritchie" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_TL_F_pop_Ritchie", x="Population", y = "TL_micrometers") + coord_cartesian(ylim =c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_F_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1)+ droseu_theme + colScale
invisible(dev.off())
```

```{r echo=FALSE}
p_TL_F_pop_Ritchie 
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Ritchie.pdf",width=8, height=5)
p_TL_F_pop_Ritchie
invisible(dev.off())
```

```{r p_TL_M_Ritchie, echo=FALSE}
p_TL_M_Ritchie <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Ritchie", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_M_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Ritchie.pdf",width=8, height=5)
p_TL_M_Ritchie
invisible(dev.off())
```

```{r p_TL_M_pop_Ritchie, echo=FALSE}
p_TL_M_pop_Ritchie <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Ritchie", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_M_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_M_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Ritchie.pdf",width=8, height=5)
p_TL_M_pop_Ritchie
invisible(dev.off())
```

#### Schmidt Lab

```{r}
lmers_anova$TL_F_Schmidt_lmer_pop
```

```{r}
lmers_sum$TL_F_Schmidt_lmer_pop
```

```{r p_TL_F_Schmidt, echo=FALSE}
p_TL_F_Schmidt <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Schmidt" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Schmidt", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_TL_F_Schmidt
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Schmidt.pdf",width=8, height=5)
p_TL_F_Schmidt
invisible(dev.off())
```

```{r p_TL_F_pop_Schmidt, echo=FALSE}
p_TL_F_pop_Schmidt <- ggplot(data = filter(droseu$tl,Supervisor.PI=="Schmidt" & Sex == "F"), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Schmidt", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ geom_text(data = lmers_tukey$TL_F_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_TL_F_pop_Schmidt
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Schmidt.pdf",width=8, height=5)
p_TL_F_pop_Schmidt
invisible(dev.off())
```

### Linear Models / Residuals

#### Kozeretska Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Kozeretska_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Kozeretska_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Kozeretska_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Kozeretska_lmer_pop_qq_plot_residuals.png")
```

#### Posnien Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Posnien_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Posnien_lmer_pop_qq_plot_residuals.png")
```

#### Ritchie Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Ritchie_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_M_Ritchie_lmer_pop_qq_plot_residuals.png")
```

#### Schmidt Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ThoraxLength/by_lab_models_residuals/TL_F_Schmidt_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_TL, echo=FALSE}
intersect_Line_TL  <- Reduce(intersect, list(droseu$tl$Line[droseu$tl$Supervisor.PI == "Kozeretska"],
                                        droseu$tl$Line[droseu$tl$Supervisor.PI == "Posnien"],
                                        droseu$tl$Line[droseu$tl$Supervisor.PI == "Ritchie"],
                                        droseu$tl$Line[droseu$tl$Supervisor.PI == "Schmidt"]))

write(intersect_Line_TL, file ="ThoraxLength/intersect_Line_TL.txt", sep = "\t")

intersect_Pop_TL  <- Reduce(intersect, list(droseu$tl$Population[droseu$tl$Supervisor.PI == "Kozeretska"],
                                        droseu$tl$Population[droseu$tl$Supervisor.PI == "Posnien"],
                                        droseu$tl$Population[droseu$tl$Supervisor.PI == "Ritchie"],
                                        droseu$tl$Population[droseu$tl$Supervisor.PI == "Schmidt"]))

write(intersect_Pop_TL, file ="ThoraxLength/intersect_Pop_TL.txt", sep = "\t")
```

There are `r length(intersect_Line_TL) ` populations and `r length(intersect_Pop_TL) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/ThoraxLength/TL_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/ThoraxLength/TL_M_lmer_lab_correlations.png")
```

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some sometimes
```

## Wing area

```{r include=FALSE}
dir.create(file.path("WingArea"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Onder Lab : Cansu Aksoy, Ekin Demir, Ezgi Cobanoglu, Banu Sebnem Onder

Posnien Lab : Micael Reis, Lennart Hüper, Nico Posnien

Ritchie Lab : Megan Mcgunnigle, Nicola  Cook, Teresa Abaurrea, Marija Tanaskovic, Michael Ritchie

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Filip Filopovski, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

### Data Reformatting

```{r d_WA}
str(droseu$wa)
```

### _Left_

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some sometimes
```


### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$WA_Left, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$WA_Left, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$WA_Left, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$WA_Left, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}

min_WAL <- min(droseu$wa$CentroidSizeLeft_micrometers)
max_WAL <- max(droseu$wa$CentroidSizeLeft_micrometers)

```

y-axis is scaled by the minimum (`r min_WAL`) and maximum (`r max_WAL`) values in the full data set. 

```{r p_WA_F_L, echo=FALSE}
p_WA_F_L <- ggplot(data = filter(droseu$wa, Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_L
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L.pdf",width=8, height=5)
p_WA_F_L
invisible(dev.off())
```

```{r p_WA_M_L, echo=FALSE}
p_WA_M_L <- ggplot(data = filter(droseu$wa, Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_L 
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L.pdf",width=8, height=5)
p_WA_M_L
invisible(dev.off())
```

#### Onder Lab

```{r}
lmers_anova$WA_L_F_Onder_lmer_pop
```

```{r}
lmers_sum$WA_L_F_Onder_lmer_pop
```

```{r}
lmers_anova$WA_L_M_Onder_lmer_pop
```

```{r}
lmers_sum$WA_L_M_Onder_lmer_pop
```

```{r p_WA_F_L_Onder, echo=FALSE}
p_WA_F_L_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_Onder_L", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_L_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_Onder_L.pdf",width=8, height=5)
p_WA_F_L_Onder
invisible(dev.off())
```

```{r p_WA_F_L_pop_Onder, echo=FALSE}
p_WA_F_L_pop_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Onder", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_F_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_L_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Onder.pdf",width=8, height=5)
p_WA_F_L_pop_Onder
invisible(dev.off())
```

```{r p_WA_M_L_Onder, echo=FALSE}
p_WA_M_L_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_Onder_L", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_L_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_Onder_L.pdf",width=8, height=5)
p_WA_M_L_Onder
invisible(dev.off())
```

```{r p_WA_M_L_pop_Onder, echo=FALSE}
p_WA_M_L_pop_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Onder", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_M_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_L_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Onder.pdf",width=8, height=5)
p_WA_M_L_pop_Onder
invisible(dev.off())
```

#### Posnien Lab 

```{r}
lmers_anova$WA_L_F_Posnien_lmer_pop
```

```{r}
lmers_sum$WA_L_F_Posnien_lmer_pop
```

```{r}
lmers_anova$WA_L_M_Posnien_lmer_pop
```

```{r}
lmers_sum$WA_L_M_Posnien_lmer_pop
```

```{r p_WA_F_L_Posnien, echo=FALSE}

p_WA_F_L_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_Posnien", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_L_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_Posnien.pdf",width=8, height=5)
p_WA_F_L_Posnien
invisible(dev.off())
```

```{r p_WA_F_L_pop_Posnien, echo=FALSE}
p_WA_F_L_pop_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Posnien", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_F_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_L_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Posnien.pdf",width=8, height=5)
p_WA_F_L_pop_Posnien
invisible(dev.off())
```

```{r p_WA_M_L_Posnien, echo=FALSE}
p_WA_M_L_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_Posnien", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_L_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_Posnien.pdf",width=8, height=5)
p_WA_M_L_Posnien
invisible(dev.off())
```

```{r p_WA_M_L_pop_Posnien, echo=FALSE}
p_WA_M_L_pop_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Posnien", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_M_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_L_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Posnien.pdf",width=8, height=5)
p_WA_M_L_pop_Posnien
invisible(dev.off())
```

#### Ritchie Lab

```{r}
lmers_anova$WA_L_F_Ritchie_lmer_pop
```

```{r}
lmers_sum$WA_L_F_Ritchie_lmer_pop
```

```{r}
lmers_anova$WA_L_M_Ritchie_lmer_pop
```

```{r}
lmers_sum$WA_L_M_Ritchie_lmer_pop
```

```{r p_WA_F_L_Ritchie, echo=FALSE}
p_WA_F_L_Ritchie <- ggplot(data =  filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "F"),  aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_L_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_Ritchie.pdf",width=8, height=5)
p_WA_F_L_Ritchie
invisible(dev.off())
```

```{r p_WA_F_L_pop_Ritchie, echo=FALSE}
p_WA_F_L_pop_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_F_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
  droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_L_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Ritchie.pdf",width=8, height=5)
p_WA_F_L_pop_Ritchie
invisible(dev.off())
```

```{r p_WA_M_L_Ritchie, echo=FALSE}
p_WA_M_L_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) + 
  labs(title="p_WA_M_L_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_L_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_Ritchie.pdf",width=8, height=5)
p_WA_M_L_Ritchie
invisible(dev.off())
```

```{r p_WA_M_L_pop_Ritchie, echo=FALSE}
p_WA_M_L_pop_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_M_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
  droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_L_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Ritchie.pdf",width=8, height=5)
p_WA_M_L_pop_Ritchie
invisible(dev.off())
```

#### Stamenkovic-Radak Lab

```{r}
lmers_anova$WA_L_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$WA_L_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_anova$WA_L_M_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$WA_L_M_StamenkovicRadak_lmer_pop
```

```{r p_WA_F_L_StamenkovicRadak, echo=FALSE}
p_WA_F_L_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_L_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_L_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_F_L_pop_StamenkovicRadak,echo=FALSE}
p_WA_F_L_pop_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_F_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_L_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_L_pop_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_M_L_StamenkovicRadak, echo=FALSE}
p_WA_M_L_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "M"),  aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_L_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_L_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_M_L_pop_StamenkovicRadak, echo=FALSE}
p_WA_M_L_pop_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_L_M_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_L_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_L_pop_StamenkovicRadak
invisible(dev.off())
```

### _Right_

### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$WA_Right, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$WA_Right, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$WA_Right, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$WA_Right, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_WAR <- min(droseu$wa$CentroidSizeRight_micrometers)
max_WAR <- max(droseu$wa$CentroidSizeRight_micrometers)
```

```{r p_WA_F_R, echo=FALSE}
p_WA_F_R <- ggplot(data = filter(droseu$wa, Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_R
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R.pdf",width=8, height=5)
p_WA_F_R
invisible(dev.off())
```

```{r p_WA_M_R, echo=FALSE}
p_WA_M_R <- ggplot(data = filter(droseu$wa, Sex == "M"),  aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_R
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R.pdf",width=8, height=5)
p_WA_M_R
invisible(dev.off())
```

#### Onder Lab

```{r include=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some 
```

```{r}
lmers_anova$WA_R_F_Onder_lmer_pop
```

```{r}
lmers_sum$WA_R_F_Onder_lmer_pop
```

```{r}
lmers_anova$WA_R_M_Onder_lmer_pop
```

```{r}
lmers_sum$WA_R_M_Onder_lmer_pop
```

```{r p_WA_F_R_Onder, echo=FALSE}
p_WA_F_R_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_Onder_R", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_R_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Onder.pdf",width=8, height=5)
p_WA_F_R_Onder
invisible(dev.off())
```

```{r p_WA_F_R_pop_Onder, echo=FALSE}
p_WA_F_R_pop_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR)) + geom_text(data = lmers_tukey$WA_R_F_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_R_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Onder.pdf",width=8, height=5)
p_WA_F_R_pop_Onder
invisible(dev.off())
```

```{r p_WA_M_R_Onder, echo=FALSE}
p_WA_M_R_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_R_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Onder.pdf",width=8, height=5)
p_WA_M_R_Onder
invisible(dev.off())
```

```{r p_WA_M_R_pop_Onder, echo=FALSE}
p_WA_M_R_pop_Onder <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Onder" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR)) + geom_text(data = lmers_tukey$WA_R_M_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_R_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_Onder.pdf",width=8, height=5)
p_WA_M_R_pop_Onder
invisible(dev.off())
```

#### Posnien Lab 

```{r}
lmers_anova$WA_R_F_Posnien_lmer_pop
```

```{r}
lmers_sum$WA_R_F_Posnien_lmer_pop
```

```{r}
lmers_anova$WA_R_M_Posnien_lmer_pop
```

```{r}
lmers_sum$WA_R_M_Posnien_lmer_pop
```

```{r p_WA_F_R_Posnien, echo=FALSE}
p_WA_F_R_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_R_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Posnien.pdf",width=8, height=5)
p_WA_F_R_Posnien
invisible(dev.off())
```

```{r p_WA_F_R_pop_Posnien, echo=FALSE}
p_WA_F_R_pop_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR)) + geom_text(data = lmers_tukey$WA_R_F_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_R_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Posnien.pdf",width=8, height=5)
p_WA_F_R_pop_Posnien
invisible(dev.off())
```

```{r p_WA_M_R_Posnien, echo=FALSE}
p_WA_M_R_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_R_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Posnien.pdf",width=8, height=5)
p_WA_M_R_Posnien
invisible(dev.off())
```

```{r p_WA_M_R_pop_Posnien, echo=FALSE}
p_WA_M_R_pop_Posnien <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Posnien" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR)) + geom_text(data = lmers_tukey$WA_R_M_Posnien_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_R_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_Posnien.pdf",width=8, height=5)
p_WA_M_R_pop_Posnien
invisible(dev.off())
```

#### Ritchie Lab

```{r}
lmers_anova$WA_R_F_Ritchie_lmer_pop
```

```{r}
lmers_sum$WA_R_F_Ritchie_lmer_pop
```

```{r}
lmers_anova$WA_R_M_Ritchie_lmer_pop
```

```{r}
lmers_sum$WA_R_M_Ritchie_lmer_pop
```

```{r p_WA_F_R_Ritchie, echo=FALSE}
p_WA_F_R_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_F_R_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Ritchie.pdf",width=8, height=5)
p_WA_F_R_Ritchie
invisible(dev.off())
```

```{r p_WA_F_R_pop_Ritchie, echo=FALSE}
p_WA_F_R_pop_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ geom_text(data = lmers_tukey$WA_R_F_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_R_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Ritchie.pdf",width=8, height=5)
p_WA_F_R_pop_Ritchie
invisible(dev.off())
```

```{r p_WA_M_R_Ritchie, echo=FALSE}
p_WA_M_R_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_R_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Ritchie.pdf",width=8, height=5)
p_WA_M_R_Ritchie
invisible(dev.off())
```

```{r p_WA_M_R_pop_Ritchie, echo=FALSE}
p_WA_M_R_pop_Ritchie <- ggplot(data = filter(droseu$wa, Supervisor.PI=="Ritchie" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ geom_text(data = lmers_tukey$WA_R_M_Ritchie_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_R_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_Ritchie.pdf",width=8, height=5)
p_WA_M_R_pop_Ritchie
invisible(dev.off())
```

#### Stamenkovic-Radak Lab

```{r}
lmers_anova$WA_R_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$WA_R_F_StamenkovicRadak_lmer_pop
```

```{r}
lmers_anova$WA_R_M_StamenkovicRadak_lmer_pop
```

```{r}
lmers_sum$WA_R_M_StamenkovicRadak_lmer_pop
```

```{r p_WA_F_R_StamenkovicRadak, echo=FALSE}
p_WA_F_R_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```


```{r echo=FALSE}
p_WA_F_R_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_R_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_F_R_pop_StamenkovicRadak, echo=FALSE}
p_WA_F_R_pop_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "F"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_R_F_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_F_R_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_R_pop_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_M_R_StamenkovicRadak, echo=FALSE}
p_WA_M_R_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR)) +droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_WA_M_R_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_R_StamenkovicRadak
invisible(dev.off())
```

```{r p_WA_M_R_pop_StamenkovicRadak, echo=FALSE}
p_WA_M_R_pop_StamenkovicRadak <- ggplot(data = filter(droseu$wa, Supervisor.PI=="StamenkovicRadak" & Sex == "M"), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAL, max_WAL))+ geom_text(data = lmers_tukey$WA_R_M_StamenkovicRadak_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_WA_M_R_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_R_pop_StamenkovicRadak
invisible(dev.off())
```

### Linear Models / Residuals (Left)

#### Onder Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Onder_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Onder_lmer_pop_qq_plot_residuals.png")
```

#### Posnien Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Posnien_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Posnien_lmer_pop_qq_plot_residuals.png")
```

#### Ritchie Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_Ritchie_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_Ritchie_lmer_pop_qq_plot_residuals.png")
```

#### Stamenkovic-Radak Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_F_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_L_M_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

### Linear Models / Residuals (Right)

#### Onder Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Onder_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Onder_lmer_pop_qq_plot_residuals.png")
```

#### Posnien Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Posnien_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Posnien_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Posnien_lmer_pop_qq_plot_residuals.png")
```

#### Ritchie Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_Ritchie_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Ritchie_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_Ritchie_lmer_pop_qq_plot_residuals.png")
```

#### Stamenkovic-Radak Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_F_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_StamenkovicRadak_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/WingArea/by_lab_models_residuals/WA_R_M_StamenkovicRadak_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intesect_WA, echo=FALSE}
intersect_Line_WA  <- Reduce(intersect, list(droseu$wa$Line[droseu$wa$Supervisor.PI == "Onder"],
                                          droseu$wa$Line[droseu$wa$Supervisor.PI == "Posnien"],
                                          droseu$wa$Line[droseu$wa$Supervisor.PI == "Ritchie"],
                                          droseu$wa$Line[droseu$wa$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Line_WA, file ="WingArea/intersect_Line_WA.txt", sep = "\t")

intersect_Pop_WA  <- Reduce(intersect, list(droseu$wa$Population[droseu$wa$Supervisor.PI == "Onder"],
                                          droseu$wa$Population[droseu$wa$Supervisor.PI == "Posnien"],
                                          droseu$wa$Population[droseu$wa$Supervisor.PI == "Ritchie"],
                                          droseu$wa$Population[droseu$wa$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Pop_WA, file ="WingArea/intersect_Pop_WA_F.txt", sep = "\t")

```

There are `r length(intersect_Pop_WA) ` populations and `r length(intersect_Line_WA) ` isofemale lines have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

### _Left_

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/WingArea/WA_L_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/WingArea/WA_L_M_lmer_lab_correlations.png")
```

### _Right_

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/WingArea/WA_R_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/WingArea/WA_R_M_lmer_lab_correlations.png")
```

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some sometimes
```

## Fecundity

```{r include=FALSE}
dir.create(file.path("Fecundity"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r}
#Note that the trait has been phenotyped only in females.
```

### Contributors  

Billeter Lab : Xiaocui Wang, Tiphaine Bailly, Mario Mira, Jean-Christophe Billeter

Fricke Lab : Claudia Fricke

### Data Reformatting

```{r d_Fec}
str(droseu$fec)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r tables_fec, echo=FALSE}
DT::datatable(table_line_wbatch$Fec, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics for fecundity at the line level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$Fec, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$Fec, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$Fec, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r echo=TRUE}
min_Fec <- min(droseu$fec$NumberOfAdultsEclosed)
max_Fec <- max(droseu$fec$NumberOfAdultsEclosed)
```

y-axis is scaled by the minimum (`r min_Fec`) and maximum (`r max_Fec`) values in the full data set. 

```{r p_Fec_all, echo=FALSE}
p_Fec_all <- ggplot(data = droseu$fec, aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Fec_all", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Fec_all
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_all.pdf",width=8, height=5)
p_Fec_all
invisible(dev.off())
```

#### Billeter Lab

```{r}
lmers_anova$Fec_Billeter_lmer_pop
```

```{r}
lmers_sum$Fec_Billeter_lmer_pop
```

```{r p_Fec_Billeter, echo=FALSE}
p_Fec_Billeter <- ggplot(data = filter(droseu$fec, Supervisor.PI=="Billeter"), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Batch)) +  geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_Billeter", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Fec_Billeter
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_Billeter.pdf",width=8, height=5)
p_Fec_Billeter
invisible(dev.off())
```

```{r p_Fec_pop_Billeter, echo=FALSE}
p_Fec_pop_Billeter <- ggplot(data = filter(droseu$fec, Supervisor.PI=="Billeter"), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_pop_Billeter", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+geom_text(data = lmers_tukey$Fec_Billeter_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Fec_pop_Billeter
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_pop_Billeter.pdf",width=8, height=5)
p_Fec_pop_Billeter
invisible(dev.off())
```

#### Fricke Lab 

```{r}
lmers_anova$Fec_Fricke_lmer_pop
```

```{r}
lmers_sum$Fec_Fricke_lmer_pop
```

```{r p_Fec_Fricke, echo=FALSE, message=FALSE, warning=FALSE}
p_Fec_Fricke <- ggplot(data = filter(droseu$fec, Supervisor.PI=="Fricke"), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_Fricke", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Fec_Fricke
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_Fricke.pdf",width=8, height=5)
p_Fec_Fricke
invisible(dev.off())
```

```{r p_Fec_pop_Fricke, echo=FALSE}
p_Fec_pop_Fricke <- ggplot(data = filter(droseu$fec, Supervisor.PI=="Fricke"), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_pop_Fricke", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ geom_text(data = lmers_tukey$Fec_Fricke_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Fec_pop_Fricke
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_pop_Fricke.pdf",width=8, height=5)
p_Fec_pop_Fricke
invisible(dev.off())
```

### Linear Models / Residuals

#### Billeter Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Fecundity/by_lab_models_residuals/Fec_Billeter_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Fecundity/by_lab_models_residuals/Fec_Billeter_lmer_pop_qq_plot_residuals.png")
```

#### Fricke Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Fecundity/by_lab_models_residuals/Fec_Fricke_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Fecundity/by_lab_models_residuals/Fec_Fricke_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_Fec, echo=FALSE}
intersect_Line_Fec <- intersect(droseu$fec$Line[droseu$fec$Supervisor.PI == "Billeter"], 
                           droseu$fec$Line[droseu$fec$Supervisor.PI == "Fricke"])
write(intersect_Line_Fec, file ="Fecundity/intersect_Line_Fec.txt", sep = "\t")


intersect_Pop_Fec <- intersect(droseu$fec$Population[droseu$fec$Supervisor.PI == "Billeter"], 
                           droseu$fec$Population[droseu$fec$Supervisor.PI == "Fricke"])
write(intersect_Pop_Fec, file ="Fecundity/intersect_Pop_Fec.txt", sep = "\t")


```

There are `r length(intersect_Pop_Fec) ` populations and `r length(intersect_Line_Fec) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Fecundity/Fec_F_lmer_lab_correlations.png")
```

## Lifespan

```{r echo=FALSE}
dir.create(file.path("Lifespan"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some 
```

### Contributors  

Flatt Lab : Esra Durmaz, Envel Kerdaffrec, Thibault Schowing, Virginie Thieu, Marisa Rodrigues, Thomas Flatt

Parsch Lab : Amanda Glaser-Schmitt, Eliza Argyridou, John Parsch

Pasyukova Lab : Natalia Roshina, Alexander Symonenko, Mikhail Trostnikov, Evgenia Tsybul'ko, Ekaterina Veselkina, Olga Rybina, Elena Pasyukova

### Data Reformatting

```{r}
str(droseu$lsl)
```

```{r}
str(droseu$lsp)
```

```{r}
str(droseu$lsm)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :

```{r tbales_ls, echo=FALSE}
DT::datatable(table_line_wbatch$LS_L, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :

```{r, echo=FALSE}
DT::datatable(table_line_wobatch$LS_L, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$LS_M, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$LS_M, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_LS <- min(droseu$lsm$LSM_AgeAtDeath_days)
max_LS <- max(droseu$lsm$LSM_AgeAtDeath_days)
```

y-axis is scaled by the minimum (`r min_LS`) and maximum (`r max_LS`) values in the full data set.

```{r p_LS_F, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F <- ggplot(data = filter(droseu$lsm, Sex == "F"), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Supervisor.PI)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_F
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F.pdf",width=8, height=5)
p_LS_F
invisible(dev.off())
```

```{r p_LS_M, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M <- ggplot(data = filter(droseu$lsm, Sex == "M"), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Supervisor.PI)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_M
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M.pdf",width=8, height=5)
p_LS_M
invisible(dev.off())
```

#### Flatt Lab

```{r}
lmers_anova$LS_F_Flatt_lmer_pop
```

```{r}
lmers_sum$LS_F_Flatt_lmer_pop
```

```{r}
lmers_anova$LS_M_Flatt_lmer_pop
```

```{r}
lmers_sum$LS_M_Flatt_lmer_pop
```

```{r p_LS_F_Flatt, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F_Flatt <- ggplot(data = filter(droseu$lsp, Censor == "0" & Sex == "F" & Supervisor.PI == "Flatt"), aes(x=Population_Lat, y=LSP_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Flatt", x="Population", y = "LSP_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ geom_text(data = lmers_tukey$LS_F_Flatt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_F_Flatt
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Flatt.pdf",width=8, height=5)
p_LS_F_Flatt
invisible(dev.off())
```

```{r p_LS_M_Flatt, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M_Flatt <- ggplot(data = filter(droseu$lsp, Censor == "0" & Sex == "M" & Supervisor.PI == "Flatt"), aes(x=Population_Lat, y=LSP_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Flatt", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ geom_text(data = lmers_tukey$LS_M_Flatt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_M_Flatt
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Flatt.pdf",width=8, height=5)
p_LS_M_Flatt
invisible(dev.off())
```

#### Parsch Lab 

```{r}
lmers_anova$LS_F_Parsch_lmer_pop
```

```{r}
lmers_sum$LS_F_Parsch_lmer_pop
```

```{r}
lmers_anova$LS_M_Parsch_lmer_pop
```

```{r}
lmers_sum$LS_M_Parsch_lmer_pop
```

```{r p_LS_F_Parsch, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F_Parsch <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "F" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Parsch", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_F_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Parsch.pdf",width=8, height=5)
p_LS_F_Parsch
invisible(dev.off())
```

```{r p_LS_F_pop_Parsch, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F_pop_Parsch <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "F" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_pop_Parsch", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ 
geom_text(data = lmers_tukey$LS_F_Parsch_lmer_pop$letters, aes(x = Population, label = cld), y = max_LS,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_F_pop_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_pop_Parsch.pdf",width=8, height=5)
p_LS_F_pop_Parsch
invisible(dev.off())
```

```{r p_LS_M_Parsch, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M_Parsch <- ggplot(data =  filter(droseu$lsl, Censor == "0" & Sex == "M" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Parsch", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_M_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Parsch.pdf",width=8, height=5)
p_LS_M_Parsch
invisible(dev.off())
```

```{r p_LS_M_pop_Parsch, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M_pop_Parsch <- ggplot(data =  filter(droseu$lsl, Censor == "0" & Sex == "M" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_pop_Parsch", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ geom_text(data = lmers_tukey$LS_M_Parsch_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_M_pop_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_pop_Parsch.pdf",width=8, height=5)
p_LS_M_pop_Parsch
invisible(dev.off())
```

#### Pasyukova Lab

```{r}
lmers_anova$LS_F_Pasyukova_lmer_pop
```

```{r}
lmers_sum$LS_F_Pasyukova_lmer_pop
```

```{r}
lmers_anova$LS_M_Pasyukova_lmer_pop
```

```{r}
lmers_sum$LS_M_Pasyukova_lmer_pop
```

```{r p_LS_F_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F_Pasyukova <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "F" & Supervisor.PI == "Pasyukova"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Pasyukova", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_F_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Pasyukova.pdf",width=8, height=5)
p_LS_F_Pasyukova
invisible(dev.off())
```

```{r p_LS_F_pop_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_F_pop_Pasyukova <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "F" & Supervisor.PI == "Pasyukova"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_pop_Pasyukova", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ 
geom_text(data = lmers_tukey$LS_F_Pasyukova_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_F_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_pop_Pasyukova.pdf",width=8, height=5)
p_LS_F_pop_Pasyukova
invisible(dev.off())
```

```{r p_LS_M_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M_Pasyukova <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "M" & Supervisor.PI == "Pasyukova"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Pasyukova", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_LS_M_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Pasyukova.pdf",width=8, height=5)
p_LS_M_Pasyukova
invisible(dev.off())
```

```{r p_LS_M_pop_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}
p_LS_M_pop_Pasyukova <- ggplot(data = filter(droseu$lsl, Censor == "0" & Sex == "M" & Supervisor.PI == "Pasyukova"), aes(x=Population_Lat, y=LSL_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_pop_Pasyukova", x="Population", y = "LSL_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+  geom_text(data = lmers_tukey$LS_M_Pasyukova_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_LS_M_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_pop_Pasyukova.pdf",width=8, height=5)
p_LS_M_pop_Pasyukova
invisible(dev.off())
```

### Survival Analyses

#### Flatt Lab

_Females_
```{r}
coxme_anova$LS_P_F_Flatt_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_F_Flatt_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$LS_P_M_Flatt_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_M_Flatt_survival_curves.pdf")
```

#### Parsch Lab

_Females_

```{r}
coxme_anova$LS_L_F_Parsch_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_F_Parsch_survival_curves.pdf")
```

_Males_

```{r}
coxme_anova$LS_L_M_Parsch_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_M_Parsch_survival_curves.pdf")
```

#### Pasyukova Lab

_Females_
```{r}
coxme_anova$LS_L_F_Pasyukova_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_F_Pasyukova_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$LS_L_M_Pasyukova_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Lifespan/p_LS_M_Pasyukova_survival_curves.pdf")
```

### Linear Models / Residuals

#### Flatt Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Flatt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Flatt_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Flatt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Flatt_lmer_pop_qq_plot_residuals.png")
```

#### Parsch Lab
_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Parsch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Parsch_lmer_pop_qq_plot_residuals.png")
```

_Males_

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Parsch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Parsch_lmer_pop_qq_plot_residuals.png")
```

#### Pasyukova Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Pasyukova_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_F_Pasyukova_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Pasyukova_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Lifespan/by_lab_models_residuals/LS_M_Pasyukova_lmer_pop_qq_plot_residuals.png")
```


### Lab correlations

```{r intersect_LS, echo=FALSE}
intersect_Line_LS <- intersect(droseu$lsl$Line[droseu$lsl$Supervisor.PI == "Parsch"], 
                           droseu$lsl$Line[droseu$lsl$Supervisor.PI == "Pasyukova"])

write(intersect_Line_LS, file ="Lifespan/intersect_Line_LS", sep = "\t")

intersect_Pop_LS <- Reduce(intersect, list(droseu$lsm$Population[droseu$lsm$Supervisor.PI == "Parsch"],
                              droseu$lsm$Population[droseu$lsm$Supervisor.PI == "Flatt"],
                           droseu$lsm$Population[droseu$lsm$Supervisor.PI == "Pasyukova"]))

write(intersect_Pop_LS, file ="Lifespan/intersect_Pop_LS", sep = "\t")

```

There are `r length(intersect_Pop_LS) ` populations and `r length(intersect_Line_LS) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Lifespan/LS_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Lifespan/LS_M_lmer_lab_correlations.png")
```

## Cold-shock mortality

```{r echo=FALSE}
dir.create(file.path("ColdShock"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Gonzalez Lab : Llewellyn Green, Josefa Gonzalez, Miriam Merenciano

Kozeretska Lab : Svitlana Serga, Alexandra Protsenko, Oleksandr Maistrenko, Iryna Kozeretska

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias


### Data Reformatting

```{r}
str(droseu$csm)
```

### Descriptive Statistics


Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$CSM, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$CSM, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$CSM, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$CSM, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r min_max_CSM, echo=TRUE}
min_CSM <- min(droseu$csm$CSM_PropDead_ED)
max_CSM <- max(droseu$csm$CSM_PropDead_ED)
```

y-axis is scaled by the minimum (`r min_CSM`) and maximum (`r max_CSM`) values in the full data set.

```{r p_CSM_F, echo=FALSE}
p_CSM_F <- ggplot(data = filter(droseu$csm, Sex == "F"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F", x="Population", y = "Prop_dead") + ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_F
```

```{r, echo=FALSE}
pdf(file="ColdShock/p_CSM_F.pdf",width=8, height=5)
p_CSM_F
invisible(dev.off())
```

```{r p_CSM_M, echo=FALSE}
p_CSM_M <- ggplot(data = filter(droseu$csm, Sex == "M"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M", x="Population", y = "Prop_dead") +  ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_M
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M.pdf",width=8, height=5)
p_CSM_M
invisible(dev.off())
```

#### Gonzalez Lab

```{r}
lmers_anova$CSM_F_Gonzalez_lmer_pop
```

```{r}
lmers_sum$CSM_F_Gonzalez_lmer_pop
```

```{r}
lmers_anova$CSM_M_Gonzalez_lmer_pop
```

```{r}
lmers_sum$CSM_M_Gonzalez_lmer_pop
```

```{r p_CSM_F_Gonzalez, echo=FALSE}
p_CSM_F_Gonzalez <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Gonzalez"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_F_Gonzalez
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_Gonzalez.pdf",width=8, height=5)
p_CSM_F_Gonzalez
invisible(dev.off())
```

```{r p_CSM_F_pop_Gonzalez, echo=FALSE}
p_CSM_F_pop_Gonzalez <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Gonzalez"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Gonzalez", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ geom_text(data = lmers_tukey$CSM_F_Gonzalez_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_F_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_pop_Gonzalez.pdf",width=8, height=5)
p_CSM_F_pop_Gonzalez
invisible(dev.off())
```

```{r p_CSM_M_Gonzalez, echo=FALSE}
p_CSM_M_Gonzalez <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Gonzalez"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_M_Gonzalez
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_Gonzalez.pdf",width=8, height=5)
p_CSM_M_Gonzalez
invisible(dev.off())
```

```{r p_CSM_M_pop_Gonzalez, echo=FALSE}
p_CSM_M_pop_Gonzalez <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Gonzalez"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ geom_text(data = lmers_tukey$CSM_M_Gonzalez_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_M_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_pop_Gonzalez.pdf",width=8, height=5)
p_CSM_M_pop_Gonzalez
invisible(dev.off())
```

#### Kozeretska Lab 

```{r}
lmers_anova$CSM_F_Kozeretska_lmer_pop
```

```{r}
lmers_sum$CSM_F_Kozeretska_lmer_pop
```

```{r}
lmers_anova$CSM_M_Kozeretska_lmer_pop
```

```{r}
lmers_sum$CSM_M_Kozeretska_lmer_pop
```

```{r p_CSM_F_Kozeretska, echo=FALSE}
p_CSM_F_Kozeretska <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Kozeretska"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Kozeretska", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_F_Kozeretska
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_Kozeretska.pdf",width=8, height=5)
p_CSM_F_Kozeretska
invisible(dev.off())
```

```{r p_CSM_F_pop_Kozeretska, echo=FALSE}
p_CSM_F_pop_Kozeretska <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Kozeretska"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Kozeretska", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ 
geom_text(data = lmers_tukey$CSM_F_Kozeretska_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_F_pop_Kozeretska
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_pop_Kozeretska.pdf",width=8, height=5)
p_CSM_F_pop_Kozeretska
invisible(dev.off())
```

```{r p_CSM_M_Kozeretska, echo=FALSE}
p_CSM_M_Kozeretska <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Kozeretska"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Kozeretska", x="Population", y = "CSM (PropSur)")  +  ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_M_Kozeretska
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_Kozeretska.pdf",width=8, height=5)
p_CSM_M_Kozeretska
invisible(dev.off())
```

```{r p_CSM_M_pop_Kozeretska, echo=FALSE}
p_CSM_M_pop_Kozeretska <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Kozeretska"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Kozeretska", x="Population", y = "CSM (PropSur)")  +  ylim(c(min_CSM, max_CSM))+ geom_text(data = lmers_tukey$CSM_M_Kozeretska_lmer_pop$letters, aes(x = Population, label = cld), y = max_CSM, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_M_pop_Kozeretska
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_pop_Kozeretska.pdf",width=8, height=5)
p_CSM_M_pop_Kozeretska
invisible(dev.off())
```

#### Vieira Lab

```{r}
lmers_anova$CSM_F_Vieira_lmer_pop
```

```{r}
lmers_sum$CSM_F_Vieira_lmer_pop
```

```{r}
lmers_anova$CSM_M_Vieira_lmer_pop
```

```{r}
lmers_sum$CSM_M_Vieira_lmer_pop
```

```{r p_CSM_F_Vieira, echo=FALSE}
p_CSM_F_Vieira <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_F_Vieira
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_Vieira.pdf",width=8, height=5)
p_CSM_F_Vieira
invisible(dev.off())
```

```{r p_CSM_F_pop_Vieira, echo=FALSE}
p_CSM_F_pop_Vieira <- ggplot(data = filter(droseu$csm, Sex == "F" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ geom_text(data = lmers_tukey$CSM_F_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_F_pop_Vieira
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_F_pop_Vieira.pdf",width=8, height=5)
p_CSM_F_pop_Vieira
invisible(dev.off())
```

```{r p_CSM_M_Vieira, echo=FALSE}
p_CSM_M_Vieira <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CSM_M_Vieira
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_Vieira.pdf",width=8, height=5)
p_CSM_M_Vieira
invisible(dev.off())
```

```{r p_CSM_M_pop_Vieira, echo=FALSE}
p_CSM_M_pop_Vieira <- ggplot(data = filter(droseu$csm, Sex == "M" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ geom_text(data = lmers_tukey$CSM_M_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CSM_M_pop_Vieira
```

```{r echo=FALSE}
pdf(file="ColdShock/p_CSM_M_pop_Vieira.pdf",width=8, height=5)
p_CSM_M_pop_Vieira
invisible(dev.off())
```

### Linear Models / Residuals

#### Gonzalez Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Gonzalez_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Gonzalez_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Gonzalez_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Gonzalez_lmer_pop_qq_plot_residuals.png")
```

#### Kozeretska Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Kozeretska_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Kozeretska_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Kozeretska_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Kozeretska_lmer_pop_qq_plot_residuals.png")
```

#### Vieira Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_F_Vieira_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ColdShock/by_lab_models_residuals/CSM_M_Vieira_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_CSM, echo=FALSE}
intersect_Line_CSM  <- Reduce(intersect, list(droseu$csm$Line[droseu$csm$Supervisor.PI == "Gonzalez"],
                                         droseu$csm$Line[droseu$csm$Supervisor.PI == "Vieira"],
                                         droseu$csm$Line[droseu$csm$Supervisor.PI == "Kozeretska"]))
write(intersect_Line_CSM, file ="ColdShock/intersect_Line_CSM.txt", sep = "\t")

intersect_Pop_CSM  <- Reduce(intersect, list(droseu$csm$Population[droseu$csm$Supervisor.PI == "Gonzalez"],
                                         droseu$csm$Population[droseu$csm$Supervisor.PI == "Vieira"],
                                         droseu$csm$Population[droseu$csm$Supervisor.PI == "Kozeretska"]))
write(intersect_Pop_CSM, file ="ColdShock/intersect_Pop_CSM.txt", sep = "\t")
```

There are `r length(intersect_Pop_CSM) ` populations and `r length(intersect_Line_CSM) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/ColdShock/CSM_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/ColdShock/CSM_M_lmer_lab_correlations.png")
```

```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   invisible(dev.off())
}
# crashed bc tries to save lots -- need to remove some sometimes
```

## Chill-coma recovery time

```{r include=FALSE}
dir.create(file.path("ChillComa"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Mensch Lab : Florencia Putero, Lucas Kreiman, Julian Mensch

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias


### Data Reformatting

```{r}
str(droseu$ccrt)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$CCRT, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$CCRT, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$CCRT, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$CCRT, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r min_max_CCRT, echo=TRUE}
min_CCRT <- min(droseu$ccrt$CCRT_seconds)
max_CCRT <- max(droseu$ccrt$CCRT_seconds)
```

y-axis is scaled by the minimum (`r min_CSM`) and maximum (`r max_CSM`) values in the full data set.

#### Mensch Lab

```{r}
lmers_anova$CCRT_F_Mensch_lmer_pop
```

```{r}
lmers_sum$CCRT_F_Mensch_lmer_pop
```

```{r}
lmers_anova$CCRT_M_Mensch_lmer_pop
```

```{r}
lmers_sum$CCRT_M_Mensch_lmer_pop
```

```{r p_CCRT_F_Mensch, echo=FALSE}
p_CCRT_F_Mensch <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Mensch" & Sex == "F"), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_Mensch", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CCRT_F_Mensch
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_F_Mensch.pdf",width=8, height=5)
p_CCRT_F_Mensch
invisible(dev.off())
```

```{r p_CCRT_F_pop_Mensch, echo=FALSE}
p_CCRT_F_pop_Mensch <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Mensch" & Sex == "F"), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_pop_Mensch", x="Population", y = "CCRT_seconds")+ ylim(c(min_CCRT, max_CCRT))+ geom_text(data = lmers_tukey$CCRT_F_Mensch_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CCRT_F_pop_Mensch
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_F_pop_Mensch.pdf",width=8, height=5)
p_CCRT_F_pop_Mensch
invisible(dev.off())
```

```{r echo=FALSE}
p_CCRT_M_Mensch <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Mensch" & Sex == "M"), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CCRT_M_Mensch
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_M_Mensch.pdf",width=8, height=5)
p_CCRT_M_Mensch
invisible(dev.off())
```

```{r p_CCRT_M_pop_Mensch, echo=FALSE}
p_CCRT_M_pop_Mensch <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Mensch" & Sex == "M"), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M_pop_Mensch", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ geom_text(data = lmers_tukey$CCRT_M_Mensch_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CCRT_M_pop_Mensch
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_M_pop_Mensch.pdf",width=8, height=5)
p_CCRT_M_pop_Mensch
invisible(dev.off())
```



#### Vieira Lab

```{r}
lmers_anova$CCRT_F_Vieira_lmer_pop
```

```{r}
lmers_sum$CCRT_F_Vieira_lmer_pop
```

```{r}
lmers_anova$CCRT_M_Vieira_lmer_pop
```

```{r}
lmers_sum$CCRT_M_Vieira_lmer_pop
```

```{r p_CCRT_F_Vieira, echo=FALSE}
p_CCRT_F_Vieira <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Vieira" & Sex == "F"), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_Vieira", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CCRT_F_Vieira
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_F_Vieira.pdf",width=8, height=5)
p_CCRT_F_Vieira
invisible(dev.off())
```

```{r p_CCRT_F_pop_Vieira, echo=FALSE}
p_CCRT_F_pop_Vieira <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Vieira" & Sex == "F"), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_pop_Vieira", x="Population", y = "CCRT_seconds")+ ylim(c(min_CCRT, max_CCRT))+ geom_text(data = lmers_tukey$CCRT_F_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CCRT_F_pop_Vieira
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_F_pop_Vieira.pdf",width=8, height=5)
p_CCRT_F_pop_Vieira
invisible(dev.off())
```

```{r echo=FALSE}
p_CCRT_M_Vieira <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Vieira" & Sex == "M"), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_CCRT_M_Vieira
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_M_Vieira.pdf",width=8, height=5)
p_CCRT_M_Vieira
invisible(dev.off())
```

```{r p_CCRT_M_pop_Vieira, echo=FALSE}
p_CCRT_M_pop_Vieira <- ggplot(data = filter(droseu$ccrt, Censor == "0" & Supervisor.PI == "Vieira" & Sex == "M"), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M_pop_Vieira", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ geom_text(data = lmers_tukey$CCRT_M_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_CCRT_M_pop_Vieira
```

```{r echo=FALSE}
pdf(file="ChillComa/p_CCRT_M_pop_Vieira.pdf",width=8, height=5)
p_CCRT_M_pop_Vieira
invisible(dev.off())
```

### Survival Analyses

#### Mensch Lab

_Females_
```{r}
coxme_anova$CCRT_F_coxme_Mensch
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/ChillComa/p_CCRT_F_Mensch_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$CCRT_M_coxme_Mensch
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/ChillComa/p_CCRT_M_Mensch_survival_curves.pdf")
```

#### Vieira Lab

_Females_
```{r}
coxme_anova$CCRT_F_coxme_Vieira
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/ChillComa/p_CCRT_F_Vieira_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$CCRT_M_coxme_Vieira
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/ChillComa/p_CCRT_M_Vieira_survival_curves.pdf")
```

### Linear Models / Residuals

#### Mensch Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_F_Mensch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_F_Mensch_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_M_Mensch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_M_Mensch_lmer_pop_qq_plot_residuals.png")
```

#### Vieira Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_F_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_F_Vieira_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_M_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/ChillComa/by_lab_models_residuals/CCRT_M_Vieira_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

## Heat-shock mortality

```{r include=FALSE}
dir.create(file.path("HeatShock"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Parsch Lab : Eliza Argyridou, Amanda Glaser-Schmitt, John Parsch

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias

### Data Reformatting

```{r}
str(droseu$hsm)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$HSM, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$HSM, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$HSM, options = list(pageLength = 10)) %>% formatRound(5:11, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$HSM, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_HSM <- min(droseu$hsm$TimeDeath_min)
max_HSM <- max(droseu$hsm$TimeDeath_min)
```

y-axis is scaled by the minimum (`r min_HSM`) and maximum (`r max_HSM`) values in the full data set.

```{r p_HSM_F, echo=FALSE}
p_HSM_F <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "F"), aes(x=Population_Lat, y=TimeDeath_min, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F", x="Population", y = "TimeDeath(min)")  + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_HSM_F
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_F.pdf",width=8, height=5)
p_HSM_F
invisible(dev.off())
```

```{r p_HSM_M, echo=FALSE}
p_HSM_M <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "M"), aes(x=Population_Lat, y=TimeDeath_min, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M", x="Population", y = "TimeDeath(min)")  + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_HSM_M
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_M.pdf",width=8, height=5)
p_HSM_M
invisible(dev.off())
```

#### Parsch Lab

```{r}
lmers_anova$HSM_F_Parsch_lmer_pop
```

```{r}
lmers_sum$HSM_F_Parsch_lmer_pop
```

```{r}
lmers_anova$HSM_M_Parsch_lmer_pop
```

```{r}
lmers_sum$HSM_M_Parsch_lmer_pop
```

```{r p_HSM_F_Parsch, echo=FALSE}
p_HSM_F_Parsch <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "F" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_HSM_F_Parsch
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_F_Parsch.pdf",width=8, height=5)
p_HSM_F_Parsch
invisible(dev.off())
```

```{r p_HSM_F_pop_Parsch, echo=FALSE}
p_HSM_F_pop_Parsch <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "F" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_pop_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+  geom_text(data = lmers_tukey$HSM_F_Parsch_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_HSM_F_pop_Parsch
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_F_pop_Parsch.pdf",width=8, height=5)
p_HSM_F_pop_Parsch
invisible(dev.off())
```

```{r p_HSM_M_Parsch}
p_HSM_M_Parsch <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "M" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r}
p_HSM_M_Parsch
```

```{r}
pdf(file="HeatShock/p_HSM_M_Parsch.pdf",width=8, height=5)
p_HSM_M_Parsch
invisible(dev.off())
```

```{r p_HSM_M_pop_Parsch, echo=FALSE}
p_HSM_M_pop_Parsch <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "M" & Supervisor.PI == "Parsch"), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_pop_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ geom_text(data = lmers_tukey$HSM_M_Parsch_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_HSM_M_pop_Parsch
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_M_pop_Parsch.pdf",width=8, height=5)
p_HSM_M_pop_Parsch
invisible(dev.off())
```

#### Vieira Lab 

```{r}
lmers_anova$HSM_F_Vieira_lmer_pop
```

```{r}
lmers_sum$HSM_F_Vieira_lmer_pop
```

```{r}
lmers_anova$HSM_M_Vieira_lmer_pop
```

```{r}
lmers_sum$HSM_M_Vieira_lmer_pop
```

```{r p_HSM_F_Vieira, echo=FALSE}
p_HSM_F_Vieira <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "F" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_HSM_F_Vieira
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_F_Vieira.pdf",width=8, height=5)
p_HSM_F_Vieira
invisible(dev.off())
```

```{r p_HSM_F_pop_Vieira, echo=FALSE}
p_HSM_F_pop_Vieira <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "F" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_pop_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+  geom_text(data = lmers_tukey$HSM_F_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_HSM_F_pop_Vieira
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_F_pop_Vieira.pdf",width=8, height=5)
p_HSM_F_pop_Vieira
invisible(dev.off())
```

```{r p_HSM_M_Vieira, echo=FALSE}
p_HSM_M_Vieira <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "M" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_HSM_M_Vieira
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_M_Vieira.pdf",width=8, height=5)
p_HSM_M_Vieira
invisible(dev.off())
```

```{r p_HSM_M_pop_Vieira, echo=FALSE}
p_HSM_M_pop_Vieira <- ggplot(data = filter(droseu$hsm, Censor == "0" & Sex == "M" & Supervisor.PI == "Vieira"), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_pop_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ geom_text(data = lmers_tukey$HSM_M_Vieira_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_HSM_M_pop_Vieira
```

```{r echo=FALSE}
pdf(file="HeatShock/p_HSM_M_pop_Vieira.pdf",width=8, height=5)
p_HSM_M_pop_Vieira
invisible(dev.off())
```

### Survival Analyses

#### Parsch Lab

_Females_
```{r}
coxme_anova$HSM_F_coxme_Parsch
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/HeatShock/p_HSM_F_Parsch_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$HSM_M_coxme_Parsch
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/HeatShock/p_HSM_M_Parsch_survival_curves.pdf")
```

#### Vieira Lab

_Females_
```{r}
coxme_anova$HSM_F_coxme_Vieira
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/HeatShock/p_HSM_F_Vieira_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$HSM_M_coxme_Vieira
```

```{r, echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/HeatShock/p_HSM_M_Vieira_survival_curves.pdf")
```

### Linear Models / Residuals

#### Parsch Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_F_Parsch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_F_Parsch_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_M_Parsch_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_M_Parsch_lmer_pop_qq_plot_residuals.png")
```

#### Vieria Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_F_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_F_Vieira_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_M_Vieira_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/HeatShock/by_lab_models_residuals/HSM_M_Vieira_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_HSM, echo=FALSE}
intersect_Line_HSM  <- Reduce(intersect, list(droseu$hsm$Line[droseu$hsm$Supervisor.PI == "Parsch"],
                                         droseu$hsm$Line[droseu$hsm$Supervisor.PI == "Vieira"]))
write(intersect_Line_HSM, file ="HeatShock/intersect_Line_HSM.txt", sep = "\t")

intersect_Pop_HSM  <- Reduce(intersect, list(droseu$hsm$Population[droseu$hsm$Supervisor.PI == "Parsch"],
                                         droseu$hsm$Population[droseu$hsm$Supervisor.PI == "Vieira"]))
write(intersect_Pop_HSM, file ="HeatShock/intersect_Pop_HSM.txt", sep = "\t")
```

There are `r length(intersect_Pop_HSM) ` populations and `r length(intersect_Line_HSM) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r, echo=FALSE}
knitr::include_graphics("LabCorrelations/HeatShock/HSM_F_lmer_lab_correlations.png")
```

_Males_
```{r, echo=FALSE}
knitr::include_graphics("LabCorrelations/HeatShock/HSM_M_lmer_lab_correlations.png")
```

## Diapause

```{r include=FALSE}
dir.create(file.path("Diapause"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Bergland Lab : Liam Miller, Alan Bergland, Priscilla Erickson

Flatt Lab : Esra Durmaz, Envel Kerdaffrec, Thibault Schowing, Virginie Thieu, Marisa Rodrigues, Thomas Flatt

Schlotterer Lab : Manolis Lyrakis, Christian Schlötterer

### Data Reformatting

```{r}
str(droseu$dia)
```

### Descriptive Statistics

Descriptive statistics at the population level, with batch information :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$Dia_Prop_Max_Stage9, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r echo=FALSE}
DT::datatable(table_pop_wobatch$Dia_Prop_Max_Stage9, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab

#### Overview

```{r}
min_Dia <- min(droseu$dia$Prop_Max_Stage9)
max_Dia <- max(droseu$dia$Prop_Max_Stage9)
```


```{r p_Dia, echo=FALSE}
p_Dia <- ggplot(data = filter(droseu$dia, Sex == "F"), aes(x=Population_Lat, y=Prop_Max_Stage9, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Dia", x="Population", y = "Prop_Max_Stage9") + ylim(c(min_Dia, max_Dia))+ droseu_theme + scale_fill_grey(start=1, end=0)
```


```{r echo=FALSE}
p_Dia
```

```{r echo=FALSE}
pdf(file="Diapause/p_Dia.pdf",width=8, height=5)
p_Dia
invisible(dev.off())
```


#### Bergland Lab
```{r}
lmers_anova$Dia_Bergland_lmer_pop
```

```{r}
lmers_sum$Dia_Bergland_lmer_pop
```

```{r echo=FALSE}
p_Dia_Pop_Bergland_wbatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Bergland') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  labs(title = "p_Dia_Bergland", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + scale_fill_grey(start=1, end=0) +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Bergland_wbatch
```
```{r echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Bergland_wbatch.pdf",width=8, height=5)
p_Dia_Pop_Bergland_wbatch
invisible(dev.off())
```
```{r echo=FALSE}
p_Dia_Pop_Bergland_wobatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Bergland') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_text(data = lmers_tukey$Dia_Bergland_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
  labs(title = "p_Dia_Bergland", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + colScale +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Bergland_wobatch
```
```{r echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Bergland_wobatch.pdf",width=8, height=5)
p_Dia_Pop_Bergland_wobatch
invisible(dev.off())
```

#### Flatt Lab 

```{r}
lmers_anova$Dia_Flatt_lm_pop
```

```{r}
lmers_sum$Dia_Flatt_lm_pop
```

```{r echo=FALSE}
p_Dia_Pop_Flatt_wbatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Flatt') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  labs(title = "p_Dia_Flatt", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + scale_fill_grey(start=1, end=0) +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Flatt_wbatch
```

```{r  echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Flatt_wbatch.pdf", width=8, height=5)
p_Dia_Pop_Flatt_wbatch
invisible(dev.off())
```

```{r echo=FALSE}
p_Dia_Pop_Flatt_wobatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Flatt') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_text(data = lmers_tukey$Dia_Flatt_lm_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
  labs(title = "p_Dia_Flatt", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + colScale +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Flatt_wobatch
```

```{r  echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Flatt_wobatch.pdf", width=8, height=5)
p_Dia_Pop_Flatt_wobatch
invisible(dev.off())
```

#### Schlotterer Lab

```{r}
lmers_anova$Dia_Schlotterer_lmer_pop
```

```{r}
lmers_sum$Dia_Schlotterer_lmer_pop
```

```{r echo=FALSE}
p_Dia_Pop_Schlotterer_wbatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Schlotterer') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  labs(title = "p_Dia_Schlotterer", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + scale_fill_grey(start=1, end=0) +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Schlotterer_wbatch
```
```{r echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Schlotterer_wbatch.pdf", width=8, height=5)
p_Dia_Pop_Schlotterer_wbatch
invisible(dev.off())
```
```{r echo=FALSE}
p_Dia_Pop_Schlotterer_wobatch <- droseu$dia %>% 
  filter(Supervisor.PI == 'Schlotterer') %>%
  ggplot(aes(x = Population_Lat, y = Prop_Max_Stage9, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_text(data = lmers_tukey$Dia_Schlotterer_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) +
  labs(title = "p_Dia_Schlotterer", x = "Population", y = "Prop_Max_Stage9") +
  droseu_theme + colScale +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Schlotterer_wobatch
```

```{r  echo=FALSE}
pdf(file="Diapause/p_Dia_Pop_Schlotterer_wobatch.pdf", width=8, height=5)
p_Dia_Pop_Schlotterer_wobatch
invisible(dev.off())
```

### Linear Models / Residuals

#### Bergland Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Bergland_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Bergland_lmer_pop_qq_plot_residuals.png")
```

#### Flatt Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Flatt_lm_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Flatt_lm_pop_qq_plot_residuals.png")
```

#### Schlotterer Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Schlotterer_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Diapause/by_lab_models_residuals/Dia_Schlotterer_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_Dia, echo=FALSE}
intersect_Line_Dia  <- Reduce(intersect, list(droseu$dia$Line[droseu$dia$Supervisor.PI == "Flatt"],
                                         droseu$dia$Line[droseu$dia$Supervisor.PI == "Bergland"],
                                         droseu$dia$Line[droseu$dia$Supervisor.PI == "Schlotterer"]))

write(intersect_Line_Dia, file ="Diapause/intersect_Line_Dia.txt", sep = "\t")

intersect_Pop_Dia  <- Reduce(intersect, list(droseu$dia$Population[droseu$dia$Supervisor.PI == "Flatt"],
                                         droseu$dia$Population[droseu$dia$Supervisor.PI == "Bergland"],
                                         droseu$dia$Population[droseu$dia$Supervisor.PI == "Schlotterer"]))

write(intersect_Pop_Dia, file ="Diapause/intersect_Pop_Dia.txt", sep = "\t")

```

There are `r length(intersect_Pop_Dia) ` populations and `r length(intersect_Line_Dia) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

Using LMER estimates
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Diapause/Dia_F_lmer_lab_correlations.png")
```

Using GLMER estimates
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Diapause/Dia_F_glmer_lab_correlations.png")
```
## Circadian eclosion timing

```{r include=FALSE}
dir.create(file.path("CircadianEclosion"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r}
#Note that the trait has been phenotyped as mixed sex. 
```

### Contributors  

Wegener Lab : Susanne Klühspies, Christian Wegener

### Data Reformatting

```{r}
str(droseu$cets)
```

### Descriptive Statistics

#### 18_LD_DD

Descriptive statistics for ZT_hours_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_ZT_hours_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for ZT_hours_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_ZT_hours_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_Rhythmicity_LSPR_amplitude, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_DD_Rhythmicity_JTK_p_BH_corrected, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

#### 18_LD_LD

Descriptive statistics for ZT_hours_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_ZT_hours_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for ZT_hours_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_ZT_hours_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_Rhythmicity_LSPR_amplitude, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_18_LD_LD_Rhythmicity_JTK_p_BH_corrected, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

#### 29_LD_DD

Descriptive statistics for ZT_hours_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_ZT_hours_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for ZT_hours_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_ZT_hours_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_Rhythmicity_LSPR_amplitude, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_DD_Rhythmicity_JTK_p_BH_corrected, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

#### 29_LD_LD

Descriptive statistics for ZT_hours_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_ZT_hours_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for ZT_hours_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_ZT_hours_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_Rhythmicity_LSPR_amplitude, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r echo=FALSE}
DT::datatable(table_pop_wbatch$CETS_29_LD_LD_Rhythmicity_JTK_p_BH_corrected, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

#### Wegener Lab

From Chris :

```{r echo=FALSE}
knitr::include_graphics("CircadianEclosion/FromChris/Graphs_plate_MESA.png")
```

```{r echo=FALSE}
knitr::include_graphics("CircadianEclosion/FromChris/Graphs_DrosEU_eclosion/Slide1.png")
```

```{r echo=FALSE}
knitr::include_graphics("CircadianEclosion/FromChris/Graphs_DrosEU_eclosion/Slide2.png")
```

```{r echo=FALSE}
knitr::include_graphics("CircadianEclosion/FromChris/Graphs_DrosEU_eclosion/Slide3.png")
```

From Eran :

```{r}
knitr::include_graphics("CircadianEclosion/FromEran/eclosion_data_Christian_Page_1.png")
```

```{r}
knitr::include_graphics("CircadianEclosion/FromEran/eclosion_data_Christian_Page_2.png")
```

## Locomotor activity

```{r include=FALSE}
dir.create(file.path("Locomotor"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r}
#Note that the trait has been phenotyped only in males.
```

### Contributors  

Tauber Lab : Bettina Fishman, Eran Tauber

### Data Reformatting

```{r}
str(droseu$la)
```
### Descriptive Statistics

#### LA - Activity

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$LA_Activity, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$LA_Activity, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$LA_Activity, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$LA_Activity, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

#### LA - ND ratio

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$LA_ND, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$LA_ND, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$LA_ND, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$LA_ND, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

#### LA - Circadian Phase

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$LA_CircPhase, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$LA_CircPhase, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$LA_CircPhase, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$LA_CircPhase, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

#### Tauber Lab

_ND_
```{r}
lmers_anova$LA_NDlog2_Tauber_lmer_pop
```

```{r}
lmers_sum$LA_NDlog2_Tauber_lmer_pop
```

_CircPhase_
```{r}
lmers_anova$LA_CircPhase_Tauber_lmer_pop
```

```{r}
lmers_sum$LA_CircPhase_Tauber_lmer_pop
```

_Activity_
```{r}
lmers_anova$LA_Activity_Tauber_lmer_pop
```

```{r}
lmers_sum$LA_Activity_Tauber_lmer_pop
```

From Eran :

Red letters denote significant difference by Multiple Comparisons of Means: Tukey Contrasts

```{r echo=FALSE}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_1.png")
```

```{r echo=FALSE}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_2.png")
```

```{r echo=FALSE}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_3.png")
```

Phase in DD represented in angle. The mean and 95 confidence limits are shown. CI limits in red indicate uniform distribution (low concentration. i.e. Rayleigh test not significant).

```{r echo=FALSE}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_4.png")
```

Oriana 3 (Stacked circular).   

```{r echo=FALSE}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_5.png")
```

### Linear Models / Residuals 

_Activity_
```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_Activity_Tauber_lmer_pop_hist_residuals.png")
```

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_Activity_Tauber_lmer_pop_hist_residuals.png")
```

_ND Ratio_
```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_NDlog2_Tauber_lmer_pop_hist_residuals.png")
```

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_NDlog2_Tauber_lmer_pop_qq_plot_residuals.png")
```

_Circadian Phase_
```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_CircPhase_Tauber_lmer_pop_hist_residuals.png")
```

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/Locomotor/by_lab_models_residuals/LA_CircPhase_Tauber_lmer_pop_qq_plot_residuals.png")
```

## Starvation resistance

```{r include=FALSE}
dir.create(file.path("Starvation"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Gonzalez Lab : Llewellyn Green, Josefa Gonzalez, Miriam Merenciano

Onder Lab : Seda Coskun, Ekin Demir, Senel Selin Senkal, Cansu Aksoy

Pasyukova Lab : Alexander Symonenko, Natalia Roshina, Mikhail Trostnokov, Ekaterina Veselkina, Evgenia Tsybul'ko, Olga Rybina, Elena Pasyukova


### Data Reformatting

```{r}
str(droseu$sr)
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$SR, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wobatch$SR, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wbatch$SR, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r, echo=FALSE}
DT::datatable(table_pop_wobatch$SR, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_SR <- min(droseu$sr$AgeAtDeath_hours)
max_SR <- max(droseu$sr$AgeAtDeath_hours)
```

```{r p_SR_F, echo=FALSE}
p_SR_F <- ggplot(data = filter(droseu$sr, Sex == "F"), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_SR_F", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_F
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F.pdf",width=8, height=5)
p_SR_F
invisible(dev.off())
```

```{r p_SR_M, echo=FALSE}
p_SR_M <- ggplot(data = filter(droseu$sr, Sex == "M"), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_SR_M", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_M
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M.pdf",width=8, height=5)
p_SR_M
invisible(dev.off())
```

#### Gonzalez Lab

```{r}
lmers_anova$SR_F_Gonzalez_lmer_pop
```

```{r}
lmers_sum$SR_F_Gonzalez_lmer_pop
```

```{r}
lmers_anova$SR_M_Gonzalez_lmer_pop
```

```{r}
lmers_sum$SR_M_Gonzalez_lmer_pop
```

```{r p_SR_F_Gonzalez, echo=FALSE}
p_SR_F_Gonzalez <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=='Gonzalez'), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_F_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Gonzalez.pdf",width=8, height=5)
p_SR_F_Gonzalez
invisible(dev.off())
```

```{r p_SR_F_pop_Gonzalez, echo=FALSE}
p_SR_F_pop_Gonzalez <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=='Gonzalez'), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_F_Gonzalez_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_F_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Gonzalez.pdf",width=8, height=5)
p_SR_F_pop_Gonzalez
invisible(dev.off())
```

```{r p_SR_M_Gonzalez, echo=FALSE}
p_SR_M_Gonzalez <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=='Gonzalez'), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_M_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Gonzalez.pdf",width=8, height=5)
p_SR_M_Gonzalez
invisible(dev.off())
```

```{r p_SR_M_pop_Gonzalez, echo=FALSE}
p_SR_M_pop_Gonzalez <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=='Gonzalez'), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_M_Gonzalez_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_M_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Gonzalez.pdf",width=8, height=5)
p_SR_M_pop_Gonzalez
invisible(dev.off())
```

#### Onder Lab 

```{r}
lmers_anova$SR_F_Onder_lmer_pop
```

```{r}
lmers_sum$SR_F_Onder_lmer_pop
```

```{r}
lmers_anova$SR_M_Onder_lmer_pop
```

```{r}
lmers_sum$SR_M_Onder_lmer_pop
```

```{r p_SR_F_Onder, echo=FALSE}
p_SR_F_Onder <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=="Onder"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_F_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Onder.pdf", width=8, height=5)
p_SR_F_Onder
invisible(dev.off())
```

```{r p_SR_F_pop_Onder, echo=FALSE}
p_SR_F_pop_Onder <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=="Onder"), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_F_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_F_pop_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Onder.pdf",width=8, height=5)
p_SR_F_pop_Onder
invisible(dev.off())
```

```{r p_SR_M_Onder, echo=FALSE}
p_SR_M_Onder <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=="Onder"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_M_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Onder.pdf",width=8, height=5)
p_SR_M_Onder
invisible(dev.off())
```

```{r p_SR_M_pop_Onder, echo=FALSE}
p_SR_M_pop_Onder <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=="Onder"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_M_Onder_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_M_pop_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Onder.pdf",width=8, height=5)
p_SR_M_pop_Onder
invisible(dev.off())
```

#### Pasyukova Lab

```{r}
lmers_anova$SR_F_Pasyukova_lmer_pop
```

```{r}
lmers_sum$SR_F_Pasyukova_lmer_pop
```

```{r}
lmers_anova$SR_M_Pasyukova_lmer_pop
```

```{r}
lmers_sum$SR_M_Pasyukova_lmer_pop
```

```{r p_SR_F_Pasyukova, echo=FALSE}
p_SR_F_Pasyukova <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=="Pasyukova"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_F_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Pasyukova.pdf",width=8, height=5)
p_SR_F_Pasyukova
invisible(dev.off())
```

```{r p_SR_F_pop_Pasyukova, echo=FALSE}
p_SR_F_pop_Pasyukova <- ggplot(data = filter(droseu$sr, Sex == "F" & Supervisor.PI=="Pasyukova"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_F_Pasyukova_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_F_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Pasyukova.pdf",width=8, height=5)
p_SR_F_pop_Pasyukova
invisible(dev.off())
```

```{r p_SR_M_Pasyukova, echo=FALSE}
p_SR_M_Pasyukova <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=="Pasyukova"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR)) +droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_SR_M_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Pasyukova.pdf",width=8, height=5)
p_SR_M_Pasyukova
invisible(dev.off())
```

```{r p_SR_M_pop_Pasyukova, echo=FALSE}
p_SR_M_pop_Pasyukova <- ggplot(data = filter(droseu$sr, Sex == "M" & Supervisor.PI=="Pasyukova"),  aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ geom_text(data = lmers_tukey$SR_M_Pasyukova_lmer_pop$letters, aes(x = Population, label = cld), y = Inf, vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_SR_M_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Pasyukova.pdf",width=8, height=5)
p_SR_M_pop_Pasyukova
invisible(dev.off())
```

### Survival Analyses

#### Gonzalez Lab

_Females_
```{r}
coxme_anova$SR_F_Gonzalez_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_F_Gonzalez_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$SR_M_Gonzalez_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_M_Gonzalez_survival_curves.pdf")
```

#### Onder Lab

_Females_
```{r}
coxme_anova$SR_F_Onder_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_F_Onder_survival_curves.pdf")
```

_Males_

```{r}
coxme_anova$SR_M_Onder_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_M_Onder_survival_curves.pdf")
```

#### Pasyukova Lab

_Females_
```{r}
coxme_anova$SR_F_Pasyukova_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_F_Pasyukova_survival_curves.pdf")
```

_Males_
```{r}
coxme_anova$SR_M_Pasyukova_coxme
```

```{r echo=FALSE}
knitr::include_graphics("SurvivalAnalyses/Starvation/p_SR_M_Pasyukova_survival_curves.pdf")
```

#### coxme

### Linear Models / Residuals

#### Gonzalez Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Gonzalez_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Gonzalez_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Gonzalez_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Gonzalez_lmer_pop_qq_plot_residuals.png")
```

#### Onder Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Onder_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Onder_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Onder_lmer_pop_qq_plot_residuals.png")
```

#### Pasyukova Lab

_Females_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Pasyukova_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_F_Pasyukova_lmer_pop_qq_plot_residuals.png")
```

_Males_
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Pasyukova_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Starvation/by_lab_models_residuals/SR_M_Pasyukova_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_SR, echo=FALSE}
intersect_Line_SR  <- Reduce(intersect, list(droseu$sr$Line[droseu$sr$Supervisor.PI == "Gonzalez"],
                                        droseu$sr$Line[droseu$sr$Supervisor.PI == "Pasyukova"],
                                        droseu$sr$Line[droseu$sr$Supervisor.PI == "Onder"]))

write(intersect_Line_SR, file ="Starvation/intersect_Line_SR.txt", sep = "\t")

intersect_Pop_SR  <- Reduce(intersect, list(droseu$sr$Population[droseu$sr$Supervisor.PI == "Gonzalez"],
                                        droseu$sr$Population[droseu$sr$Supervisor.PI == "Pasyukova"],
                                        droseu$sr$Population[droseu$sr$Supervisor.PI == "Onder"]))
write(intersect_Pop_SR, file ="Starvation/intersect_Pop_SR.txt", sep = "\t")

```

There are `r length(intersect_Pop_SR) ` populations and `r length(intersect_Line_SR) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

_Females_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Starvation/SR_F_lmer_lab_correlations.png")
```

_Males_
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Starvation/SR_M_lmer_lab_correlations.png")
```

## Pigmentation

```{r include=FALSE}
dir.create(file.path("Pigmentation"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Abbott Lab : Jessica Abbott, Qinyang Li, Shahzad Khan

Gibert Lab :Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Camille Mermet, Patricia Gibert

Schmidt Lab : Amy Goldfischer, Paul Schmidt 

### Data Reformatting

```{r}
str(droseu$pgm)
```

### Descriptive Statistics

### _T4_
Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$Pgm_PercT4, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_Pgm_Line_PercT4_wobatch, echo=FALSE}
DT::datatable(table_line_wobatch$Pgm_PercT4, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_Pgm_Pop_PercT4_wbatch, echo=FALSE}
DT::datatable(table_pop_wbatch$Pgm_PercT4, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_Pgm_Pop_PercT4_wobatch, echo=FALSE}
DT::datatable(table_pop_wobatch$Pgm_PercT4, options = list(pageLength = 10))%>% formatRound(4:11, 3)
```

### _T5_

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$Pgm_PercT5, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_Pgm_Line_PercT5_wobatch, echo=FALSE}
DT::datatable(table_line_wobatch$Pgm_PercT5, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_Pgm_Pop_PercT5_wbatch, echo=FALSE}
DT::datatable(table_pop_wbatch$Pgm_PercT5, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_Pgm_Pop_PercT5_wobatch, echo=FALSE}
DT::datatable(table_pop_wobatch$Pgm_PercT5, options = list(pageLength = 10))%>% formatRound(4:11, 3)
```

### _T6_

Descriptive statistics at the line level, with batch information :
```{r, echo=FALSE}
DT::datatable(table_line_wbatch$Pgm_PercT6, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_Pgm_Line_PercT6_wobatch, echo=FALSE}
DT::datatable(table_line_wobatch$Pgm_PercT6, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_Pgm_Pop_PercT6_wbatch, echo=FALSE}
DT::datatable(table_pop_wbatch$Pgm_PercT6, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_Pgm_Pop_PercT6_wobatch, echo=FALSE}
DT::datatable(table_pop_wobatch$Pgm_PercT6, options = list(pageLength = 10))%>% formatRound(4:11, 3)
```

### _Total_

Descriptive statistics at the line level, with batch information :

```{r, echo=FALSE}
DT::datatable(table_line_wbatch$Pgm_TotalPerc, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_Pgm_Line_PercT_wobatch, echo=FALSE}
DT::datatable(table_line_wobatch$Pgm_TotalPerc, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_Pgm_Pop_PercT_wbatch, echo=FALSE}
DT::datatable(table_pop_wbatch$Pgm_TotalPerc, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_Pgm_Pop_PercT_wobatch, echo=FALSE}
DT::datatable(table_pop_wobatch$Pgm_TotalPerc, options = list(pageLength = 10))%>% formatRound(4:11, 3)
```

#### Overview 

### Plots and Linear Models by Lab  

#### Abbott Lab

_PercT4_

```{r}
lmers_anova$Pgm_T4_Abbott_lmer_pop
```

```{r}
lmers_sum$Pgm_T4_Abbott_lmer_pop
```

```{r p_Pgm_Abbott_PercT4, echo=FALSE}
p_Pgm_Abbott_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT4, fill=Batch)) +
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT4.pdf",width=8, height=5)
p_Pgm_Abbott_PercT4
invisible(dev.off())
```

```{r p_Pgm_pop_Abbott_PercT4, echo=FALSE}
p_Pgm_pop_Abbott_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT4, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ geom_text(data = lmers_tukey$Pgm_T4_Abbott_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT4.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT4
invisible(dev.off())
```

_PercT5_

```{r}
lmers_anova$Pgm_T5_Abbott_lmer_pop
```

```{r}
lmers_sum$Pgm_T5_Abbott_lmer_pop
```

```{r p_Pgm_Abbott_PercT5, echo=FALSE}
p_Pgm_Abbott_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT5, fill=Batch)) +   geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT5.pdf",width=8, height=5)
p_Pgm_Abbott_PercT5
invisible(dev.off())
```

```{r p_Pgm_pop_Abbott_PercT5, echo=FALSE}
p_Pgm_pop_Abbott_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT5, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ geom_text(data = lmers_tukey$Pgm_T5_Abbott_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT5.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT5
invisible(dev.off())
```

_PercT6_

```{r}
lmers_anova$Pgm_T6_Abbott_lmer_pop
```

```{r}
lmers_sum$Pgm_T6_Abbott_lmer_pop
```

```{r p_Pgm_Abbott_PercT6, echo=FALSE}
p_Pgm_Abbott_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT6, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT6.pdf",width=8, height=5)
p_Pgm_Abbott_PercT6
invisible(dev.off())
```

```{r p_Pgm_pop_Abbott_PercT6, echo=FALSE}
p_Pgm_pop_Abbott_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=PercT6, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ geom_text(data = lmers_tukey$Pgm_T6_Abbott_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT6.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT6
invisible(dev.off())
```

_TotalPerc_

```{r}
lmers_anova$Pgm_Total_Abbott_lmer_pop
```

```{r}
lmers_sum$Pgm_Total_Abbott_lmer_pop
```

```{r p_Pgm_Abbott_TotalPerc, echo=FALSE}
p_Pgm_Abbott_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=TotalPerc, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Abbott_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_TotalPerc.pdf",width=8, height=5)
p_Pgm_Abbott_TotalPerc
invisible(dev.off())
```

```{r p_Pgm_pop_Abbott_TotalPerc, echo=FALSE}
p_Pgm_pop_Abbott_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Abbott'), aes(x=Population_Lat, y=TotalPerc, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ geom_text(data = lmers_tukey$Pgm_Total_Abbott_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_TotalPerc.pdf",width=8, height=5)
p_Pgm_pop_Abbott_TotalPerc
invisible(dev.off())
```

#### Gibert Lab 

_PercT4_

```{r}
lmers_anova$Pgm_T4_Gibert_lmer_pop
```

```{r}
lmers_sum$Pgm_T4_Gibert_lmer_pop
```

```{r p_Pgm_Gibert_PercT4, echo=FALSE}
p_Pgm_Gibert_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT4, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT4.pdf",width=8, height=5)
p_Pgm_Gibert_PercT4
invisible(dev.off())
```

```{r p_Pgm_pop_Gibert_PercT4, echo=FALSE}
p_Pgm_pop_Gibert_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT4, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ geom_text(data = lmers_tukey$Pgm_T4_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT4.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT4
invisible(dev.off())
```

_PercT5_

```{r}
lmers_anova$Pgm_T5_Gibert_lmer_pop
```

```{r}
lmers_sum$Pgm_T5_Gibert_lmer_pop
```

```{r p_Pgm_Gibert_PercT5, echo=FALSE}
p_Pgm_Gibert_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT5, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT5.pdf",width=8, height=5)
p_Pgm_Gibert_PercT5
invisible(dev.off())
```

```{r p_Pgm_pop_Gibert_PercT5, echo=FALSE}
p_Pgm_pop_Gibert_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT5, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ geom_text(data = lmers_tukey$Pgm_T5_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT5.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT5
invisible(dev.off())
```

_PercT6_


```{r}
lmers_anova$Pgm_T6_Gibert_lmer_pop
```

```{r}
lmers_sum$Pgm_T6_Gibert_lmer_pop
```

```{r p_Pgm_Gibert_PercT6, echo=FALSE}
p_Pgm_Gibert_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT6, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT6.pdf",width=8, height=5)
p_Pgm_Gibert_PercT6
invisible(dev.off())
```

```{r p_Pgm_pop_Gibert_PercT6, echo=FALSE}
p_Pgm_pop_Gibert_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=PercT6, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ geom_text(data = lmers_tukey$Pgm_T6_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT6.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT6
invisible(dev.off())
```

_TotalPerc_

```{r}
lmers_anova$Pgm_Total_Gibert_lmer_pop
```

```{r}
lmers_sum$Pgm_Total_Gibert_lmer_pop
```

```{r p_Pgm_Gibert_TotalPerc, echo=FALSE}
p_Pgm_Gibert_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=TotalPerc, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Gibert_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_TotalPerc.pdf",width=8, height=5)
p_Pgm_Gibert_TotalPerc
invisible(dev.off())
```

```{r p_Pgm_pop_Gibert_TotalPerc, echo=FALSE}
p_Pgm_pop_Gibert_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Gibert'), aes(x=Population_Lat, y=TotalPerc, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ geom_text(data = lmers_tukey$Pgm_Total_Gibert_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_TotalPerc.pdf",width=8, height=5)
p_Pgm_pop_Gibert_TotalPerc
invisible(dev.off())
```

#### Schmidt Lab

_PercT4_

```{r}
lmers_anova$Pgm_T4_Schmidt_lmer_pop
```

```{r}
lmers_sum$Pgm_T4_Schmidt_lmer_pop
```

```{r p_Pgm_Schmidt_PercT4, echo=FALSE}

p_Pgm_Schmidt_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT4, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Schmidt_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Schmidt_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Schmidt_PercT4.pdf",width=8, height=5)
p_Pgm_Schmidt_PercT4
invisible(dev.off())
```

```{r p_Pgm_pop_Schmidt_PercT4, echo=FALSE}
p_Pgm_pop_Schmidt_PercT4 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT4, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Schmidt_PercT4", x="Population", y = "PercT4") + ylim(c(min(droseu$pgm$PercT4) , max(droseu$pgm$PercT4)))+ geom_text(data = lmers_tukey$Pgm_T4_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Schmidt_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Schmidt_PercT4.pdf",width=8, height=5)
p_Pgm_pop_Schmidt_PercT4
invisible(dev.off())
```

_PercT5_
```{r}
lmers_anova$Pgm_T5_Schmidt_lmer_pop
```

```{r}
lmers_sum$Pgm_T5_Schmidt_lmer_pop
```

```{r p_Pgm_Schmidt_PercT5, echo=FALSE}
p_Pgm_Schmidt_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT5, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Schmidt_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Schmidt_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Schmidt_PercT5.pdf",width=8, height=5)
p_Pgm_Schmidt_PercT5
invisible(dev.off())
```

```{r p_Pgm_pop_Schmidt_PercT5, echo=FALSE}
p_Pgm_pop_Schmidt_PercT5 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT5, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Schmidt_PercT5", x="Population", y = "PercT5") + ylim(c(min(droseu$pgm$PercT5) , max(droseu$pgm$PercT5)))+ geom_text(data = lmers_tukey$Pgm_T5_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Schmidt_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Schmidt_PercT5.pdf",width=8, height=5)
p_Pgm_pop_Schmidt_PercT5
invisible(dev.off())
```

_PercT6_
```{r}
lmers_anova$Pgm_T6_Schmidt_lmer_pop
```

```{r}
lmers_sum$Pgm_T6_Schmidt_lmer_pop
```

```{r p_Pgm_Schmidt_PercT6, echo=FALSE}
p_Pgm_Schmidt_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT6, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Schmidt_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Schmidt_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Schmidt_PercT6.pdf",width=8, height=5)
p_Pgm_Schmidt_PercT6
invisible(dev.off())
```

```{r p_Pgm_pop_Schmidt_PercT6, echo=FALSE}
p_Pgm_pop_Schmidt_PercT6 <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=PercT6, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Schmidt_PercT6", x="Population", y = "PercT6") + ylim(c(min(droseu$pgm$PercT6) , max(droseu$pgm$PercT6)))+ geom_text(data = lmers_tukey$Pgm_T6_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Schmidt_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Schmidt_PercT6.pdf",width=8, height=5)
p_Pgm_pop_Schmidt_PercT6
invisible(dev.off())
```

_TotalPerc_

```{r}
lmers_anova$Pgm_Total_Schmidt_lmer_pop
```

```{r}
lmers_sum$Pgm_Total_Schmidt_lmer_pop
```

```{r p_Pgm_Schmidt_TotalPerc, echo=FALSE}
p_Pgm_Schmidt_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=TotalPerc, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Schmidt_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ droseu_theme + scale_fill_grey(start=1, end=0)
```

```{r echo=FALSE}
p_Pgm_Schmidt_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Schmidt_TotalPerc.pdf",width=8, height=5)
p_Pgm_Schmidt_TotalPerc
invisible(dev.off())
```

```{r p_Pgm_pop_Schmidt_TotalPerc, echo=FALSE}
p_Pgm_pop_Schmidt_TotalPerc <- ggplot(data = filter(droseu$pgm, Supervisor.PI=='Schmidt'), aes(x=Population_Lat, y=TotalPerc, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Schmidt_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(droseu$pgm$TotalPerc) , max(droseu$pgm$TotalPerc)))+ geom_text(data = lmers_tukey$Pgm_Total_Schmidt_lmer_pop$letters, aes(x = Population, label = cld), y = Inf,  vjust = 1) + droseu_theme + colScale
```

```{r echo=FALSE}
p_Pgm_pop_Schmidt_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Schmidt_TotalPerc.pdf",width=8, height=5)
p_Pgm_pop_Schmidt_TotalPerc
invisible(dev.off())
```

### Linear Models / Residuals

#### Abbott Lab
```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Abbott_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Abbott_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Abbott_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Abbott_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Abbott_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Abbott_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Abbott_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Abbott_lmer_pop_qq_plot_residuals.png")
```

#### Gibert Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Gibert_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Gibert_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Gibert_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Gibert_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Gibert_lmer_pop_qq_plot_residuals.png")
```

#### Schmidt Lab

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T4_Schmidt_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T5_Schmidt_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_T6_Schmidt_lmer_pop_qq_plot_residuals.png")
```

```{r fig.show = "hold", out.width = "49%", fig.align = "default", echo = FALSE}
knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Schmidt_lmer_pop_hist_residuals.png")

knitr::include_graphics("LinearModelsPop/Pigmentation/by_lab_models_residuals/Pgm_Total_Schmidt_lmer_pop_qq_plot_residuals.png")
```

### Lab correlations

```{r intersect_Pgm, echo=FALSE}

intersect_Line_Pgm  <- Reduce(intersect, list(droseu$pgm$Line[droseu$pgm$Supervisor.PI == "Abbott"],
                                         droseu$pgm$Line[droseu$pgm2$Supervisor.PI == "Schmidt"],
                                         droseu$pgm$Line[droseu$pgm$Supervisor.PI == "Gibert"]))

write(intersect_Line_Pgm, file ="Pigmentation/intersect_Line_Pgm.txt", sep = "\t")


intersect_Pop_Pgm  <- Reduce(intersect, list(droseu$pgm$Population[droseu$pgm$Supervisor.PI == "Abbott"],
                                         droseu$pgm$Population[droseu$pgm2$Supervisor.PI == "Schmidt"],
                                         droseu$pgm$Population[droseu$pgm$Supervisor.PI == "Gibert"]))

write(intersect_Pop_Pgm, file ="Pigmentation/intersect_Pop_Pgm", sep = "\t")

```

There are `r length(intersect_Pop_Pgm) ` populations and `r length(intersect_Line_Pgm) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 

```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Pigmentation/Pgm_T4_F_lmer_lab_correlations.png")
```

```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Pigmentation/Pgm_T5_F_lmer_lab_correlations.png")
```

```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Pigmentation/Pgm_T6_F_lmer_lab_correlations.png")
```

```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/Pigmentation/Pgm_Total_F_lmer_lab_correlations.png")
```

## Parasitoid resistance

```{r include=FALSE}
dir.create(file.path("ParasitoidResistance"), showWarnings = FALSE)
```

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Hrcek Lab : Vincent Montbel, Somayeh Rasouli Dogaheh, Jan Hrcek

# Results : Meta-Analyses

```{r echo=FALSE}
# Full .pdf can be downloaded at /MetaAnalyses directory.
knitr::include_graphics("MetaAnalyses/README_META.pdf")
```


The aim of the meta analysis approach is to combine effects from different studies to identify an overall effect. Here, for a given trait, we consider each lab as being a study in which the effect of _Population_ has been assessed via a linear mixed-effect model. However, as we are not directly interested in finding overall effects and because _Population_ has 9 levels, we perform a subgroup meta analysis that allows to test for differences between populations (each population being considered as a subgroup). In a way, this is conceptually similar to performing a regression analysis to test for the effect of _Population_ on a given trait. 

The input data for the subgroup meta analysis consists of the estimates and standard errors obtained for _Population_ in the trait- and lab-specific linear mixed-effect models. Estimates are used as populations effects, and standard errors of those estimates are used as weights --- to give more or less weight to labs depending on sample size and replication level.

This approach can be used to assess differences between populations and generate compound population estimates as input data for downstream analyses. Similarly, this approach can be applied to line random coefficents extracted from the mixed-effect models (in which _Line_ is a random-effect variable) to generate compound line estimates --- note that we are not interested in finding differences between lines here.

## Population differentiation and compound estimates

### Input data

Linear models population estimates are located in the LinearModelsPop directory and trait sub directories. Files with identical names but different extensions contain the same data, they are just in different formats to simplify data handling and browsing. 

```{r echo=FALSE}
dir("../..", recursive = T)[grep("pop_estimates", dir("../..", recursive = T))]
```
Population estimates are available as a list (File 1), in which each element contains estimates for a given trait, or as a table (collapsed list, File 2 and 3). These files contain the population estimates for all the traits.

Alternatively, population estimates are available for each trait separately, for example for Viability:

```{r echo=FALSE}
f <- dir("../..", recursive = T)[grep("pop_model_estimates", dir("../..", recursive = T))]
f[grep("LinearModelsPop/Viability/", f)]
```



```{r load data table}
# read in models estimates for a specific trait, Viability, as a table
estimates_via <- readRDS("LinearModelsPop/Viability/Via_lmers_pop_model_estimates.rds")
print(estimates_via)
```



## Meta analyses model

We run meta analyses trait- and sex-wise using a random-effect model since we assume that effects measured in each lab do not only deviate because of sampling error alone but also because of other sources of variance --- such as lab effect.

```{r wa meta libs}
# packages and function
library(meta)
library(metafor)
source("Code/functions.R") # get makeEffects
```

```{r wa meta}
# read in models estimates for all models as a list
estimates_list <- readRDS("LinearModelsPop/all_models_pop_estimates_list.rds")

# meta analysis
meta_via <- metagen(data = makeEffects(estimates_list$via_lmer), 
                    TE = Y, 
                    seTE = SE, 
                    studlab = Study, 
                    fixed = FALSE, 
                    random = TRUE, 
                    method.tau = "REML")
```

```{r wa subgroup}
# subgroup meta analysis
meta_via_sub <- update.meta(meta_via, subgroup = Population, tau.common = FALSE)
```

As discussed in early September 2022 at the "analyses task force" meeting, partial data (incomple data sets) from Posnien lab has been removed prior to running analyses for Wing Area and Thorax Length. 

Importantly meta analyses have been run for all the traits, including those that have been measured in single labs (Locomotor Activity and Egg-to-pupa Development Time) and thus for which there is no data to combine. Obviously, results from these analyses are not relevant but it allows us to keep those traits in the loop and to streamline the generation of compound estimates --- they will be equal to linear model estimates in the case of the aforementioned traits. The same applies to Thorax Length males, a trait for which some populations have been measured only in one lab. _Population_ subgroup meta analyses have been run for the following 33 traits / sub traits / sex combinations (only 26 of them are actually relevant):

```{r echo=FALSE}
ce <- readRDS("MetaAnalyses/all_models_pop_meta_compound_estimates_list.rds")
print(gsub("MetaAnalyses/_pop_meta_compound_estimates", "", names(ce) ))
```
Also note that glmer estimates (not lmer) were used as input for the Diapause meta analysis.


## Meta analyses output

All meta analyses related outputs are saved in the MetaAnalyses directory and trait sub directories. For example all the _Population_ subgroup analysis files for Viability are listed below:

```{r echo=FALSE}
f <- dir("../..", recursive = T)[grep("pop_meta", dir("../..", recursive = T))]
rev(f[grep("MetaAnalyses/Viability/", f)])
#rev(dir("Viability/")[grep("pop_meta", dir("Viability/"))])
```
File naming is consistent between traits. The _trait_ or _sub trait_ abbrevation (Via for Viability, for other traits such as Wing Area Left it will be WA_L) is followed by _sex_ (NA because not available for Viability, otherwise F or M, and sometimes B when measurements were done on both sexes at the same time) and by the type of _models_ the input data comes from (lmers, can also be glmers). Files with identical names but with different extensions contain the same data but are saved in different formats to facilitate both data handling and browsing. Raw results of the subgroup analysis are stored in Files 1 and 2, which are then used to extract population summary effects (compound estimates) and analysis statistics (Files 5 and 6). Files 3 and 4 are graphic representations of the subgroup analysis results.


### Model results

Below are shown the raw results of the Viabilty meta analysis (files 1 and 2):
```{r}
# meta results for Viability
meta_via <- readRDS("MetaAnalyses/Viability/Via_NA_lmers_pop_meta.rds")
print(meta_via)
```

We are mainly interested in the second part of the meta analysis output, starting from the "Results for subgroups (random effects model)" table. For each population one can extract a summary effect (compound estimate) with its 95% confidence interval as well as the number of labs that have contributed to phenoytyping (k). Differences between populations can be assessed with the _Q_ statistic shown in the "Test for subgroup differences (random effects model)" part of the model output. In short, the _Q_ statistic quantifies the heterogeneity between the different subgroups, the higher the _Q_ value the greater the heterogeneity. Under the null hypothesis of no differences between subgroups, _Q_ follows a central $\chi^2$ distribution with degrees of freedom equal to k subgroups - 1, so one can report a _p_ value for any observed value of _Q_. In the case of Viability, _Q_ = 100.09 and is statistically significant (_p_ < 0.0001), meaning that _Population_ does have a significant effect on Viability.

### Compound population estimates

Compound population estimates (population summary effects) and their 95% confidence intervals were extracted from the meta analyses results and stored in Files 5 and 6. Below is an example for Viability:

```{r load comp pop via}
# read in population compound estimates
comp_pop_via <- readRDS("MetaAnalyses/Viability/Via_NA_lmers_pop_meta_compound_estimates.rds")
print(select(comp_pop_via, -c(Models, Sex, SE, N_lab_av))) # for clarity
```


### Visualisation of the meta analyses results

Results can be represented with a simplified forest plot (Files 3 and 4) where population summary effects (compound estimates) and populations are represented on x and y axis, respectively (Figure \@ref(fig:meta-plot-example)).


```{r meta-plot-example, echo=FALSE, out.width="50%", fig.cap="Subgroup meta analysis for Viability. N indicates the average number of labs that have phenotyped the different populations.", fig.align = "center"}
knitr::include_graphics("MetaAnalyses/Viability/Via_NA_lmers_pop_meta_summary_effect.pdf")
```


### Compiled data for all traits

Compiled population compound estimates, meta analyses statistics and composite figures for all traits are available in the MetaAnalyses directory:

```{r echo=FALSE}
dir("../..", recursive = T)[grep("all_models_pop_meta", dir("../..", recursive = T))]

#dir()[grep("pop", dir())]
```

All meta analyses main statistics are compiled in a single table (Files 4 and 6). _P_ values were corrected for multiple testing using Bonferroni and Benjamini Hochberg procedures (For Bonferroni n= 26 which corresponds to the number of "relevant" meta analyses that have been performed, see above). As mentioned earlier in the document, statistics for Locomotor Activity, Egg-to-pupa Development Time and Thorax Length in males should not be considered and have been filtered out from this table, leaving results for only 26 traits.

```{r}
# meta compiled statistics
meta_stats <- readRDS("MetaAnalyses/all_models_pop_meta_pvalues.rds")
print(meta_stats %>% mutate_at(vars(contains(c("P", "Q"))), round, 3))
```

Statistics such as _Q_ and _p_ values for all traits can be visualised on a single graph (File 5 and Figure \@ref(fig:meta-plot-pvalues)). 

```{r meta-plot-pvalues, echo=FALSE, out.width="50%", fig.cap="All meta analyses Q statistics and p values.", fig.align = "center"}
knitr::include_graphics("MetaAnalyses/all_models_pop_meta_pvalues.pdf")
```


Compiled compound population estimates for all traits are available both as a list (File 1) or a table (collapsed list, Files 2 and 3).
```{r}
# population compoud estimates as list
comp_pop_list <- readRDS("MetaAnalyses/all_models_pop_meta_compound_estimates_list.rds")
lapply(comp_pop_list, function(x) select(x, -c(Models, SE, N_lab_av))) %>% head(4)
```


Finally population summary effects for all traits can be visualized with a composite figure of all the meta analyses results (Files 7 and 8, Figure \@ref(fig:meta-fig-main)).


```{r meta-fig-main, echo=FALSE, fig.cap="Meta analyses population summary effects for all 26 traits.", fig.align = "center"}
knitr::include_graphics("MetaAnalyses/all_models_pop_meta_summary_effect.pdf")
```

## Compound line estimates

The meta analysis approach described for _Population_ has also been used to generate line compound estimates.

### Input data

Compiled line random coefficients extracted from the linear models outputs:
```{r echo=FALSE}
dir("../..", recursive = T)[grep("all_models_line_random_coefs", dir("../..", recursive = T))]
```

Trait-specific line random coefficients extracted from the linear models outputs, for example for Viability:
```{r echo=FALSE}
f <- dir("../..", recursive = T)[grep("line_random_coefs", dir("../..", recursive = T))]
f[grep("LinearModelsPop/Viability/", f)]
```

### Meta analyses model

The only difference with the _Population_ subgroup meta analyses is that here subgroups are defined by the _Line_ variable.

Importantly, as previously mentionned in the _Population_ meta analyses section, meta analyses for _Line_ have been run for all the traits, including those that have been measured in single labs (Locomotor Activity and Egg-to-pupa Development Time). In addition, even for traits involving several labs, some lines might have been measured only once. Again, results from these analyses are meaningless and should not be considered but it allows us to keep those traits in the loop and to streamline the generation of compound estimates. _Line_ subgroup meta analyses have been run for the following 32 traits to generate line compound estimates:

```{r echo=FALSE}
rc <- readRDS("MetaAnalyses/all_models_line_meta_compound_random_coefs_list.rds")
print(gsub("MetaAnalyses/_line_meta_compound_random_coefs", "", names(rc) ))
```

Note that we could not run the analysis for Locomotor Activity AbsPhase since line random coefficients are not available for that particular trait --- _Line_ could not be included as a random-effect factor in the linear model. For Diapause, we ran the meta analysis using the glmer models estimates only.

Finally partial data (incomple data sets) from Posnien lab has been removed prior to running analyses for Wing Area and Thorax Length, to match what has been done in the _Population_ meta analyses.

### Meta analyses output

We are not interested in testing for differences between lines, we just want to extract line summary effects (compound estimates), so there is not much to be shown here. However analyses raw results are still available for each trait, for example for Viability:

```{r echo=FALSE}
f <- dir("../..", recursive = T)[grep("line_meta", dir("../..", recursive = T))]
f <- f[grep("MetaAnalyses/Viability/", f)]
rev(f[grep("random_coefs", f, invert = T)])
#rev(dir("Viability/")[grep("pop_meta", dir("Viability/"))])
```

#### Compound line estimates

Compound line estimates (line summary effects) and their 95% confidence intervals were extracted from the meta analyses raw results for each trait. Below are listed the files for Viability:
```{r echo=FALSE}
f <- dir("../..", recursive = T)[grep("line_meta_compound", dir("../..", recursive = T))]
rev(f[grep("MetaAnalyses/Viability/", f)])
#rev(dir("Viability/")[grep("pop_meta", dir("Viability/"))])
```

#### Compiled data for all traits

Line compound estimates for all traits have been exported as a list, table and wide table:

```{r echo=FALSE}
dir("../..", recursive = T)[grep("all_models_line_meta", dir("../..", recursive = T))]

#dir()[grep("pop", dir())]
```
```{r}
# wide table, showing the first 30 lines and first 6 traits
lc_wide <- read.csv("MetaAnalyses/all_models_line_meta_compound_random_coefs_wide.csv")
print(lc_wide[1:30, 1:8])
```

## Results overview 

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/all_models_pop_meta_summary_effect.pdf")
```

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/all_models_pop_meta_pvalues.pdf")
```

## Plots by Trait  

### Viability

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Viability/Via_NA_lmers_pop_meta_summary_effect.pdf")
```

### Development Time

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/DevelopmentTime/DT_A_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/DevelopmentTime/DT_A_M_lmers_pop_meta_summary_effect.pdf")
```

### Dry weight

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/DryWeight/DW_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/DryWeight/DW_M_lmers_pop_meta_summary_effect.pdf")
```

### Thorax length

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/ThoraxLength/TL_F_lmers_pop_meta_summary_effect.pdf")
```

### Wing area

_Left_
_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/WingArea/WA_L_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/WingArea/WA_L_M_lmers_pop_meta_summary_effect.pdf")
```

_Right_
_Females_
```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/WingArea/WA_R_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/WingArea/WA_R_M_lmers_pop_meta_summary_effect.pdf")
```

### Fecundity

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Fecundity/Fec_F_lmers_pop_meta_summary_effect.pdf")
```

### Lifespan

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Lifespan/LS_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Lifespan/LS_M_lmers_pop_meta_summary_effect.pdf")
```

### Cold-shock mortality

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/ColdShock/CSM_F_lmers_pop_meta_summary_effect.png")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/ColdShock/CSM_M_lmers_pop_meta_summary_effect.pdf")
```


### Chill-coma recovery time

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/ChillComa/CCRT_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/ChillComa/CCRT_M_lmers_pop_meta_summary_effect.pdf")
```


### Heat-shock mortality

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/HeatShock/HSM_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/HeatShock/HSM_M_lmers_pop_meta_summary_effect.pdf")
```

### Diapause

Using GLMER estimates
```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Diapause/Dia_F_glmers_pop_meta_summary_effect.pdf")
```

### Starvation resistance

_Females_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Starvation/SR_F_lmers_pop_meta_summary_effect.pdf")
```

_Males_

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Starvation/SR_M_lmers_pop_meta_summary_effect.pdf")
```

### Pigmentation

```{r echo=FALSE}
knitr::include_graphics("MetaAnalyses/Pigmentation/Pgm_Total_F_lmers_pop_meta_summary_effect.pdf")
```

# Results : Environmental Variables  

```{r eval=FALSE, echo=TRUE}
# All model outputs can be found in :

lmers_lat <- readRDS("LinearModelsLat/all_lmers_lat_anova_list.rds")
lmers_lon <- readRDS("LinearModelsLon/all_lmers_lon_anova_list.rds")
lmers_alt <- readRDS("LinearModelsAlt/all_lmers_alt_anova_list.rds")
```

## Geography - Latitude 

```{r, echo=FALSE}
pval_table_lat <- read.csv("LinearModelsLat/all_models_lat_pvalues.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_table_lat, options = list(pageLength = 25)) %>% formatRound(6, 4)
```

## Geography - Longitude

```{r, echo=FALSE}
pval_table_lon <- read.csv("LinearModelsLon/all_models_lon_pvalues.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_table_lon, options = list(pageLength = 25)) %>% formatRound(6, 4)
```

## Geography - Altitude

```{r, echo=FALSE}
pval_table_alt <- read.csv("LinearModelsAlt/all_models_alt_pvalues.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_table_alt, options = list(pageLength = 25)) %>% formatRound(6, 4)
```

## Geography - Altitude

# Results : GeoCorrelations

## Latitude - Line
```{r}
knitr::include_graphics("GeoCorrelations/line_lat_pearson_correlations_facets.pdf")
```

```{r}
knitr::include_graphics("GeoCorrelations/line_lat_pearson_correlations.pdf")
```

## Latitude - Population
```{r}
knitr::include_graphics("GeoCorrelations/pop_lat_pearson_correlations_facets.pdf")
```

```{r}
knitr::include_graphics("GeoCorrelations/pop_lat_pearson_correlations.pdf")
```

## Longtitude - Line
```{r}
knitr::include_graphics("GeoCorrelations/line_lon_pearson_correlations_facets.pdf")
```

```{r}
knitr::include_graphics("GeoCorrelations/line_lon_pearson_correlations.pdf")
```

## Longtitude - Population
```{r}
knitr::include_graphics("GeoCorrelations/pop_lon_pearson_correlations_facets.pdf")
```

```{r}
knitr::include_graphics("GeoCorrelations/pop_lon_pearson_correlations.pdf")
```

# Results : Diet

## Overview

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_traits_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_traits_pop_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_lab_traits_pop_facets.pdf")
```

### Cold-shock mortality
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_CSM_pop_facets.pdf")
```

### Diapause
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Dia_pop_facets.pdf")
```

### Development time
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_DT_A_pop_facets.pdf")
```

### Dry weight
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_DW_pop_facets.pdf")
```

### Fecundity
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Fec_pop_facets.pdf")
```

### Heat-shock mortality
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_HSM_pop_facets.pdf")
```

### Lifespan
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_LS_pop_facets.pdf")
```

### Pigmentation
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Pgm_T4_pop_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Pgm_T5_pop_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Pgm_T6_pop_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Pgm_Total_pop_facets.pdf")
```

### Starvation resistance 
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_SR_pop_facets.pdf")
```

### Thorax length
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_TL_pop_facets.pdf")
```

### Viability
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_Via_pop_facets.pdf")
```

### Wing area
```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_WA_L_pop_facets.pdf")
```

```{r}
knitr::include_graphics("Diets/DrosEU_Diets_PC_ratios_WA_R_pop_facets.pdf")
```

## PCAs with ~similar P:C ratio datasets 

Notes
- Using model estimates for line rather than raw data (scaled to
unit variance).
- Comparing all data (i.e. the previous analysis) with estimates
from a single lab but with similar P:C ratio in diet.
- TL is missing from males
- Lmer estimates (rather than glmer estimates used for dia)
- Sexes dealt with separately
  - PCA1 (M9) – male PCA with 9 traits
  - PCA2 (F9) – female PCA with 9 traits equivalent to males
  - PCA3 (Fmax) – female PCA with all 12 female traits
  - PCA4 (FmaxPlus) – female PCA with 13 traits (12 female traits + via)
- Loadings of traits on to PCs are considered of interest if greater
than > 0.4 (or < -0.4).
  - Loadings > 0.6 are in bold red
  - Lodings from 0.4 - 0.59 are in dark red

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd1.pdf")
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd2.pdf")
```

### PCA 1 differences

- The main axes of variation have ‘swapped’.  
  - In the all data analysis, CCRT + CSM (-ve) and DW + WA (+ve) load on to PC1, in the P:C control, they load onto PC2.  
  - In all data, HSM + LS (-ve) and WA (+ve) load on to PC2, in the P:C control they load onto PC1  
  - A direct inverse correlation between HSM and CSM + SR has strengthened for PC3 in the P:C control  
- What could be driving changes?  
  - There is no TL in P:C control, so the body size correlations may be less strong?  
  - In the P:C control DT_A loads onto PC1 (but in all data it only loads
strongly onto PC4)

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd3.pdf")
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd4.pdf")
```

### PCA 2 results
- The main axis of variation (PC1) is fairly similar  
    - In both all data and P:C control size traits (DW, TL and WA) positively correlate. In all data they negatively correlate to LS, and in P:C control they positively correlate with DT_A.  

- The negative correlation between CCRT and CSM moves from PC2 in all data to PC3 in P:C control, and the negative correlation between CSM and HSM is weaker (loading < 0.4)

- Some trait correlations along PC2 and PC3 appear to have broken down

- Again, it seems like DT_A is driving these changes (it correlates with both PC1 and PC2 in P:C control, but only PC4 in all data

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd5.pdf")
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd6.pdf")
```

### PCA 3 results 
- Similar to PCA 2 results in some ways: the main axis of variation (PC1) is again a size correlation:

  - In both all data and P:C control size traits (DW, TL and WA) positively correlate. In all data they negatively correlate to LS, and in P:C control they positively correlate with DT_A and Pigm.
  
- The negative correlation between CCRT and CSM moves from PC3 in all data to PC2 in P:C control (similar but inverse to PCA 2 result).

- Possible negative correlation between CSM and HSM, bu 
weaker (loading < 0.4)

- DT_A effect? Loss of fecundity correlations?

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd7.pdf")
knitr::include_graphics("LinearModelsPop/PCA_ControlledDiet/PCAd_4_Rmd/PCAd_r_Rmd8.pdf")
```

### PCA 4 results

- Similar results to PCA 2 and PCA 3.

- Negative correlation between CSM and HSM on PC3 is now maintained with highish loadings (> 0.4), although correlation of dia has switched signs.
  
  - Across PCA 3 and PCA 4 there is a disassociation of the all data PC3 (+CCRT +dia +HSM –CSM)

- Again, DT_A is strong, viability and fecundity do not retain high loading for PC1, 2 or 3

### Summary

Summary
- Some important changes to trait correlations between all data and P:C controlled data. Some patterns remain similar, but the North/South divide (at least in females) is less clear.

- Strong effect of development time, suggesting that DT_A variability may be more influenced by diet than other traits? Perhaps not surprising, given nutritional/resource thresholds for metamorphosis?

- On the other hand, fecundity, viability (and to a lesser extent life span) lose importance 

– why might this be?

  - Could inter-line (genotypic) variability be more important in these traits than diet-induced variability?
  
# Results : Lab Correlations

## Pearson's - Line
```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("LabCorrelations/lab_correlation_line_pearson.pdf")
```

## Pearson's - Population
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/lab_correlation_pop_pearson.pdf")
```

## Spearman's - Line
```{r echo=FALSE}
knitr::include_graphics("LabCorrelations/lab_correlation_pop_spearman.pdf")
```

# Results : Trait Correlations 

* Input data : line means
* Input data : line means extracted either from models with Lab as a random effect or from meta analyses estimates (or both)
(i) Correlations between all pairs of traits using 
- Pearson’s 
- Spearman’s
- Distance correlations
(ii) MANOVA on line means 
(iii) PCAs

## Pearson's 
```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_f9_line_random_coefs_diet.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_f9_line_random_coefs.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_fmax_line_random_coefs_diet.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_fmax_line_random_coefs.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_fmaxp_line_random_coefs_diet.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_fmaxp_line_random_coefs.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_m9_line_random_coefs_diet.pdf")
```

```{r}
knitr::include_graphics("TraitCorrelations/trait_correlations_m9_line_random_coefs.pdf")
```

## PCA

__**Notes**__
- Using model estimates for line rather than raw data (scaled to unit variance).

- Sexes dealt with seperately

- PCA1 (M9) – male PCA with 9 traits

- PCA2 (F9) – female PCA with 9 traits equivalent to males

- PCA3 (Fmax) – female PCA with all 12 female traits

- PCA4 (FmaxPlus) – female PCA with 13 traits (12 female traits + viability)

- Loadings of traits on to PCs are considered of interest if greater than > 0.4 (or < -0.4).

  - Loadings __> 0.6__ are in __bold red__
  - Loadings from __0.4__ - __0.59__ are in __dark red__

```{r echo=FALSE}
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_1.png")
```

### PCA 1 results

- PC1 accounts for 25.23% of the variance

- PC1: high trait loading values (>0.5):
  
  - WA, DW, SR = +ve PC1
  
  - CCRT, CSM = –ve PC1.
  
  - Por/Aus/Ukr/Rus = +ve PC1 (large, resistant to starvation & cold)
  
  - Tur/Spa = –ve PC1 (small, susceptible to starvation & cold)

- PC2: high trait loading values (>0.5):
  
  - TL, WA +ve PC2,
  
  - LS, HSM –ve PC2
  
  - Por/Tur/Spa = +ve PC2 (large, short-lived, resistant to heat)
  
  - Den/Fin. = -ve PC2 (small, long-lived, susceptible to heat)


```{r, echo=FALSE}
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_2.png")
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_3.png")
```

### PCA 2 results

- PC1 accounts for 23.61% of the variance

- PC1: high trait loading values (>0.4):

  - DW, WA, TL, SR = +ve PC1

  - LS = –ve PC1.

  - Por/Aus = +ve PC1 (large, resistant to starvation)

  - Tur/Fin/Spa = –ve PC1 (small, susceptible to starvation)

- PC2: high trait loading values (>0.4):

  - LS, SR +ve PC2,

  - TL –ve PC2

  - Den/Rus/Fin = +ve PC2 (small, long-lived, resistant to starvation)

  - Tur/Ukr/Por = -ve PC2 (large, short-lived, susceptible to starvation)

- PC3: high trait loading values (>0.5):

  - CCRT, HSM +ve PC3,

  - CSM –ve PC3

  - Ukr/Fin = +ve PC3 (resistance to cold, susceptible to heat)

  - Tur/Spa/Den = -ve PC3 (susceptible to cold, resistant to heat)

```{r, echo=FALSE}
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_4.png")
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_5.png")
```

### PCA 3 results

- PC1 accounts for 18.61% of the variance

- PC1: high trait loading values (>0.4):

  - DW, WA, TL, SR = +ve PC1

  - LS = –ve PC1.

  - Por/Aus/Ukr = +ve PC1 (large, resistant to starvation)

  - Tur/Fin/Spa = –ve PC1 (small, susceptible to starvation)

- PC2: high trait loading values (>0.4):

  - Fec, SR, LS +ve PC2,

  - TL –ve PC2

  - Den/Rus/Fin = +ve PC2 (small, long-lived, resistant to starvation)

  - Tur/Ukr/Por = -ve PC2 (large, short-lived, susceptible to starvation)

- PC3: high trait loading values (>0.4):

  - HSM, Pigm, dia, CCRT +ve PC3,

  - CSM –ve PC3

  - Ukr/Aus = +ve PC3 (resist cold, suscept heat, higher diap, more pigm)

  - Spa/Den/Por = -ve PC3 (suscept cold, resist heat, lower diap, less pigm)


```{r echo=FALSE}
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_6.png")
knitr::include_graphics("EnvironmentalAnalysis/PCA_Results/PCA_4_Rmd/PCA_4_Rmd_Page_7.png")
```


### PCA 4 results

- PC1 accounts for 16.73% of the variance

- PC1: high trait loading values (>0.4):

  - WA, DW, TL, SR = +ve PC1

  - LS = –ve PC1.

  - Por/Aus/Ukr = +ve PC1 (large, resistant to starvation)

  - Fin/Spa/Tur = –ve PC1 (small, susceptible to starvation)

- PC2: high trait loading values (>0.4):

  - Via, Fec, SR, HSM, LS +ve PC2,

  - 0 traits –ve PC2

  - Fin/Den/Ger = +ve PC2 (High via & fec, long-lived, resist starve, suscept. heat)

  - Tur/Spa/Por = -ve PC2 (Low via & fec, short-lived, suscept. starve, resist heat)

- PC3: high trait loading values (>0.4):

  - HSM, dia, Pigm, CCRT +ve PC3,

  - CSM –ve PC3

  - Ukr/Aus = +ve PC3 (resist cold, suscept heat, higher diapause, more pigm)

  - Spa/Den/Rus = -ve PC3 (suscept cold, resist heat, lower diapause, less pigm)


###Summary

- PC1 always includes positive correlation of dry weight, wing area and starvation resistance as well as….

  - … negative corr. with CSM in males
  
  - … negative corr. with life span in females
  
  - Por/Aus (+ Ukr/Rus) are positive
  
  - Tur/Spa (+ Fin) are negative

- PC2 differs somewhat between males and females (note ‘+’ and ‘–’ switch)

  - In males:

    - +ve correlation with thorax length and wing area

    - -ve correlation with HSM and lifespan

    - Por/Tur/Spa are positive

    - Den/Fin are negative

  - In females:

    - -ve correlation with thorax length

    - +ve correlation with lifespan and starvation resistance (+ fecundity and viability)

    - Tur/Por (+ Ukr/Spa) are negative

    - Den/Fin (+ Rus/Ger) are positive

- PC3 potentially interesting in females…

  - Positive correlation between HSM and CCRT (+ diapause and pigmentation)

  - Negative correlation with CSM

  - Ukr (+Aus/Fin) are positive

  - Spa/Den (+Tur/Rus/Por) are negative

  - Interestingly, in males HSM and CCRT negatively correlate with one another on PC3….

## Trait Correlations & Discriminant Function Analyses

### Females 

```{r out.width="50%"}
knitr::include_graphics("TraitCorrelations/FromMR/FemaleParCor.png")
knitr::include_graphics("TraitCorrelations/FromMR/FemaleDis.png")
```

### Males

```{r out.width="50%"}
knitr::include_graphics("TraitCorrelations/FromMR/MaleCor.png")
knitr::include_graphics("TraitCorrelations/FromMR/MaleParCor.png")
knitr::include_graphics("TraitCorrelations/FromMR/MaleDis.png")
```

# Results : Climatic variables _add AB results_

```{r eval=FALSE, include=FALSE}
VT_results <- readxl::read_xlsx("EnvironmentalAnalysis/PCA_clim/TraitsCombined/summary_all_traits_compare_30y_vs_30d.xlsx")
DT::datatable(VT_results, options = list(pageLength = 10))
```

For the analyses of the climatic variables, two time periods were chosen: 30 years (to trace the long-lasting climatic effects) and 30 days (short weather effect, on average over a couple generations for different localities, to account for maternal/grand-maternal effects). 14 climatic variables data (see the list below) was downloaded from the NASA database using R package “nasapower” and PCA analysis was done with “FactoMineR” package.

```{r}
ClimVarPCA <- read.csv("EnvironmentalAnalysis/PCA_clim/TraitsCombined/ClimVar4PCA_4Rmd.csv")
knitr::kable(ClimVarPCA, caption = 'Table X: List of the climatic variables used in PCA.')
```

__PCA for 30 days data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_PCA.png")
```

__PCA for 30 years data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_PCA.png")
```

First two PCs in both datasets had eigen values >1 explaining 94.7% (30 days) and 89.8% (30 years) and were used in the further analyses.


__PCA for 30 days data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_scree_plot.png")
```

__PCA for 30 years data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_scree_plot.png")
```

The populations are separated in two dimensions rather differently in two datasets - possibly because the short-term climate data (30 days) does not include winter (cold season).


__PCA for 30 days data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_PCA_pops.png")
```

__PCA for 30 years data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_PCA_pops.png")
```

Contribution of PCs

PC1 is mostly affected by the temperature values (but not only), while precipitation/humidity is among strongest contributors to PC2.

__PCA for 30 days data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_PC1_contr.png")
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_PC2_contr.png")
```

__PCA for 30 years data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_PC1_contr.png")
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_PC2_contr.png")
```

Correlation with geographical coordinates

__PCA for 30 days data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30d_correlations.png")
```

__PCA for 30 years data__ 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/graphs/30y_correlations.png")
```

Analysis of the trait PCA (Ewan) with the climate data PCA (above). 

```{r}
knitr::include_graphics("EnvironmentalAnalysis/PCA_clim/TraitsCombined/ClimVarTable_4Rmd.png")
```

There is a strong association of trait PC2 with climate PCs in both datasets. However, the association of the trait PC3 with climate PCs is clear in 30-years dataset (in 30-day dataset - only clim PC2 shows association in F9 set).



# Results : GDM

_**Please refer to /GDM folder for details.**_


```{r echo=FALSE}
GDM_table1 <- read.csv("GDM/GDM_table1.csv")
GDM_table2 <- read.csv("GDM/GDM_table2.csv")
GDM_table3 <- read.csv("GDM/GDM_table3.csv")
```

```{r echo=FALSE, message=FALSE}
knitr::kable(GDM_table1, caption = 'Table 1: Predictor variables identified as important in GDMs.')
```

```{r echo=FALSE, message=FALSE}
knitr::kable(GDM_table2, caption = 'Table 2: Proportion of variation in phenotypic variables that explained by each model')
```

```{r echo=FALSE, message=FALSE}
knitr::kable(GDM_table3, caption = 'Table 3: Result of generalized dissimilarity model for phenotypic variables, the most important predictor variables were shown in bold. ')
```

## Dry weight
```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/DW_M/DW_M_vapr7_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/DW_M/DW_M_bio2_i-spline.jpeg")
```

## Fecundity
```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/Fec/Fec_srad01_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/Fec/Fec_wind07_i-spline.jpeg")
```

## Lifespan
```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_F/LS_F_srad05_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_F/LS_F_bio10_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_F/LS_F_vapr06_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_F/LS_F_wind08_ispline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_M/LS_M_GDM_srad05_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_M/LS_M_GDM_srad06_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_M/LS_M_GDM_prec10_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/LS_M/LS_M_GDM_wind12_i-spline.jpeg")
```

## Thorax length
```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/TL_F/TL_F_perc05_i-spline.jpeg")
```

```{r, out.width="50%"}
  knitr::include_graphics("GDM/GDM_Worldclim/TL_F/TL_F_srad06_i-spline.jpeg")
```

```{r, out.width="50%"}
  knitr::include_graphics("GDM/GDM_Worldclim/TL_F/TL_F_wind12_i-spline.jpeg")
```

## Wing area
```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_L_M/WA_L_M_wind08_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_L_M/WA_L_M_vapr06_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_R_F/WA_R_F_wind8_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_R_F/WA_R_F_vapr8_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_R_F/WA_R_F_bio8_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_R_M/WA_R_M_wind08_i-spline.jpeg")
```

```{r, out.width="50%"}
knitr::include_graphics("GDM/GDM_Worldclim/WA_R_M/WA_R_M_vapr06_i-spline.jpeg")
```

# Results : Heritability

* Input data line means per lab and each lab is a replicate
* Input data line means for each lab
* Intraclass correlations (David et al. 2005)
* Evolvability 


```{r echo=FALSE, message=FALSE}
h2_rc_btwlabs <- read.csv("Heritability/H2_line_random_coefs_between_labs.csv")
DT::datatable(h2_rc_btwlabs, options = list(pageLength = 10)) %>% formatRound(4:6, 3)

```

```{r echo=FALSE, message=FALSE}
h2_data_btwlabs <- read.csv("Heritability/H2_line_raw_data_between_labs.csv")
DT::datatable(h2_data_btwlabs, options = list(pageLength = 10)) %>% formatRound(4:6, 3)
```

```{r echo=FALSE, message=FALSE}
h2_data_withinlabs <- read.csv("Heritability/H2_line_raw_data_within_labs.csv")
DT::datatable(h2_data_withinlabs, options = list(pageLength = 10)) %>% formatRound(4:7, 3)
```


# Results : Wolbachia

## Population

```{r, echo=FALSE}
pval_Wolb_pop <- read.csv("LinearModelsPop_Wolb/all_models_pop_pvalues_Wolb.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_Wolb_pop, options = list(pageLength = 10)) %>% formatRound(6:6, 3)
```

```{r echo=FALSE}
knitr::include_graphics("LinearModelsPop_Wolb/all_models_pop_pvalues_Wolb.pdf")
```

## Latitude 

```{r, echo=FALSE}
pval_Wolb_lat <- read.csv("LinearModelsLat_Wolb/all_models_lat_pvalues_Wolb.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_Wolb_lat, options = list(pageLength = 10)) %>% formatRound(6:6, 3)
```

```{r echo=FALSE}
knitr::include_graphics("LinearModelsLat_Wolb/all_models_lat_pvalues_Wolb.pdf")
```

## Longitude

```{r, echo=FALSE}
pval_Wolb_lon <- read.csv("LinearModelsLon_Wolb/all_models_lon_pvalues_Wolb.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_Wolb_lon, options = list(pageLength = 10)) %>% formatRound(6:6, 4)
```


```{r echo=FALSE}
knitr::include_graphics("LinearModelsLon_Wolb/all_models_lon_pvalues_Wolb.pdf")
```


## Altitude

```{r, echo=FALSE}
pval_Wolb_alt <- read.csv("LinearModelsAlt_Wolb/all_models_alt_pvalues_Wolb.csv")
```

```{r, echo=FALSE}
DT::datatable(pval_Wolb_alt, options = list(pageLength = 10)) %>% formatRound(6:6, 3)
```


```{r echo=FALSE}
knitr::include_graphics("LinearModelsAlt_Wolb/all_models_alt_pvalues_Wolb.pdf")
```


# Results : UPGMA trees 

Here are some example UPGMA trees from Jorge and Cristina -- please refer to /UPGMATrees folder for all of the trees. 

_CCRT Female_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/CCRT_F_meta_summary.txt.Mensch.png")
```

_CSM Female_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/CSM_F_meta_summary.txt.Gonzalez.png")
```

_DT_A Female_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/DT_A_F_meta_summary.txt.Hoedjes.png")
```

_DW Male_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/DW_M_meta_summary.txt.Colinet.png")
```

_SR Female_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/SR_F_meta_summary.txt.Pasyukova.png")
```

_WA_R Female_

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("UPGMATrees/WA_R_F_meta_summary.txt.StamenkovicRadak.png")
```

# Results : Qst - Fst  _tbd_
# _Extra : Species Distribution Model_

## SDM_Maxent_WorldClim

```{r eval=FALSE, include=FALSE}
htmltools::includeHTML("SDM_Maxent_worldclime/Results/Dmelanogaster.html")
```

```{r echo=FALSE}
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_1.png")
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_2.png")
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_3.png")
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_4.png")
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_5.png")
knitr::include_graphics("SDM_Maxent_worldclime/SDM_4_Rmd/DrosEU_PhenotypingWG_Page_6.png")
```

# References

## GDM

- Baldassarre, D. T., Thomassen, H. A., Karubian, J., & Webster, M. S. (2013). The role of ecological variation in driving divergence of sexual and non-sexual traits in the red-backed fairy-wren (Malurus melanocephalus). BMC Evolutionary Biology, 13(1), 75. doi:10.1186/1471-2148-13-75

- Ferrier, S., Manion, G., Elith, J., & Richardson, K. (2007). Using generalized dissimilarity modelling to analyse and predict patterns of beta diversity in regional biodiversity assessment. Diversity and Distributions, 13(3), 252-264. doi:https://doi.org/10.1111/j.1472-4642.2007.00341.x

- Thomassen, H. A., Buermann, W., Milá, B., . . . Smith, T. B. (2010). Modeling environmentally associated morphological and genetic variation in a rainforest bird, and its application to conservation prioritization. Evolutionary Applications, 3(1), 1-16. doi:https://doi.org/10.1111/j.1752-4571.2009.00093.x

## Heritability

- David, J., Gibert, P., Legout, H. et al. Isofemale lines in Drosophila: an empirical approach to quantitative trait analysis in natural populations. Heredity 94, 3–12 (2005). https://doi.org/10.1038/sj.hdy.6800562

## SDM

- Mina Hojat Ansari, Steven J.B. Cooper, Michael P. Schwarz, Mehregan Ebrahimi, Gaynor Dolman, Leah Reinberger, Kathleen M. Saint, Stephen C. Donnellan, C. Michael Bull, Michael G. Gardner, Plio-Pleistocene diversification and biogeographic barriers in southern Australia reflected in the phylogeography of a widespread and common lizard species, Molecular Phylogenetics and Evolution, Volume 133, 2019, Pages 107-119, ISSN 1055-7903, https://doi.org/10.1016/j.ympev.2018.12.014.