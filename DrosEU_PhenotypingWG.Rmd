---
title: "**DrosEU Phenotyping Working Group Updates **"
author: "by Esra Durmaz Mitchell"
date: "Last updated: `r format(Sys.Date())`"
output: 
  html_document:
    keep_md: true
    toc: true
    toc_depth: 4
    toc_float: true
    theme: yeti  
---


# Phenotyping effort

**Collaborative phenotyping effort of European _Drosophila melanogaster_ populations**  

Genomic analyses (Kapun et al. 2020) showed that there is longitudinal population structure, continent-wide sweeps, candidate genes for local climate adaptation by using 48 pooled population samples from 32 locations.

In 2017, DrosEU consortium has decided to make a collaborative phenotyping effort of European _Drosophila melanogaster_ populations at the Groningen meeting. 

The call was made with approximate numbers of populations, lines, etc. and under predefined criteria (finish within a year, reps, blocks, etc) and participating labs have indicated which traits they are willing to phenotype. 

## Sampling Locations

```{r libraries, echo=FALSE, message=FALSE}

setwd("/Users/durmazm/Documents/GitHub/DrosEU_PhenotypingWG/")
library(tidyverse)
library(ggpubr)
library(multcompView)
library(hrbrthemes)
library(rworldmap)
library(maps)
library(rnaturalearth)
library(maptools)
library(rgeos)
library(qwraps2)
library(afex)
library(Hmisc)
library(lme4)
library(nlme)
library(multcomp)
library(emmeans)
library(coxme)
library(knitr)
library(sf)
library(rnaturalearthdata)
library(cowplot)
library(googleway)
library(ggrepel)
library(ggspatial)
library(DT)
library(data.table)
library(meta)
library(metafor)
library(survival)
library(survminer)
```

Nine sampling locations were chosen based on genomic data and cover a wide range of latitude (~20°) and longitude (~40°) across the continent  (see table below). From each location, 15 to 20 isofemale lines were established in corresponding labs at the sampling location and the isofemale lines were centrally maintained by Élio Sucena  at Instituto Gulbenkian de Ciência (IGC), Lisbon, Portugal. A total of 173 isofemale lines were used in this study. 


```{r droseu_coord, echo=FALSE, message=FALSE}
droseu_coord <- read.csv("DrosEU_Coordinates.csv")

droseu_coord <- data.frame(droseu_coord %>%
  add_column(Collector = c("Jorge Vieira", "Josefa Gonzalez", "Mads Schou", "Amanda Glaser-Schmitt","Andrea Betancourt","Maaria Kankare","Iryna Kozeretska","Banu Onder","Elena Pasyukova")))
```

```{r echo=FALSE, message=FALSE}
knitr::kable(droseu_coord, align = "llcccl", caption = 'Table X. Sampling locations, coordinates and collectors, sorted by increasing latitude')
```

```{css, echo = FALSE}
caption {
      color: black;
      font-weight: bold;
      font-size: 1.0em;
    }
```

```{r samples_map, echo=FALSE, message=TRUE}
world <- ne_countries(scale = "medium", returnclass = "sf")
samples_map <- ggplot(data = world) + geom_sf() + xlab("Latitude") + ylab("Longitude") + ggplot2::coord_sf(xlim = c(-12, 38), ylim = c(30, 65), expand = FALSE) + annotation_scale(location = "bl", width_hint = 0.5) + ggtitle("Sampling locations")
```

```{r map_theme, echo=FALSE, message=FALSE}
map_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black",), axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 14, colour = "black"),axis.text.y = element_text(size = 14, colour = "black"),axis.title.y = element_text(size = 16), plot.title = element_text(color="black", size=14, face="bold"))
```

```{r panmix_theme, echo=FALSE, message=FALSE}
panmix_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black",), axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16, colour = "black"), axis.text.y = element_text(size = 16, colour = "black"),axis.title.y = element_text(size = 16))
```

```{r samples_map_2, echo=FALSE, message=TRUE}
samples_map + map_theme + 
  annotate(geom = "point", x = -8.410, y = 41.150, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 0.620, y = 41.618,colour = "orange", size = 3) + 
  annotate(geom = "point", x = 10.213, y = 55.945, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 32.260, y = 40.231, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 11.610, y = 48.180, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 15.560, y = 48.375, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 33.244, y = 57.979, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 30.206, y = 48.753, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 23.520, y = 61.100, colour = "orange", size = 3) +
  annotate(geom = "text", x = -8.410, y = 41.150, label ="PT",fontface = "bold", color = "black", size =5, angle=15) +
  annotate(geom = "text", x = 0.620, y = 41.618, label ="ES",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 10.213, y = 55.945, label ="DK",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 32.260, y = 40.231, label ="TR",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 11.610, y = 48.180, label ="DE",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 15.560, y = 48.375, label ="AT",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 33.244, y = 57.979, label ="RU",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 30.206, y = 48.753, label ="UA",fontface = "bold", color = "black", size =5, angle=15) + 
  annotate(geom = "text", x = 23.520, y = 61.100, label ="FI",fontface = "bold", color = "black", size =5, angle=15) 

```

```{r droseu_labs, echo=FALSE, message=FALSE}
droseu_labs <- data.frame(read.csv("DrosEU_Labs.csv"))
```

## Contributers (phenotyping)

Contributed labs are `r unique(droseu_labs$PI)` and detailed list below :


```{r echo=FALSE}
knitr::kable(droseu_labs, allign = "llll", caption = "Table X. Contributed labs and traits, sorted by PI") 
```

```{r echo=FALSE, message=FALSE}
cities <- read.csv("DrosEU_cities.csv")
```


```{r research_groups_map, echo=FALSE, message=TRUE}

globe_labs <- ggplot(data = world) + geom_sf() + xlab("Latitude") + ylab("Longitude") +
  coord_sf(xlim = c(-80.15, 40.12), ylim = c(-45, 60), expand = TRUE) +
  ggtitle("Contributed labs", subtitle = paste0("(", length(unique(droseu_labs$Country)), " countries", ", ", length(unique(droseu_labs$PI)), " research groups", ")")) +
  annotate(geom = "point", x = cities$Long, y = cities$Lat, colour = "red", size = 2) 
  
globe_labs + map_theme 

```

## Contributers (analyses)

Esra Durmaz (all), Envel Kerdaffrec (all), Katja Hoedjes (Via, DT, DW), Banu Onder (SR, WA), Marija Tanaskovic (WA), Chris Wegener (CET), Eran Tauber (LA), Rudolf Rohr (UniFr), coordination-team


# Phenotyping 

## Overview 

# Methods

## Wolbachia

```{r wolbachia-data, echo=FALSE, message=FALSE}
droseu_wol <- data.frame(read.csv("DrosEU_wolbachia_2021.csv"))
```

```{r, echo=FALSE}
DT::datatable(droseu_wol, options = list(pageLength = 10))
```

```{r Wol_Freqs, echo=FALSE}
Wol_Freqs <- data.frame(unique(droseu_wol$Population))

Wol_Pops <- c((AK_freq <- nrow(droseu_wol %>% filter(Population=="AK") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "AK")) * 100), 
  (GI_freq <- nrow(droseu_wol %>% filter(Population=="GI") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "GI")) * 100), 
  (KA_freq <- nrow(droseu_wol %>% filter(Population=="KA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "KA")) * 100), 
  (MA_freq <- nrow(droseu_wol %>% filter(Population=="MA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "MA")) * 100), 
  (MU_freq <- nrow(droseu_wol %>% filter(Population=="MU") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "MU")) * 100), 
  (RE_freq <- nrow(droseu_wol %>% filter(Population=="RE") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "RE")) * 100),
  (UM_freq <- nrow(droseu_wol %>% filter(Population=="UM") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "UM")) * 100),
  (VA_freq <- nrow(droseu_wol %>% filter(Population=="VA") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "VA")) * 100),
  (YE_freq <- nrow(droseu_wol %>% filter(Population=="YE") %>% filter(Wolbachia=="1")) / 
  nrow(droseu_wol %>% filter(Population == "YE")) * 100))

pop_freqs <- cbind(unique(droseu_wol$Country), Wol_Freqs, Wol_Pops)

cols <- c("Country", "Population", "Wolbachia_Freq")
wolbachia_pop_freqs <- setnames(pop_freqs, cols)

```

```{r wolbachia_pop_freqs}
wolbachia_pop_freqs # Wolbachia frequency by country and population abbreviation 
```

## Diets


```{r droseu_diets, echo=FALSE, message=FALSE}
droseu_diets <- data.frame(read.csv("DrosEU_Diets_Feb22.csv"))
```

```{r, echo=FALSE}
DT::datatable(droseu_diets, options = list(pageLength = 10))
```


## Inversion Frequencies

## Traits 

_Contributors and methods for experiments_

### Viability
##### Gibert, Grath, Hoedjes, Schmidt, Stamenkovic-Radak and Zwaan Labs


3-5 day old adults (at least 25 pairs) are allowed to lay eggs en masse. Yeast is provided to stimulate egg laying (for at least 2 hours). Eggs are collected, and 40 are placed in each vial[^1]. Viability is calculated per vial, as the percentage of individuals that emerged from the 40 eggs.

Please see below number of 

[^1]: @ Schmidt lab, females were allowed to lay eggs for Xh, and viability is calculated as the percentage of individuals that emerged from total number of eggs, per vial.

### Developmental time

#### Egg-to-pupa developmental time
##### Schmidt Lab



#### Egg-to-adult developmental time
##### Gibert, Grath, Hoedjes, Schmidt, Stamenkovic-Radak and Zwaan Labs


Developmental time is scored as both the egg-to-pupa and egg-to-adult development time. Both were scored twice a day, when the chamber lights are turned on and two hours before they are turned off. In order to measure the egg-to-pupa developmental time, the spot where a pupa is found is marked with a permanent marker to keep track of which pupae have emerged in each day. The egg-to-adult developmental time is estimated by counting all emerged adults from the vial, and by sexing them.


### Dry weight
##### Colinet, Hoedjes and Onder Labs

At day 7 after emergence, flies are killed by snap freezing them in liquid nitrogen, by putting them at -20ºC or by putting them into an ethyl acetate solution and stored at -20ºC. Then they are sexed and placed into 96 wells plates, and placed in an oven set at 60-70 °C, for at least 3 days. At this point flies can be stored at room temperature using a protective cover. If this is the case, the day before measurements are made dry flies are again placed for 24h in the oven (60-70 °C) to ensure material is well dehydrated. Flies are then placed on a small piece of aluminium foil for direct weight measurement on microbalance (accuracy 1µg).


### Thorax length
##### Kozeretska, Posnien, Ritchie and Schmidt Labs

Five to seven days old flies are placed onto a double-sided sticky tape attached to a microscope slide and a picture of the thorax taken using a digital camera connected to a dissecting microscope. The same magnification and resolution is always used to increase reproducibility, and a scale bar inserted on each photo to allow transforming pixels into µm units. Thorax length is defined as the distance from the anterior margin of the thorax to the posterior tip of the scutellum and it is measured using the “Straight Line” in ImageJ/Fiji.


### Wing area
##### Onder, Posnien, Ritchie and Stamenkovic-Radak Labs

Both the left and right wings of five to seven days old flies (10 flies per sex per replicate) are removed and placed into a drop of Entellan®Merck, Hoyer’s Medium, sticked to a double-side sticky tape, or taped directly to the slide. Pictures of the wing preparations are taken using a digital camera connected to a dissecting microscope. The same magnification and resolution is always used to increase reproducibility. A scale bar is placed on each photo to allow transforming pixels into µm units. Manual measurements of wing length and wing area are performed using the “Straight Line” and “Polygon Selection” tools, respectively of ImageJ/Fiji (10.1371/journal.pone.0000007).


### Fecundity
##### Billeter and Fricke Labs

For each isofemale line, 10 males and 10 females are placed together in single-sex groups and allowed to mature for five days. Then, they are placed together (5-7 pairs), and mating interactions observed to ensure successful mating (at least 10 min copulation duration) to ensure that we have five successfully mated females. After a successful mating, males are discarded and females allowed to oviposit alone for 48 hours, moved to another vial, and allowed to oviposit for four days, and again moved to another vial and allowed to oviposit for two days to check that of egg-laying stopped. Vials are incubated until all offspring is born. Individuals are then frozen and the offspring counted.


### Lifespan
##### Flatt, Parsch and Pasyukova Labs

Line level lifespan: Ten flies per sex/line are placed in each vial. The age at death will be scored when changing the food, at least three times a week. Five replicates are used.

Population level lifespan: Flies are kept in 1L demography cages (5 flies per line/sex for each population). The age at death will be scored when changing the food, at least three times a week. Ten replicates were performed.


### Cold-shock mortality
##### Gonzalez, Kozeretska and Vieira Labs

Batches of 15-20 seven days old flies are placed for 18 hours in an empty vial immersed in an ice-water slurry box placed at a 4°C room for 18 hours. Then the vials are removed to a bench in a 25°C room and mortality scored 24 hours later.


### Chill-coma recovery time
##### Vieira and Mensh Labs

Sexed flies are placed in an empty vial immersed in an ice-water slurry box placed at a 4°C room in the morning. Six hours later, flies are removed from the tube to individual wells of 24 well plates while being kept on ice. A timer is started once the plate is moved from the ice to a bench in a 25°C room. Each fly is checked by eye for recovery for a maximum of 60 minutes. Flies that are able to stand on their legs are considered recovered and the CCRT (in seconds) recorded.


### Heat-shock mortality
##### Parsch and Vieira Labs

Batches of 15-20 seven days old flies are placed in empty vials inside a 37ºC incubator and mortality checked for 7 hours every 30 minutes.


### Diapause
##### Bergland, Flatt and Schlotterer Labs

In order to induce diapause, two hour old 'phenotypic virgins' (pharate or melanized with meconium visible) female flies are exposed to 12°C and 10:14 light/dark hours for 3 weeks, using an incubator that allows temperature tracking. Vials are changed once per week. After three weeks under diapause conditions, flies are frozen at -80C until dissection. Both ovaries will be examined and classified according to the following simplified 'classification': 1) < stage 10: diapause; 2) stage 10-13: intermediate; 3) stage 14: non-diapause.


- Standard diapause conditions: 12°C at 10:14 hrs L:D (under these conditions we might expect around 50% dipause frequency)
- duration of exposure: 3 weeks
- assays will be done in incubators (Percival or Memmert); temperature conditions will be tracked using data loggers / iButtons
- Try to have haphazard standardization; similar conditions coupled with consistent tracking of temperature (multiple iButtons, for example)
- We will use egg lays in bottles to be able to collect more flies for the assay (approx. 1-2 bottles per line)
- Larval density will be controlled (approximately) prior to assays: we will do this by letting a fixed number of (approx. 10-20) females (housed together with 5-10 males) oviposit over night (fixed time window) - how many females and the duration of egg laying might need to be adjusted a bit depending on the fertility of the lines (to be determined when lines are being amplified prior to assays)
- The Bergland and Flatt labs will standardize their fly food according to the Gulbenkian recipe (in terms of amounts / proportions); Manolis from the Schlötterer lab will not standardize the food and use their local diet; importantly, flies for the assays will not be exposed to any (additional) live yeast (i.e., the diet will contain liophilized yeast but no live yeast sprinkled on top).
- From the bottles we will collect upon eclosion 'phenotypic virgins' (=pharate adults or melanized with meconium visible), approx. within 2 hours after eclosion
- Flies will be kept in vials for assay (15-20 flies in the same vial to account for mortality); we aim to measure a minimum of 10 females per line (from approx. 10-15 lines x 10 populations, yielding about 1000-1500 flies for dissections in total)
- The food in the assays will be changed once per week
- To keep the workload and effort manageable the assays will be performed in 2-3 blocks (optimally only 2) over time: e.g., from each population we will measure a subset of all lines (e.g., 5-7 lines, i.e. 1/2 or 1/3 of all lines) in each of the 2-3 blocks. 
- After 3 weeks under diapause conditions, flies will either be dissected or kept frozen until dissection (dry, at -80C; can be stored for a few months) 
- We will adopt a simplified diapause 'classification':
- Stage 10 will be defined as the checkpoint
- < Stage 10: diapause
- Stage 10-13: intermediate
- Stage 14: non-diapause
- We will examine both ovaries.


### Circadian eclosion timing
##### Wegener Lab

The eclosion rhythmicity has been measured in outcrossed Munich, Akaa, Gimenells, Uman, Mauternbach, Karensminde, Valday, Yesiloz and Recarei strains at:

1) LD14:10 @ 29°C, flies raised at 29°C

2) DD 29°C after LD14:10 entrainment, flies raised at 29°C

3) LD14:10 @ 18°C, flies raised at 18°C

4) DD 18°C after LD14:10 entrainment, flies raised at 18°C



### Locomotor activity
##### Tauber Lab

The locomotor activity of the flies (males only) was measured using the DAM2 Drosophila monitors (Trikinetics Inc., Waltham, MA). Flies were 1-3 days old. Single flies were placed in glass tubes (10 cm × 0.5 cm) that were filled with 2 cm sugar/agar medium. The monitors were placed in light chambers driven by LED,  in an incubator at 24°C, ~30% humidity. The flies were entrained to a light-dark cycle (LD 12:12) for 5d and then allowed to free-run for 10 d in constant darkness (DD). The activity data were processed into 30 min bins, and four different variables were analysed. These included the circadian period, and the phase, which were analyzed using the FFT NLLS algorithm available at the BioDare2 server (https://biodare2.ed.ac.uk/). The other two variables, level of activity and the nocturnal/diurnal ratio were analyzed by a custom-made R script.
 

### Starvation resistance
##### Gonzalez, Onder and Pasyukova Labs

Batches of 10 sexed flies are transferred to glass vials filled with 5 mL of 2% agar for starvation 3-7 days after eclosion. The age at death will be scored every 8 hours.

### Pigmentation
##### Abbott, Gibert and Schmidt

For each line, 10 females, 13-15 days old, either alive or stored in 95% ethanol, are air dried and placed on their left side, and pictures taken using a dissecting microscope. Images are then analysed in ImageJ 1.46r, using the Area Fraction measurement in the Analyze menu. Area Fraction measures the percentage of pixels in a selected area that have been highlighted in red using the Threshold tool. This gives an estimate of the percentage of dark pigmentation on the three terminal tergites of the abdomen (4, 5 and 6). 


## Data reformatting 

MasterSheets 


All data files are reformatted as so called _Master Sheets _, in which the data structure is the same for all the sub-data sets and all details/edits logged in a README sheet. 

```{r README_example, echo=FALSE}
headers <- c("Supervisor/PI", "Diet", "Batch", "Population", "Line", "Sex", "ReplicateVial", "TraitValue") 

descriptions <- c("Lab identifier", "Either standardized _S_ or non-standardized _NS_ ", "From 1 to n" , "Population identifier in abbreviated form (i.e. _AK_)", "Line identifier (i.e. _MU1_)", "Either female (F) or male (M)", "Replicate identifier (from 1 to n)", "Trait value in x units")

README_example <- data.table(Headers =  headers, Descriptions = descriptions)
```

```{r echo=FALSE, message=FALSE}
knitr::kable(README_example, align = "ll", caption = 'Table X. Filling in the data spreadsheet and header description')
```

```{r MS_example, echo=FALSE}
MS_example <- data.table(read.csv("MasterSheets_Oct21_git/TL_MasterSheet_Feb22.csv"))
```

```{r, echo=FALSE}
DT::datatable(MS_example, options = list(pageLength = 10)) 
```


## Data check

For each trait, sex and lab, we run counts for population, line and replicate vial (if applicable).

> insert count table


# Results I : Linear Models  {#anchor}

> text BLA BLA BLA 

## Examples & Directories & Legends 

### Tables 

Here is an example code for tables (egg-to-adult viability). The very same code is used for other traits (either with or without _Batch_) by filtering the data at supervisor, batch, population and/or line levels (and also for sex, if applicable). 

```{r descriptive_stats, eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}

## First defined standard error and coefficient of variation

std_err <- function(x) sd(x)/sqrt(length(x))
coef_var <- function(x) sd(x)/mean(x)
estimate_mode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}
```

```{r, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}

# Then compute descriptive statistics (mean, median, minimum, maximum, standard error, coefficient of variation and mode) at the defined levels (line with batch information example below) : 

table_Via_Line_wbatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Line_wbatch.csv", row.names = T)

table_Via_Line_wbatch <- read.csv("Viability/table_Via_Line_wbatch.csv") #file name is here 
```

Tables for descriptive statistics at population and line levels can be found in the trait directory, under the file name **__table_TraitAbbreviation_Level_BatchInfo.csv__**  (_i.e. Viability/table_Via_Line_wobatch.csv_)


### Figures

Data range is calculated with `#r min()` and `#r max()` functions for each trait.

y-axis on the figures is scaled by the minimum (`#r min_trait`) and maximum (`#r max_trait`) values in the full data set for a given trait. 

The very same ggplot theme has been used all across the document, called _droseu_theme_
```{r droseu_theme, eval=FALSE, echo=TRUE}
droseu_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black",),  axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16),axis.text.y = element_text(size = 16),axis.title.y = element_text(size = 16))

p_TraitAbbreviation_Lab + ylim(c(min_trait, max_triat)) + droseu_theme 

```

```{r, echo=FALSE}

## Need to run this in the background

droseu_theme <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black",),  axis.title.x = element_text(size = 16), axis.text.x = element_text(size = 16),axis.text.y = element_text(size = 16),axis.title.y = element_text(size = 16))
```


Here is an example code for figures (egg-to-adult viabiliy, Gibert Lab). The very same code is used to generate plots for other contributing labs and traits (either for _Batch_ or _Population_) by filtering the data at supervisor level (for females and males separately, if applicable). 

```{r plot_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}

p_Via_Gibert <- ggplot(data = (subset(d_Via,Supervisor.PI=='Gibert')), #subsets for supervisor
                       aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + #define x- and y-axis
                       geom_boxplot(outlier.shape = NA, notch=FALSE) +  #boxplot
                       geom_jitter(width=0.2,alpha=0.05) + #jitters
                       labs(title="p_Via_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + 
                      ylim(c(min_Via, max_Via)) + 
                      droseu_theme #y-axis limits, axis labels and droseu_theme

pdf(file="Viability/p_Via_Gibert.pdf",width=8, height=5)

p_Via_Gibert

dev.off()
```



### Linear Models

Here is an example code for linear models (egg-to-adult development time, males, Gibert Lab). The very same code is used for other contributing labs and traits by filtering the data at supervisor level (for females and males separately, if applicable), adding or removing factors if they cause singularity problems (i.e. if only one replicate vial has been phenotyped per line and/or population and/or batch, the lowest level [ _replicate_vial_  in this example] has been dropped from given model). 

```{r lmer_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
DT_A_M_lmer_Gibert <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + #Line (random) is nested in Population (fixed)
                             (1|Batch) + #Batch is a random effect 
                             (1|ReplicateVial : Line), #Replicate vial (random) is nested in Line (random)
                           data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Gibert",]) #Filter by Lab in development time, males data 
capture.output(summary(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert_sum.txt") #save output summary 
capture.output(anova(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert.txt") #save anova output 
capture.output(emmeans(DT_A_M_lmer_Gibert, list(pairwise ~ Population), adjust = "tukey"),file =  "DevelopmentTime/DT_A_M_lmer_Gibert_tk.txt") #run and save post-hoc test (tukey) output 
```

```{r anova_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
anova(DT_A_M_lmer_Gibert) #print anova output
```

```{r summary_example, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
summary(DT_A_M_lmer_Gibert) #print model output summary 
```


Analyses outputs can be found in the trait directory, under the file name **__TraitAbbreviation_Sex_Function_LabIdentifier.txt__**  (_i.e. DevelopmentTime/DT_A_M_lmer_Gibert.txt_)


```{r source_correlation_meta_Rs, include=FALSE}
source("lab_correlations_functions.R")
source("meta_analysis_functions.R")
```



**_Please note that "Plots and Linear Models by Lab" are presented in alphabetical order._** 

```{r, echo=FALSE}
local_directory <- "DrosEU_PhenotypingWG/" #if you want to run the code, you need to specify the path here
```


## Viability


```{r}
dir.create(file.path("Viability"), showWarnings = FALSE)
```




_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Gibert Lab :Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Patricia Gibert

Grath Lab : Ingo Müller, Sonja Grath

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Schmidt Lab : Ozan Kiratli, Yonatan Babore, Liam Forsythe, Paul Schmidt

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

Zwaan Lab : Joost van den Heuvel, Bas Zwaan

### Data reformatting

```{r eval=FALSE}
ifelse(!dir.exists(file.path("Viability")), dir.create(file.path("Viability")), FALSE)
```

**Reading data in R**
```{r viability}
d_Via <- read.csv("MasterSheets_Oct21_git/VIA_MasterSheet_Oct21.csv")
str(d_Via)
```

Factors need reformatting (i.e. Supervisor.PI should be coded as a factor, not character).

```{r}
str(d_Via)
d_Via$Supervisor.PI <- as.factor(d_Via$Supervisor.PI)
d_Via$Diet <- as.factor(d_Via$Diet)
d_Via$Batch <- as.factor(d_Via$Batch)
d_Via$Population_Lat <- factor(d_Via$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_Via$Population_Lon <- factor(d_Via$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_Via$Population_Alt <- factor(d_Via$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_Via$Line <- as.factor(d_Via$Line)
d_Via$ReplicateVial <- as.factor(d_Via$ReplicateVial)
d_Via$ProportionEggtoAdultSurvival <- as.numeric(d_Via$ProportionEggtoAdultSurvival)
d_Via$Country <- as.factor(d_Via$Country)
d_Via$Latitude <- as.numeric(d_Via$Latitude)
d_Via$Longitude <- as.numeric(d_Via$Longitude)
d_Via$Altitude <- as.numeric(d_Via$Altitude)

# Now they should be in the correct format, see below. 
```



```{r}
str(d_Via)

# Voila! 
```


### Descriptive Statistics


Descriptive statistics at the line level, with batch information : 

```{r table_Via_Line_wbatch-tables, echo=FALSE}
table_Via_Line_wbatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Line_wbatch.csv", row.names = T)
table_Via_Line_wbatch <- read.csv("Viability/table_Via_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Via_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level, without batch information : 

```{r table_Via_Line_wobatch, echo=FALSE}
table_Via_Line_wobatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Population, Line) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Line_wobatch.csv", row.names = T)
table_Via_Line_wobatch <- read.csv("Viability/table_Via_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Via_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 

```{r table_Via_Pop_wbatch, echo=FALSE}
table_Via_Pop_wbatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Batch, Population) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Pop_wbatch.csv", row.names = T)
table_Via_Pop_wbatch <- read.csv("Viability/table_Via_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Via_Pop_wbatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r table_Via_Pop_wobatch, echo=FALSE}
table_Via_Pop_wobatch <- write.csv(d_Via %>% group_by(Supervisor.PI, Population) %>% summarise_at(vars(ProportionEggtoAdultSurvival), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Viability/table_Via_Pop_wobatch.csv", row.names = T)
table_Via_Pop_wobatch <- read.csv("Viability/table_Via_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Via_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```



### Plots and Linear Models by Lab  

#### Overview 

```{r min_max_Via, echo=TRUE}
min_Via <- min(d_Via$ProportionEggtoAdultSurvival)
max_Via <- max(d_Via$ProportionEggtoAdultSurvival)
```

y-axis is scaled by the minimum (`r min_Via`) and maximum (`r max_Via`) values in the full data set.



```{r p_Via_all, echo=FALSE}
p_Via_all <- ggplot(data = d_Via, aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Via_all", x="Population", y = "DW_micrograms") + ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_all
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_all.pdf",width=8, height=5)
p_Via_all
invisible(dev.off())
```



#### Gibert Lab

```{r Via_lmer_Gibert, echo=FALSE, message= FALSE, warning=FALSE}
Via_lmer_Gibert <- lmer(ProportionEggtoAdultSurvival ~ -1 + Population + (1|Line:Population) + (1|Batch) , data = d_Via[d_Via$Supervisor.PI == "Gibert",])
capture.output(summary(Via_lmer_Gibert),file = "Viability/Via_lmer_Gibert_sum.txt")
capture.output(anova(Via_lmer_Gibert),file = "Viability/Via_lmer_Gibert.txt")
capture.output(emmeans(Via_lmer_Gibert, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lmer_Gibert_tk.txt")
```

```{r}
anova(Via_lmer_Gibert)
```

```{r}
summary(Via_lmer_Gibert)
```


```{r p_Via_Gibert, echo=FALSE}
p_Via_Gibert <- ggplot(data = (subset(d_Via,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_Gibert
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Gibert.pdf",width=8, height=5)
p_Via_Gibert
invisible(dev.off())
```


```{r p_Via_pop_Gibert, echo=FALSE, message=FALSE, warning=FALSE}
p_Via_pop_Gibert <- ggplot(data = (subset(d_Via,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) +geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Gibert", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_pop_Gibert
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
pdf(file="Viability/p_Via_pop_Gibert.pdf",width=8, height=5)
p_Via_pop_Gibert
invisible(dev.off())
```

#### Grath Lab

```{r Via_lmer_Grath, echo=FALSE, message= FALSE, warning=FALSE}
Via_lmer_Grath <- lmer(ProportionEggtoAdultSurvival ~ -1 + Population + (1|Line:Population) , data = d_Via[d_Via$Supervisor.PI == "Grath",])
capture.output(summary(Via_lmer_Grath),file = "Viability/Via_lmer_Grath_sum.txt")
capture.output(anova(Via_lmer_Grath),file = "Viability/Via_lmer_Grath.txt")
capture.output(emmeans(Via_lmer_Grath, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lmer_Grath_tk.txt")
```

```{r}
anova(Via_lmer_Grath)
```

```{r}
summary(Via_lmer_Grath)
```


```{r p_Via_Grath, echo=FALSE, message= FALSE, warning=FALSE}
p_Via_Grath <- ggplot(data = (subset(d_Via,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Grath", x="Population", y = "ProportionEggtoAdultSurvival")+ ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_Grath
```

```{r echo=FALSE, message= FALSE, warning=FALSE}
pdf(file="Viability/p_Via_Grath.pdf",width=8, height=5)
p_Via_Grath 
invisible(dev.off())
```


```{r, echo=FALSE, message= FALSE, warning=FALSE}
p_Via_pop_Grath <- ggplot(data = (subset(d_Via,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Grath", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r echo=FALSE}
p_Via_pop_Grath
```

```{r echo=FALSE, message= FALSE, warning=FALSE}
pdf(file="Viability/p_Via_pop_Grath.pdf",width=8, height=5)
p_Via_pop_Grath
invisible(dev.off())
```


#### Hoedjes Lab

```{r Via_lmer_Hoedjes, echo=FALSE, message= FALSE, warning=FALSE}
Via_lmer_Hoedjes <- lmer(ProportionEggtoAdultSurvival ~ -1 + Population + (1|Line:Population) + (1|Batch), data = d_Via[d_Via$Supervisor.PI == "Hoedjes",])
capture.output(summary(Via_lmer_Hoedjes),file = "Viability/Via_lmer_Hoedjes_sum.txt")
capture.output(anova(Via_lmer_Hoedjes),file = "Viability/Via_lmer_Hoedjes.txt")
capture.output(emmeans(Via_lmer_Hoedjes, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lmer_Hoedjes_tk.txt")
```

```{r}
anova(Via_lmer_Hoedjes)
```

```{r}
summary(Via_lmer_Hoedjes)
```


```{r p_Via_Hoedjes, echo=FALSE, message= FALSE, warning=FALSE}
p_Via_Hoedjes <- ggplot(data = (subset(d_Via,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Hoedjes", x="Population", y = "ProportionEggtoAdultSurvival")+ ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r echo=FALSE}
p_Via_Hoedjes
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Hoedjes.pdf",width=8, height=5)
p_Via_Hoedjes
invisible(dev.off())
```


```{r p_Via_pop_Hoedjes, echo=FALSE, message= FALSE, warning=FALSE}

p_Via_pop_Hoedjes <- ggplot(data = (subset(d_Via,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Hoedjes", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r echo=FALSE}
p_Via_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_pop_Hoedjes.pdf",width=8, height=5)
p_Via_pop_Hoedjes
invisible(dev.off())
```



#### Schmidt Lab

```{r Via_lm_Schmidt, echo=FALSE, message= FALSE, warning=FALSE}
Via_lm_Schmidt <- lm(ProportionEggtoAdultSurvival ~ -1 + Population, data = d_Via[d_Via$Supervisor.PI == "Schmidt",])
capture.output(summary(Via_lm_Schmidt),file = "Viability/Via_lm_Schmidt_sum.txt")
capture.output(anova(Via_lm_Schmidt),file = "Viability/Via_lm_Schmidt.txt")
capture.output(emmeans(Via_lm_Schmidt, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lm_Schmidt_tk.txt")
```

```{r}
anova(Via_lm_Schmidt) #lm()` is used only for Schmidt Lab's viability data, as only one vial per line was phenotyped 
```

```{r}
summary(Via_lm_Schmidt)
```


```{r p_Via_Schmidt, echo=FALSE, message= FALSE, warning=FALSE}

p_Via_Schmidt <- ggplot(data = (subset(d_Via,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Schmidt", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r echo=FALSE}
p_Via_Schmidt
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_Schmidt.pdf",width=8, height=5)
p_Via_Schmidt
invisible(dev.off())
```


```{r p_Via_pop_Schmidt, echo=FALSE, message= FALSE, warning=FALSE}
pdf(file="Viability/p_Via_pop_Schmidt.pdf",width=8, height=5)
p_Via_pop_Schmidt <- ggplot(data = (subset(d_Via,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) +geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Schmidt", x="Population", y = "ProportionEggtoAdultSurvival") 
dev.off()

p_Via_pop_Schmidt + ylim(c(min_Via, max_Via))+ droseu_theme
invisible(dev.off())
```

#### Stamenkovic-Radak Lab

```{r Via_lmer_StamenkovicRadak, echo=FALSE, message= FALSE, warning=FALSE}
Via_lmer_StamenkovicRadak <- lmer(ProportionEggtoAdultSurvival ~ -1 + Population + (1|Line:Population)+ (1|Batch), data = d_Via[d_Via$Supervisor.PI == "StamenkovicRadak",])
capture.output(summary(Via_lmer_StamenkovicRadak),file = "Viability/Via_lmer_StamenkovicRadak_sum.txt")
capture.output(anova(Via_lmer_StamenkovicRadak),file = "Viability/Via_lmer_StamenkovicRadak.txt")
capture.output(emmeans(Via_lmer_StamenkovicRadak, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lmer_StamenkovicRadak_tk.txt")
```

```{r}
anova(Via_lmer_StamenkovicRadak)
```

```{r}
summary(Via_lmer_StamenkovicRadak)
```

```{r p_Via_StamenkovicRadak, echo=FALSE, message= FALSE, warning=FALSE}

p_Via_StamenkovicRadak <- ggplot(data = (subset(d_Via,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_StamenkovicRadak", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_StamenkovicRadak
```

```{r , echo=FALSE, message= FALSE, warning=FALSE}
pdf(file="Viability/p_Via_StamenkovicRadak.pdf",width=8, height=5)
p_Via_StamenkovicRadak
invisible(dev.off())
```

```{r p_Via_pop_StamenkovicRadak, echo=FALSE, message= FALSE, warning=FALSE}
p_Via_pop_StamenkovicRadak <- ggplot(data = (subset(d_Via,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_StamenkovicRadak", x="Population", y = "ProportionEggtoAdultSurvival")  + ylim(c(min_Via, max_Via))+ droseu_theme
```

```{r echo=FALSE}
p_Via_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="Viability/p_Via_pop_StamenkovicRadak.pdf",width=8, height=5)
p_Via_pop_StamenkovicRadak
invisible(dev.off())
```


#### Zwaan Lab

```{r Via_lmer_Zwaan, echo=FALSE, message= FALSE, warning=FALSE}
Via_lmer_Zwaan <- lmer(ProportionEggtoAdultSurvival ~ -1 + Population + (1|Line:Population) + (1|Batch), data = d_Via[d_Via$Supervisor.PI == "Zwaan",])
capture.output(summary(Via_lmer_Zwaan),file = "Viability/Via_lmer_Zwaan_sum.txt")
capture.output(anova(Via_lmer_Zwaan),file = "Viability/Via_lmer_Zwaan.txt")
capture.output(emmeans(Via_lmer_Zwaan, list(pairwise ~ Population), adjust = "tukey"),file = "Viability/Via_lmer_Zwaan_tk.txt")
```

```{r}
anova(Via_lmer_Zwaan)
```

```{r}
summary(Via_lmer_Zwaan)
```

```{r p_Via_Zwaan, echo=FALSE, message= FALSE, warning=FALSE}

p_Via_Zwaan <- ggplot(data = (subset(d_Via,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_Zwaan", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r}
p_Via_Zwaan
```

```{r}
pdf(file="Viability/p_Via_Zwaan.pdf",width=8, height=5)
p_Via_Zwaan
invisible(dev.off())
```


```{r p_Via_pop_Zwaan, echo=FALSE, message= FALSE, warning=FALSE}

p_Via_pop_Zwaan <- ggplot(data = (subset(d_Via,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=ProportionEggtoAdultSurvival, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Via_pop_Zwaan", x="Population", y = "ProportionEggtoAdultSurvival") + ylim(c(min_Via, max_Via))+ droseu_theme

```

```{r}
p_Via_pop_Zwaan
```

```{r}
pdf(file="Viability/p_Via_pop_Zwaan.pdf",width=8, height=5)
p_Via_pop_Zwaan
invisible(dev.off())
```


### Lab correlations

```{r  intersect_Via, echo=FALSE}
intersect_Via_line  <- Reduce(intersect, list(d_Via$Line[d_Via$Supervisor.PI == "Gibert"],
                                         d_Via$Line[d_Via$Supervisor.PI == "Grath"],
                                         d_Via$Line[d_Via$Supervisor.PI == "Hoedjes"],
                                         d_Via$Line[d_Via$Supervisor.PI == "Schmidt"],
                                         d_Via$Line[d_Via$Supervisor.PI == "StamenkovicRadak"],
                                         d_Via$Line[d_Via$Supervisor.PI == "Zwaan"]))

write(intersect_Via_line, file ="Viability/Via_int_line.txt", sep = "\t")

intersect_Via_pop  <- Reduce(intersect, list(d_Via$Population[d_Via$Supervisor.PI == "Gibert"],
                                         d_Via$Population[d_Via$Supervisor.PI == "Grath"],
                                         d_Via$Population[d_Via$Supervisor.PI == "Hoedjes"],
                                         d_Via$Population[d_Via$Supervisor.PI == "Schmidt"],
                                         d_Via$Population[d_Via$Supervisor.PI == "StamenkovicRadak"],
                                         d_Via$Population[d_Via$Supervisor.PI == "Zwaan"]))

write(intersect_Via_pop, file ="Viability/Via_int_pop.txt", sep = "\t")

```

There are `r length(intersect_Via_pop) ` populations and `r length(intersect_Via_line) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r}
Via_fitted <- combineFitted(labs = c("Gibert", "Grath", "Hoedjes", "Schmidt", "StamenkovicRadak", "Zwaan"), sex = rep("NA", 6), models = list(Via_lmer_Gibert, Via_lmer_Grath, Via_lmer_Hoedjes, Via_lm_Schmidt, Via_lmer_StamenkovicRadak, Via_lmer_Zwaan))

p_Via_lab_cor <- function() scatterPlotMatrix(Via_fitted, sex = "NA")
```

```{r p_Via_lab_cor, fig.height=8, fig.width=8}
p_Via_lab_cor()
```

```{r}
pdf(file="Viability/p_Via_lab_cor.pdf", width=8, height=8)
p_Via_lab_cor()
invisible(dev.off())
```





## Developmental time


```{r}
dir.create(file.path("DevelopmentTime"), showWarnings = FALSE)
```


### Egg-to-pupa developmental time

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

#### Contributors  

Schmidt Lab : Paul Schmidt


#### Data Reformatting

**Reading data in R**

```{r}
d_DT_P <- read.csv("MasterSheets_Oct21_git/DTP_MasterSheet_Oct21.csv")
str(d_DT_P) #Factors need reformatting 
```

```{r}
d_DT_P$Supervisor.PI <- as.factor(d_DT_P$Supervisor.PI)
d_DT_P$Diet <- as.factor(d_DT_P$Diet)
d_DT_P$Batch <- as.factor(d_DT_P$Batch)
d_DT_P$Population_Lat <- factor(d_DT_P$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_DT_P$Population_Lon <- factor(d_DT_P$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_DT_P$Population_Alt <- factor(d_DT_P$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_DT_P$Line <- as.factor(d_DT_P$Line)
d_DT_P$ReplicateVial <- as.factor(d_DT_P$ReplicateVial)
d_DT_P$DT_EggPupa <- as.numeric(d_DT_P$DT_EggPupa)
```

```{r}
str(d_DT_P) #They should be ok now. 
```


#### Descriptive Statistics

```{r}
# Note that the trait has been phenotyped only in Schmidt lab and in one batch.
```

Descriptive statistics at the line level :  
```{r table_DT_P_Line, echo=FALSE}
table_DT_P_Line <- write.csv(d_DT_P %>% group_by(Supervisor.PI, Population, Line) %>% 
                                     summarise_at(vars(DT_EggPupa), 
                                                  list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                       SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                             file = "DevelopmentTime/table_DT_P_Line.csv", row.names = T)
table_DT_P_Line <- read.csv("DevelopmentTime/table_DT_P_Line.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_P_Line, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level: 
```{r table_DT_P_Pop, echo=FALSE}
table_DT_P_Pop <- write.csv(d_DT_P %>% group_by(Supervisor.PI, Population) %>% 
                                    summarise_at(vars(DT_EggPupa), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "DevelopmentTime/table_DT_P_Pop.csv", row.names = T)
table_DT_P_Pop <- read.csv("DevelopmentTime/table_DT_P_Pop.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_P_Pop, options = list(pageLength = 10))  %>% formatRound(4:11, 3)
```


#### Plots and Linear Models by Lab

```{r min_max_DT_P, echo=TRUE}
min_DT_P <- min(d_DT_P$DT_EggPupa)
max_DT_P <- max(d_DT_P$DT_EggPupa)
```

y-axis is scaled by the minimum (`r min_DT_P`) and maximum (`r max_DT_P`) values in the full data set. 

##### Schmidt Lab

```{r DT_P_lmer, echo=TRUE, message= FALSE, warning=FALSE}
DT_P_lmer <- lmer(DT_EggPupa ~ -1 + Population + (1|Population:Line), data = d_DT_P)
capture.output(summary(DT_P_lmer),file = "DevelopmentTime/DT_P_lmer_sum.txt")
capture.output(anova(DT_P_lmer),file = "DevelopmentTime/DT_P_F_lmer.txt")
capture.output(emmeans(DT_P_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_P_tk.txt")
```

```{r}
anova(DT_P_lmer)
```

```{r}
summary(DT_P_lmer)
```

```{r p_DT_P_Schmidt, echo=TRUE, message= FALSE, warning=FALSE}

p_DT_P_Schmidt <- ggplot(data = (subset(d_DT_P,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=DT_EggPupa, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_P_Schmidt", x="Population", y = "DT_EggPupa") + ylim(c(min_DT_P, max_DT_P))+ droseu_theme

```

```{r}
p_DT_P_Schmidt
```

```{r}
pdf(file="DevelopmentTime/p_DT_P_Schmidt.pdf",width=8, height=5)
p_DT_P_Schmidt
invisible(dev.off())
```

### Egg-to-adult developmental time

_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

#### Contributors  

Gibert Lab : Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Patricia Gibert

Grath Lab : Ingo Müller, Sonja Grath

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Schmidt Lab : Ozan Kiratli, Yonatan Babore, Liam Forsythe, Paul Schmidt

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

Zwaan Lab : Joost van den Heuvel, Bas Zwaan

#### Data Reformatting


```{r d_DT_A}
d_DT_A <- read.csv("MasterSheets_Oct21_git/DTA_MasterSheet_Oct21.csv")
str(d_DT_A) #Factors need reformatting 
```

```{r}
d_DT_A$Supervisor.PI <- as.factor(d_DT_A$Supervisor.PI)
d_DT_A$Diet <- as.factor(d_DT_A$Diet)
d_DT_A$Batch <- as.factor(d_DT_A$Batch)
d_DT_A$Population_Lat <- factor(d_DT_A$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_DT_A$Population_Lon <- factor(d_DT_A$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_DT_A$Population_Alt <- factor(d_DT_A$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_DT_A$Line <- as.factor(d_DT_A$Line)
d_DT_A$Sex <- as.factor(d_DT_A$Sex)
d_DT_A$ReplicateVial <- as.factor(d_DT_A$ReplicateVial)
d_DT_A$DT_EggAdult <- as.numeric(d_DT_A$DT_EggAdult)
```

```{r}
str(d_DT_A) #They should be ok now. 
```

```{r}
#Create data sheets for females (d_DT_A_F) and males (d_DT_A_M), by sorting at sex level.
d_DT_A_F <-subset(d_DT_A,Sex=='F')
d_DT_A_M <-subset(d_DT_A,Sex=='M')
```


#### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r table_DT_A_Line_wbatch, echo=FALSE}

table_DT_A_Line_wbatch <- write.csv(d_DT_A %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                    summarise_at(vars(DT_EggAdult), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "DevelopmentTime/table_DT_A_Line_wbatch.csv", row.names = T)
table_DT_A_Line_wbatch <- read.csv("DevelopmentTime/table_DT_A_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_A_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information : 

```{r table_DT_A_Line_wobatch, echo=FALSE}

table_DT_A_Line_wobatch <- write.csv(d_DT_A %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                    summarise_at(vars(DT_EggAdult), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "DevelopmentTime/table_DT_A_Line_wobatch.csv", row.names = T)
table_DT_A_Line_wobatch <- read.csv("DevelopmentTime/table_DT_A_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_A_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r table_DT_A_Pop_wbatch, echo=FALSE}
table_DT_A_Pop_wbatch <- write.csv(d_DT_A %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                   summarise_at(vars(DT_EggAdult), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "DevelopmentTime/table_DT_A_Pop_wbatch.csv", row.names = T)
table_DT_A_Pop_wbatch <- read.csv("DevelopmentTime/table_DT_A_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_A_Pop_wbatch, options = list(pageLength = 10))  %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r table_DT_A_Pop_wobatch, echo=FALSE}
table_DT_A_Pop_wobatch <- write.csv(d_DT_A %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                   summarise_at(vars(DT_EggAdult), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "DevelopmentTime/table_DT_A_Pop_wobatch.csv", row.names = T)
table_DT_A_Pop_wobatch <- read.csv("DevelopmentTime/table_DT_A_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DT_A_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

#### Plots and Linear Models by Lab

##### Overview 

```{r min_max_DT_A, echo=TRUE}
min_DT_A <- min(d_DT_A$DT_EggAdult)
max_DT_A <- max(d_DT_A$DT_EggAdult)
```
  
y-axis is scaled by the minimum (`r min_DT_A`) and maximum (`r max_DT_A`) values in the full data set. 



```{r p_DT_A_F_all}

p_DT_A_F_all <- ggplot(data = d_DT_A_F, aes(x=Population_Lat, y=DT_EggAdult, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_F_all", x="Population", y = "DW_micrograms") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme
```


```{r echo=FALSE}
p_DT_A_F_all
```


```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_all.pdf",width=8, height=5)
p_DT_A_F_all
dev.off()
```





```{r p_DT_A_M_all}
p_DT_A_M_all <- ggplot(data = d_DT_A_M, aes(x=Population_Lat, y=DT_EggAdult, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DT_A_M_all", x="Population", y = "DW_micrograms") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme
```

```{r echo=FALSE}
p_DT_A_M_all
```

```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_all.pdf",width=8, height=5)
p_DT_A_M_all
dev.off()
```

  
##### Gibert Lab

```{r DT_A_F_lmer_Gibert}
DT_A_F_lmer_Gibert <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "Gibert",])
capture.output(summary(DT_A_F_lmer_Gibert),file = "DevelopmentTime/DT_A_F_lmer_Gibert_sum.txt")
capture.output(anova(DT_A_F_lmer_Gibert),file = "DevelopmentTime/DT_A_F_lmer_Gibert.txt")
capture.output(emmeans(DT_A_F_lmer_Gibert, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_Gibert_tk.txt")
```

```{r}
anova(DT_A_F_lmer_Gibert)
```

```{r}
summary(DT_A_F_lmer_Gibert)
```

```{r DT_A_M_lmer_Gibert}
DT_A_M_lmer_Gibert <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Gibert",])
capture.output(summary(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert_sum.txt")
capture.output(anova(DT_A_M_lmer_Gibert),file = "DevelopmentTime/DT_A_M_lmer_Gibert.txt")
capture.output(emmeans(DT_A_M_lmer_Gibert, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_Gibert_tk.txt")
```

```{r}
anova(DT_A_M_lmer_Gibert)
```

```{r}
summary(DT_A_M_lmer_Gibert)
```


```{r p_DT_A_F_Gibert}

p_DT_A_F_Gibert <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_Gibert", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_Gibert
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_Gibert.pdf",width=8, height=5)
p_DT_A_F_Gibert
dev.off()
```


```{r p_DT_A_F_pop_Gibert, echo=FALSE}
p_DT_A_F_pop_Gibert <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_Gibert", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r, echo=FALSE}
p_DT_A_F_pop_Gibert
```

```{r, echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Gibert.pdf",width=8, height=5)
p_DT_A_F_pop_Gibert
dev.off()
```


```{r p_DT_A_M_Gibert, echo=FALSE}

p_DT_A_M_Gibert <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_Gibert", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r, echo=FALSE}
p_DT_A_M_Gibert
```

```{r, echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Gibert.pdf",width=8, height=5)
p_DT_A_M_Gibert
dev.off()
```



```{r p_DT_A_M_pop_Gibert}

p_DT_A_M_pop_Gibert <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_Gibert", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_pop_Gibert
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Gibert.pdf",width=8, height=5)
p_DT_A_M_pop_Gibert
dev.off()
```

##### Grath Lab

```{r DT_A_F_lmer_Grath}
DT_A_F_lmer_Grath <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|ReplicateVial : Line), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "Grath",])
capture.output(summary(DT_A_F_lmer_Grath),file = "DevelopmentTime/DT_A_F_lmer_Grath_sum.txt")
capture.output(anova(DT_A_F_lmer_Grath),file = "DevelopmentTime/DT_A_F_lmer_Grath.txt")
capture.output(emmeans(DT_A_F_lmer_Grath, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_Grath_tk.txt")
```

```{r}
anova(DT_A_F_lmer_Grath)
```

```{r}
summary(DT_A_F_lmer_Grath)
```

```{r DT_A_M_lmer_Grath}
DT_A_M_lmer_Grath <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|ReplicateVial : Line), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Grath",])
capture.output(summary(DT_A_M_lmer_Grath),file = "DevelopmentTime/DT_A_M_lmer_Grath_sum.txt")
capture.output(anova(DT_A_M_lmer_Grath),file = "DevelopmentTime/DT_A_M_lmer_Grath.txt")
capture.output(emmeans(DT_A_M_lmer_Grath, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_Grath_tk.txt")
```

```{r}
anova(DT_A_M_lmer_Grath)
```

```{r}
summary(DT_A_M_lmer_Grath)
```

```{r p_DT_A_F_Grath}
pdf(file="DevelopmentTime/p_DT_A_F_Grath.pdf",width=8, height=5)
p_DT_A_F_Grath <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_Grath", x="Population", y = "DT_EggAdult")

p_DT_A_F_Grath + ylim(c(min_DT_A, max_DT_A))+ droseu_theme
dev.off()
```

```{r}

```


```{r}

```

```{r p_DT_A_F_pop_Grath}

p_DT_A_F_pop_Grath <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```


```{r}
p_DT_A_F_pop_Grath
```


```{r}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Grath.pdf",width=8, height=5)
p_DT_A_F_pop_Grath
dev.off()
```

```{r p_DT_A_M_Grath}

p_DT_A_M_Grath <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```


```{r}
p_DT_A_M_Grath
```


```{r}
pdf(file="DevelopmentTime/p_DT_A_M_Grath.pdf",width=8, height=5)
p_DT_A_M_Grath
dev.off()
```

```{r p_DT_A_M_pop_Grath}

p_DT_A_M_pop_Grath <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Grath')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_Grath", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_pop_Grath
```


```{r}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Grath.pdf",width=8, height=5)
p_DT_A_M_pop_Grath
dev.off()
```

##### Hoedjes Lab

```{r DT_A_F_lmer_Hoedjes}

DT_A_F_lmer_Hoedjes <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "Hoedjes",])
capture.output(summary(DT_A_F_lmer_Hoedjes),file = "DevelopmentTime/DT_A_F_lmer_Hoedjes_sum.txt")
capture.output(anova(DT_A_F_lmer_Hoedjes),file = "DevelopmentTime/DT_A_F_lmer_Hoedjes.txt")
capture.output(emmeans(DT_A_F_lmer_Hoedjes, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_Hoedjes_tk.txt")

```

```{r}
anova(DT_A_F_lmer_Hoedjes)
```

```{r}
summary(DT_A_F_lmer_Hoedjes)
```

```{r DT_A_M_lmer_Hoedjes}
DT_A_M_lmer_Hoedjes <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Hoedjes",])
capture.output(summary(DT_A_M_lmer_Hoedjes),file = "DevelopmentTime/DT_A_M_lmer_Hoedjes_sum.txt")
capture.output(anova(DT_A_M_lmer_Hoedjes),file = "DevelopmentTime/DT_A_M_lmer_Hoedjes.txt")
capture.output(emmeans(DT_A_M_lmer_Hoedjes, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_Hoedjes_tk.txt")

```

```{r}
anova(DT_A_M_lmer_Hoedjes)
```

```{r}
summary(DT_A_M_lmer_Hoedjes)
```


```{r p_DT_A_F_Hoedjes}

p_DT_A_F_Hoedjes <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_Hoedjes", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r echo=FALSE}
p_DT_A_F_Hoedjes
```

```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_Hoedjes.pdf",width=8, height=5)
p_DT_A_F_Hoedjes
dev.off()
```


```{r p_DT_A_F_pop_Hoedjes}

p_DT_A_F_pop_Hoedjes <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_Hoedjes", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r echo=FALSE}
p_DT_A_F_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Hoedjes.pdf",width=8, height=5)
p_DT_A_F_pop_Hoedjes
dev.off()
```


```{r p_DT_A_M_Hoedjes}

p_DT_A_M_Hoedjes <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_Hoedjes", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme
```

```{r echo=FALSE}
p_DT_A_M_Hoedjes
```

```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_Hoedjes.pdf",width=8, height=5)
p_DT_A_M_Hoedjes
dev.off()
```


```{r p_DT_A_M_pop_Hoedjes}

p_DT_A_M_pop_Hoedjes <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_Hoedjes", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r echo=FALSE}
p_DT_A_M_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Hoedjes.pdf",width=8, height=5)
p_DT_A_M_pop_Hoedjes
dev.off()
```



##### Schmidt Lab

```{r DT_A_F_lmer_Schmidt}
DT_A_F_lmer_Schmidt <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "Schmidt",])
capture.output(summary(DT_A_F_lmer_Schmidt),file = "DevelopmentTime/DT_A_F_lmer_Schmidt_sum.txt")
capture.output(anova(DT_A_F_lmer_Schmidt),file = "DevelopmentTime/DT_A_F_lmer_Schmidt.txt")
capture.output(emmeans(DT_A_F_lmer_Schmidt, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_Schmidt_tk.txt")
```

```{r}
anova(DT_A_F_lmer_Schmidt)
```

```{r}
summary(DT_A_F_lmer_Schmidt)
```

```{r DT_A_M_lmer_Schmidt}
DT_A_M_lmer_Schmidt <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Schmidt",])
capture.output(summary(DT_A_M_lmer_Schmidt),file = "DevelopmentTime/DT_A_M_lmer_Schmidt_sum.txt")
capture.output(anova(DT_A_M_lmer_Schmidt),file = "DevelopmentTime/DT_A_M_lmer_Schmidt.txt")
capture.output(emmeans(DT_A_M_lmer_Schmidt, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_Schmidt_tk.txt")
```

```{r}
anova(DT_A_M_lmer_Schmidt)
```

```{r}
summary(DT_A_M_lmer_Schmidt)
```


```{r p_DT_A_F_Schmidt}

p_DT_A_F_Schmidt <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_Schmidt
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_Schmidt.pdf",width=8, height=5)
p_DT_A_F_Schmidt
dev.off()
```

```{r p_DT_A_F_pop_Schmidt}

p_DT_A_F_pop_Schmidt <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_pop_Schmidt
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Schmidt.pdf",width=8, height=5)
p_DT_A_F_pop_Schmidt
dev.off()
```

```{r p_DT_A_M_Schmidt}

p_DT_A_M_Schmidt <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_Schmidt
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_Schmidt.pdf",width=8, height=5)
p_DT_A_M_Schmidt
dev.off()
```


```{r p_DT_A_M_pop_Schmidt}

p_DT_A_M_pop_Schmidt <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_Schmidt", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_pop_Schmidt
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Schmidt.pdf",width=8, height=5)
p_DT_A_M_pop_Schmidt
dev.off()

```

##### Stamenkovic-Radak Lab

```{r DT_A_F_lmer_StamenkovicRadak}
DT_A_F_lmer_StamenkovicRadak <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population)+ (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "StamenkovicRadak",])
capture.output(summary(DT_A_F_lmer_StamenkovicRadak),file = "DevelopmentTime/DT_A_F_lmer_StamenkovicRadak_sum.txt")
capture.output(anova(DT_A_F_lmer_StamenkovicRadak),file = "DevelopmentTime/DT_A_F_lmer_StamenkovicRadak.txt")
capture.output(emmeans(DT_A_F_lmer_StamenkovicRadak, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_StamenkovicRadak_tk.txt")
```

```{r}
anova(DT_A_F_lmer_StamenkovicRadak)
```

```{r}
summary(DT_A_F_lmer_StamenkovicRadak)
```

```{r DT_A_M_lmer_StamenkovicRadak}
DT_A_M_lmer_StamenkovicRadak <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "StamenkovicRadak",])
capture.output(summary(DT_A_M_lmer_StamenkovicRadak),file = "DevelopmentTime/DT_A_M_lmer_StamenkovicRadak_sum.txt")
capture.output(anova(DT_A_M_lmer_StamenkovicRadak),file = "DevelopmentTime/DT_A_M_lmer_StamenkovicRadak.txt")
capture.output(emmeans(DT_A_M_lmer_StamenkovicRadak, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_StamenkovicRadak_tk.txt")
```

```{r}
anova(DT_A_M_lmer_StamenkovicRadak)
```

```{r}
summary(DT_A_M_lmer_StamenkovicRadak)
```


```{r p_DT_A_F_StamenkovicRadak}

p_DT_A_F_StamenkovicRadak <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_StamenkovicRadak
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_F_StamenkovicRadak
dev.off()
```


```{r p_DT_A_F_pop_StamenkovicRadak}
p_DT_A_F_pop_StamenkovicRadak <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_pop_StamenkovicRadak
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_pop_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_F_pop_StamenkovicRadak
dev.off()
```

```{r p_DT_A_M_StamenkovicRadak}

p_DT_A_M_StamenkovicRadak <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_StamenkovicRadak", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_StamenkovicRadak
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_M_StamenkovicRadak
dev.off()
```


```{r p_DT_A_M_pop_StamenkovicRadak}

p_DT_A_M_pop_StamenkovicRadak <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_StamenkovicRadak", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_pop_StamenkovicRadak
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_pop_StamenkovicRadak.pdf",width=8, height=5)
p_DT_A_M_pop_StamenkovicRadak
dev.off()
```


##### Zwaan Lab

```{r DT_A_F_lmer_Zwaan}
DT_A_F_lmer_Zwaan <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_F[d_DT_A_F$Supervisor.PI == "Zwaan",])
capture.output(summary(DT_A_F_lmer_Zwaan),file = "DevelopmentTime/DT_A_F_lmer_Zwaan_sum.txt")
capture.output(anova(DT_A_F_lmer_Zwaan),file = "DevelopmentTime/DT_A_F_lmer_Zwaan.txt")
capture.output(emmeans(DT_A_F_lmer_Zwaan, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_F_lmer_Zwaan_tk.txt")

```

```{r}
anova(DT_A_F_lmer_Zwaan)
```

```{r}
summary(DT_A_F_lmer_Zwaan)
```

```{r DT_A_M_lmer_Zwaan}
DT_A_M_lmer_Zwaan <- lmer(DT_EggAdult ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial : Line), data = d_DT_A_M[d_DT_A_M$Supervisor.PI == "Zwaan",])
capture.output(summary(DT_A_M_lmer_Zwaan),file = "DevelopmentTime/DT_A_M_lmer_Zwaan_sum.txt")
capture.output(anova(DT_A_M_lmer_Zwaan),file = "DevelopmentTime/DT_A_M_lmer_Zwaan.txt")
capture.output(emmeans(DT_A_M_lmer_Zwaan, list(pairwise ~ Population), adjust = "tukey"),file = "DevelopmentTime/DT_A_M_lmer_Zwaan_tk.txt")
```


```{r}
anova(DT_A_M_lmer_Zwaan)
```

```{r}
summary(DT_A_M_lmer_Zwaan)
```

```{r p_DT_A_F_Zwaan}

p_DT_A_F_Zwaan <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_Zwaan
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_Zwaan.pdf",width=8, height=5)
p_DT_A_F_Zwaan
dev.off()
```

```{r p_DT_A_F_pop_Zwaan}

p_DT_A_F_pop_Zwaan <- ggplot(data = (subset(d_DT_A_F,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_F_pop_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_F_pop_Zwaan
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_F_pop_Zwaan.pdf",width=8, height=5)
p_DT_A_F_pop_Zwaan
dev.off()
```


```{r p_DT_A_M_Zwaan}

p_DT_A_M_Zwaan <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=DT_EggAdult, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_Zwaan", x="Population", y = "DT_EggAdult")+ ylim(c(min_DT_A, max_DT_A))+ droseu_theme

```

```{r}
p_DT_A_M_Zwaan
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_Zwaan.pdf",width=8, height=5)
p_DT_A_M_Zwaan
dev.off()
```

```{r p_DT_A_M_pop_Zwaan}

p_DT_A_M_pop_Zwaan <- ggplot(data = (subset(d_DT_A_M,Supervisor.PI=='Zwaan')), aes(x=Population_Lat, y=DT_EggAdult, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  geom_jitter(width=0.2,alpha=0.01) + 
        labs(title="p_DT_A_M_pop_Zwaan", x="Population", y = "DT_EggAdult") + ylim(c(min_DT_A, max_DT_A))+ droseu_theme
```

```{r}
p_DT_A_M_pop_Zwaan
```

```{r}
pdf(file="DevelopmentTime/p_DT_A_M_pop_Zwaan.pdf",width=8, height=5)
p_DT_A_M_pop_Zwaan
dev.off
```

#### Lab correlations

```{r}
intersect_Line_DT_A  <- Reduce(intersect, list(d_DT_A$Line[d_DT_A$Supervisor.PI == "Gibert"],
                                          d_DT_A$Line[d_DT_A$Supervisor.PI == "Grath"],
                                          d_DT_A$Line[d_DT_A$Supervisor.PI == "Hoedjes"],
                                          d_DT_A$Line[d_DT_A$Supervisor.PI == "Schmidt"],
                                          d_DT_A$Line[d_DT_A$Supervisor.PI == "StamenkovicRadak"],
                                          d_DT_A$Line[d_DT_A$Supervisor.PI == "Zwaan"]))
write(intersect_Line_DT_A, file ="DevelopmentTime/intersect_Line_DT_A.txt", sep = "\t")

intersect_Pop_DT_A  <- Reduce(intersect, list(d_DT_A$Population[d_DT_A$Supervisor.PI == "Gibert"],
                                          d_DT_A$Population[d_DT_A$Supervisor.PI == "Grath"],
                                          d_DT_A$Population[d_DT_A$Supervisor.PI == "Hoedjes"],
                                          d_DT_A$Population[d_DT_A$Supervisor.PI == "Schmidt"],
                                          d_DT_A$Population[d_DT_A$Supervisor.PI == "StamenkovicRadak"],
                                          d_DT_A$Population[d_DT_A$Supervisor.PI == "Zwaan"]))
write(intersect_Pop_DT_A, file ="DevelopmentTime/intersect_Pop_DT_A.txt", sep = "\t")

```

There are `r length(intersect_Pop_DT_A) ` populations and `r length(intersect_Line_DT_A) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 




```{r}
DT_A_fitted <- combineFitted(labs = rep(c("Gibert", "Grath", "Hoedjes", "Schmidt", "StamenkovicRadak", "Zwaan"), 2), sex = rep(c("F", "M"), each = 6), models = list(DT_A_F_lmer_Gibert, DT_A_F_lmer_Grath, DT_A_F_lmer_Hoedjes, DT_A_F_lmer_Schmidt, DT_A_F_lmer_StamenkovicRadak, DT_A_F_lmer_Zwaan, DT_A_M_lmer_Gibert, DT_A_M_lmer_Grath, DT_A_M_lmer_Hoedjes, DT_A_M_lmer_Schmidt, DT_A_M_lmer_StamenkovicRadak, DT_A_M_lmer_Zwaan))

p_DT_A_F_lab_cor <- function() scatterPlotMatrix(DT_A_fitted, sex = "F")
p_DT_A_M_lab_cor <- function() scatterPlotMatrix(DT_A_fitted, sex = "M")
```

```{r p_DT_A_F_lab_cor, fig.height=8, fig.width=8}
p_DT_A_F_lab_cor()
```
```{r}
pdf(file="DevelopmentTime/p_DT_A_F_lab_cor.pdf",width=8, height=8)
p_DT_A_F_lab_cor()
invisible(dev.off())
```

```{r p_DT_A_M_lab_cor, fig.height=8, fig.width=8}
p_DT_A_M_lab_cor()
```
```{r}
pdf(file="DevelopmentTime/p_DT_A_M_lab_cor.pdf",width=8, height=8)
p_DT_A_M_lab_cor()
invisible(dev.off())
```




## Dry weight


```{r}
dir.create(file.path("DryWeight"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Colinet Lab : Sapho-Lou Marti , Hervé Colinet

Hoedjes Lab : Hristina Kostic, Katja Hoedjes

Onder Lab : Seda Coskun, Senel Selin Senkal, Dogus Can, Banu Sebnem Onder

### Data Reformatting


**Read data in R**

```{r d_DW}
d_DW <- read.csv("MasterSheets_Oct21_git/DW_MasterSheet_Oct21.csv")
```

```{r}
str(d_DW)
```

```{r}

d_DW$Supervisor.PI <- as.factor(d_DW$Supervisor.PI)
d_DW$Diet <- as.factor(d_DW$Diet)
d_DW$Batch <- as.factor(d_DW$Batch)
d_DW$Population <- as.factor(d_DW$Population)
d_DW$Population_Lat <- factor(d_DW$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_DW$Population_Lon <- factor(d_DW$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_DW$Population_Alt <- factor(d_DW$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_DW$Line <- as.factor(d_DW$Line)
d_DW$Sex <- as.factor(d_DW$Sex)
d_DW$DW_micrograms <- as.numeric(d_DW$DW_micrograms)

```

```{r}
str(d_DW)
```

```{r d_DW_F_M}
d_DW_F <-subset(d_DW,Sex=='F')
d_DW_M <-subset(d_DW,Sex=='M')
```


### Descriptive Statistics


Descriptive statistics at the line level, with batch information : 
```{r table_DW_Line_wbatch, echo=FALSE}
table_DW_Line_wbatch <- write.csv(d_DW %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                     summarise_at(vars(DW_micrograms), 
                                                  list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                       SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                             file = "DryWeight/table_DW_Line_wbatch.csv", row.names = T)
table_DW_Line_wbatch <- read.csv("DryWeight/table_DW_Line_wbatch.csv")
```

```{r table_DW_Line_wobatch, echo=FALSE}
DT::datatable(table_DW_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information : 

```{r, echo=FALSE}
table_DW_Line_wobatch <- write.csv(d_DW %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                     summarise_at(vars(DW_micrograms), 
                                                  list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                       SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                             file = "DryWeight/table_DW_Line_wobatch.csv", row.names = T)
table_DW_Line_wobatch <- read.csv("DryWeight/table_DW_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DW_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r table_DW_Pop_wbatch, echo=FALSE}
table_DW_Pop_wbatch <- write.csv(d_DW %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                    summarise_at(vars(DW_micrograms), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "DryWeight/table_DW_Pop_wbatch.csv", row.names = T)
table_DW_Pop_wbatch <- read.csv("DryWeight/table_DW_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DW_Pop_wbatch, options = list(pageLength = 10))  %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information : 

```{r table_DW_Pop_wobatch, echo=FALSE}
table_DW_Pop_wobatch <- write.csv(d_DW %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                    summarise_at(vars(DW_micrograms), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "DryWeight/table_DW_Pop_wobatch.csv", row.names = T)
table_DW_Pop_wobatch <- read.csv("DryWeight/table_DW_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_DW_Pop_wobatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

### Plots and Linear Models by Lab

#### Overview 

```{r min_max_DW}
min_DW <- min(d_DW$DW_micrograms)
max_DW <- max(d_DW$DW_micrograms)
```

y-axis is scaled by the minimum (`r min_DW`) and maximum (`r max_DW`) values in the full data set. 

```{r p_DW_F_all}
pdf(file="DryWeight/p_DW_F_all.pdf",width=8, height=5)
p_DW_F_all <- ggplot(data = d_DW_F, aes(x=Population_Lat, y=DW_micrograms, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_all", x="Population", y = "DW_micrograms")

p_DW_F_all + ylim(c(min_DW, max_DW))+ droseu_theme
dev.off()
```


```{r p_DW_M_all}
pdf(file="DryWeight/p_DW_M_all.pdf",width=8, height=5)
p_DW_M_all <- ggplot(data = d_DW_M, aes(x=Population_Lat, y=DW_micrograms, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_all", x="Population", y = "DW_micrograms")

p_DW_M_all + ylim(c(min_DW, max_DW))+ droseu_theme
dev.off()
```



#### Colinet Lab


```{r DW_F_lmer_Colinet}
DW_F_lmer_Colinet <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_F[d_DW_F$Supervisor.PI == "Colinet",])
capture.output(summary(DW_F_lmer_Colinet),file = "DryWeight/DW_F_lmer_Colinet_sum.txt")
capture.output(anova(DW_F_lmer_Colinet),file = "DryWeight/DW_F_lmer_Colinet.txt")
capture.output(emmeans(DW_F_lmer_Colinet, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_F_lmer_Colinet_tk.txt")
```

```{r}
anova(DW_F_lmer_Colinet)
```

```{r}
summary(DW_F_lmer_Colinet)
```


```{r DW_M_lmer_Colinet}
DW_M_lmer_Colinet <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_M[d_DW_M$Supervisor.PI == "Colinet",])
capture.output(summary(DW_M_lmer_Colinet),file = "DryWeight/DW_M_lmer_Colinet_sum.txt")
capture.output(anova(DW_M_lmer_Colinet),file = "DryWeight/DW_M_lmer_Colinet.txt")
capture.output(emmeans(DW_M_lmer_Colinet, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_M_lmer_Colinet_tk.txt")
```


```{r}
anova(DW_M_lmer_Colinet)
```

```{r}
summary(DW_M_lmer_Colinet)
```


```{r p_DW_F_Colinet}

p_DW_F_Colinet <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Colinet')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_F_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Colinet.pdf",width=8, height=5)
p_DW_F_Colinet
dev.off()
```


```{r p_DW_F_pop_Colinet}

p_DW_F_pop_Colinet <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Colinet')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```


```{r echo=FALSE}
p_DW_F_pop_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Colinet.pdf",width=8, height=5)
p_DW_F_pop_Colinet
dev.off()
```


```{r p_DW_M_Colinet}

p_DW_M_Colinet <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Colinet')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```


```{r echo=FALSE}
p_DW_M_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Colinet.pdf",width=8, height=5)
p_DW_M_Colinet
dev.off()

```


```{r p_DW_M_pop_Colinet}

p_DW_M_pop_Colinet <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Colinet')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Colinet", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_M_pop_Colinet
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Colinet.pdf",width=8, height=5)
p_DW_M_pop_Colinet
dev.off()
```

#### Hoedjes Lab 

```{r}
DW_F_lmer_Hoedjes <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_F[d_DW_F$Supervisor.PI == "Hoedjes",])
capture.output(summary(DW_F_lmer_Hoedjes),file = "DryWeight/DW_F_lmer_Hoedjes_sum.txt")
capture.output(anova(DW_F_lmer_Hoedjes),file = "DryWeight/DW_F_lmer_Hoedjes.txt")
capture.output(emmeans(DW_F_lmer_Hoedjes, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_F_lmer_Hoedjes_tk.txt")
```

```{r}
anova(DW_F_lmer_Hoedjes)
```

```{r}
summary(DW_F_lmer_Hoedjes)
```

```{r}
DW_M_lmer_Hoedjes <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_M[d_DW_M$Supervisor.PI == "Hoedjes",])
capture.output(summary(DW_M_lmer_Hoedjes),file = "DryWeight/DW_M_lmer_Hoedjes_sum.txt")
capture.output(anova(DW_M_lmer_Hoedjes),file = "DryWeight/DW_M_lmer_Hoedjes.txt")
capture.output(emmeans(DW_M_lmer_Hoedjes, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_M_lmer_Hoedjes_tk.txt")
```

```{r}
anova(DW_M_lmer_Hoedjes)
```

```{r}
summary(DW_M_lmer_Hoedjes)
```

```{r p_DW_F_Hoedjes}

p_DW_F_Hoedjes <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_F_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Hoedjes.pdf",width=8, height=5)
p_DW_F_Hoedjes
dev.off()
```


```{r p_DW_F_pop_Hoedjes}

p_DW_F_pop_Hoedjes <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```


```{r echo=FALSE}
p_DW_F_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Hoedjes.pdf",width=8, height=5)
p_DW_F_pop_Hoedjes
dev.off()
```


```{r p_DW_M_Hoedjes}

p_DW_M_Hoedjes <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Hoedjes", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme

```


```{r echo=FALSE}
p_DW_M_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Hoedjes.pdf",width=8, height=5)
p_DW_M_Hoedjes
dev.off()
```


```{r p_DW_M_pop_Hoedjes}

p_DW_M_pop_Hoedjes <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Hoedjes')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Hoedjes", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```


```{r echo=FALSE}
p_DW_M_pop_Hoedjes
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Hoedjes.pdf",width=8, height=5)
p_DW_M_pop_Hoedjes
dev.off()
```

#### Onder Lab


```{r DW_F_lmer_Onder}

DW_F_lmer_Onder <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_F[d_DW_F$Supervisor.PI == "Onder",])
capture.output(summary(DW_F_lmer_Onder),file = "DryWeight/DW_F_lmer_Onder_sum.txt")
capture.output(anova(DW_F_lmer_Onder),file = "DryWeight/DW_F_lmer_Onder.txt")
capture.output(emmeans(DW_F_lmer_Onder, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_F_lmer_Onder_tk.txt")

```


```{r}
anova(DW_F_lmer_Onder)
```

```{r}
summary(DW_F_lmer_Onder)
```


```{r DW_M_lmer_Onder}

DW_M_lmer_Onder <- lmer(DW_micrograms ~ -1 + Population + (1|Population:Line) + (1|Batch), data = d_DW_M[d_DW_M$Supervisor.PI == "Onder",])
capture.output(summary(DW_M_lmer_Onder),file = "DryWeight/DW_M_lmer_Onder_sum.txt")
capture.output(anova(DW_M_lmer_Onder),file = "DryWeight/DW_M_lmer_Onder.txt")
capture.output(emmeans(DW_M_lmer_Onder, list(pairwise ~ Population), adjust = "tukey"),file = "DryWeight/DW_M_lmer_Onder_tk.txt")

```

```{r}
anova(DW_M_lmer_Onder)
```

```{r}
summary(DW_M_lmer_Onder)
```


```{r p_DW_F_Onder}

p_DW_F_Onder <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_Onder", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_F_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_Onder.pdf",width=8, height=5)
p_DW_F_Onder
dev.off()
```


```{r p_DW_F_pop_Onder}

p_DW_F_pop_Onder <- ggplot(data = (subset(d_DW_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_F_pop_Onder", x="Population", y = "DW_micrograms") + ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_F_pop_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_F_pop_Onder.pdf",width=8, height=5)
p_DW_F_pop_Onder
dev.off()
```


```{r p_DW_M_Onder}

p_DW_M_Onder <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=DW_micrograms, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_Onder", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_M_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_Onder.pdf",width=8, height=5)
p_DW_M_Onder
dev.off()
```



```{r p_DW_M_pop_Onder}

p_DW_M_pop_Onder <- ggplot(data = (subset(d_DW_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=DW_micrograms, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_DW_M_pop_Onder", x="Population", y = "DW_micrograms")+ ylim(c(min_DW, max_DW))+ droseu_theme

```

```{r echo=FALSE}
p_DW_M_pop_Onder
```

```{r echo=FALSE}
pdf(file="DryWeight/p_DW_M_pop_Onder.pdf",width=8, height=5)
p_DW_M_pop_Onder
dev.off()
```

### Lab correlations

```{r intersect_DW}
intersect_Line_DW  <- Reduce(intersect, list(d_DW$Line[d_DW$Supervisor.PI == "Colinet"],
                                        d_DW$Line[d_DW$Supervisor.PI == "Hoedjes"],
                                        d_DW$Line[d_DW$Supervisor.PI == "Onder"]))

write(intersect_Line_DW, file ="DryWeight/intersect_Line_DW.txt", sep = "\t")

intersect_Pop_DW  <- Reduce(intersect, list(d_DW$Population[d_DW$Supervisor.PI == "Colinet"],
                                        d_DW$Population[d_DW$Supervisor.PI == "Hoedjes"],
                                        d_DW$Population[d_DW$Supervisor.PI == "Onder"]))

write(intersect_Pop_DW, file ="DryWeight/intersect_Pop_DW.txt", sep = "\t")

```

There are `r length(intersect_Line_DW) ` populations and `r length(intersect_Pop_DW) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 




```{r}
DW_fitted <- combineFitted(labs = rep(c("Colinet", "Onder", "Hoedjes"), 2), sex = rep(c("F", "M"), each = 3), models = list(DW_F_lmer_Colinet, DW_F_lmer_Hoedjes, DW_F_lmer_Onder, DW_M_lmer_Colinet, DW_M_lmer_Hoedjes, DW_M_lmer_Onder))

p_DW_F_lab_cor <- function() scatterPlotMatrix(DW_fitted, sex = "F")
p_DW_M_lab_cor <- function() scatterPlotMatrix(DW_fitted, sex = "M")
```

```{r p_DW_F_lab_cor, fig.height=8, fig.width=8}
p_DW_F_lab_cor()
```
```{r}
pdf(file="DryWeight/p_DW_F_lab_cor.pdf",width=8, height=8)
p_DW_F_lab_cor()
invisible(dev.off())
```

```{r p_DW_M_lab_cor, fig.height=8, fig.width=8}
p_DW_M_lab_cor()
```
```{r}
pdf(file="DryWeight/p_DW_M_lab_cor.pdf",width=8, height=8)
p_DW_M_lab_cor()
invisible(dev.off())
```



```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some sometimes
```


## Thorax length


```{r}
dir.create(file.path("ThoraxLength"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Kozeretska Lab : Svitlana Serga, Alexandra Protsenko, Oleksandr Maistrenko, Iryna Kozeretska

Posnien Lab : Micael Reis, Lennart Hüper

Ritchie Lab : Megan Mcgunnigle, Nicola  Cook, Teresa Abaurrea, Michael Ritchie

Schmidt Lab : Amy Goldfischer, Paul Schmidt

### Data Reformatting

**Read data in R**

```{r d_TL}
d_TL <- read.csv("MasterSheets_Oct21_git/TL_MasterSheet_Feb22.csv")
str(d_TL)
```

```{r}
str(d_TL)
```

```{r}
d_TL$Supervisor.PI <- as.factor(d_TL$Supervisor.PI)
d_TL$Diet <- as.factor(d_TL$Diet)
d_TL$Batch <- as.factor(d_TL$Batch)
d_TL$Population_Lat <- factor(d_TL$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_TL$Population_Lon <- factor(d_TL$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_TL$Population_Alt <- factor(d_TL$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_TL$Line <- as.factor(d_TL$Line)
d_TL$Sex <- as.factor(d_TL$Sex)
d_TL$ReplicateVial <- as.factor(d_TL$ReplicateVial)
d_TL$TL_micrometers <- as.numeric(d_TL$TL_micrometers)
```

```{r}
str(d_TL)
```

```{r}

d_TL_F <-subset(d_TL,Sex=='F')
d_TL_M <-subset(d_TL,Sex=='M')

```


### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 

```{r table_TL_Line_wbatch, echo=FALSE}
table_TL_Line_wbatch <- write.csv(d_TL %>% group_by(Supervisor.PI, Batch, Sex,Population, Line) %>% 
                                  summarise_at(vars(TL_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ThoraxLength/table_TL_Line_wbatch.csv", row.names = T)
table_TL_Line_wbatch <- read.csv("ThoraxLength/table_TL_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_TL_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information : 

```{r table_TL_Line_wobatch, echo=FALSE}
table_TL_Line_wobatch <- write.csv(d_TL %>% group_by(Supervisor.PI, Sex,Population, Line) %>% 
                                  summarise_at(vars(TL_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ThoraxLength/table_TL_Line_wobatch.csv", row.names = T)
table_TL_Line_wobatch <- read.csv("ThoraxLength/table_TL_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_TL_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```


Descriptive statistics at the population level, with batch information : 

```{r table_TL_Pop_wbatch, echo=FALSE}
table_TL_Pop_wbatch <- write.csv(d_TL %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                  summarise_at(vars(TL_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ThoraxLength/table_TL_Pop_wbatch.csv", row.names = T)
table_TL_Pop_wbatch <- read.csv("ThoraxLength/table_TL_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_TL_Pop_wbatch, options = list(pageLength = 10))  %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information : 

```{r table_TL_Pop_wobatch, echo=FALSE}
table_TL_Pop_wobatch <- write.csv(d_TL %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                  summarise_at(vars(TL_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ThoraxLength/table_TL_Pop_wobatch.csv", row.names = T)
table_TL_Pop_wobatch <- read.csv("ThoraxLength/table_TL_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_TL_Pop_wobatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_TL <- min(d_TL$TL_micrometers)
max_TL <- max(d_TL$TL_micrometers)
```

y-axis is scaled by the minimum (`r min_TL`) and maximum (`r max_TL`) values in the full data set. 


```{r p_TL_F, echo=FALSE}
p_TL_F <- ggplot(data = d_TL_F, aes(x=Population_Lat, y=TL_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme
```


```{r , echo=FALSE}
p_TL_F
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F.pdf",width=8, height=5)
p_TL_F 
dev.off()
```

```{r p_TL_M}

p_TL_M <- ggplot(data = d_TL_M, aes(x=Population_Lat, y=TL_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme


```


```{r echo=FALSE}
p_TL_M
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M.pdf",width=8, height=5)
p_TL_M
dev.off()
```


#### Kozeretska Lab

```{r TL_F_lmer_Kozeretska}
TL_F_lmer_Kozeretska <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population) +
                               (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_TL_F,Supervisor.PI=='Kozeretska')))
capture.output(summary(TL_F_lmer_Kozeretska),file = "ThoraxLength/TL_F_Kozeretska_sum.txt")
capture.output(anova(TL_F_lmer_Kozeretska),file = "ThoraxLength/TL_F_lmer_Kozeretska.txt")
capture.output(emmeans(TL_F_lmer_Kozeretska, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_F_tk.txt")
```

```{r}
anova(TL_F_lmer_Kozeretska)
```

```{r}
summary(TL_F_lmer_Kozeretska)
```

```{r TL_M_lmer_Kozeretska}
TL_M_lmer_Kozeretska <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population) +
                               (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_TL_M,Supervisor.PI=='Kozeretska')))
capture.output(summary(TL_M_lmer_Kozeretska),file = "ThoraxLength/TL_M_Kozeretska_sum.txt")
capture.output(anova(TL_M_lmer_Kozeretska),file = "ThoraxLength/TL_M_lmer_Kozeretska.txt")
capture.output(emmeans(TL_M_lmer_Kozeretska, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_M_tk.txt")
```

```{r}
anova(TL_M_lmer_Kozeretska)
```

```{r}
summary(TL_M_lmer_Kozeretska)
```


```{r p_TL_F_Kozeretska}

p_TL_F_Kozeretska <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Kozeretska')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```


```{r echo=FALSE}
p_TL_F_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Kozeretska.pdf",width=8, height=5)
dev.off()
```

```{r p_TL_F_pop_Kozeretska}

p_TL_F_pop_Kozeretska <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Kozeretska')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_F_pop_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Kozeretska.pdf",width=8, height=5)
p_TL_F_pop_Kozeretska
dev.off()
```

```{r p_TL_M_Kozeretska}

p_TL_M_Kozeretska <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Kozeretska')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```


```{r echo=FALSE}
p_TL_M_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Kozeretska.pdf",width=8, height=5)
p_TL_M_Kozeretska
dev.off()
```

```{r p_TL_M_pop_Kozeretska}

p_TL_M_pop_Kozeretska <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Kozeretska')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Kozeretska", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_M_pop_Kozeretska
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_pop_Kozeretska.pdf",width=8, height=5)
p_TL_M_pop_Kozeretska
dev.off()
```


#### Posnien Lab 

```{r TL_F_lmer_Posnien}
TL_F_lmer_Posnien <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population)+ 
                            (1|ReplicateVial : Line : Population), data = (subset(d_TL_F,Supervisor.PI=='Posnien')))
capture.output(summary(TL_F_lmer_Posnien),file = "ThoraxLength/TL_F_Posnien_sum.txt")
capture.output(anova(TL_F_lmer_Posnien),file = "ThoraxLength/TL_F_lmer_Posnien.txt")
capture.output(emmeans(TL_F_lmer_Posnien, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_F_lmer_Posnientk.txt")
```

```{r}
anova(TL_F_lmer_Posnien)
```

```{r}
summary(TL_F_lmer_Posnien)
```


```{r TL_M_lmer_Posnien}
TL_M_lmer_Posnien <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population), data = (subset(d_TL_M,Supervisor.PI=='Posnien')))
capture.output(summary(TL_M_lmer_Posnien),file = "ThoraxLength/TL_M_Posnien_sum.txt")
capture.output(anova(TL_M_lmer_Posnien),file = "ThoraxLength/TL_M_lmer_Posnien.txt")
capture.output(emmeans(TL_M_lmer_Posnien, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_M_lmer_Posnien_tk.txt")
```

```{r}
anova(TL_M_lmer_Posnien)
```

```{r}
summary(TL_M_lmer_Posnien)
```


```{r p_TL_F_Posnien}

p_TL_F_Posnien <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Posnien", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_F_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Posnien.pdf",width=8, height=5)
p_TL_F_Posnien
dev.off()
```


```{r p_TL_F_pop_Posnien}

p_TL_F_pop_Posnien <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Posnien", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_F_pop_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Posnien.pdf",width=8, height=5)
p_TL_F_pop_Posnien
dev.off()
```

```{r p_TL_M_Posnien}

p_TL_M_Posnien <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Posnien", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme

```


```{r echo=FALSE}
p_TL_M_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Posnien.pdf",width=8, height=5)
p_TL_M_Posnien
dev.off()
```

```{r p_TL_M_pop_Posnien}

p_TL_M_pop_Posnien <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Posnien", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_M_pop_Posnien
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_pop_Posnien.pdf",width=8, height=5)
p_TL_M_pop_Posnien
dev.off()
```



#### Ritchie Lab

```{r TL_F_lmer_Ritchie}
TL_F_lmer_Ritchie <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|Batch), data = (subset(d_TL_F,Supervisor.PI=='Ritchie')))
capture.output(summary(TL_F_lmer_Ritchie),file = "ThoraxLength/TL_F_Ritchie_sum.txt")
capture.output(anova(TL_F_lmer_Ritchie),file = "ThoraxLength/TL_F_lmer_Ritchie.txt")
capture.output(emmeans(TL_F_lmer_Ritchie, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_F_lmer_Ritchie_tk.txt")
```


```{r}
anova(TL_F_lmer_Ritchie)
```

```{r}
summary(TL_F_lmer_Ritchie)
```

```{r TL_M_lmer_Ritchie}
TL_M_lmer_Ritchie <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|Batch), data = (subset(d_TL_M,Supervisor.PI=='Ritchie')))
capture.output(summary(TL_M_lmer_Ritchie),file = "ThoraxLength/TL_M_Ritchie_sum.txt")
capture.output(anova(TL_M_lmer_Ritchie),file = "ThoraxLength/TL_M_lmer_Ritchie.txt")
capture.output(emmeans(TL_M_lmer_Ritchie, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_M_lmer_Ritchie_tk.txt")
```

```{r}
anova(TL_M_lmer_Ritchie)
```

```{r}
summary(TL_M_lmer_Ritchie)
```


```{r p_TL_F_Ritchie}

p_TL_F_Ritchie <- filter(d_TL_F, Supervisor.PI == "Ritchie") %>% 
  ggplot(aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  geom_jitter(width=0.2,alpha=0.05) + 
  labs(title="p_TL_F_Ritchie", x="Population", y = "TL_micrometers") +
  ylim(c(min_TL, max_TL)) + 
  droseu_theme

```

```{r echo=FALSE}
p_TL_F_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Ritchie.pdf",width=8, height=5)
p_TL_F_Ritchie
dev.off()
```

```{r p_TL_F_pop_Ritchie}

p_TL_F_pop_Ritchie <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Ritchie", x="Population", y = "TL_micrometers")+ coord_cartesian(ylim =c(min_TL, max_TL))+ droseu_theme
dev.off()
```

```{r echo=FALSE}


p_TL_F_pop_Ritchie 
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Ritchie.pdf",width=8, height=5)
p_TL_F_pop_Ritchie
dev.off()
```


```{r p_TL_M_Ritchie}

p_TL_M_Ritchie <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_Ritchie", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme

```


```{r echo=FALSE}
p_TL_M_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Ritchie.pdf",width=8, height=5)
p_TL_M_Ritchie
dev.off()
```


```{r p_TL_M_pop_Ritchie}

p_TL_M_pop_Ritchie <- ggplot(data = (subset(d_TL_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_M_pop_Ritchie", x="Population", y = "TL_micrometers")+ ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_M_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_M_Ritchie.pdf",width=8, height=5)
p_TL_M_pop_Ritchie
dev.off()
```

#### Schmidt Lab

```{r TL_F_lmer_Schmidt}
TL_F_lmer_Schmidt <- lmer(TL_micrometers ~ -1 + Population + (1|Line:Population), data = (subset(d_TL_F,Supervisor.PI=='Schmidt')))
capture.output(summary(TL_F_lmer_Schmidt),file = "ThoraxLength/TL_F_Schmidt_sum.txt")
capture.output(anova(TL_F_lmer_Schmidt),file = "ThoraxLength/TL_F_lmer_Schmidt.txt")
capture.output(emmeans(TL_F_lmer_Schmidt, list(pairwise ~ Population), adjust = "tukey"),file = "ThoraxLength/TL_F_lmer_Schmidt_tk.txt")
```

```{r}
anova(TL_F_lmer_Schmidt)
```

```{r}
summary(TL_F_lmer_Schmidt)
```


```{r p_TL_F_Schmidt}

p_TL_F_Schmidt <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=TL_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_Schmidt", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_F_Schmidt
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_Schmidt.pdf",width=8, height=5)
p_TL_F_Schmidt
dev.off()
```


```{r p_TL_F_pop_Schmidt}

p_TL_F_pop_Schmidt <- ggplot(data = (subset(d_TL_F,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=TL_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_TL_F_pop_Schmidt", x="Population", y = "TL_micrometers") + ylim(c(min_TL, max_TL))+ droseu_theme

```

```{r echo=FALSE}
p_TL_F_pop_Schmidt
```

```{r echo=FALSE}
pdf(file="ThoraxLength/p_TL_F_pop_Schmidt.pdf",width=8, height=5)
p_TL_F_pop_Schmidt
dev.off()
```


### Lab correlations

```{r intersect_TL}
intersect_Line_TL  <- Reduce(intersect, list(d_TL$Line[d_TL$Supervisor.PI == "Kozeretska"],
                                        d_TL$Line[d_TL$Supervisor.PI == "Posnien"],
                                        d_TL$Line[d_TL$Supervisor.PI == "Ritchie"],
                                        d_TL$Line[d_TL$Supervisor.PI == "Schmidt"]))

write(intersect_Line_TL, file ="ThoraxLength/intersect_Line_TL.txt", sep = "\t")

intersect_Pop_TL  <- Reduce(intersect, list(d_TL$Population[d_TL$Supervisor.PI == "Kozeretska"],
                                        d_TL$Population[d_TL$Supervisor.PI == "Posnien"],
                                        d_TL$Population[d_TL$Supervisor.PI == "Ritchie"],
                                        d_TL$Population[d_TL$Supervisor.PI == "Schmidt"]))

write(intersect_Pop_TL, file ="ThoraxLength/intersect_Pop_TL.txt", sep = "\t")
```

There are `r length(intersect_Line_TL) ` populations and `r length(intersect_Pop_TL) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 



```{r}
TL_fitted <- combineFitted(labs = rep(c("Kozeretska", "Posnien", "Ritchie"), 2), sex = rep(c("F", "M"), each = 3), models = list(TL_F_lmer_Kozeretska, TL_F_lmer_Posnien, TL_F_lmer_Ritchie, TL_M_lmer_Kozeretska, TL_M_lmer_Posnien, TL_M_lmer_Ritchie)) %>%
  bind_rows(combineFitted(labs = "Schmidt", sex = "F", models = list(TL_F_lmer_Schmidt)))

p_TL_F_lab_cor <- function() scatterPlotMatrix(TL_fitted, sex = "F")
p_TL_M_lab_cor <- function() scatterPlotMatrix(TL_fitted, sex = "M")
```

```{r p_TL_F_lab_cor, fig.height=8, fig.width=8}
p_TL_F_lab_cor()
```
```{r}
pdf(file="ThoraxLength/p_TL_F_lab_cor.pdf",width=8, height=8)
p_TL_F_lab_cor()
invisible(dev.off())
```

```{r p_TL_M_lab_cor, fig.height=8, fig.width=8}
p_TL_M_lab_cor()
```
```{r}
pdf(file="ThoraxLength/p_TL_M_lab_cor.pdf",width=8, height=8)
p_TL_M_lab_cor()
invisible(dev.off())
```



## Wing area


```{r}
dir.create(file.path("WingArea"), showWarnings = FALSE)
```


_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Onder Lab : Cansu Aksoy, Ekin Demir, Ezgi Cobanoglu, Banu Sebnem Onder

Posnien Lab : Micael Reis, Lennart Hüper, Nico Posnien

Ritchie Lab : Megan Mcgunnigle, Nicola  Cook, Teresa Abaurrea, Marija Tanaskovic, Michael Ritchie

Stamenkovic-Radak Lab : Marija Savic Veselinovic, Marija Tanaskovic, Aleksandra Patenkovic, Filip Filopovski, Mihailo Jelic, Katarina Eric, Pavle Eric, Slobodan Davidovic, Marina Stamenkovic-Radak

### Data Reformatting

```{r d_WA}
d_WA <- read.csv("MasterSheets_Oct21_git/WA_MasterSheet_Nov21.csv")
str(d_WA)
```


```{r}
d_WA$Supervisor.PI <- as.factor(d_WA$Supervisor.PI)
d_WA$Diet <- as.factor(d_WA$Diet)
d_WA$Batch <- as.factor(d_WA$Batch)
d_WA$Population_Lat <- factor(d_WA$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_WA$Population_Lon <- factor(d_WA$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_WA$Population_Alt <- factor(d_WA$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_WA$Line <- as.factor(d_WA$Line)
d_WA$Sex <- as.factor(d_WA$Sex)
d_WA$ReplicateVial <- as.factor(d_WA$ReplicateVial)
d_WA$CentroidSizeLeft_micrometers <- as.numeric(d_WA$CentroidSizeLeft_micrometers)
d_WA$CentroidSizeRight_micrometers <- as.numeric(d_WA$CentroidSizeRight_micrometers)
```

```{r}
str(d_WA)
```


```{r}
d_WA_F <-subset(d_WA,Sex=='F')
d_WA_M <-subset(d_WA,Sex=='M')
```

### _Left_

```{r wing-area-left}

```


```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some sometimes
```


### Descriptive Statistics

Descriptive statistics at the line level, with batch information : 
```{r table_WA_Line_Left_wbatch, echo=FALSE}
table_WA_Line_Left_wbatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                  summarise_at(vars(CentroidSizeLeft_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                file = "WingArea/table_WA_Line_Left_wbatch.csv", row.names = T)
table_WA_Line_Left_wbatch <- read.csv("WingArea/table_WA_Line_Left_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Line_Left_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r table_WA_Line_Left_wobatch, echo=FALSE}
table_WA_Line_Left_wobatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                  summarise_at(vars(CentroidSizeLeft_micrometers), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                file = "WingArea/table_WA_Line_Left_wobatch.csv", row.names = T)
table_WA_Line_Left_wobatch <- read.csv("WingArea/table_WA_Line_Left_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Line_Left_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r table_WA_Pop_Left_wbatch, echo=FALSE}
table_WA_Pop_Left_wbatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                 summarise_at(vars(CentroidSizeLeft_micrometers), 
                                              list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                   SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                               file = "WingArea/table_WA_Pop_Left_wbatch.csv", row.names = T)

table_WA_Pop_Left_wbatch <- read.csv("WingArea/table_WA_Pop_Left_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Pop_Left_wbatch, options = list(pageLength = 10))  %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r table_WA_Pop_Left_wobatch, echo=FALSE}
table_WA_Pop_Left_wobatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                 summarise_at(vars(CentroidSizeLeft_micrometers), 
                                              list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                   SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                               file = "WingArea/table_WA_Pop_Left_wobatch.csv", row.names = T)

table_WA_Pop_Left_wobatch <- read.csv("WingArea/table_WA_Pop_Left_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Pop_Left_wobatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 

```{r}

min_WAL <- min(d_WA$CentroidSizeLeft_micrometers)
max_WAL <- max(d_WA$CentroidSizeLeft_micrometers)

```

y-axis is scaled by the minimum (`r min_WAL`) and maximum (`r max_WAL`) values in the full data set. 


```{r p_WA_F_L}

p_WA_F_L <- ggplot(data = d_WA_F, aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_L
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L.pdf",width=8, height=5)
p_WA_F_L
dev.off()
```

```{r p_WA_M_L}

p_WA_M_L <- ggplot(data = d_WA_M, aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L 
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L.pdf",width=8, height=5)
p_WA_M_L
dev.off()
```


#### Onder Lab

```{r WA_F_L_Onder_lmer}
WA_F_L_Onder_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) + (1|Batch) + (1|ReplicateVial:Line:Population), data = d_WA_F %>% filter(Supervisor.PI=='Onder'))
capture.output(summary(WA_F_L_Onder_lmer),file = "WingArea/WA_F_L_Onder_sum.txt")
capture.output(anova(WA_F_L_Onder_lmer),file = "WingArea/WA_F_L_Onder_lmer.txt")
capture.output(emmeans(WA_F_L_Onder_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_L_Onder_lmer_tk.txt")

```

```{r}
anova(WA_F_L_Onder_lmer)
```

```{r}
summary(WA_F_L_Onder_lmer)
```


```{r WA_M_L_Onder_lmer}
WA_M_L_Onder_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Onder')))
capture.output(summary(WA_M_L_Onder_lmer),file = "WingArea/WA_M_L_Onder_sum.txt")
capture.output(anova(WA_M_L_Onder_lmer),file = "WingArea/WA_M_L_Onder_lmer.txt")
capture.output(emmeans(WA_M_L_Onder_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_L_Onder_lmer_tk.txt")
```

```{r}
anova(WA_M_L_Onder_lmer)
```

```{r}
summary(WA_M_L_Onder_lmer)
```



```{r p_WA_F_L_Onder}

p_WA_F_L_Onder <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_Onder_L", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_L_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_Onder_L.pdf",width=8, height=5)
p_WA_F_L_Onder
dev.off()
```

```{r p_WA_F_L_pop_Onder}

p_WA_F_L_pop_Onder <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Onder", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_L_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Onder.pdf",width=8, height=5)
p_WA_F_L_pop_Onder
dev.off()
```



```{r p_WA_M_L_Onder}


p_WA_M_L_Onder <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_Onder_L", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_L_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_Onder_L.pdf",width=8, height=5)
p_WA_M_L_Onder
dev.off()
```

```{r p_WA_M_L_pop_Onder}

p_WA_M_L_pop_Onder <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Onder", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Onder.pdf",width=8, height=5)
p_WA_M_L_pop_Onder
dev.off()
```


#### Posnien Lab 

```{r WA_F_L_Posnien_lmer}
WA_F_L_Posnien_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='Posnien')))
capture.output(summary(WA_F_L_Posnien_lmer),file = "WingArea/WA_F_L_Posnien_sum.txt")
capture.output(anova(WA_F_L_Posnien_lmer),file = "WingArea/WA_F_L_Posnien_lmer.txt")
capture.output(emmeans(WA_F_L_Posnien_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_L_Posnien_lmer_tk.txt")

```

```{r}
anova(WA_F_L_Posnien_lmer)
```

```{r}
summary(WA_F_L_Posnien_lmer)
```



```{r WA_M_L_Posnien_lmer}
WA_M_L_Posnien_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Posnien')))
capture.output(summary(WA_M_L_Posnien_lmer),file = "WingArea/WA_M_L_Posnien_sum.txt")
capture.output(anova(WA_M_L_Posnien_lmer),file = "WingArea/WA_M_L_Posnien_lmer.txt")
capture.output(emmeans(WA_M_L_Posnien_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_L_Posnien_lmer_tk.txt")

```

```{r}
anova(WA_M_L_Posnien_lmer)
```

```{r}
summary(WA_M_L_Posnien_lmer)
```


```{r p_WA_F_L_Posnien}

p_WA_F_L_Posnien <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_Posnien", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_L_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_Posnien.pdf",width=8, height=5)
p_WA_F_L_Posnien
dev.off()
```


```{r p_WA_F_L_pop_Posnien}

p_WA_F_L_pop_Posnien <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Posnien", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_L_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Posnien.pdf",width=8, height=5)
p_WA_F_L_pop_Posnien
dev.off()
```

```{r p_WA_M_L_Posnien}

p_WA_M_L_Posnien <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_Posnien", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_Posnien.pdf",width=8, height=5)
p_WA_M_L_Posnien
dev.off()
```


```{r p_WA_M_L_pop_Posnien}


p_WA_M_L_pop_Posnien <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Posnien", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_L_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Posnien.pdf",width=8, height=5)
p_WA_M_L_pop_Posnien
dev.off()
```


#### Ritchie Lab

```{r WA_F_L_Ritchie_lmer}
WA_F_L_Ritchie_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='Ritchie')))
capture.output(summary(WA_F_L_Ritchie_lmer),file = "WingArea/WA_F_L_Ritchie_sum.txt")
capture.output(anova(WA_F_L_Ritchie_lmer),file = "WingArea/WA_F_L_Ritchie_lmer.txt")
capture.output(emmeans(WA_F_L_Ritchie_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_L_Ritchie_lmer_tk.txt")

```

```{r}
anova(WA_F_L_Ritchie_lmer)
```

```{r}
summary(WA_F_L_Ritchie_lmer)
```


```{r WA_M_L_Ritchie_lmer}
WA_M_L_Ritchie_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Ritchie')))
capture.output(summary(WA_M_L_Ritchie_lmer),file = "WingArea/WA_M_L_Ritchie_sum.txt")
capture.output(anova(WA_M_L_Ritchie_lmer),file = "WingArea/WA_M_L_Ritchie_lmer.txt")
capture.output(emmeans(WA_M_L_Ritchie_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_L_Ritchie_lmer_tk.txt")

```


```{r}
anova(WA_M_L_Ritchie_lmer)
```

```{r}
summary(WA_M_L_Ritchie_lmer)
```


```{r p_WA_F_L_Ritchie}

p_WA_F_L_Ritchie <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_L_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_Ritchie.pdf",width=8, height=5)
p_WA_F_L_Ritchie
dev.off()
```



```{r p_WA_F_L_pop_Ritchie}

p_WA_F_L_pop_Ritchie <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_L_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_Ritchie.pdf",width=8, height=5)
p_WA_F_L_pop_Ritchie
dev.off()
```



```{r p_WA_M_L_Ritchie}

p_WA_M_L_Ritchie <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_Ritchie.pdf",width=8, height=5)
p_WA_M_L_Ritchie
dev.off()
```

```{r p_WA_M_L_pop_Ritchie}


p_WA_M_L_pop_Ritchie <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_Ritchie", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_Ritchie.pdf",width=8, height=5)
p_WA_M_L_pop_Ritchie
dev.off()
```

#### Stamenkovic-Radak Lab


```{r WA_F_L_StamenkovicRadak_lmer}
WA_F_L_StamenkovicRadak_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                                       (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')))
capture.output(summary(WA_F_L_StamenkovicRadak_lmer),file = "WingArea/WA_F_L_StamenkovicRadak_sum.txt")
capture.output(anova(WA_F_L_StamenkovicRadak_lmer),file = "WingArea/WA_F_L_StamenkovicRadak_lmer.txt")
capture.output(emmeans(WA_F_L_StamenkovicRadak_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_L_StamenkovicRadak_lmer_tk.txt")


```

```{r}
anova(WA_F_L_StamenkovicRadak_lmer)
```

```{r}
summary(WA_F_L_StamenkovicRadak_lmer)
```


```{r WA_M_L_StamenkovicRadak_lmer}
WA_M_L_StamenkovicRadak_lmer <- lmer(CentroidSizeLeft_micrometers ~ -1 + Population + (1|Line:Population) +
                                       (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')))
capture.output(summary(WA_M_L_StamenkovicRadak_lmer),file = "WingArea/WA_M_L_StamenkovicRadak_sum.txt")
capture.output(anova(WA_M_L_StamenkovicRadak_lmer),file = "WingArea/WA_M_L_StamenkovicRadak_lmer.txt")
capture.output(emmeans(WA_M_L_StamenkovicRadak_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_L_StamenkovicRadak_lmer_tk.txt")

```


```{r}
anova(WA_M_L_StamenkovicRadak_lmer)
```

```{r}
summary(WA_M_L_StamenkovicRadak_lmer)
```


```{r p_WA_F_L_StamenkovicRadak}

p_WA_F_L_StamenkovicRadak <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_L_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_L_StamenkovicRadak
dev.off()
```


```{r p_WA_F_L_pop_StamenkovicRadak}

p_WA_F_L_pop_StamenkovicRadak <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_L_pop_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_L_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_L_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_L_pop_StamenkovicRadak
dev.off()
```

```{r p_WA_M_L_StamenkovicRadak}

p_WA_M_L_StamenkovicRadak <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_L_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_L_StamenkovicRadak
dev.off()
```

```{r p_WA_M_L_pop_StamenkovicRadak}

p_WA_M_L_pop_StamenkovicRadak <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeLeft_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_L_pop_StamenkovicRadak", x="Population", y = "CentroidSizeLeft_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_L_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_L_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_L_pop_StamenkovicRadak
dev.off()
```

### _Right_

```{r wing-area-right}

```

### Descriptive Statistics



Descriptive statistics at the line level, with batch information : 
```{r table_WA_Line_Right_wbatch, echo=FALSE}
table_WA_Line_Right_wbatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                         summarise_at(vars(CentroidSizeRight_micrometers), 
                                                      list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                           SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                       file = "WingArea/table_WA_Line_Right_wbatch.csv", row.names = T)
table_WA_Line_Right_wbatch <- read.csv("WingArea/table_WA_Line_Right_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Line_Right_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information : 
```{r table_WA_Line_Right_wobatch, echo=FALSE}
table_WA_Line_Right_wobatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                          summarise_at(vars(CentroidSizeRight_micrometers), 
                                                       list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                            SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                        file = "WingArea/table_WA_Line_Right_wobatch.csv", row.names = T)
table_WA_Line_Right_wobatch <- read.csv("WingArea/table_WA_Line_Right_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Line_Right_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r table_WA_Pop_Right_wbatch, echo=FALSE}
table_WA_Pop_Right_wbatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                        summarise_at(vars(CentroidSizeRight_micrometers), 
                                                     list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                          SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                      file = "WingArea/table_WA_Pop_Right_wbatch.csv", row.names = T)

table_WA_Pop_Right_wbatch <- read.csv("WingArea/table_WA_Pop_Right_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Pop_Right_wbatch, options = list(pageLength = 10))  %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r table_WA_Pop_Right_wobatch, echo=FALSE}
table_WA_Pop_Right_wobatch <- write.csv(d_WA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                         summarise_at(vars(CentroidSizeRight_micrometers), 
                                                      list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                           SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                       file = "WingArea/table_WA_Pop_Right_wobatch.csv", row.names = T)

table_WA_Pop_Right_wobatch <- read.csv("WingArea/table_WA_Pop_Right_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_WA_Pop_Right_wobatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 

```{r}

min_WAR <- min(d_WA$CentroidSizeRight_micrometers)
max_WAR <- max(d_WA$CentroidSizeRight_micrometers)

```


```{r p_WA_F_R}

p_WA_F_R <- ggplot(data = d_WA_F, aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAL, max_WAL))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_R
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R.pdf",width=8, height=5)
p_WA_F_R
dev.off()
```


```{r p_WA_M_R}

p_WA_M_R <- ggplot(data = d_WA_M, aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Supervisor.PI)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAL, max_WAL))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_R
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R.pdf",width=8, height=5)
p_WA_M_R
dev.off()
```

#### Onder Lab

```{r}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some 
```


```{r WA_F_R_Onder_lmer}
WA_F_R_Onder_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='Onder')))
capture.output(summary(WA_F_R_Onder_lmer),file = "WingArea/WA_F_R_Onder_sum.txt")
capture.output(anova(WA_F_R_Onder_lmer),file = "WingArea/WA_F_R_Onder_lmer.txt")
capture.output(emmeans(WA_F_R_Onder_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_R_Onder_lmer_tk.txt")

```

```{r}
anova(WA_F_R_Onder_lmer)
```

```{r}
summary(WA_F_R_Onder_lmer)
```


```{r WA_M_R_Onder_lmer}
WA_M_R_Onder_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                            (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Onder')))
capture.output(summary(WA_M_R_Onder_lmer),file = "WingArea/WA_M_R_Onder_sum.txt")
capture.output(anova(WA_M_R_Onder_lmer),file = "WingArea/WA_M_R_Onder_lmer.txt")
capture.output(emmeans(WA_M_R_Onder_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_R_Onder_lmer_tk.txt")

```


```{r}
anova(WA_M_R_Onder_lmer)
```

```{r}
summary(WA_M_R_Onder_lmer)
```


```{r p_WA_F_R_Onder}

p_WA_F_R_Onder <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_Onder_R", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_R_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Onder.pdf",width=8, height=5)
p_WA_F_R_Onder
dev.off()
```

```{r p_WA_F_R_pop_Onder}

p_WA_F_R_pop_Onder <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_R_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Onder.pdf",width=8, height=5)
p_WA_F_R_pop_Onder
dev.off()
```


```{r p_WA_M_R_Onder}

p_WA_M_R_Onder <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_R_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Onder.pdf",width=8, height=5)
p_WA_M_R_Onder
dev.off()
```

```{r p_WA_M_R_pop_Onder}

p_WA_M_R_pop_Onder <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Onder", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_R_pop_Onder
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_Onder.pdf",width=8, height=5)
p_WA_M_R_pop_Onder
dev.off()
```


#### Posnien Lab 


```{r WA_F_R_Posnien_lmer}
WA_F_R_Posnien_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='Posnien')))
capture.output(summary(WA_F_R_Posnien_lmer),file = "WingArea/WA_F_R_Posnien_sum.txt")
capture.output(anova(WA_F_R_Posnien_lmer),file = "WingArea/WA_F_R_Posnien_lmer.txt")
capture.output(emmeans(WA_F_R_Posnien_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_R_Posnien_lmer_tk.txt")

```

```{r}
anova(WA_F_R_Posnien_lmer)
```

```{r}
summary(WA_F_R_Posnien_lmer)
```


```{r WA_M_R_Posnien_lmer}
WA_M_R_Posnien_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                               (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Posnien')))
capture.output(summary(WA_M_R_Posnien_lmer),file = "WingArea/WA_M_R_Posnien_sum.txt")
capture.output(anova(WA_M_R_Posnien_lmer),file = "WingArea/WA_M_R_Posnien_lmer.txt")
capture.output(emmeans(WA_M_R_Posnien_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_R_Posnien_lmer_tk.txt")

```


```{r}
anova(WA_M_R_Posnien_lmer)
```

```{r}
summary(WA_M_R_Posnien_lmer)
```

```{r p_WA_F_R_Posnien}

p_WA_F_R_Posnien <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_R_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Posnien.pdf",width=8, height=5)
p_WA_F_R_Posnien
dev.off()
```


```{r p_WA_F_R_pop_Posnien}

p_WA_F_R_pop_Posnien <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Posnien", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_R_pop_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Posnien.pdf",width=8, height=5)
p_WA_F_R_pop_Posnien
dev.off()
```

```{r p_WA_M_R_Posnien}

p_WA_M_R_Posnien <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_R_Posnien
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Posnien.pdf",width=8, height=5)
p_WA_M_R_Posnien
dev.off()
```


```{r p_WA_M_R_pop_Posnien}

p_WA_M_R_pop_Posnien <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Posnien')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Posnien", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_R_pop_Posnien
```

```{r echo=FALSE}

pdf(file="WingArea/p_WA_M_R_pop_Posnien.pdf",width=8, height=5)
p_WA_M_R_pop_Posnien
dev.off()
```


#### Ritchie Lab

```{r WA_F_R_Ritchie_lmer}
WA_F_R_Ritchie_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='Ritchie')))
capture.output(summary(WA_F_R_Ritchie_lmer),file = "WingArea/WA_F_R_Ritchie_sum.txt")
capture.output(anova(WA_F_R_Ritchie_lmer),file = "WingArea/WA_F_R_Ritchie_lmer.txt")
capture.output(emmeans(WA_F_R_Ritchie_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_R_Ritchie_lmer_tk.txt")

```

```{r}
anova(WA_F_R_Ritchie_lmer)
```

```{r}
summary(WA_F_R_Ritchie_lmer)
```


```{r WA_M_R_Ritchie_lmer}
WA_M_R_Ritchie_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                              (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='Ritchie')))
capture.output(summary(WA_M_R_Ritchie_lmer),file = "WingArea/WA_M_R_Ritchie_sum.txt")
capture.output(anova(WA_M_R_Ritchie_lmer),file = "WingArea/WA_M_R_Ritchie_lmer.txt")
capture.output(emmeans(WA_M_R_Ritchie_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_M_R_Ritchie_lmer_tk.txt")

```


```{r}
anova(WA_M_R_Ritchie_lmer)
```

```{r}
summary(WA_M_R_Ritchie_lmer)
```

```{r p_WA_F_R_Ritchie}

p_WA_F_R_Ritchie <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_R_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_Ritchie.pdf",width=8, height=5)
p_WA_F_R_Ritchie
dev.off()
```


```{r p_WA_F_R_pop_Ritchie}

p_WA_F_R_pop_Ritchie <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_F_R_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_Ritchie.pdf",width=8, height=5)
p_WA_F_R_pop_Ritchie
dev.off()
```

```{r p_WA_M_R_Ritchie}


p_WA_M_R_Ritchie <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_Ritchie", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_R_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_Ritchie.pdf",width=8, height=5)
p_WA_M_R_Ritchie
dev.off()
```


```{r p_WA_M_R_pop_Ritchie}

p_WA_M_R_pop_Ritchie <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='Ritchie')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_Ritchie", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_R_pop_Ritchie
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_Ritchie.pdf",width=8, height=5)
p_WA_M_R_pop_Ritchie
dev.off()
```



#### Stamenkovic-Radak Lab

```{r WA_F_R_StamenkovicRadak_lmer}
WA_F_R_StamenkovicRadak_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                                       (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')))
capture.output(summary(WA_F_R_StamenkovicRadak_lmer),file = "WingArea/WA_F_R_StamenkovicRadak_sum.txt")
capture.output(anova(WA_F_R_StamenkovicRadak_lmer),file = "WingArea/WA_F_R_StamenkovicRadak_lmer.txt")
capture.output(emmeans(WA_F_R_StamenkovicRadak_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_R_StamenkovicRadak_lmer_tk.txt")

```

```{r}
anova(WA_F_R_StamenkovicRadak_lmer)
```

```{r}
summary(WA_F_R_StamenkovicRadak_lmer)
```


```{r WA_M_R_StamenkovicRadak_lmer}
WA_M_R_StamenkovicRadak_lmer <- lmer(CentroidSizeRight_micrometers ~ -1 + Population + (1|Line:Population) +
                                       (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')))
capture.output(summary(WA_M_R_StamenkovicRadak_lmer),file = "WingArea/WA_M_R_StamenkovicRadak_sum.txt")
capture.output(anova(WA_M_R_StamenkovicRadak_lmer),file = "WingArea/WA_M_R_StamenkovicRadak_lmer.txt")
capture.output(emmeans(WA_M_R_StamenkovicRadak_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "WingArea/WA_F_R_StamenkovicRadak_lmer_tk.txt")


```

```{r}
anova(WA_M_R_StamenkovicRadak_lmer)
```

```{r}
summary(WA_M_R_StamenkovicRadak_lmer)
```


```{r p_WA_F_R_StamenkovicRadak}

p_WA_F_R_StamenkovicRadak <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_R_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_R_StamenkovicRadak
dev.off()
```


```{r p_WA_F_R_pop_StamenkovicRadak}

p_WA_F_R_pop_StamenkovicRadak <- ggplot(data = (subset(d_WA_F,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_F_R_pop_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_F_R_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_F_R_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_F_R_pop_StamenkovicRadak
dev.off()
```

```{r p_WA_M_R_StamenkovicRadak}


p_WA_M_R_StamenkovicRadak <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Batch)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers")+ ylim(c(min_WAR, max_WAR))+ droseu_theme

```


```{r echo=FALSE}
p_WA_M_R_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_R_StamenkovicRadak
dev.off()
```

```{r p_WA_M_R_pop_StamenkovicRadak}


p_WA_M_R_pop_StamenkovicRadak <- ggplot(data = (subset(d_WA_M,Supervisor.PI=='StamenkovicRadak')), aes(x=Population_Lat, y=CentroidSizeRight_micrometers, fill=Population)) + 
  geom_boxplot(outlier.shape = NA, notch=FALSE) + 
  labs(title="p_WA_M_R_pop_StamenkovicRadak", x="Population", y = "CentroidSizeRight_micrometers") + ylim(c(min_WAR, max_WAR))+ droseu_theme

```

```{r echo=FALSE}
p_WA_M_R_pop_StamenkovicRadak
```

```{r echo=FALSE}
pdf(file="WingArea/p_WA_M_R_pop_StamenkovicRadak.pdf",width=8, height=5)
p_WA_M_R_pop_StamenkovicRadak
dev.off()
```


### Lab correlations


```{r intesect_WA}
intersect_Line_WA_F  <- Reduce(intersect, list(d_WA_F$Line[d_WA_F$Supervisor.PI == "Onder"],
                                          d_WA_F$Line[d_WA_F$Supervisor.PI == "Posnien"],
                                          d_WA_F$Line[d_WA_F$Supervisor.PI == "Ritchie"],
                                          d_WA_F$Line[d_WA_F$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Line_WA_F, file ="WingArea/intersect_Line_WA_F.txt", sep = "\t")

intersect_Pop_WA_F  <- Reduce(intersect, list(d_WA_F$Population[d_WA_F$Supervisor.PI == "Onder"],
                                          d_WA_F$Population[d_WA_F$Supervisor.PI == "Posnien"],
                                          d_WA_F$Population[d_WA_F$Supervisor.PI == "Ritchie"],
                                          d_WA_F$Population[d_WA_F$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Pop_WA_F, file ="WingArea/intersect_Pop_WA_F.txt", sep = "\t")

```


```{r}
intersect_Line_WA_M  <- Reduce(intersect, list(d_WA_M$Line[d_WA_M$Supervisor.PI == "Onder"],
                                          d_WA_M$Line[d_WA_M$Supervisor.PI == "Posnien"],
                                          d_WA_M$Line[d_WA_M$Supervisor.PI == "Ritchie"],
                                          d_WA_M$Line[d_WA_M$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Line_WA_M, file ="WingArea/intersect_Line_WA_M.txt", sep = "\t")

intersect_Pop_WA_M  <- Reduce(intersect, list(d_WA_M$Population[d_WA_M$Supervisor.PI == "Onder"],
                                          d_WA_M$Population[d_WA_M$Supervisor.PI == "Posnien"],
                                          d_WA_M$Population[d_WA_M$Supervisor.PI == "Ritchie"],
                                          d_WA_M$Population[d_WA_M$Supervisor.PI == "StamenkovicRadak"]))
write(intersect_Pop_WA_M, file ="WingArea/intersect_Pop_WA_M.txt", sep = "\t")


```

There are `r length(intersect_Pop_WA_F) ` populations and `r length(intersect_Line_WA_F) ` isofemale lines for females and `r length(intersect_Pop_WA_M) ` populations and `r length(intersect_Line_WA_M) ` isofemale lines for males have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 




### _Left_

```{r}
WA_L_fitted <- combineFitted(labs = rep(c("Onder", "Posnien", "Ritchie", "StamenkovicRadak"), 2), sex = rep(c("F", "M"), each = 4), models = list(WA_F_L_Onder_lmer, WA_F_L_Posnien_lmer, WA_F_L_Ritchie_lmer, WA_F_L_StamenkovicRadak_lmer, WA_M_L_Onder_lmer, WA_M_L_Posnien_lmer, WA_M_L_Ritchie_lmer, WA_M_L_StamenkovicRadak_lmer))

p_WA_L_F_lab_cor <- function() scatterPlotMatrix(WA_L_fitted, sex = "F")
p_WA_L_M_lab_cor <- function() scatterPlotMatrix(WA_L_fitted, sex = "M")
```

```{r p_WA_L_F_lab_cor, fig.height=8, fig.width=8}
p_WA_L_F_lab_cor()
```
```{r}
pdf(file="WingArea/p_WA_L_F_lab_cor.pdf",width=8, height=8)
p_WA_L_F_lab_cor()
invisible(dev.off())
```

```{r p_WA_L_M_lab_cor, fig.height=8, fig.width=8}
p_WA_L_M_lab_cor()
```
```{r}
pdf(file="WingArea/p_WA_L_M_lab_cor.pdf",width=8, height=8)
p_WA_L_M_lab_cor()
invisible(dev.off())
```
### _Right_

```{r}
WA_R_fitted <- combineFitted(labs = rep(c("Onder", "Posnien", "Ritchie", "StamenkovicRadak"), 2), sex = rep(c("F", "M"), each = 4), models = list(WA_F_R_Onder_lmer, WA_F_R_Posnien_lmer, WA_F_R_Ritchie_lmer, WA_F_R_StamenkovicRadak_lmer, WA_M_R_Onder_lmer, WA_M_R_Posnien_lmer, WA_M_R_Ritchie_lmer, WA_M_R_StamenkovicRadak_lmer))

p_WA_R_F_lab_cor <- function() scatterPlotMatrix(WA_R_fitted, sex = "F")
p_WA_R_M_lab_cor <- function() scatterPlotMatrix(WA_R_fitted, sex = "M")
```

```{r p_WA_R_F_lab_cor, fig.height=8, fig.width=8}
p_WA_R_F_lab_cor()
```

```{r}
pdf(file="WingArea/p_WA_R_F_lab_cor.pdf",width=8, height=8)
p_WA_R_F_lab_cor()
invisible(dev.off())
```

```{r p_WA_R_M_lab_cor, fig.height=8, fig.width=8}
p_WA_R_M_lab_cor()
```
```{r}
pdf(file="WingArea/p_WA_R_M_lab_cor.pdf",width=8, height=8)
p_WA_R_M_lab_cor()
invisible(dev.off())
```






```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some sometimes
```


## Fecundity


```{r}
dir.create(file.path("Fecundity"), showWarnings = FALSE)
```




_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


```{r}
#Note that the trait has been phenotyped only in females.
```

### Contributors  

Billeter Lab : Xiaocui Wang, Tiphaine Bailly, Mario Mira, Jean-Christophe Billeter

Fricke Lab : Claudia Fricke

### Data Reformatting


**Reading data in R**

```{r d_Fec}
d_Fec <- read.csv("MasterSheets_Oct21_git/FEC_MasterSheet_Oct21.csv")
str(d_Fec)
```

Factors need reformatting (i.e. Supervisor.PI should be coded as a factor, not character).

```{r}
str(d_Fec)
d_Fec$Supervisor.PI <- as.factor(d_Fec$Supervisor.PI)
d_Fec$Diet <- as.factor(d_Fec$Diet)
d_Fec$Batch <- as.factor(d_Fec$Batch)
d_Fec$Population <- as.factor(d_Fec$Population)
d_Fec$Population_Lat <- factor(d_Fec$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_Fec$Population_Lon <- factor(d_Fec$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_Fec$Population_Alt <- factor(d_Fec$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_Fec$Line <- as.factor(d_Fec$Line)
d_Fec$NumberOfAdultsEclosed <- as.numeric(d_Fec$NumberOfAdultsEclosed)
d_Fec$Censor <- as.factor(d_Fec$Censor)
str(d_Fec)

d_Fec <- subset(d_Fec, Censor == "0")
```

Now they should be in the correct format, see below. 

```{r}
str(d_Fec)
```

### Descriptive Statistics



Descriptive statistics at the line level, with batch information : 
```{r table_Fec_Line_wbatch, echo=FALSE}
table_Fec_Line_wbatch <- write.csv(d_Fec %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(NumberOfAdultsEclosed), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Fecundity/table_Fec_Line_wbatch.csv", row.names = T)
table_Fec_Line_wbatch <- read.csv("Fecundity/table_Fec_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Fec_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics for fecundity at the line level, without batch information : 
  
```{r table_Fec_Line_wobatch, echo=FALSE}
table_Fec_Line_wobatch <- write.csv(d_Fec %>% group_by(Supervisor.PI, Population, Line) %>% summarise_at(vars(NumberOfAdultsEclosed), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Fecundity/table_Fec_Line_wobatch.csv", row.names = T)
table_Fec_Line_wobatch <- read.csv("Fecundity/table_Fec_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Fec_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, with batch information : 
```{r table_Fec_Pop_wbatch, echo=FALSE}
table_Fec_Pop_wbatch <- write.csv(d_Fec %>% group_by(Supervisor.PI, Batch, Population) %>% summarise_at(vars(NumberOfAdultsEclosed), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Fecundity/table_Fec_Pop_wbatch.csv", row.names = T)
table_Fec_Pop_wbatch <- read.csv("Fecundity/table_Fec_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Fec_Pop_wbatch, options = list(pageLength = 10))  %>% formatRound(5:12, 3)
```

Descriptive statistics at the population level, without batch information : 
```{r table_Fec_Pop_wobatch, echo=FALSE}
table_Fec_Pop_wobatch <- write.csv(d_Fec %>% group_by(Supervisor.PI, Population) %>% summarise_at(vars(NumberOfAdultsEclosed), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Fecundity/table_Fec_Pop_wobatch.csv", row.names = T)
table_Fec_Pop_wobatch <- read.csv("Fecundity/table_Fec_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_Fec_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(4:11, 3)
```


### Plots and Linear Models by Lab  

#### Overview 



```{r echo=TRUE}
min_Fec <- min(d_Fec$NumberOfAdultsEclosed)
max_Fec <- max(d_Fec$NumberOfAdultsEclosed)
```

y-axis is scaled by the minimum (`r min_Fec`) and maximum (`r max_Fec`) values in the full data set. 

```{r p_Fec_all}

p_Fec_all <- ggplot(data = d_Fec, aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Fec_all", x="Population", y = "DW_micrograms") + ylim(c(min_Fec, max_Fec))+ droseu_theme

```

```{r echo=FALSE}
p_Fec_all
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_all.pdf",width=8, height=5)
p_Fec_all
dev.off()
```


#### Billeter Lab

```{r Fec_lmer_Billeter, echo=TRUE, message=TRUE, warning=TRUE}
Fec_lmer_Billeter <- lmer(NumberOfAdultsEclosed ~ -1 + Population + (1|Population:Line), data = d_Fec[d_Fec$Supervisor.PI == "Billeter",]) 
capture.output(anova(Fec_lmer_Billeter),file = "Fecundity/Fec_lmer_Billeter.txt")
capture.output(summary(Fec_lmer_Billeter),file = "Fecundity/Fec_lmer_Billeter_sum.txt")
capture.output(emmeans(Fec_lmer_Billeter, list(pairwise ~ Population), adjust = "tukey"),file = "Fecundity/Fec_lmer_Billeter_tukey.txt")

```

```{r}
anova(Fec_lmer_Billeter)
```

```{r}
summary(Fec_lmer_Billeter)
```

```{r p_Fec_Billeter, echo=TRUE, message=TRUE, warning=TRUE}

p_Fec_Billeter <- ggplot(data = (subset(d_Fec,Supervisor.PI=='Billeter')), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Batch)) +  geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_Billeter", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme

```

```{r echo=FALSE}
p_Fec_Billeter
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_Billeter.pdf",width=8, height=5)
p_Fec_Billeter
dev.off()
```

```{r p_Fec_pop_Billeter, echo=TRUE, message=TRUE, warning=TRUE}
p_Fec_pop_Billeter <- ggplot(data = (subset(d_Fec,Supervisor.PI=='Billeter')), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_pop_Billeter", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme
```

```{r echo=FALSE}
p_Fec_pop_Billeter
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_pop_Billeter.pdf",width=8, height=5)
p_Fec_pop_Billeter
dev.off()
```


#### Fricke Lab 

```{r Fec_lmer_Fricke, echo=FALSE, message=FALSE, warning=FALSE}
Fec_lmer_Fricke <- lmer(NumberOfAdultsEclosed ~ -1 + Population + (1|Population:Line) +
                         (1|Batch), data = d_Fec[d_Fec$Supervisor.PI == "Fricke",])
capture.output(anova(Fec_lmer_Fricke),file = "Fecundity/Fec_lmer_Fricke.txt")
capture.output(summary(Fec_lmer_Fricke),file = "Fecundity/Fec_lmer_Fricke_sum.txt")
capture.output(emmeans(Fec_lmer_Fricke, list(pairwise ~ Population), adjust = "tukey"),file = "Fecundity/Fec_lmer_Fricke_tukey.txt")
```

```{r}
anova(Fec_lmer_Fricke)
```

```{r}
summary(Fec_lmer_Fricke)
```

```{r p_Fec_Fricke, echo=FALSE, message=FALSE, warning=FALSE}

p_Fec_Fricke <- ggplot(data = (subset(d_Fec,Supervisor.PI=='Fricke')), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_Fricke", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme

```

```{r echo=FALSE}
p_Fec_Fricke
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_Fricke.pdf",width=8, height=5)
p_Fec_Fricke
dev.off()
```


```{r p_Fec_pop_Fricke, echo=FALSE, message=FALSE, warning=FALSE}

p_Fec_pop_Fricke <- ggplot(data = (subset(d_Fec,Supervisor.PI=='Fricke')), aes(x=Population_Lat, y=NumberOfAdultsEclosed, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_Fec_pop_Fricke", x="Population", y = "NumberOfAdultsEclosed") + ylim(c(min_Fec, max_Fec))+ droseu_theme

```

```{r echo=FALSE}
p_Fec_pop_Fricke
```

```{r echo=FALSE}
pdf(file="Fecundity/p_Fec_pop_Fricke.pdf",width=8, height=5)
p_Fec_pop_Fricke
dev.off()
```


### Lab correlations

```{r intersect_Fec}
intersect_Line_Fec <- intersect(d_Fec$Line[d_Fec$Supervisor.PI == "Billeter"], 
                           d_Fec$Line[d_Fec$Supervisor.PI == "Fricke"])
write(intersect_Line_Fec, file ="Fecundity/intersect_Line_Fec.txt", sep = "\t")


intersect_Pop_Fec <- intersect(d_Fec$Line[d_Fec$Supervisor.PI == "Billeter"], 
                           d_Fec$Line[d_Fec$Supervisor.PI == "Fricke"])
write(intersect_Pop_Fec, file ="Fecundity/intersect_Pop_Fec.txt", sep = "\t")


```

There are `r length(intersect_Pop_Fec) ` populations and `r length(intersect_Line_Fec) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 



```{r}
Fec_fitted <- combineFitted(labs = c("Billeter", "Fricke"), sex = rep("NA", 2), models = list(Fec_lmer_Billeter, Fec_lmer_Fricke))

p_Fec_lab_cor <- function() scatterPlotMatrix(Fec_fitted, sex = "NA")
```


```{r p_Fec_lab_cor, fig.height=8, fig.width=8}
p_Fec_lab_cor()
```
```{r}
pdf(file="Fecundity/p_Fec_lab_cor.pdf",width=8, height=8)
p_Fec_lab_cor()
invisible(dev.off())
```




## Lifespan


```{r}
dir.create(file.path("Lifespan"), showWarnings = FALSE)
```




_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some 
```


### Contributors  

Flatt Lab : Esra Durmaz, Envel Kerdaffrec, Thibault Schowing, Virginie Thieu, Marisa Rodrigues, Thomas Flatt

Parsch Lab : Amanda Glaser-Schmitt, Eliza Argyridou, John Parsch

Pasyukova Lab : Natalia Roshina, Alexander Symonenko, Mikhail Trostnikov, Evgenia Tsybul'ko, Ekaterina Veselkina, Olga Rybina, Elena Pasyukova


### Data Reformatting

```{r d_LS_L}
d_LS_L <- read.csv("MasterSheets_Oct21_git/LSL_MasterSheet_Oct21.csv")
```

```{r}
str(d_LS_L)
```


```{r}
d_LS_L$Supervisor.PI <- as.factor(d_LS_L$Supervisor.PI)
d_LS_L$Diet <- as.factor(d_LS_L$Diet)
d_LS_L$Batch <- as.factor(d_LS_L$Batch)
d_LS_L$Population <- as.factor(d_LS_L$Population)
d_LS_L$Population_Lat <- factor(d_LS_L$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_LS_L$Population_Lon <- factor(d_LS_L$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_LS_L$Population_Alt <- factor(d_LS_L$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_LS_L$Line <- as.factor(d_LS_L$Line)
d_LS_L$ReplicateVial <- as.factor(d_LS_L$ReplicateVial)
d_LS_L$LSL_AgeAtDeath_days <- as.numeric(d_LS_L$LSL_AgeAtDeath_days)
d_LS_L$Censor <- as.factor(d_LS_L$Censor)
```


```{r}
str(d_LS_L)
```


```{r}
d_LS_L_F <-subset(d_LS_L,Sex=='F')
d_LS_L_M <-subset(d_LS_L,Sex=='M')


```


```{r d_LS_P}
d_LS_P <- read.csv("MasterSheets_Oct21_git/LSP_MasterSheet_Oct21.csv")
```

```{r}
str(d_LS_P)
```


```{r}
d_LS_P$Supervisor.PI <- as.factor(d_LS_P$Supervisor.PI)
d_LS_P$Diet <- as.factor(d_LS_P$Diet)
d_LS_P$Batch <- as.factor(d_LS_P$Batch)
d_LS_P$Population <- as.factor(d_LS_P$Population)
d_LS_P$Population_Lat <- factor(d_LS_P$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_LS_P$Population_Lon <- factor(d_LS_P$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_LS_P$Population_Alt <- factor(d_LS_P$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_LS_P$ReplicateCage <- as.factor(d_LS_P$ReplicateCage)
d_LS_P$LSP_AgeAtDeath_days <- as.numeric(d_LS_P$LSP_AgeAtDeath_days)
d_LS_P$Censor <- as.factor(d_LS_P$Censor)
```


```{r}
str(d_LS_P)
```


```{r}
d_LS_P_F <-subset(d_LS_P,Sex=='F')
d_LS_P_M <-subset(d_LS_P,Sex=='M')

```


```{r d_LS_M}
d_LS_M <- read.csv("MasterSheets_Oct21_git/LSM_MasterSheet_Oct21.csv")
```

```{r}
str(d_LS_M)
```


```{r}
d_LS_M$Supervisor.PI <- as.factor(d_LS_M$Supervisor.PI)
d_LS_M$Diet <- as.factor(d_LS_M$Diet)
d_LS_M$Batch <- as.factor(d_LS_M$Batch)
d_LS_M$Population <- as.factor(d_LS_M$Population)
d_LS_M$Population_Lat <- factor(d_LS_M$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_LS_M$Population_Lon <- factor(d_LS_M$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_LS_M$Population_Alt <- factor(d_LS_M$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_LS_M$LSM_AgeAtDeath_days <- as.numeric(d_LS_M$LSM_AgeAtDeath_days)
d_LS_M$Censor <- as.factor(d_LS_M$Censor)
```

```{r}
str(d_LS_M)
```


```{r}
d_LS_M_F <-subset(d_LS_M,Sex=='F')
d_LS_M_M <-subset(d_LS_M,Sex=='M')

```


### Descriptive Statistics

Descriptive statistics at the line level, with batch information :

```{r table_LS_L_Line_wbatch}
table_LS_L_Line_wbatch <- write.csv(d_LS_L %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                    summarise_at(vars(LSL_AgeAtDeath_days), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Lifespan/table_LS_L_Line_wbatch.csv", row.names = T)
table_LS_L_Line_wbatch <- read.csv("Lifespan/table_LS_L_Line_wbatch.csv")
```


```{r, echo=FALSE}
DT::datatable(table_LS_L_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```


Descriptive statistics at the line level, without batch information :

```{r table_LS_L_Line_wobatch}
table_LS_L_Line_wobatch <- write.csv(d_LS_L %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                    summarise_at(vars(LSL_AgeAtDeath_days), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Lifespan/table_LS_L_Line_wobatch.csv", row.names = T)
table_LS_L_Line_wobatch <- read.csv("Lifespan/table_LS_L_Line_wobatch.csv")
```


```{r, echo=FALSE}
DT::datatable(table_LS_L_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```



Descriptive statistics at the population level, with batch information :
```{r table_LS_M_Pop_wbatch}
table_LS_M_Pop_wbatch <- write.csv(d_LS_M %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                   summarise_at(vars(LSM_AgeAtDeath_days), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Lifespan/table_LS_M_Pop_wbatch.csv", row.names = T)

table_LS_M_Pop_wbatch <- read.csv("Lifespan/table_LS_M_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LS_M_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :

```{r table_LS_M_Pop_wobatch}
table_LS_M_Pop_wobatch <- write.csv(d_LS_M %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                   summarise_at(vars(LSM_AgeAtDeath_days), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Lifespan/table_LS_M_Pop_wobatch.csv", row.names = T)
table_LS_M_Pop_wobatch <- read.csv("Lifespan/table_LS_M_Pop_wobatch.csv")
```


```{r, echo=FALSE}
DT::datatable(table_LS_M_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 


```{r}
min_LS <- min(d_LS_M$LSM_AgeAtDeath_days)
max_LS <- max(d_LS_M$LSM_AgeAtDeath_days)
```

y-axis is scaled by the minimum (`r min_LS`) and maximum (`r max_LS`) values in the full data set.


```{r p_LS_F, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F <- ggplot(data = d_LS_M_F, aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Supervisor.PI)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F.pdf",width=8, height=5)
p_LS_F
dev.off()
```


```{r p_LS_M, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M <- ggplot(data = d_LS_M_M, aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Supervisor.PI)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M.pdf",width=8, height=5)
p_LS_M
dev.off()
```


#### Flatt Lab

```{r LS_P_F_Flatt_lmer}

LS_P_F_Flatt_lmer <- lmer(LSP_AgeAtDeath_days ~ -1 + Population + (1|Population:ReplicateCage), data = filter(d_LS_P_F, Censor == "0" & Supervisor.PI == "Flatt"))
capture.output(summary(LS_P_F_Flatt_lmer),file = "Lifespan/LS_P_F_Flatt_lmer.txt")
capture.output(anova(LS_P_F_Flatt_lmer),file = "Lifespan/LS_P_F_Flatt_lmer.txt")
#capture.output(emmeans(LS_P_F_Flatt_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "LS_P_F_Flatt_lmer_tk.txt")
```

```{r}
anova(LS_P_F_Flatt_lmer)
```

```{r}
summary(LS_P_F_Flatt_lmer)
```

```{r LS_P_M_Flatt_lmer}
LS_P_M_Flatt_lmer <- lmer(LSP_AgeAtDeath_days ~ -1 + Population + (1|Population:ReplicateCage), data = filter(d_LS_P_M, Censor == "0" & Supervisor.PI == "Flatt"))
capture.output(summary(LS_P_M_Flatt_lmer),file = "Lifespan/LS_P_M_Flatt_lmer_sum.txt")
capture.output(anova(LS_P_M_Flatt_lmer),file = "Lifespan/LS_P_M_Flatt_lmer.txt")
#capture.output(emmeans(LS_P_F_Flatt_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "LS_P_M_Flatt_lmer_tk.txt")
```


```{r}
anova(LS_P_M_Flatt_lmer)
```

```{r}
summary(LS_P_M_Flatt_lmer)
```


```{r p_LS_F_Flatt, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F_Flatt <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Flatt")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Flatt", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F_Flatt
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Flatt.pdf",width=8, height=5)
p_LS_F_Flatt
dev.off()
```


```{r p_LS_M_Flatt, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M_Flatt <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Flatt")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Flatt", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M_Flatt
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Flatt.pdf",width=8, height=5)
p_LS_M_Flatt
dev.off()
```

#### Parsch Lab 


```{r LS_L_F_Parsch_lmer}
LS_L_F_Parsch_lmer <- lmer(LSL_AgeAtDeath_days ~ -1 + Population + (1|Batch) + (1|Population:Line) + (1|Line:ReplicateVial), data = filter(d_LS_L_F, Censor == "0" & Supervisor.PI == "Parsch"))
capture.output(summary(LS_L_F_Parsch_lmer),file = "Lifespan/LS_L_F_Parsch_lmer_sum.txt")
capture.output(anova(LS_L_F_Parsch_lmer),file = "Lifespan/LS_L_F_Parsch_lmer.txt")
#capture.output(emmeans(LS_L_F_Parsch_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "d_LS_L_F_Parsch_lmer_tk.txt")
```


```{r}
anova(LS_L_F_Parsch_lmer)
```

```{r}
summary(LS_L_F_Parsch_lmer)
```

```{r LS_L_M_Parsch_lmer}
LS_L_M_Parsch_lmer <- lmer(LSL_AgeAtDeath_days ~ -1 + Population + (1|Batch) + (1|Population:Line) + (1|Line:ReplicateVial), data = filter(d_LS_L_M, Censor == "0" & Supervisor.PI == "Parsch"))
capture.output(summary(LS_L_M_Parsch_lmer),file = "Lifespan/LS_L_M_Parsch_lmer_sum.txt")
capture.output(anova(LS_L_M_Parsch_lmer),file = "Lifespan/LS_L_M_Parsch_lmer.txt")
#capture.output(emmeans(LS_L_F_Parsch_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "LS_L_M_Parsch_lmer_tk.txt")
```

```{r}
anova(LS_L_M_Parsch_lmer)
```

```{r}
summary(LS_L_M_Parsch_lmer)
```


```{r p_LS_F_Parsch, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F_Parsch <- ggplot(data = filter(d_LS_M_F, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Parsch", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Parsch.pdf",width=8, height=5)
p_LS_F_Parsch
dev.off()
```

```{r p_LS_F_pop_Parsch, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F_pop_Parsch <- ggplot(data = filter(d_LS_M_F, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_pop_Parsch", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F_pop_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_pop_Parsch.pdf",width=8, height=5)
p_LS_F_pop_Parsch
dev.off()
```



```{r p_LS_M_Parsch, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M_Parsch <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Parsch", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Parsch.pdf",width=8, height=5)
p_LS_M_Parsch
dev.off()
```

```{r p_LS_M_pop_Parsch, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M_pop_Parsch <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_pop_Parsch", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M_pop_Parsch
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_pop_Parsch",width=8, height=5)
p_LS_M_pop_Parsch
dev.off()
```

#### Pasyukova Lab

```{r LS_L_F_Pasyukova_lmer}
LS_L_F_Pasyukova_lmer <- lmer(LSL_AgeAtDeath_days ~ -1 + Population + (1|Batch) + (1|Population:Line) + (1|Line:ReplicateVial), data = filter(d_LS_L_F, Censor == "0" & Supervisor.PI == "Pasyukova"))
capture.output(summary(LS_L_F_Pasyukova_lmer),file = "Lifespan/LS_L_F_Pasyukova_lmer_sum.txt")
capture.output(anova(LS_L_F_Pasyukova_lmer),file = "Lifespan/LS_L_F_Pasyukova_lmer.txt")
#capture.output(emmeans(LS_L_F_Pasyukova_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "LS_L_F_Pasyukova_lmer_tk.txt")
```

```{r}
anova(LS_L_F_Pasyukova_lmer)
```

```{r}
summary(LS_L_F_Pasyukova_lmer)
```


```{r LS_L_M_Pasyukova_lmer}
LS_L_M_Pasyukova_lmer <- lmer(LSL_AgeAtDeath_days ~ -1 + Population + (1|Batch) + (1|Population:Line) + (1|Line:ReplicateVial), data = filter(d_LS_L_M, Censor == "0" & Supervisor.PI == "Pasyukova"))
capture.output(summary(LS_L_M_Pasyukova_lmer),file = "Lifespan/LS_L_M_Pasyukova_lmer_sum.txt")
capture.output(anova(LS_L_M_Pasyukova_lmer),file = "Lifespan/LS_L_M_Pasyukova_lmer.txt")
#capture.output(emmeans(d_LS_L_F_Pasyukova_lmer, list(pairwise ~ Population), adjust = "tukey"),file = "LS_L_M_Pasyukova_lmer_tk.txt")
```

```{r}
anova(LS_L_M_Pasyukova_lmer)
```

```{r}
summary(LS_L_M_Pasyukova_lmer)
```


```{r p_LS_F_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F_Pasyukova <- ggplot(data = filter(d_LS_M_F, (Censor == "0") & (Supervisor.PI == "Pasyukova")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_Pasyukova", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_Pasyukova.pdf",width=8, height=5)
p_LS_F_Pasyukova
dev.off()
```

```{r p_LS_F_pop_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_F_pop_Pasyukova <- ggplot(data = filter(d_LS_M_F, (Censor == "0") & (Supervisor.PI == "Pasyukova")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_F_pop_Pasyukova", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_F_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_F_pop_Pasyukova.pdf",width=8, height=5)
p_LS_F_pop_Pasyukova
dev.off()
```



```{r p_LS_M_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M_Pasyukova <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Pasyukova")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Batch)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_Pasyukova", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_Pasyukova.pdf",width=8, height=5)
p_LS_M_Pasyukova
dev.off()
```

```{r p_LS_M_pop_Pasyukova, echo=FALSE, message=FALSE, warning=FALSE}

p_LS_M_pop_Pasyukova <- ggplot(data = filter(d_LS_M_M, (Censor == "0") & (Supervisor.PI == "Pasyukova")), aes(x=Population_Lat, y=LSM_AgeAtDeath_days, fill=Population)) + geom_boxplot(outlier.shape = NA, notch=FALSE) + labs(title="p_LS_M_pop_Pasyukova", x="Population", y = "LSM_AgeAtDeath_days") + ylim(c(min_LS, max_LS))+ droseu_theme

```

```{r echo=FALSE}
p_LS_M_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Lifespan/p_LS_M_pop_Pasyukova",width=8, height=5)
p_LS_M_pop_Pasyukova
dev.off()
```


### Survival 

```{r}
d_LS_P_surv <- d_LS_P %>% mutate(Censor = ifelse(Censor == 0, 1, 0))
d_LS_L_surv <- d_LS_L %>% mutate(Censor = ifelse(Censor == 0, 1, 0))
```


#### Flatt Lab
##### Females
```{r}
LS_F_Flatt_survfit <- survfit(Surv(LSP_AgeAtDeath_days) ~ Population, data = filter(d_LS_P_surv, Supervisor.PI == "Flatt", Sex == "F"))
```
```{r}
p_LS_F_Flatt_survfit <- ggsurvplot(LS_F_Flatt_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_F_Flatt_survfit")
```
```{r}
p_LS_F_Flatt_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_F_Flatt_survfit.pdf", width=8, height=5)
p_LS_F_Flatt_survfit$plot
invisible(dev.off())
```

##### Males
```{r}
LS_M_Flatt_survfit <- survfit(Surv(LSP_AgeAtDeath_days) ~ Population, data = filter(d_LS_P_surv, Supervisor.PI == "Flatt", Sex == "M"))
```
```{r}
p_LS_M_Flatt_survfit <- ggsurvplot(LS_M_Flatt_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_M_Flatt_survfit")
```
```{r}
p_LS_M_Flatt_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_M_Flatt_survfit.pdf", width=8, height=5)
p_LS_M_Flatt_survfit$plot
invisible(dev.off())
```



#### Parsch Lab
##### Females
```{r}
LS_F_Parsch_survfit <- survfit(Surv(LSL_AgeAtDeath_days) ~ Population, data = filter(d_LS_L_surv, Supervisor.PI == "Parsch", Sex == "F"))
```
```{r}
p_LS_F_Parsch_survfit <- ggsurvplot(LS_F_Parsch_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_F_Parsch_survfit")
```
```{r}
p_LS_F_Parsch_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_F_Parsch_survfit.pdf", width=8, height=5)
p_LS_F_Parsch_survfit$plot
invisible(dev.off())
```

##### Males
```{r}
LS_M_Parsch_survfit <- survfit(Surv(LSL_AgeAtDeath_days) ~ Population, data = filter(d_LS_L_surv, Supervisor.PI == "Parsch", Sex == "M"))
```
```{r}
p_LS_M_Parsch_survfit <- ggsurvplot(LS_M_Parsch_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_M_Parsch_survfit")
```
```{r}
p_LS_M_Parsch_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_M_Parsch_survfit.pdf", width=8, height=5)
p_LS_M_Parsch_survfit$plot
invisible(dev.off())
```


#### Pasyukova Lab
##### Females
```{r}
LS_F_Pasyukova_survfit <- survfit(Surv(LSL_AgeAtDeath_days) ~ Population, data = filter(d_LS_L_surv, Supervisor.PI == "Pasyukova", Sex == "F"))
```
```{r}
p_LS_F_Pasyukova_survfit <- ggsurvplot(LS_F_Pasyukova_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_F_Pasyukova_survfit")
```
```{r}
p_LS_F_Pasyukova_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_F_Pasyukova_survfit.pdf", width=8, height=5)
p_LS_F_Pasyukova_survfit$plot
invisible(dev.off())
```

##### Males
```{r}
LS_M_Pasyukova_survfit <- survfit(Surv(LSL_AgeAtDeath_days) ~ Population, data = filter(d_LS_L_surv, Supervisor.PI == "Pasyukova", Sex == "M"))
```
```{r}
p_LS_M_Pasyukova_survfit <- ggsurvplot(LS_M_Pasyukova_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "LS_M_Pasyukova_survfit")
```
```{r}
p_LS_M_Pasyukova_survfit$plot
```
```{r}
pdf(file="Lifespan/p_LS_M_Pasyukova_survfit.pdf", width=8, height=5)
p_LS_M_Pasyukova_survfit$plot
invisible(dev.off())
```


### coxme

```{r eval = FALSE}
LS_P_F_coxme_Flatt <- coxme(Surv(LSP_AgeAtDeath_days, Censor) ~ Population + (1|Population/ReplicateCage), data = filter(d_LS_P_surv, Supervisor.PI == "Flatt", Sex == "F"))
capture.output(summary(LS_P_F_coxme_Flatt), file = "Starvation/LS_P_F_coxme_Flatt_sum.txt")
capture.output(anova(LS_P_F_coxme_Flatt), file = "Starvation/LS_P_F_coxme_Flatt.txt")
```           
```{r eval = FALSE}
LS_P_M_coxme_Flatt <- coxme(Surv(LSP_AgeAtDeath_days, Censor) ~ Population + (1|Population/ReplicateCage), data = filter(d_LS_P_surv, Supervisor.PI == "Flatt", Sex == "M"))
capture.output(summary(LS_P_M_coxme_Flatt), file = "Starvation/LS_P_M_coxme_Flatt_sum.txt")
capture.output(anova(LS_P_M_coxme_Flatt), file = "Starvation/LS_P_M_coxme_Flatt")
```           


```{r eval = FALSE}
LS_L_F_coxme_Parsch <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_LS_L_surv, Supervisor.PI == "Parsch", Sex == "F"))
capture.output(summary(LS_L_F_coxme_Parsch), file = "Starvation/LS_L_F_coxme_Parsch_sum.txt")
capture.output(anova(LS_L_F_coxme_Parsch), file = "Starvation/LS_L_F_coxme_Parsch.txt")
```  

```{r eval = FALSE}
LS_L_M_coxme_Parsch <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_LS_L_surv, Supervisor.PI == "Parsch", Sex == "M"))
capture.output(summary(LS_L_M_coxme_Parsch), file = "Starvation/LS_L_M_coxme_Parsch_sum.txt")
capture.output(anova(LS_L_M_coxme_Parsch), file = "Starvation/LS_L_M_coxme_Parsch.txt")
```  


```{r eval = FALSE}
LS_L_F_coxme_Pasyukova <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_LS_L_surv, Supervisor.PI == "Pasyukova", Sex == "F"))
capture.output(summary(LS_L_F_coxme_Pasyukova), file = "Starvation/LS_L_F_coxme_Pasyukova_sum.txt")
capture.output(anova(LS_L_F_coxme_Pasyukova), file = "Starvation/LS_L_F_coxme_Pasyukova.txt")
```  

```{r eval = FALSE}
LS_L_M_coxme_Pasyukova <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_LS_L_surv, Supervisor.PI == "Pasyukova", Sex == "M"))
capture.output(summary(LS_L_M_coxme_Pasyukova), file = "Starvation/LS_L_M_coxme_Pasyukova_sum.txt")
capture.output(anova(LS_L_M_coxme_Pasyukova), file = "Starvation/LS_L_M_coxme_Pasyukova.txt")
```  


### Lab correlations

```{r intersect_LS, eval=TRUE, echo=TRUE}
intersect_Line_LS <- intersect(d_LS_L$Line[d_LS_L$Supervisor.PI == "Parsch"], 
                           d_LS_L$Line[d_LS_L$Supervisor.PI == "Pasyukova"])

write(intersect_Line_LS, file ="Lifespan/intersect_Line_LS", sep = "\t")

intersect_Pop_LS <- Reduce(intersect, list(d_LS_M$Population[d_LS_M$Supervisor.PI == "Parsch"],
                              d_LS_L$Line[d_LS_L$Supervisor.PI == "Flatt"],
                           d_LS_M$Population[d_LS_M$Supervisor.PI == "Pasyukova"]))

write(intersect_Pop_LS, file ="Lifespan/intersect_Pop_LS", sep = "\t")


```

There are `r length(intersect_Pop_LS) ` populations and `r length(intersect_Line_LS) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r}
LS_fitted <- combineFitted(labs = rep(c("Flatt", "Parsch", "Pasyukova"), 2), sex = rep(c("F", "M"), each = 3), models = list(LS_P_F_Flatt_lmer, LS_L_F_Parsch_lmer, LS_L_F_Pasyukova_lmer, LS_P_M_Flatt_lmer, LS_L_M_Parsch_lmer, LS_L_M_Pasyukova_lmer))

p_LS_F_lab_cor <- function() scatterPlotMatrix(LS_fitted, sex = "F")
p_LS_M_lab_cor <- function() scatterPlotMatrix(LS_fitted, sex = "M")
```

```{r p_LS_F_lab_cor, fig.height=8, fig.width=8}
p_LS_F_lab_cor()
```

```{r}
pdf(file="Lifespan/p_LS_F_lab_cor.pdf",width=8, height=8)
p_LS_F_lab_cor()
invisible(dev.off())
```

```{r p_LS_M_lab_cor, fig.height=8, fig.width=8}
p_LS_M_lab_cor()
```

```{r}
pdf(file="Lifespan/p_LS_M_lab_cor.pdf",width=8, height=8)
p_LS_M_lab_cor()
invisible(dev.off())
```



## Cold-shock mortality


```{r}
dir.create(file.path("ColdShock"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Gonzalez Lab : Llewellyn Green, Josefa Gonzalez, Miriam Merenciano

Kozeretska Lab : Svitlana Serga, Alexandra Protsenko, Oleksandr Maistrenko, Iryna Kozeretska

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias


### Data Reformatting

```{r d_CSM}
d_CSM <- read.csv("MasterSheets_Oct21_git/CSM_MasterSheet_Oct21.csv")
```


```{r}
str(d_CSM)
```


```{r}
d_CSM$Supervisor.PI <- as.factor(d_CSM$Supervisor.PI)
d_CSM$Diet <- as.factor(d_CSM$Diet)
d_CSM$Batch <- as.factor(d_CSM$Batch)
d_CSM$Population_Lat <- factor(d_CSM$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_CSM$Population_Lon <- factor(d_CSM$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_CSM$Population_Alt <- factor(d_CSM$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_CSM$Line <- as.factor(d_CSM$Line)
d_CSM$Sex <- as.factor(d_CSM$Sex)
d_CSM$ReplicateVial <- as.factor(d_CSM$ReplicateVial)
d_CSM$CSM_PropDead_ED <- as.numeric(d_CSM$CSM_PropDead_ED)
```


```{r}
str(d_CSM)
```


```{r}
d_CSM_F <-subset(d_CSM,Sex=='F')
d_CSM_M <-subset(d_CSM,Sex=='M')
```


### Descriptive Statistics


Descriptive statistics at the line level, with batch information :
```{r table_CSM_Line_wbatch}
table_CSM_Line_wbatch <- write.csv(d_CSM %>% group_by(Supervisor.PI, Batch, Sex,Population, Line) %>% 
                                   summarise_at(vars(CSM_PropDead_ED), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "ColdShock/table_CSM_Line_wbatch.csv", row.names = T)
table_CSM_Line_wbatch <- read.csv("ColdShock/table_CSM_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_CSM_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_CSM_Line_wobatch}
table_CSM_Line_wobatch <- write.csv(d_CSM %>% group_by(Supervisor.PI, Sex,Population, Line) %>% 
                                   summarise_at(vars(CSM_PropDead_ED), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "ColdShock/table_CSM_Line_wobatch.csv", row.names = T)
table_CSM_Line_wobatch <- read.csv("ColdShock/table_CSM_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_CSM_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_CSM_Pop_wbatch}
table_CSM_Pop_wbatch <- write.csv(d_CSM %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                  summarise_at(vars(CSM_PropDead_ED), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ColdShock/table_CSM_Pop_wbatch.csv", row.names = T)

table_CSM_Pop_wbatch <- read.csv("ColdShock/table_CSM_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_CSM_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_CSM_Pop_wobatch}
table_CSM_Pop_wobatch <- write.csv(d_CSM %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                  summarise_at(vars(CSM_PropDead_ED), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "ColdShock/table_CSM_Pop_wobatch.csv", row.names = T)

table_CSM_Pop_wobatch <- read.csv("ColdShock/table_CSM_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_CSM_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 



```{r min_max_CSM, echo=TRUE}
min_CSM <- min(d_CSM$CSM_PropDead_ED)
max_CSM <- max(d_CSM$CSM_PropDead_ED)
```

y-axis is scaled by the minimum (`r min_CSM`) and maximum (`r max_CSM`) values in the full data set.


```{r p_CSM_F}
p_CSM_F <- ggplot(data = d_CSM_F, aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F", x="Population", y = "Prop_dead") + ylim(c(min_CSM, max_CSM))+ droseu_theme
```

```{r}
p_CSM_F
```

```{r}
pdf(file="ColdShock/p_CSM_F.pdf",width=8, height=5)
p_CSM_F
dev.off()
```


```{r p_CSM_M}
p_CSM_M <- ggplot(data = d_CSM_M, aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M", x="Population", y = "Prop_dead") +  ylim(c(min_CSM, max_CSM))+ droseu_theme
```

```{r}
p_CSM_M
```

```{r}
pdf(file="ColdShock/p_CSM_M.pdf",width=8, height=5)
p_CSM_M
dev.off()
```


#### Gonzalez Lab

```{r CSM_F_lmer_Gonzalez}
CSM_F_lmer_Gonzalez <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                           (1|Batch), data = d_CSM_F[d_CSM_F$Supervisor.PI == "Gonzalez",])
capture.output(summary(CSM_F_lmer_Gonzalez),file = "ColdShock/CSM_F_lmer_sum_Gonzalez.txt")
capture.output(anova(CSM_F_lmer_Gonzalez),file = "ColdShock/CSM_F_lmer_Gonzalez.txt")
#capture.output(emmeans(CSM_F_lmer_Gonzalez, list(pairwise ~ Population), adjust = "tukey"),file = "ColdShock/CSM_F_lmer_Gonzalez_tk.txt")
```

```{r}
anova(CSM_F_lmer_Gonzalez)
```

```{r}
summary(CSM_F_lmer_Gonzalez)
```


```{r CSM_M_lmer_Gonzalez}
CSM_M_lmer_Gonzalez <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                                    (1|Batch), data = d_CSM_M[d_CSM_M$Supervisor.PI == "Gonzalez",])
capture.output(summary(CSM_M_lmer_Gonzalez),file = "ColdShock/CSM_M_lmer_sum_Gonzalez.txt")
capture.output(anova(CSM_M_lmer_Gonzalez),file = "ColdShock/CSM_M_lmer_Gonzalez.txt")
#capture.output(emmeans(CSM_M_lmer_Gonzalez, list(pairwise ~ Population), adjust = "tukey"),file = "ColdShock/CSM_M_lmer_Gonzalez_tk.txt")
```

```{r}
anova(CSM_M_lmer_Gonzalez)
```

```{r}
summary(CSM_M_lmer_Gonzalez)
```

```{r p_CSM_F_Gonzalez}
p_CSM_F_Gonzalez <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Gonzalez")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme
```

```{r}
p_CSM_F_Gonzalez
```

```{r}
pdf(file="ColdShock/p_CSM_F_Gonzalez.pdf",width=8, height=5)
p_CSM_F_Gonzalez
dev.off()
```


```{r p_CSM_F_pop_Gonzalez}
p_CSM_F_pop_Gonzalez <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Gonzalez")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Gonzalez", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme
```

```{r}
p_CSM_F_pop_Gonzalez
```

```{r}
pdf(file="ColdShock/p_CSM_F_pop_Gonzalez.pdf",width=8, height=5)
p_CSM_F_pop_Gonzalez
dev.off()
```



```{r p_CSM_M_Gonzalez}
p_CSM_M_Gonzalez <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Gonzalez")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme
```

```{r}
p_CSM_M_Gonzalez
```

```{r}
pdf(file="ColdShock/p_CSM_M_Gonzalez.pdf",width=8, height=5)
p_CSM_M_Gonzalez
dev.off()
```



```{r p_CSM_M_pop_Gonzalez}
p_CSM_M_pop_Gonzalez <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Gonzalez")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Gonzalez", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_M_pop_Gonzalez
```

```{r}
pdf(file="ColdShock/p_CSM_M_pop_Gonzalez.pdf",width=8, height=5)
p_CSM_M_pop_Gonzalez
dev.off()
```






#### Kozeretska Lab 

```{r CSM_F_lmer_Kozeretska}
CSM_F_lmer_Kozeretska <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                                      (1|Batch), data = d_CSM_F[d_CSM_F$Supervisor.PI == "Kozeretska",])
capture.output(summary(CSM_F_lmer_Kozeretska),file = "ColdShock/CSM_F_lmer_sum_Kozeretska.txt")
capture.output(anova(CSM_F_lmer_Kozeretska),file = "ColdShock/CSM_F_lmer_Kozeretska.txt")
#capture.output(emmeans(CSM_F_lmer_Kozeretska, list(pairwise ~ Population), adjust = "tukey"),file = "ColdShock/CSM_F_lmer_Kozeretska_tk.txt")
```

```{r}
anova(CSM_F_lmer_Kozeretska)
```

```{r}
summary(CSM_F_lmer_Kozeretska)
```


```{r CSM_M_lmer_Kozeretska}
CSM_M_lmer_Kozeretska <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                                      (1|Batch), data = d_CSM_M[d_CSM_M$Supervisor.PI == "Kozeretska",])
capture.output(summary(CSM_M_lmer_Kozeretska),file = "ColdShock/CSM_M_lmer_sum_Kozeretska.txt")
capture.output(anova(CSM_M_lmer_Kozeretska),file = "ColdShock/CSM_M_lmer_Kozeretska.txt")
#capture.output(emmeans(CSM_M_lmer_Kozeretska, list(pairwise ~ Population), adjust = "tukey"),file = "CSM_M_tk_Kozeretska_tk.txt")
```


```{r}
anova(CSM_M_lmer_Kozeretska)
```

```{r}
summary(CSM_M_lmer_Kozeretska)
```



```{r p_CSM_F_Kozeretska}

p_CSM_F_Kozeretska <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Kozeretska")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Kozeretska", x="Population", y = "CSM (PropSur)") + ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_F_Kozeretska
```

```{r}
pdf(file="ColdShock/p_CSM_F_Kozeretska.pdf",width=8, height=5)
p_CSM_F_Kozeretska
dev.off()
```


```{r p_CSM_F_pop_Kozeretska}

p_CSM_F_pop_Kozeretska <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Kozeretska")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Kozeretska", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_F_pop_Kozeretska
```

```{r}
pdf(file="ColdShock/p_CSM_F_pop_Kozeretska.pdf",width=8, height=5)
p_CSM_F_pop_Kozeretska
dev.off()
```



```{r p_CSM_M_Kozeretska}
p_CSM_M_Kozeretska <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Kozeretska")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Kozeretska", x="Population", y = "CSM (PropSur)")  +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_M_Kozeretska
```

```{r}
pdf(file="ColdShock/p_CSM_M_Kozeretska.pdf",width=8, height=5)
p_CSM_M_Kozeretska
dev.off()
```


```{r p_CSM_M_pop_Kozeretska}
p_CSM_M_pop_Kozeretska <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Kozeretska")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Kozeretska", x="Population", y = "CSM (PropSur)")  +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_M_pop_Kozeretska
```

```{r}
pdf(file="ColdShock/p_CSM_M_pop_Kozeretska.pdf",width=8, height=5)
p_CSM_M_pop_Kozeretska
dev.off()
```


#### Vieira Lab

```{r CSM_F_lmer_Vieira}
CSM_F_lmer_Vieira <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                                  (1|Batch), data = d_CSM_F[d_CSM_F$Supervisor.PI == "Vieira",])
capture.output(summary(CSM_F_lmer_Vieira),file = "ColdShock/CSM_F_lmer_sum_Vieira.txt")
capture.output(anova(CSM_F_lmer_Vieira),file = "ColdShock/CSM_F_lmer_Vieira.txt")
#capture.output(emmeans(CSM_F_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "ColdShock/CSM_F_lmer_Vieira_tk.txt")

```


```{r}
anova(CSM_F_lmer_Vieira)
```

```{r}
summary(CSM_F_lmer_Vieira)
```


```{r CSM_M_lmer_Vieira}
CSM_M_lmer_Vieira <- lmer(CSM_PropDead_ED ~ -1 + Population  + (1| Line : Population) +
                                  (1|Batch), data = d_CSM_M[d_CSM_M$Supervisor.PI == "Vieira",])
capture.output(summary(CSM_M_lmer_Vieira),file = "ColdShock/CSM_M_lmer_sum_Vieira.txt")
capture.output(anova(CSM_M_lmer_Vieira),file = "ColdShock/CSM_M_lmer_Vieira.txt")
#capture.output(emmeans(CSM_M_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "ColdShock/CSM_M_lmer_Vieira_tk.txt")

```

```{r}
anova(CSM_M_lmer_Vieira)
```

```{r}
summary(CSM_M_lmer_Vieira)
```

```{r p_CSM_F_Vieira}


p_CSM_F_Vieira <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_F_Vieira
```

```{r}
pdf(file="ColdShock/p_CSM_F_Vieira.pdf",width=8, height=5)
p_CSM_F_Vieira
dev.off()
```


```{r p_CSM_F_pop_Vieira}


p_CSM_F_pop_Vieira <- ggplot(data = (subset(d_CSM_F, Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_F_pop_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_F_pop_Vieira
```

```{r}
pdf(file="ColdShock/p_CSM_F_pop_Vieira.pdf",width=8, height=5)
p_CSM_F_pop_Vieira
dev.off()
```



```{r p_CSM_M_Vieira}


p_CSM_M_Vieira <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_M_Vieira
```

```{r}
pdf(file="ColdShock/p_CSM_M_Vieira.pdf",width=8, height=5)
p_CSM_M_Vieira
dev.off()
```


```{r p_CSM_M_pop_Vieira}


p_CSM_M_pop_Vieira <- ggplot(data = (subset(d_CSM_M, Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CSM_PropDead_ED, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CSM_M_pop_Vieira", x="Population", y = "CSM (PropSur)") +  ylim(c(min_CSM, max_CSM))+ droseu_theme

```

```{r}
p_CSM_M_pop_Vieira
```

```{r}
pdf(file="ColdShock/p_CSM_M_pop_Vieira.pdf",width=8, height=5)
p_CSM_M_pop_Vieira
dev.off()
```




### Lab correlations

```{r intersect_CSM}
intersect_Line_CSM  <- Reduce(intersect, list(d_CSM$Line[d_CSM$Supervisor.PI == "Gonzalez"],
                                         d_CSM$Line[d_CSM$Supervisor.PI == "Vieira"],
                                         d_CSM$Line[d_CSM$Supervisor.PI == "Kozeretska"]))
write(intersect_Line_CSM, file ="ColdShock/intersect_Line_CSM.txt", sep = "\t")

intersect_Pop_CSM  <- Reduce(intersect, list(d_CSM$Population[d_CSM$Supervisor.PI == "Gonzalez"],
                                         d_CSM$Population[d_CSM$Supervisor.PI == "Vieira"],
                                         d_CSM$Population[d_CSM$Supervisor.PI == "Kozeretska"]))
write(intersect_Pop_CSM, file ="ColdShock/intersect_Pop_CSM.txt", sep = "\t")
```

There are `r length(intersect_Pop_CSM) ` populations and `r length(intersect_Line_CSM) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r echo=FALSE}
for (i in dev.list()[1]:dev.list()[length(dev.list())]) {
   dev.off()
}
# crashed bc tries to save lots -- need to remove some sometimes
```



## Chill-coma recovery time


```{r}
dir.create(file.path("ChillComa"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Mensh Lab : Florencia Putero, Lucas Kreiman, Julian Mensh

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias


### Data Reformatting

```{r d_CCRT}
d_CCRT <- read.csv("MasterSheets_Oct21_git/CCRT_MasterSheet_Oct21.csv")
```

```{r}
str(d_CCRT)
```


```{r}
d_CCRT$Supervisor.PI <- as.factor(d_CCRT$Supervisor.PI)
d_CCRT$Diet <- as.factor(d_CCRT$Diet)
d_CCRT$Batch <- as.factor(d_CCRT$Batch)
d_CCRT$Population_Lat <- factor(d_CCRT$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_CCRT$Population_Lon <- factor(d_CCRT$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_CCRT$Population_Alt <- factor(d_CCRT$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_CCRT$Line <- as.factor(d_CCRT$Line)
d_CCRT$Sex <- as.factor(d_CCRT$Sex)
d_CCRT$ReplicateVial <- as.factor(d_CCRT$ReplicateVial)
d_CCRT$CCRT_seconds <- as.numeric(d_CCRT$CCRT_seconds)
d_CCRT$Censor <- as.numeric(d_CCRT$Censor)
```


```{r}
str(d_CCRT)
```



```{r}
d_CCRT_F <-subset(d_CCRT,Sex=='F')
d_CCRT_M <-subset(d_CCRT,Sex=='M')
```


### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r table_CCRT_Line_wbatch}
table_CCRT_Line_wbatch <- write.csv(d_CCRT %>% group_by(Supervisor.PI, Batch, Sex,Population, Line) %>% 
                                    summarise_at(vars(CCRT_seconds), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "ChillComa/table_CCRT_Line_wbatch.csv", row.names = T)

table_CCRT_Line_wbatch <- read.csv("ChillComa/table_CCRT_Line_wbatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_CCRT_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_CCRT_Line_wobatch}

table_CCRT_Line_wobatch <- write.csv(d_CCRT %>% group_by(Supervisor.PI, Sex,Population, Line) %>% 
                                    summarise_at(vars(CCRT_seconds), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "ChillComa/table_CCRT_Line_wobatch.csv", row.names = T)

table_CCRT_Line_wobatch <- read.csv("ChillComa/table_CCRT_Line_wobatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_CCRT_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_CCRT_pop_wbatch}


table_CCRT_pop_wbatch <- write.csv(d_CCRT %>% group_by(Supervisor.PI, Batch, Sex,Population) %>% 
                                    summarise_at(vars(CCRT_seconds), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "ChillComa/table_CCRT_pop_wbatch.csv", row.names = T)

table_CCRT_pop_wbatch <- read.csv("ChillComa/table_CCRT_pop_wbatch.csv")


```

```{r, echo=FALSE}
DT::datatable(table_CCRT_pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_CCRT_pop_wobatch}

table_CCRT_pop_wobatch <- write.csv(d_CCRT %>% group_by(Supervisor.PI, Sex,Population) %>% 
                                    summarise_at(vars(CCRT_seconds), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "ChillComa/table_CCRT_pop_wobatch.csv", row.names = T)

table_CCRT_pop_wobatch <- read.csv("ChillComa/table_CCRT_pop_wobatch.csv")


```

```{r, echo=FALSE}
DT::datatable(table_CCRT_pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```



### Plots and Linear Models by Lab  

#### Overview 


```{r min_max_CCRT, echo=TRUE}
min_CCRT <- min(d_CCRT$CCRT_seconds)
max_CCRT <- max(d_CCRT$CCRT_seconds)
```

y-axis is scaled by the minimum (`r min_CSM`) and maximum (`r max_CSM`) values in the full data set.

#### Vieira Lab


```{r CCRT_F_lmer_Vieira}
CCRT_F_lmer_Vieira <- lmer(CCRT_seconds ~ -1 + Population + (1|Population:Line) + (1|Batch) + (1|ReplicateVial:Line), data = filter(d_CCRT_F, Censor == "0" & Supervisor.PI == "Vieira"))
capture.output(summary(CCRT_F_lmer_Vieira),file = "ChillComa/CCRT_F_lmer_Vieira_sum.txt")
capture.output(anova(CCRT_F_lmer_Vieira),file = "ChillComa/CCRT_F_lmer_Vieira.txt")
#capture.output(emmeans(CCRT_F_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "ChillComa/CCRT_F_lmer_Vieira_tk.txt")

```


```{r}
anova(CCRT_F_lmer_Vieira)
```

```{r}
summary(CCRT_F_lmer_Vieira)
```


```{r CCRT_M_lmer_Vieira}
CCRT_M_lmer_Vieira <- lmer(CCRT_seconds ~ -1 + Population + (1|Population:Line) + (1|Batch) + (1|ReplicateVial:Line), data = filter(d_CCRT_M, Censor == "0" & Supervisor.PI == "Vieira"))
capture.output(summary(CCRT_M_lmer_Vieira),file = "ChillComa/CCRT_M_lmer_Vieira_sum.txt")
capture.output(anova(CCRT_M_lmer_Vieira),file = "ChillComa/CCRT_M_lmer_Vieira.txt")
#capture.output(emmeans(CCRT_M_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "ChillComa/CCRT_M_lmer_Vieira_tk.txt")

```


```{r}
anova(CCRT_M_lmer_Vieira)
```

```{r}
summary(CCRT_M_lmer_Vieira)
```


```{r p_CCRT_F_Vieira}
p_CCRT_F_Vieira <- ggplot(data = filter(d_CCRT_F, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_Vieira", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme

```

```{r}
p_CCRT_F_Vieira
```

```{r}
pdf(file="ChillComa/p_CCRT_F_Vieira.pdf",width=8, height=5)
p_CCRT_F_Vieira
dev.off()
```



```{r p_CCRT_F_pop_Vieira}

p_CCRT_F_pop_Vieira <- ggplot(data = filter(d_CCRT_F, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_F_pop_Vieira", x="Population", y = "CCRT_seconds")+ ylim(c(min_CCRT, max_CCRT))+ droseu_theme


```

```{r}
p_CCRT_F_pop_Vieira
```

```{r}
pdf(file="ChillComa/p_CCRT_F_pop_Vieira.pdf",width=8, height=5)
p_CCRT_F_pop_Vieira
dev.off()
```



```{r}
p_CCRT_M_Vieira <- ggplot(data = filter(d_CCRT_M, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CCRT_seconds, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme

```

```{r}
p_CCRT_M_Vieira
```

```{r}
pdf(file="ChillComa/p_CCRT_M_Vieira.pdf",width=8, height=5)
p_CCRT_M_Vieira
dev.off()
```


```{r p_CCRT_M_pop_Vieira}
p_CCRT_M_pop_Vieira <- ggplot(data = filter(d_CCRT_M, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=CCRT_seconds, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_CCRT_M_pop_Vieira", x="Population", y = "CCRT_seconds") + ylim(c(min_CCRT, max_CCRT))+ droseu_theme

```

```{r}
p_CCRT_M_pop_Vieira
```

```{r}
pdf(file="ChillComa/p_CCRT_M_pop_Vieira.pdf",width=8, height=5)
p_CCRT_M_pop_Vieira
dev.off()
```

#### Mensh Lab 


### Lab correlations

NA

```{r eval=FALSE, include=FALSE}
CCRT_fitted <- combineFitted(labs = rep(c("Vieira", "Mensh"), 2), sex = rep(c("F", "M"), each = 2), models = list(CCRT_F_lmer_Vieira, CCRT_F_lmer_Mensh, CCRT_M_lmer_Vieira, CCRT_M_lmer_Mensh)

p_CCRT_F_lab_cor <- function() scatterPlotMatrix(CCRT_fitted, sex = "F")
p_CCRT_M_lab_cor <- function() scatterPlotMatrix(CCRT_fitted, sex = "M")
```

```{r p_CCRT_F_lab_cor, fig.height=8, fig.width=8, eval=FALSE, include=FALSE}
p_CCRT_F_lab_cor()
```

```{r eval=FALSE, include=FALSE}
pdf(file="ChillComa/p_CCRT_F_lab_cor.pdf",width=8, height=8)
p_CCRT_F_lab_cor()
invisible(dev.off())
```


```{r p_CCRT_M_lab_cor, fig.height=8, fig.width=8, eval=FALSE, include=FALSE}
p_CCRT_M_lab_cor()
```

```{r eval=FALSE, include=FALSE}
pdf(file="ChillComa/p_CCRT_M_lab_cor.pdf",width=8, height=8)
p_CCRT_M_lab_cor()
invisible(dev.off())
```





## Heat-shock mortality


```{r}
dir.create(file.path("HeatShock"), showWarnings = FALSE)
```




_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Parsch Lab : Eliza Argyridou, Amanda Glaser-Schmitt, John Parsch

Vieira Lab : Jorge Vieira, Cristina P. Vieira, Pedro Duque, Tânia Dias

### Data Reformatting

```{r d_HSM}
d_HSM <- read.csv("MasterSheets_Oct21_git/HSM_MasterSheet_Oct21.csv")
```


```{r}
str(d_HSM)
```


```{r}
d_HSM$Supervisor.PI <- as.factor(d_HSM$Supervisor.PI)
d_HSM$Diet <- as.factor(d_HSM$Diet)
d_HSM$Batch <- as.factor(d_HSM$Batch)
d_HSM$Population_Lat <- factor(d_HSM$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_HSM$Population_Lon <- factor(d_HSM$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_HSM$Population_Alt <- factor(d_HSM$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_HSM$Line <- as.factor(d_HSM$Line)
d_HSM$Sex <- as.factor(d_HSM$Sex)
d_HSM$ReplicateVial <- as.factor(d_HSM$ReplicateVial)
d_HSM$TimeDeath_min <- as.numeric(d_HSM$TimeDeath_min)
d_HSM$Censor <- as.numeric(d_HSM$Censor)
str(d_HSM)
```


```{r}
d_HSM_F <-subset(d_HSM,Sex=='F')
d_HSM_M <-subset(d_HSM,Sex=='M')
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r table_HSM_Line_wbatch}
table_HSM_Line_wbatch <- write.csv(d_HSM %>% group_by(Supervisor.PI, Batch, Sex,Population, Line) %>% 
                                    summarise_at(vars(TimeDeath_min), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "HeatShock/table_HSM_Line_wbatch.csv", row.names = T)
table_HSM_Line_wbatch <- read.csv("HeatShock/table_HSM_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_HSM_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_HSM_Line_wobatch}
table_HSM_Line_wobatch <- write.csv(d_HSM %>% group_by(Supervisor.PI, Sex,Population, Line) %>% 
                                    summarise_at(vars(TimeDeath_min), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "HeatShock/table_HSM_Line_wobatch.csv", row.names = T)
table_HSM_Line_wobatch <- read.csv("HeatShock/table_HSM_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_HSM_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_HSM_Pop_wbatch}
table_HSM_Pop_wbatch <- write.csv(d_HSM %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                   summarise_at(vars(TimeDeath_min), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "HeatShock/table_HSM_Pop_wbatch.csv", row.names = T)

table_HSM_Pop_wbatch <- read.csv("HeatShock/table_HSM_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_HSM_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_HSM_Pop_wobatch}
table_HSM_Pop_wobatch <- write.csv(d_HSM %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                   summarise_at(vars(TimeDeath_min), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "HeatShock/table_HSM_Pop_wobatch.csv", row.names = T)
table_HSM_Pop_wobatch <- read.csv("HeatShock/table_HSM_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_HSM_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```



### Plots and Linear Models by Lab  

#### Overview 

```{r}
min_HSM <- min(d_HSM$TimeDeath_min)
max_HSM <- max(d_HSM$TimeDeath_min)
```


y-axis is scaled by the minimum (`r min_HSM`) and maximum (`r max_HSM`) values in the full data set.

```{r p_HSM_F}

p_HSM_F <- ggplot(data = filter(d_HSM_F, (Censor == "0")), aes(x=Population_Lat, y=TimeDeath_min, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F", x="Population", y = "TimeDeath(min)")  + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_F
```

```{r}
pdf(file="HeatShock/p_HSM_F.pdf",width=8, height=5)
p_HSM_F
dev.off()
```


```{r p_HSM_M}

p_HSM_M <- ggplot(data = filter(d_HSM_M, (Censor == "0")), aes(x=Population_Lat, y=TimeDeath_min, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M", x="Population", y = "TimeDeath(min)")  + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_M
```

```{r}
pdf(file="HeatShock/p_HSM_M.pdf",width=8, height=5)
p_HSM_M
dev.off()
```

#### Parsch Lab

```{r HSM_F_lmer_Parsch}
HSM_F_lmer_Parsch <- lmer(TimeDeath_min ~ -1 + Population  + (1| Line : Population) + (1|Batch), data = filter(d_HSM_F, Censor == "0" & Supervisor.PI == "Parsch"))
capture.output(summary(HSM_F_lmer_Parsch),file = "HeatShock/HSM_F_lmer_sum_Parsch.txt")
capture.output(anova(HSM_F_lmer_Parsch),file = "HeatShock/HSM_F_lmer_Parsch.txt")
#capture.output(emmeans(HSM_F_lmer_Parsch, list(pairwise ~ Population), adjust = "tukey"),file = "HeatShock/HSM_F_lmer_Parsch_tk.txt")
```

```{r}
anova(HSM_F_lmer_Parsch)
```

```{r}
summary(HSM_F_lmer_Parsch)
```

```{r HSM_M_lmer_Parsch}
HSM_M_lmer_Parsch <- lmer(TimeDeath_min ~ -1 + Population  + (1| Line : Population) + (1|Batch), data = filter(d_HSM_M, Censor == "0" & Supervisor.PI == "Parsch"))
capture.output(summary(HSM_M_lmer_Parsch),file = "HeatShock/HSM_M_lmer_sum_Parsch.txt")
capture.output(anova(HSM_M_lmer_Parsch),file = "HeatShock/HSM_M_lmer_Parsch.txt")
#capture.output(emmeans(HSM_M_lmer_Parsch, list(pairwise ~ Population), adjust = "tukey"),file = "HeatShock/HSM_M_lmer_Parsch_tk.txt")
```

```{r}
anova(HSM_M_lmer_Parsch)
```

```{r}
summary(HSM_M_lmer_Parsch)
```



```{r p_HSM_F_Parsch}
p_HSM_F_Parsch <- ggplot(data = filter(d_HSM_F, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_F_Parsch
```

```{r}
pdf(file="HeatShock/p_HSM_F_Parsch.pdf",width=8, height=5)
p_HSM_F_Parsch
dev.off()
```


```{r p_HSM_F_pop_Parsch}
p_HSM_F_pop_Parsch <- ggplot(data = filter(d_HSM_F, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_pop_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_F_pop_Parsch
```

```{r}
pdf(file="HeatShock/p_HSM_F_pop_Parsch.pdf",width=8, height=5)
p_HSM_F_pop_Parsch
dev.off()
```


```{r p_HSM_M_Parsch}
p_HSM_M_Parsch <- ggplot(data = filter(d_HSM_M, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_M_Parsch
```

```{r}
pdf(file="HeatShock/p_HSM_M_Parsch.pdf",width=8, height=5)
p_HSM_M_Parsch
dev.off()
```


```{r p_HSM_M_pop_Parsch}
p_HSM_M_pop_Parsch <- ggplot(data = filter(d_HSM_M, (Censor == "0") & (Supervisor.PI == "Parsch")), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_pop_Parsch", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_M_pop_Parsch
```

```{r}
pdf(file="HeatShock/p_HSM_M_pop_Parsch.pdf",width=8, height=5)
p_HSM_M_pop_Parsch
dev.off()
```



#### Vieira Lab 


```{r HSM_F_lmer_Vieira}
HSM_F_lmer_Vieira <- lmer(TimeDeath_min ~ -1 + Population  + (1|Line:Population) + (1|Batch), data = filter(d_HSM_F, Censor == "0" & Supervisor.PI == "Vieira"))
capture.output(summary(HSM_F_lmer_Vieira), file = "HeatShock/HSM_F_lmer_sum_Vieira.txt")
capture.output(anova(HSM_F_lmer_Vieira), file = "HeatShock/HSM_F_lmer_Vieira.txt")
#capture.output(emmeans(HSM_F_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "HeatShock/HSM_F_lmer_Vieira_tk.txt")
```

```{r}
anova(HSM_F_lmer_Vieira)
```

```{r}
summary(HSM_F_lmer_Vieira)
```

```{r HSM_M_lmer_Vieira}
HSM_M_lmer_Vieira <- lmer(TimeDeath_min ~ -1 + Population  + (1|Line:Population) + (1|Batch), data = filter(d_HSM_M, Censor == "0" & Supervisor.PI == "Vieira"))
capture.output(summary(HSM_M_lmer_Vieira), file = "HeatShock/HSM_M_lmer_sum_Vieira.txt")
capture.output(anova(HSM_M_lmer_Vieira), file = "HeatShock/HSM_M_lmer_Vieira.txt")
#capture.output(emmeans(HSM_M_lmer_Vieira, list(pairwise ~ Population), adjust = "tukey"),file = "HeatShock/HSM_M_lmer_Vieira_tk.txt")
```

```{r}
anova(HSM_M_lmer_Vieira)
```

```{r}
summary(HSM_M_lmer_Vieira)
```


```{r p_HSM_F_Vieira}
p_HSM_F_Vieira <- ggplot(data = filter(d_HSM_F, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_F_Vieira
```

```{r}
pdf(file="HeatShock/p_HSM_F_Vieira.pdf",width=8, height=5)
p_HSM_F_Vieira
dev.off()
```


```{r p_HSM_F_pop_Vieira}
p_HSM_F_pop_Vieira <- ggplot(data = filter(d_HSM_F, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_F_pop_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_F_pop_Vieira
```

```{r}
pdf(file="HeatShock/p_HSM_F_pop_Vieira.pdf",width=8, height=5)
p_HSM_F_pop_Vieira
dev.off()
```


```{r p_HSM_M_Vieira}
p_HSM_M_Vieira <- ggplot(data = filter(d_HSM_M, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=TimeDeath_min, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_M_Vieira
```

```{r}
pdf(file="HeatShock/p_HSM_M_Vieira.pdf",width=8, height=5)
p_HSM_M_Vieira
dev.off()
```


```{r p_HSM_M_pop_Vieira}
p_HSM_M_pop_Vieira <- ggplot(data = filter(d_HSM_M, (Censor == "0") & (Supervisor.PI == "Vieira")), aes(x=Population_Lat, y=TimeDeath_min, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_HSM_M_pop_Vieira", x="Population", y = "TimeDeath_min") + ylim(c(min_HSM, max_HSM))+ droseu_theme
```

```{r}
p_HSM_M_pop_Vieira
```

```{r}
pdf(file="HeatShock/p_HSM_M_pop_Vieira.pdf",width=8, height=5)
p_HSM_M_pop_Vieira
dev.off()
```


### Lab correlations

```{r intersect_HSM}

intersect_Line_HSM  <- Reduce(intersect, list(d_HSM$Line[d_HSM$Supervisor.PI == "Parsch"],
                                         d_HSM$Line[d_HSM$Supervisor.PI == "Vieira"]))
write(intersect_Line_HSM, file ="HeatShock/intersect_Line_HSM.txt", sep = "\t")

intersect_Pop_HSM  <- Reduce(intersect, list(d_HSM$Population[d_HSM$Supervisor.PI == "Parsch"],
                                         d_HSM$Population[d_HSM$Supervisor.PI == "Vieira"]))
write(intersect_Pop_HSM, file ="HeatShock/intersect_Pop_HSM.txt", sep = "\t")

```

There are `r length(intersect_Pop_HSM) ` populations and `r length(intersect_Line_HSM) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 




```{r}
HSM_fitted <- combineFitted(labs = rep(c("Parsch", "Vieira"), 2), sex = rep(c("F", "M"), each = 2), models = list(HSM_F_lmer_Parsch, HSM_F_lmer_Vieira, HSM_M_lmer_Parsch, HSM_M_lmer_Vieira))

p_HSM_F_lab_cor <- function() scatterPlotMatrix(HSM_fitted, sex = "F")
p_HSM_M_lab_cor <- function() scatterPlotMatrix(HSM_fitted, sex = "M")
```

```{r p_HSM_F_lab_cor, fig.height=8, fig.width=8}
p_HSM_F_lab_cor()
```

```{r}
pdf(file="HeatShock/p_HSM_F_lab_cor.pdf",width=8, height=8)
p_HSM_F_lab_cor()
invisible(dev.off())
```


```{r p_HSM_M_lab_cor, fig.height=8, fig.width=8}
p_HSM_M_lab_cor()
```

```{r}
pdf(file="HeatShock/p_HSM_M_lab_cor.pdf",width=8, height=8)
p_HSM_M_lab_cor()
invisible(dev.off())
```





## Diapause


```{r}
dir.create(file.path("Diapause"), showWarnings = FALSE)
```


_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

### Contributors  

Bergland Lab : Liam Miller, Alan Bergland, Priscilla Erickson

Flatt Lab : Esra Durmaz, Envel Kerdaffrec, Thibault Schowing, Virginie Thieu, Marisa Rodrigues, Thomas Flatt

Schlotterer Lab : Manolis Lyrakis, Christian Schlötterer

### Data Reformatting

```{r d_Dia}
d_Dia <- read.csv("MasterSheets_Oct21_git/DIA_MasterSheet_Oct21.csv")
```

```{r}
str(d_Dia)
```



```{r}
d_Dia <- d_Dia %>%
  mutate(Supervisor.PI = as.factor(Supervisor.PI),
         Diet = as.factor(Diet),
         Batch = as.factor(Batch),
         Population = as.factor(Population),
         Line = as.factor(Line),
         MostAdvancedStage = as.numeric(MostAdvancedStage),
         NumberOfEggs = as.numeric(NumberOfEggs),
         Max_Stage7 = ifelse(MostAdvancedStage <= 7 & NumberOfEggs == 0, 1, 0),
         Max_Stage8 = ifelse(MostAdvancedStage <= 8 & NumberOfEggs == 0, 1, 0),
         Max_Stage9 = ifelse(MostAdvancedStage <= 9 & NumberOfEggs == 0, 1, 0),
         Population_Lat = factor(Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK")),
         Population_Lon = factor(Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA")),
         Population_Alt = factor(Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE")))
 
```


```{r}
str(d_Dia)
```


### Descriptive Statistics

```{r}
##### calculate diapause proportions per line, with and without batch
d_Dia_Line_wbatch <- d_Dia %>%
  group_by(Supervisor.PI, Batch, Population, Population_Lat, Population_Lon, Population_Alt, Line) %>%
  dplyr::summarise(n_ind = as.numeric(n()),
            Max_Stage7_Prop = mean(Max_Stage7, na.rm = T),
            Max_Stage8_Prop = mean(Max_Stage8, na.rm = T),
            Max_Stage9_Prop = mean(Max_Stage9, na.rm = T),
            Max_Stage7_Prop_Asin = asin(sqrt(mean(Max_Stage7, na.rm = T))),
            Max_Stage8_Prop_Asin = asin(sqrt(mean(Max_Stage8, na.rm = T))),
            Max_Stage9_Prop_Asin = asin(sqrt(mean(Max_Stage9, na.rm = T))),
            .groups = "drop")
 
d_Dia_Line_wobatch <- d_Dia %>%
  group_by(Supervisor.PI, Population, Population_Lat, Population_Lon, Population_Alt, Line) %>%
  dplyr::summarise(n_ind = as.numeric(n()),
            Max_Stage7_Prop = mean(Max_Stage7, na.rm = T),
            Max_Stage8_Prop = mean(Max_Stage8, na.rm = T),
            Max_Stage9_Prop = mean(Max_Stage9, na.rm = T),
            Max_Stage7_Prop_Asin = asin(sqrt(mean(Max_Stage7, na.rm = T))),
            Max_Stage8_Prop_Asin = asin(sqrt(mean(Max_Stage8, na.rm = T))),
            Max_Stage9_Prop_Asin = asin(sqrt(mean(Max_Stage9, na.rm = T))),
            .groups = "drop")
```

Descriptive statistics at the line level for Max Stage 9, with batch information :
```{r}
table_Dia_Line_wbatch <- d_Dia_Line_wbatch %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(Max_Stage9_Prop), list(Mean = mean, SD = sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode))

write.csv(table_Dia_Line_wbatch, "Diapause/table_Dia_Line_wbatch.csv", row.names = T)
```

```{r eval=FALSE, echo=FALSE}
DT::datatable(table_Dia_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the line level for Max Stage 9, without batch information :
```{r}
table_Dia_Line_wobatch <- d_Dia_Line_wobatch %>% group_by(Supervisor.PI, Population, Line) %>% summarise_at(vars(Max_Stage9_Prop), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode))

write.csv(table_Dia_Line_wobatch, "Diapause/table_Dia_Line_wobatch.csv", row.names = T)
```

```{r eval=FALSE, echo=FALSE}
DT::datatable(table_Dia_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Dia_Pop_wbatch <- d_Dia_Line_wbatch %>% group_by(Supervisor.PI, Batch, Population) %>% summarise_at(vars(Max_Stage9_Prop), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode))

write.csv(table_Dia_Pop_wbatch, "Diapause/table_Dia_Pop_wbatch.csv", row.names = T)
```

```{r eval=FALSE, echo=FALSE}
DT::datatable(table_Dia_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Dia_Pop_wobatch <- d_Dia_Line_wobatch %>% group_by(Supervisor.PI, Population) %>% summarise_at(vars(Max_Stage9_Prop), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode))

write.csv(table_Dia_Pop_wobatch, "Diapause/table_Dia_Line_wobatch.csv", row.names = T)
```

```{r eval=FALSE, echo=FALSE}
DT::datatable(table_Dia_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```


### Plots and Linear Models by Lab
#### Bergland Lab
```{r}
Dia_lmer_Bergland <- lmer(Max_Stage9_Prop ~ -1 + Population + (1|Population:Line) + (1|Batch) , data = d_Dia_Line_wbatch %>% filter(Supervisor.PI == "Bergland"))
capture.output(summary(Dia_lmer_Bergland),file = "Diapause/Dia_lmer_Bergland_sum.txt")
capture.output(anova(Dia_lmer_Bergland),file = "Diapause/Dia_lmer_Bergland.txt")
#capture.output(emmeans(Dia_lmer_Bergland, list(pairwise ~ Population), adjust = "tukey"),file = "Diapause/Dia_lmer_Bergland_tk.txt")
```

```{r}
model_means_Bergland <- emmeans(object = Dia_lmer_Bergland, specs = ~ Population)
model_means_Bergland_cld <- cld(object = model_means_Bergland, adjust = "Tukey", Letters = letters, alpha = 0.05) %>% as.data.frame %>% mutate(Population = factor(Population, levels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))) %>% arrange(Population) %>% dplyr::rename(cld = .group)
```


```{r}
min_Dia <- min(d_Dia_Line_wbatch$Max_Stage9_Prop)
max_Dia <- max(d_Dia_Line_wbatch$Max_Stage9_Prop)
```


```{r}
p_Dia_Pop_Bergland_wbatch <- d_Dia_Line_wbatch %>% 
  filter(Supervisor.PI == 'Bergland') %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  labs(title = "p_Dia_Bergland", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Bergland_wbatch
```
```{r}
pdf(file="Diapause/p_Dia_Pop_Bergland_wbatch.pdf",width=8, height=5)
p_Dia_Pop_Bergland_wbatch
dev.off()
```
```{r}
p_Dia_Pop_Bergland_wobatch <- d_Dia_Line_wobatch %>% 
  filter(Supervisor.PI == 'Bergland') %>%
  inner_join(model_means_Bergland_cld) %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  geom_text(data = model_means_Bergland_cld, aes(x = Population, label = cld), y = 1, vjust = -1) +
  labs(title = "p_Dia_Bergland", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Bergland_wobatch
```
```{r}
pdf(file="Diapause/p_Dia_Pop_Bergland_wobatch.pdf",width=8, height=5)
p_Dia_Pop_Bergland_wobatch
dev.off()
```

#### Flatt Lab 
```{r}
Dia_lm_Flatt <- lm(Max_Stage9_Prop ~ -1 + Population, data = d_Dia_Line_wbatch %>% filter(Supervisor.PI == "Flatt"))
capture.output(summary(Dia_lm_Flatt),file = "Diapause/Dia_lm_Flatt_sum.txt")
capture.output(anova(Dia_lm_Flatt),file = "Diapause/Dia_lm_Flatt")
#capture.output(emmeans(Dia_lm_Flatt, list(pairwise ~ Population), adjust = "tukey"),file = "Diapause/Dia_lm_Flatt_tk.txt")
```

```{r}
model_means_Flatt <- emmeans(object = Dia_lm_Flatt, specs = ~ Population)
model_means_Flatt_cld <- cld(object = model_means_Flatt, adjust = "Tukey", Letters = letters, alpha = 0.05) %>% as.data.frame %>% mutate(Population = factor(Population, levels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))) %>% arrange(Population) %>% dplyr::rename(cld = .group)
```

```{r}
p_Dia_Pop_Flatt_wbatch <- d_Dia_Line_wbatch %>% 
  filter(Supervisor.PI == 'Flatt') %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  labs(title = "p_Dia_Flatt", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Flatt_wbatch
```

```{r message=FALSE, warning=FALSE}
pdf(file="Diapause/p_Dia_Pop_Flatt_wbatch.pdf", width=8, height=5)
p_Dia_Pop_Flatt_wbatch
dev.off()
```

```{r}
p_Dia_Pop_Flatt_wobatch <- d_Dia_Line_wobatch %>% 
  filter(Supervisor.PI == 'Flatt') %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  geom_text(data = model_means_Flatt_cld, aes(x = Population, label = cld), y = 1, vjust = -1) +
  labs(title = "p_Dia_Flatt", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Flatt_wobatch
```

```{r message=FALSE, warning=FALSE}
pdf(file="Diapause/p_Dia_Pop_Flatt_wobatch.pdf", width=8, height=5)
p_Dia_Pop_Flatt_wobatch
dev.off()
```




#### Schlotterer Lab
```{r}
Dia_lmer_Schlotterer <- lmer(Max_Stage9_Prop ~ -1 + Population + (1|Population:Line) + (1|Batch) , data = d_Dia_Line_wbatch %>% filter(Supervisor.PI == "Schlotterer"))
capture.output(summary(Dia_lmer_Schlotterer),file = "Diapause/Dia_lmer_Schlotterer_sum.txt")
capture.output(anova(Dia_lmer_Schlotterer),file = "Diapause/Dia_lmer_Schlotterer.txt")
#capture.output(emmeans(Dia_lmer_Schlotterer, list(pairwise ~ Population), adjust = "tukey"),file = "Diapause/Dia_lmer_Schlotterer_tk.txt")
```



```{r}
model_means_Schlotterer <- emmeans(object = Dia_lmer_Schlotterer, specs = ~ Population)
model_means_Schlotterer_cld <- cld(object = model_means_Schlotterer, adjust = "Tukey", Letters = letters, alpha = 0.05) %>% as.data.frame %>% mutate(Population = factor(Population, levels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))) %>% arrange(Population) %>% dplyr::rename(cld = .group)
```
```{r}
p_Dia_Pop_Schlotterer_wbatch <- d_Dia_Line_wbatch %>% 
  filter(Supervisor.PI == 'Schlotterer') %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Batch)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  labs(title = "p_Dia_Schlotterer", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Schlotterer_wbatch
```
```{r message=FALSE, warning=FALSE}
pdf(file="Diapause/p_Dia_Pop_Schlotterer_wbatch.pdf", width=8, height=5)
p_Dia_Pop_Schlotterer_wbatch
dev.off()
```
```{r}
p_Dia_Pop_Schlotterer_wobatch <- d_Dia_Line_wobatch %>% 
  filter(Supervisor.PI == 'Schlotterer') %>%
  ggplot(aes(x = Population_Lat, y = Max_Stage9_Prop, fill = Population)) + 
  geom_boxplot(outlier.shape = NA, notch = FALSE) +  
  geom_jitter(width = 0.2, alpha = 0.05) + 
  geom_text(data = model_means_Schlotterer_cld, aes(x = Population, label = cld), y = 1, vjust = -0.7) +
  labs(title = "p_Dia_Schlotterer", x = "Population", y = "Max_Stage9_Prop") +
  droseu_theme +
  ylim(c(min_Dia, max_Dia))
p_Dia_Pop_Schlotterer_wobatch
```

```{r message=FALSE, warning=FALSE}
pdf(file="Diapause/p_Dia_Pop_Schlotterer_wobatch.pdf", width=8, height=5)
p_Dia_Pop_Schlotterer_wobatch
dev.off()
```




### Lab correlations


```{r intersect_Dia}
intersect_Line_Dia  <- Reduce(intersect, list(d_Dia$Line[d_Dia$Supervisor.PI == "Flatt"],
                                         d_Dia$Line[d_Dia$Supervisor.PI == "Bergland"],
                                         d_Dia$Line[d_Dia$Supervisor.PI == "Schlotterer"]))

write(intersect_Line_Dia, file ="Diapause/intersect_Line_Dia.txt", sep = "\t")

intersect_Pop_Dia  <- Reduce(intersect, list(d_Dia$Population[d_Dia$Supervisor.PI == "Flatt"],
                                         d_Dia$Population[d_Dia$Supervisor.PI == "Bergland"],
                                         d_Dia$Population[d_Dia$Supervisor.PI == "Schlotterer"]))

write(intersect_Pop_Dia, file ="Diapause/intersect_Pop_Dia.txt", sep = "\t")

```

There are `r length(intersect_Pop_Dia) ` populations and `r length(intersect_Line_Dia) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r lab_correlations_Dia}
Dia_fitted <- combineFitted(labs = c("Bergland", "Flatt", "Schlotterer"), sex = rep("F", 3), models = list(Dia_lmer_Bergland, Dia_lm_Flatt, Dia_lmer_Schlotterer))

p_Dia_F_lab_cor <- function() scatterPlotMatrix(Dia_fitted, sex = "F")
```

```{r p_Dia_F_lab_cor, fig.height = 8, fig.width = 8}
p_Dia_F_lab_cor()
```

```{r}
pdf(file="Diapause/p_Dia_F_lab_cor.pdf",width=8, height=8)
p_Dia_F_lab_cor()
invisible(dev.off())
```



## Circadian eclosion timing


```{r}
dir.create(file.path("CircadianEclosion"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r}
#Note that the trait has been phenotyped as mixed sex. 
```

### Contributors  

Wegener Lab : Susanne Klühspies, Christian Wegener

### Data Reformatting

```{r d_CET}
d_CET <- read.csv("MasterSheets_Oct21_git/CET_MasterSheet_Dec21.csv")
```


```{r}
str(d_CET)
```


```{r}
d_CET$Supervisor.PI <- as.factor(d_CET$Supervisor.PI)
d_CET$Diet <- as.factor(d_CET$Diet)
d_CET$Batch <- as.factor(d_CET$Batch)
d_CET$Population_Lat <- factor(d_CET$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_CET$Population_Lon <- factor(d_CET$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_CET$Population_Alt <- factor(d_CET$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_CET$Condition <- as.factor(d_CET$Condition)
d_CET$CET_hours_MESA <- as.numeric(d_CET$CET_hours_MESA)
d_CET$CET_hours_LSPR <- as.numeric(d_CET$CET_hours_LSPR)
d_CET$Period_MESA <- as.numeric(d_CET$Period_MESA)
d_CET$Period_LSPR <- as.numeric(d_CET$Period_LSPR)
d_CET$Rhythmicity_LSPR_amplitude <- as.numeric(d_CET$Rhythmicity_LSPR_amplitude)
d_CET$Rhythmicity_JTK_p_BH_corrected <- as.numeric(d_CET$Rhythmicity_JTK_p_BH_corrected)
```


```{r}
str(d_CET)
```

```{r}
d_CET_18_LD_DD <-subset(d_CET,Condition=='18_LD_DD')
```

```{r}
d_CET_18_LD_LD <-subset(d_CET,Condition=='18_LD_LD')
```

```{r}
d_CET_29_LD_DD <-subset(d_CET,Condition=='29_LD_DD')
```

```{r}
d_CET_29_LD_LD <-subset(d_CET,Condition=='29_LD_LD')
```


### Descriptive Statistics

#### 18_LD_DD

Descriptive statistics for CET_hours_MESA :
```{r table_CET_18LDDD_CET_MESA}
table_CET_18LDDD_CET_MESA <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(CET_hours_MESA), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_CET_MESA.csv", row.names = T)
table_CET_18LDDD_CET_MESA <- read.csv("CircadianEclosion/table_CET_18LDDD_CET_MESA.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_CET_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for CET_hours_LSPR :
```{r table_CET_18LDDD_CET_LSPR}
table_CET_18LDDD_CET_LSPR <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(CET_hours_LSPR), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_CET_LSPR.csv", row.names = T)
table_CET_18LDDD_CET_LSPR <- read.csv("CircadianEclosion/table_CET_18LDDD_CET_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_CET_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```



Descriptive statistics for Period_MESA :
```{r table_CET_18LDDD_Period_MESA}
table_CET_18LDDD_Period_MESA <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(Period_MESA), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_Period_MESA.csv", row.names = T)
table_CET_18LDDD_Period_MESA <- read.csv("CircadianEclosion/table_CET_18LDDD_Period_MESA.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```


Descriptive statistics for Period_LSPR :
```{r table_CET_18LDDD_Period_LSPR}
table_CET_18LDDD_Period_LSPR <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(Period_LSPR), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_Period_LSPR.csv", row.names = T)
table_CET_18LDDD_Period_LSPR <- read.csv("CircadianEclosion/table_CET_18LDDD_Period_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```


Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r table_CET_18LDDD_Rhy_LSPR}
table_CET_18LDDD_Rhy_LSPR <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(Rhythmicity_LSPR_amplitude), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_Rhy_LSPR.csv", row.names = T)
table_CET_18LDDD_Rhy_LSPR <- read.csv("CircadianEclosion/table_CET_18LDDD_Rhy_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_Rhy_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r table_CET_18LDDD_Rhy_JTK}
table_CET_18LDDD_Rhy_JTK <- write.csv(d_CET_18_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                    summarise_at(vars(Rhythmicity_JTK_p_BH_corrected), 
                                                 list(Mean = mean)), 
                            file = "CircadianEclosion/table_CET_18LDDD_Rhy_JTK.csv", row.names = T)
table_CET_18LDDD_Rhy_JTK <- read.csv("CircadianEclosion/table_CET_18LDDD_Rhy_JTK.csv")

```

```{r}
DT::datatable(table_CET_18LDDD_Rhy_JTK, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```


#### 18_LD_LD

Descriptive statistics for CET_hours_MESA :
```{r table_CET_18LDLD_CET_MESA}
table_CET_18LDLD_CET_MESA <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_MESA), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_18LDLD_CET_MESA.csv", row.names = T)
table_CET_18LDLD_CET_MESA <- read.csv("CircadianEclosion/table_CET_18LDLD_CET_MESA.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_CET_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for CET_hours_LSPR :
```{r table_CET_18LDLD_CET_LSPR}
table_CET_18LDLD_CET_LSPR <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_LSPR), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_18LDLD_CET_LSPR.csv", row.names = T)
table_CET_18LDLD_CET_LSPR <- read.csv("CircadianEclosion/table_CET_18LDLD_CET_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_CET_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r table_CET_18LDLD_Period_MESA}
table_CET_18LDLD_Period_MESA <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_MESA), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_18LDLD_Period_MESA.csv", row.names = T)
table_CET_18LDLD_Period_MESA <- read.csv("CircadianEclosion/table_CET_18LDLD_Period_MESA.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r table_CET_18LDLD_Period_LSPR}
table_CET_18LDLD_Period_LSPR <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_LSPR), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_18LDLD_Period_LSPR.csv", row.names = T)
table_CET_18LDLD_Period_LSPR <- read.csv("CircadianEclosion/table_CET_18LDLD_Period_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r table_CET_18LDLD_Rhy_LSPR}
table_CET_18LDLD_Rhy_LSPR <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(Rhythmicity_LSPR_amplitude), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_18LDLD_Rhy_LSPR.csv", row.names = T)
table_CET_18LDLD_Rhy_LSPR <- read.csv("CircadianEclosion/table_CET_18LDLD_Rhy_LSPR.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_Rhy_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r table_CET_18LDLD_Rhy_JTK}
table_CET_18LDLD_Rhy_JTK <- write.csv(d_CET_18_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                        summarise_at(vars(Rhythmicity_JTK_p_BH_corrected), 
                                                     list(Mean = mean)), 
                                      file = "CircadianEclosion/table_CET_18LDLD_Rhy_JTK.csv", row.names = T)
table_CET_18LDLD_Rhy_JTK <- read.csv("CircadianEclosion/table_CET_18LDLD_Rhy_JTK.csv")

```

```{r}
DT::datatable(table_CET_18LDLD_Rhy_JTK, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```


#### 29_LD_DD

Descriptive statistics for CET_hours_MESA :
```{r table_CET_29LDDD_CET_MESA}
table_CET_29LDDD_CET_MESA <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_MESA), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDDD_CET_MESA.csv", row.names = T)
table_CET_29LDDD_CET_MESA <- read.csv("CircadianEclosion/table_CET_29LDDD_CET_MESA.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_CET_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for CET_hours_LSPR :
```{r table_CET_29LDDD_CET_LSPR}
table_CET_29LDDD_CET_LSPR <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_LSPR), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDDD_CET_LSPR.csv", row.names = T)
table_CET_29LDDD_CET_LSPR <- read.csv("CircadianEclosion/table_CET_29LDDD_CET_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_CET_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r table_CET_29LDDD_Period_MESA}
table_CET_29LDDD_Period_MESA <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_MESA), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_29LDDD_Period_MESA.csv", row.names = T)
table_CET_29LDDD_Period_MESA <- read.csv("CircadianEclosion/table_CET_29LDDD_Period_MESA.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r table_CET_29LDDD_Period_LSPR}
table_CET_29LDDD_Period_LSPR <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_LSPR), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_29LDDD_Period_LSPR.csv", row.names = T)
table_CET_29LDDD_Period_LSPR <- read.csv("CircadianEclosion/table_CET_29LDDD_Period_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r table_CET_29LDDD_Rhy_LSPR}
table_CET_29LDDD_Rhy_LSPR <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(Rhythmicity_LSPR_amplitude), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDDD_Rhy_LSPR.csv", row.names = T)
table_CET_29LDDD_Rhy_LSPR <- read.csv("CircadianEclosion/table_CET_29LDDD_Rhy_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_Rhy_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r table_CET_29LDDD_Rhy_JTK}
table_CET_29LDDD_Rhy_JTK <- write.csv(d_CET_29_LD_DD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                        summarise_at(vars(Rhythmicity_JTK_p_BH_corrected), 
                                                     list(Mean = mean)), 
                                      file = "CircadianEclosion/table_CET_29LDDD_Rhy_JTK.csv", row.names = T)
table_CET_29LDDD_Rhy_JTK <- read.csv("CircadianEclosion/table_CET_29LDDD_Rhy_JTK.csv")

```

```{r}
DT::datatable(table_CET_29LDDD_Rhy_JTK, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

#### 29_LD_LD

Descriptive statistics for CET_hours_MESA :
```{r table_CET_29LDLD_CET_MESA}
table_CET_29LDLD_CET_MESA <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_MESA), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDLD_CET_MESA.csv", row.names = T)
table_CET_29LDLD_CET_MESA <- read.csv("CircadianEclosion/table_CET_29LDLD_CET_MESA.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_CET_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for CET_hours_LSPR :
```{r table_CET_29LDLD_CET_LSPR}
table_CET_29LDLD_CET_LSPR <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(CET_hours_LSPR), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDLD_CET_LSPR.csv", row.names = T)
table_CET_29LDLD_CET_LSPR <- read.csv("CircadianEclosion/table_CET_29LDLD_CET_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_CET_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_MESA :
```{r table_CET_29LDLD_Period_MESA}
table_CET_29LDLD_Period_MESA <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_MESA), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_29LDLD_Period_MESA.csv", row.names = T)
table_CET_29LDLD_Period_MESA <- read.csv("CircadianEclosion/table_CET_29LDLD_Period_MESA.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_Period_MESA, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Period_LSPR :
```{r table_CET_29LDLD_Period_LSPR}
table_CET_29LDLD_Period_LSPR <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                            summarise_at(vars(Period_LSPR), 
                                                         list(Mean = mean)), 
                                          file = "CircadianEclosion/table_CET_29LDLD_Period_LSPR.csv", row.names = T)
table_CET_29LDLD_Period_LSPR <- read.csv("CircadianEclosion/table_CET_29LDLD_Period_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_Period_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_LSPR_amplitude :
```{r table_CET_29LDLD_Rhy_LSPR}
table_CET_29LDLD_Rhy_LSPR <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                         summarise_at(vars(Rhythmicity_LSPR_amplitude), 
                                                      list(Mean = mean)), 
                                       file = "CircadianEclosion/table_CET_29LDLD_Rhy_LSPR.csv", row.names = T)
table_CET_29LDLD_Rhy_LSPR <- read.csv("CircadianEclosion/table_CET_29LDLD_Rhy_LSPR.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_Rhy_LSPR, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```

Descriptive statistics for Rhythmicity_JTK_p_BH_corrected :
```{r table_CET_29LDLD_Rhy_JTK}
table_CET_29LDLD_Rhy_JTK <- write.csv(d_CET_29_LD_LD %>% group_by(Supervisor.PI, Condition, Population) %>% 
                                        summarise_at(vars(Rhythmicity_JTK_p_BH_corrected), 
                                                     list(Mean = mean)), 
                                      file = "CircadianEclosion/table_CET_29LDLD_Rhy_JTK.csv", row.names = T)
table_CET_29LDLD_Rhy_JTK <- read.csv("CircadianEclosion/table_CET_29LDLD_Rhy_JTK.csv")

```

```{r}
DT::datatable(table_CET_29LDLD_Rhy_JTK, options = list(pageLength = 10)) %>% formatRound(5:5, 3)
```


### Plots and Linear Models by Lab  

#### Overview 

#### Wegener Lab

From Chris :

```{r}
knitr::include_graphics("CircadianEclosion/FromChris/Graphs_plate_MESA.png")
```

From Eran :

```{r}
knitr::include_graphics("CircadianEclosion/FromEran/eclosion_data_Christian_Page_1.png")
```

```{r}
knitr::include_graphics("CircadianEclosion/FromEran/eclosion_data_Christian_Page_2.png")
```


## Locomotor activity



```{r}
dir.create(file.path("Locomotor"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _

```{r}
#Note that the trait has been phenotyped only in males.
```


### Contributors  

Tauber Lab : Bettina Fishman, Eran Tauber

### Data Reformatting

```{r d_LA}
d_LA <- read.csv("MasterSheets_Oct21_git/LA_MasterSheet_Oct21.csv")
```


```{r}
str(d_LA)
```


```{r}
d_LA$Supervisor.PI <- as.factor(d_LA$Supervisor.PI)
d_LA$Diet <- as.factor(d_LA$Diet)
d_LA$Batch <- as.factor(d_LA$Batch)
d_LA$Population_Lat <- factor(d_LA$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_LA$Population_Lon <- factor(d_LA$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_LA$Population_Alt <- factor(d_LA$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_LA$Line <- as.factor(d_LA$Line)
d_LA$ReplicateChamber <- as.factor(d_LA$ReplicateChamber)
d_LA$Period <- as.numeric(d_LA$Period)
d_LA$CircPhase <- as.numeric(d_LA$CircPhase)
d_LA$AbsPhase <- as.numeric(d_LA$AbsPhase)
d_LA$Experiment <- as.numeric(d_LA$Experiment)
d_LA$ND <- as.numeric(d_LA$ND)
d_LA$Activity <- as.numeric(d_LA$Activity)
```


```{r}
str(d_LA)
```

### Descriptive Statistics

#### LA - Activity

Descriptive statistics at the line level, with batch information :
```{r table_LA_Act_Line_wbatch}
table_LA_Act_Line_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                    summarise_at(vars(Activity), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Locomotor/table_LA_Act_Line_wbatch.csv", row.names = T)
table_LA_Act_Line_wbatch <- read.csv("Locomotor/table_LA_Act_Line_wbatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_Act_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_LA_Act_Line_wobatch}
table_LA_Act_Line_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                    summarise_at(vars(Activity), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Locomotor/table_LA_Act_Line_wobatch.csv", row.names = T)
table_LA_Act_Line_wobatch <- read.csv("Locomotor/table_LA_Act_Line_wobatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_Act_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_LA_Act_Pop_wbatch}
table_LA_Act_Pop_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                   summarise_at(vars(Activity), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Locomotor/table_LA_Act_Pop_wbatch.csv", row.names = T)
table_LA_Act_Pop_wbatch <- read.csv("Locomotor/table_LA_Act_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_Act_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_LA_Act_Pop_wobatch}
table_LA_Act_Pop_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                   summarise_at(vars(Activity), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Locomotor/table_LA_Act_Pop_wobatch.csv", row.names = T)
table_LA_Act_Pop_wobatch <- read.csv("Locomotor/table_LA_Act_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_Act_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```

#### LA - ND ratio

Descriptive statistics at the line level, with batch information :
```{r table_LA_ND_Line_wbatch}
table_LA_ND_Line_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                        summarise_at(vars(ND), 
                                                     list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                          SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                      file = "Locomotor/table_LA_ND_Line_wbatch.csv", row.names = T)
table_LA_ND_Line_wbatch <- read.csv("Locomotor/table_LA_ND_Line_wbatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_ND_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_LA_ND_Line_wobatch}
table_LA_ND_Line_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                         summarise_at(vars(ND), 
                                                      list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                           SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                       file = "Locomotor/table_LA_ND_Line_wobatch.csv", row.names = T)
table_LA_ND_Line_wobatch <- read.csv("Locomotor/table_LA_ND_Line_wobatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_ND_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_LA_ND_Pop_wbatch}
table_LA_ND_Pop_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                       summarise_at(vars(ND), 
                                                    list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                         SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                     file = "Locomotor/table_LA_ND_Pop_wbatch.csv", row.names = T)
table_LA_ND_Pop_wbatch <- read.csv("Locomotor/table_LA_ND_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_ND_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_LA_ND_Pop_wobatch}
table_LA_ND_Pop_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                        summarise_at(vars(ND), 
                                                     list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                          SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                      file = "Locomotor/table_LA_ND_Pop_wobatch.csv", row.names = T)
table_LA_ND_Pop_wobatch <- read.csv("Locomotor/table_LA_ND_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_ND_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```


#### LA - Circadian Phase

Descriptive statistics at the line level, with batch information :
```{r table_LA_CircPhase_Line_wbatch}
table_LA_CircPhase_Line_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population, Line) %>% 
                                        summarise_at(vars(CircPhase), 
                                                     list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                          SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                      file = "Locomotor/table_LA_CircPhase_Line_wbatch.csv", row.names = T)
table_LA_CircPhase_Line_wbatch <- read.csv("Locomotor/table_LA_CircPhase_Line_wbatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_CircPhase_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_LA_CircPhase_Line_wobatch}
table_LA_CircPhase_Line_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population, Line) %>% 
                                         summarise_at(vars(CircPhase), 
                                                      list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                           SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                       file = "Locomotor/table_LA_CircPhase_Line_wobatch.csv", row.names = T)
table_LA_CircPhase_Line_wobatch <- read.csv("Locomotor/table_LA_CircPhase_Line_wobatch.csv")

```

```{r, echo=FALSE}
DT::datatable(table_LA_CircPhase_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_LA_CircPhase_Pop_wbatch}
table_LA_CircPhase_Pop_wbatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                       summarise_at(vars(CircPhase), 
                                                    list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                         SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                     file = "Locomotor/table_LA_CircPhase_Pop_wbatch.csv", row.names = T)
table_LA_CircPhase_Pop_wbatch <- read.csv("Locomotor/table_LA_CircPhase_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_CircPhase_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_LA_CircPhase_Pop_wobatch}
table_LA_CircPhase_Pop_wobatch <- write.csv(d_LA %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                        summarise_at(vars(CircPhase), 
                                                     list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                          SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                                      file = "Locomotor/table_LA_CircPhase_Pop_wobatch.csv", row.names = T)
table_LA_CircPhase_Pop_wobatch <- read.csv("Locomotor/table_LA_CircPhase_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_LA_CircPhase_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 

#### Tauber Lab

_ND_


```{r LA_lmer_ND_Tauber}
LA_lmer_ND_Tauber <- lmer(ND ~ -1 + Population  + (1|Line:Population) +
                          (1|Batch), data = (d_LA))
capture.output(summary(LA_lmer_ND_Tauber),file = "Locomotor/LA_lmer_ND_Tauber.txt")
capture.output(anova(LA_lmer_ND_Tauber),file = "Locomotor/LA_lmer_ND_Tauber.txt")
#capture.output(emmeans(LA_lmer_ND_Tauber, list(pairwise ~ Population), adjust = "tukey"),file = "Locomotor/LA_lmer_ND_Tauber_tk.txt")
```

```{r}
anova(LA_lmer_ND_Tauber)
```

```{r}
summary(LA_lmer_ND_Tauber)
```


_CircPhase_

```{r LA_lmer_CircPhase_Tauber}
LA_lmer_CircPhase_Tauber <- lmer(CircPhase ~ -1 + Population  + (1|Line:Population) +
                          (1|Batch) , data = (d_LA))
capture.output(summary(LA_lmer_CircPhase_Tauber),file = "Locomotor/LA_lmer_CircPhase_Tauber.txt")
capture.output(anova(LA_lmer_CircPhase_Tauber),file = "Locomotor/LA_lmer_CircPhase_Tauber.txt")
#capture.output(emmeans(LA_lmer_CircPhase_Tauber, list(pairwise ~ Population), adjust = "tukey"),file = "Locomotor/LA_lmer_CircPhase_Tauber_tk.txt")
```

```{r}
anova(LA_lmer_CircPhase_Tauber)
```

```{r}
summary(LA_lmer_CircPhase_Tauber)
```


_Activity_

```{r LA_lmer_Activity_Tauber}
LA_lmer_Activity_Tauber <- lmer(Activity ~ -1 + Population  + (1|Line:Population) +
                          (1|Batch), data = (d_LA))
capture.output(summary(LA_lmer_Activity_Tauber),file = "Locomotor/LA_lmer_Activity_Tauber.txt")
capture.output(anova(LA_lmer_Activity_Tauber),file = "Locomotor/LA_lmer_Activity_Tauber.txt")
#capture.output(emmeans(LA_lmer_Activity_Tauber, list(pairwise ~ Population), adjust = "tukey"),file = "Locomotor/LA_lmer_Activity_Tauber_tk.txt")
```

```{r}
anova(LA_lmer_Activity_Tauber)
```

```{r}
summary(LA_lmer_Activity_Tauber)
```


From Eran :

Red letters denote significant difference by Multiple Comparisons of Means: Tukey Contrasts

```{r}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_1.png")
```

```{r}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_2.png")
```

```{r}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_3.png")
```

Phase in DD represented in angle. The mean and 95 confidence limits are shown. CI limits in red indicate uniform distribution (low concentration. i.e. Rayleigh test not significant).

```{r}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_4.png")
```

Oriana 3 (Stacked circular).   

```{r}
knitr::include_graphics("Locomotor/FromEran/pheno2022_Page_5.png")
```


## Starvation resistance


```{r}
dir.create(file.path("Starvation"), showWarnings = FALSE)
```




_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Gonzalez Lab : Llewellyn Green, Josefa Gonzalez, Miriam Merenciano

Onder Lab : Seda Coskun, Ekin Demir, Senel Selin Senkal, Cansu Aksoy

Pasyukova Lab : Alexander Symonenko, Natalia Roshina, Mikhail Trostnokov, Ekaterina Veselkina, Evgenia Tsybul'ko, Olga Rybina, Elena Pasyukova


### Data Reformatting

```{r d_SR}
d_SR <- read.csv("MasterSheets_Oct21_git/SR_MasterSheet_Nov21.csv")
```

```{r}
str(d_SR)
```

```{r}
d_SR$Supervisor.PI <- as.factor(d_SR$Supervisor.PI)
d_SR$Diet <- as.factor(d_SR$Diet)
d_SR$Batch <- as.factor(d_SR$Batch)
d_SR$Population_Lat <- factor(d_SR$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_SR$Population_Lon <- factor(d_SR$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_SR$Population_Alt <- factor(d_SR$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_SR$Line <- as.factor(d_SR$Line)
d_SR$Sex <- as.factor(d_SR$Sex)
d_SR$ReplicateVial <- as.factor(d_SR$ReplicateVial)
d_SR$AgeAtDeath_hours <- as.numeric(d_SR$AgeAtDeath_hours)
str(d_SR)
```

```{r}
d_SR_F <-subset(d_SR,Sex=='F')
d_SR_M <-subset(d_SR,Sex=='M')
```

### Descriptive Statistics

Descriptive statistics at the line level, with batch information :
```{r table_SR_Line_wbatch}

table_SR_Line_wbatch <- write.csv(d_SR %>% group_by(Supervisor.PI, Batch, Sex,Population, Line) %>% 
                                   summarise_at(vars(AgeAtDeath_hours), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Starvation/table_SR_Line_wbatch.csv", row.names = T)
table_SR_Line_wbatch <- read.csv("Starvation/table_SR_Line_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_SR_Line_wbatch, options = list(pageLength = 10)) %>% formatRound(7:14, 3)
```

Descriptive statistics at the line level, without batch information :
```{r table_SR_Line_wobatch}
table_SR_Line_wobatch <- write.csv(d_SR %>% group_by(Supervisor.PI, Sex,Population, Line) %>% 
                                   summarise_at(vars(AgeAtDeath_hours), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Starvation/table_SR_Line_wobatch.csv", row.names = T)
table_SR_Line_wobatch <- read.csv("Starvation/table_SR_Line_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_SR_Line_wobatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, with batch information :
```{r table_SR_Pop_wbatch}
table_SR_Pop_wbatch <- write.csv(d_SR %>% group_by(Supervisor.PI, Batch, Sex, Population) %>% 
                                  summarise_at(vars(AgeAtDeath_hours), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "Starvation/table_SR_Pop_wbatch.csv", row.names = T)

table_SR_Pop_wbatch <- read.csv("Starvation/table_SR_Pop_wbatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_SR_Pop_wbatch, options = list(pageLength = 10)) %>% formatRound(6:13, 3)
```

Descriptive statistics at the population level, without batch information :
```{r table_SR_Pop_wobatch}
table_SR_Pop_wobatch <- write.csv(d_SR %>% group_by(Supervisor.PI, Sex, Population) %>% 
                                  summarise_at(vars(AgeAtDeath_hours), 
                                               list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                    SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                          file = "Starvation/table_SR_Pop_wobatch.csv", row.names = T)

table_SR_Pop_wobatch <- read.csv("Starvation/table_SR_Pop_wobatch.csv")
```

```{r, echo=FALSE}
DT::datatable(table_SR_Pop_wobatch, options = list(pageLength = 10)) %>% formatRound(5:12, 3)
```


### Plots and Linear Models by Lab  

#### Overview 


```{r}
min_SR <- min(d_SR$AgeAtDeath_hours)
max_SR <- max(d_SR$AgeAtDeath_hours)
```

```{r p_SR_F}

p_SR_F <- ggplot(data = d_SR_F, aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  #geom_jitter(width=0.2,alpha=0.05) + 
        labs(title="p_SR_F", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```


```{r echo=FALSE}
p_SR_F
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F.pdf",width=8, height=5)
p_SR_F
dev.off()
```

```{r p_SR_M}

p_SR_M <- ggplot(data = d_SR_M, aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Supervisor.PI)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) +  #geom_jitter(width=0.2,alpha=0.05) + 
        labs(title="p_SR_M", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M.pdf",width=8, height=5)
p_SR_M
dev.off()
```



#### Gonzalez Lab


```{r SR_F_lmer_Gonzalez}
SR_F_lmer_Gonzalez <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                          (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_F,Supervisor.PI=='Gonzalez')))
capture.output(summary(SR_F_lmer_Gonzalez),file = "Starvation/SR_F_lmer_Gonzalez_sum.txt")
capture.output(anova(SR_F_lmer_Gonzalez),file = "Starvation/SR_F_lmer_Gonzalez.txt")
#capture.output(emmeans(SR_F_lmer_Gonzalez, list(pairwise ~ Population), adjust = "tukey"),file = "SR_F_Gonzalez_tk.txt")
```

```{r}
anova(SR_F_lmer_Gonzalez)
```


```{r}
summary(SR_F_lmer_Gonzalez)
```


```{r SR_M_lmer_Gonzalez}
SR_M_lmer_Gonzalez <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                                   (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_M,Supervisor.PI=='Gonzalez')))
capture.output(summary(SR_M_lmer_Gonzalez),file = "Starvation/SR_M_lmer_Gonzalez_sum.txt")
capture.output(anova(SR_M_lmer_Gonzalez),file = "Starvation/SR_M_lmer_Gonzalez.txt")
#capture.output(emmeans(SR_M_lmer_Gonzalez, list(pairwise ~ Population), adjust = "tukey"),file = "SR_M_Gonzalez_tk.txt")
```


```{r}
anova(SR_M_lmer_Gonzalez)
```


```{r}
summary(SR_M_lmer_Gonzalez)
```


```{r p_SR_F_Gonzalez}

p_SR_F_Gonzalez <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Gonzalez')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme
```

```{r echo=FALSE}
p_SR_F_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Gonzalez.pdf",width=8, height=5)
p_SR_F_Gonzalez
dev.off()
```

```{r p_SR_F_pop_Gonzalez}

p_SR_F_pop_Gonzalez <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Gonzalez')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_F_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Gonzalez.pdf",width=8, height=5)
p_SR_F_pop_Gonzalez
dev.off()
```


```{r p_SR_M_Gonzalez}

p_SR_M_Gonzalez <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Gonzalez')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Gonzalez.pdf",width=8, height=5)
p_SR_M_Gonzalez
dev.off()
```

```{r p_SR_M_pop_Gonzalez}

p_SR_M_pop_Gonzalez <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Gonzalez')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Gonzalez", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M_pop_Gonzalez
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Gonzalez.pdf",width=8, height=5)
p_SR_M_pop_Gonzalez
dev.off()
```


#### Onder Lab 


```{r SR_F_lmer_Onder}
SR_F_lmer_Onder <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                                (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_F,Supervisor.PI=='Onder')))
capture.output(summary(SR_F_lmer_Onder),file = "Starvation/SR_F_lmer_Onder_sum.txt")
capture.output(anova(SR_F_lmer_Onder),file = "Starvation/SR_F_lmer_Onder.txt")
#capture.output(emmeans(SR_F_lmer_Onder, list(pairwise ~ Population), adjust = "tukey"),file = "SR_F_Onder_tk.txt")
```

```{r}
anova(SR_F_lmer_Onder)
```

```{r}
summary(SR_F_lmer_Onder)
```


```{r SR_M_lmer_Onder}
SR_M_lmer_Onder <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                                (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_M,Supervisor.PI=='Onder')))
capture.output(summary(SR_M_lmer_Onder),file = "Starvation/SR_M_lmer_Onder_sum.txt")
capture.output(anova(SR_M_lmer_Onder),file = "Starvation/SR_M_lmer_Onder.txt")
#capture.output(emmeans(SR_M_lmer_Onder, list(pairwise ~ Population), adjust = "tukey"),file = "SR_M_Onder_tk.txt")
```

```{r}
anova(SR_M_lmer_Onder)
```

```{r}
summary(SR_M_lmer_Onder)
```

```{r p_SR_F_Onder}

p_SR_F_Onder <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_F_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Onder.pdf", width=8, height=5)
p_SR_F_Onder
dev.off()
```

```{r p_SR_F_pop_Onder}

p_SR_F_pop_Onder <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```


```{r echo=FALSE}
p_SR_F_pop_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Onder.pdf",width=8, height=5)
p_SR_F_pop_Onder
dev.off()
```

```{r p_SR_M_Onder}

p_SR_M_Onder <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Onder.pdf",width=8, height=5)
p_SR_M_Onder
dev.off()
```

```{r p_SR_M_pop_Onder}

p_SR_M_pop_Onder <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Onder')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Onder", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M_pop_Onder
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Onder.pdf",width=8, height=5)
p_SR_M_pop_Onder
dev.off()
```

#### Pasyukova Lab


```{r SR_F_lmer_Pasyukova}
SR_F_lmer_Pasyukova <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_F,Supervisor.PI=='Pasyukova')))
capture.output(summary(SR_F_lmer_Pasyukova),file = "Starvation/SR_F_lmer_Pasyukova_sum.txt")
capture.output(anova(SR_F_lmer_Pasyukova),file = "Starvation/SR_F_lmer_Pasyukova.txt")
#capture.output(emmeans(SR_F_lmer_Pasyukova, list(pairwise ~ Population), adjust = "tukey"),file = "SR_F_Pasyukova_tk.txt")
```

```{r}
anova(SR_F_lmer_Pasyukova)
```

```{r}
summary(SR_F_lmer_Pasyukova)
```

```{r SR_M_lmer_Pasyukova}
SR_M_lmer_Pasyukova <- lmer(AgeAtDeath_hours ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch) + (1|ReplicateVial : Line : Population), data = (subset(d_SR_M,Supervisor.PI=='Pasyukova')))
capture.output(summary(SR_M_lmer_Pasyukova),file = "Starvation/SR_M_lmer_Pasyukova_sum.txt")
capture.output(anova(SR_M_lmer_Pasyukova),file = "Starvation/SR_M_lmer_Pasyukova.txt")
#capture.output(emmeans(SR_M_lmer_Pasyukova, list(pairwise ~ Population), adjust = "tukey"),file = "SR_M_Pasyukova_tk.txt")
```


```{r p_SR_F_Pasyukova}

p_SR_F_Pasyukova <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Pasyukova')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_F_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_Pasyukova.pdf",width=8, height=5)
p_SR_F_Pasyukova
dev.off()
```


```{r p_SR_F_pop_Pasyukova}

p_SR_F_pop_Pasyukova <- ggplot(data = (subset(d_SR_F,Supervisor.PI=='Pasyukova')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_F_pop_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```


```{r echo=FALSE}
p_SR_F_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_F_pop_Pasyukova.pdf",width=8, height=5)
p_SR_F_pop_Pasyukova
dev.off()
```

```{r p_SR_M_Pasyukova}

p_SR_M_Pasyukova <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Pasyukova')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme
```

```{r echo=FALSE}
p_SR_M_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_Pasyukova.pdf",width=8, height=5)
p_SR_M_Pasyukova
dev.off()
```

```{r p_SR_M_pop_Pasyukova}

p_SR_M_pop_Pasyukova <- ggplot(data = (subset(d_SR_M,Supervisor.PI=='Pasyukova')), aes(x=Population_Lat, y=AgeAtDeath_hours, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_SR_M_pop_Pasyukova", x="Population", y = "AgeAtDeath_hours") + ylim(c(min_SR, max_SR))+ droseu_theme

```

```{r echo=FALSE}
p_SR_M_pop_Pasyukova
```

```{r echo=FALSE}
pdf(file="Starvation/p_SR_M_pop_Pasyukova.pdf",width=8, height=5)
p_SR_M_pop_Pasyukova
dev.off()
```


### Survival Analyses

```{r}
d_SR_surv <- d_SR %>% mutate(Censor = 1)
```


#### Gonzalez Lab
##### Females

```{r}
SR_F_Gonzalez_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Gonzalez", Sex == "F"))
```
```{r}
p_SR_F_Gonzalez_survfit <- ggsurvplot(SR_F_Gonzalez_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_F_Gonzalez")
```
```{r}
p_SR_F_Gonzalez_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_F_Gonzalez_survfit.pdf", width=8, height=5)
p_SR_F_Gonzalez_survfit$plot
invisible(dev.off())
```
##### Males
```{r}
SR_M_Gonzalez_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Gonzalez", Sex == "M"))
```
```{r}
p_SR_M_Gonzalez_survfit <- ggsurvplot(SR_M_Gonzalez_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_M_Gonzalez")
```
```{r}
p_SR_M_Gonzalez_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_M_Gonzalez_survfit.pdf", width=8, height=5)
p_SR_M_Gonzalez_survfit$plot
invisible(dev.off())
```


#### Onder Lab
##### Females
```{r}
SR_F_Onder_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Onder", Sex == "F"))
```
```{r}
p_SR_F_Onder_survfit <- ggsurvplot(SR_F_Onder_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_F_Onder")
```
```{r}
p_SR_F_Onder_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_F_Onder_survfit.pdf", width=8, height=5)
p_SR_F_Onder_survfit$plot
invisible(dev.off())
```
##### Males
```{r}
SR_M_Onder_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Onder", Sex == "M"))
```
```{r}
p_SR_M_Onder_survfit <- ggsurvplot(SR_M_Onder_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_M_Onder")
```
```{r}
p_SR_M_Onder_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_M_Onder_survfit.pdf", width=8, height=5)
p_SR_M_Onder_survfit$plot
invisible(dev.off())
```



#### Pasyukova Lab
##### Females
```{r}
SR_F_Pasyukova_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Pasyukova", Sex == "F"))
```
```{r}
p_SR_F_Pasyukova_survfit <- ggsurvplot(SR_F_Pasyukova_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_F_Pasyukova")
```
```{r}
p_SR_F_Pasyukova_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_F_Pasyukova_survfit.pdf", width=8, height=5)
p_SR_F_Pasyukova_survfit$plot
invisible(dev.off())
```
##### Males
```{r}
SR_M_Pasyukova_survfit <- survfit(Surv(AgeAtDeath_hours) ~ Population, data = filter(d_SR_surv, Supervisor.PI == "Pasyukova", Sex == "M"))
```
```{r}
p_SR_M_Pasyukova_survfit <- ggsurvplot(SR_M_Pasyukova_survfit, censor.shape="|", censor.size = 0, pval = FALSE, risk.table = FALSE, conf.int = FALSE, legend.title = "Population", legend.labs = sort(c("YE","RE","GI","MU","MA","UM","KA","VA","AK")), legend = c(0.9, 0.7), title = "p_SR_M_Pasyukova")
```
```{r}
p_SR_M_Pasyukova_survfit$plot
```
```{r}
pdf(file="Starvation/p_SR_M_Pasyukova_survfit.pdf", width=8, height=5)
p_SR_M_Pasyukova_survfit$plot
invisible(dev.off())
```


### coxme

```{r eval = FALSE}
SR_F_coxme_Gonzalez <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Gonzalez", Sex == "F"))
capture.output(summary(SR_F_coxme_Gonzalez), file = "Starvation/SR_F_coxme_Gonzalez_sum.txt")
capture.output(anova(SR_F_coxme_Gonzalez), file = "Starvation/SR_F_coxme_Gonzalez.txt")
```           


```{r eval = FALSE}
SR_M_coxme_Gonzalez <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Gonzalez", Sex == "M"))
capture.output(summary(SR_M_coxme_Gonzalez), file = "Starvation/SR_M_coxme_Gonzalez_sum.txt")
capture.output(anova(SR_M_coxme_Gonzalez), file = "Starvation/SR_M_coxme_Gonzalez.txt")
``` 

```{r eval = FALSE}
SR_F_coxme_Onder <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Onder", Sex == "F"))
capture.output(summary(SR_F_coxme_Onder), file = "Starvation/SR_F_coxme_Onder_sum.txt")
capture.output(anova(SR_F_coxme_Onder), file = "Starvation/SR_F_coxme_Onder.txt")
```  
         

```{r eval = FALSE}
SR_M_coxme_Onder <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Onder", Sex == "M"))
capture.output(summary(SR_M_coxme_Onder), file = "Starvation/SR_M_coxme_Onder_sum.txt")
capture.output(anova(SR_M_coxme_Onder), file = "Starvation/SR_M_coxme_Onder.txt")
```  


```{r eval = FALSE}
SR_F_coxme_Pasyukova <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Pasyukova", Sex == "F"))
capture.output(summary(SR_F_coxme_Pasyukova), file = "Starvation/SR_F_coxme_Pasyukova_sum.txt")
capture.output(anova(SR_F_coxme_Pasyukova), file = "Starvation/SR_F_coxme_Pasyukova.txt")
```  

```{r eval = FALSE}
SR_M_coxme_Pasyukova <- coxme(Surv(AgeAtDeath_hours, Censor) ~ Population + (1|Batch) + (1|Population/Line) + (1|Population/Line/ReplicateVial), data = filter(d_SR_surv, Supervisor.PI == "Pasyukova", Sex == "M"))
capture.output(summary(SR_M_coxme_Pasyukova), file = "Starvation/SR_M_coxme_Pasyukova_sum.txt")
capture.output(anova(SR_M_coxme_Pasyukova), file = "Starvation/SR_M_coxme_Pasyukova.txt")
```  


### Lab correlations

```{r intersect_SR}
intersect_Line_SR  <- Reduce(intersect, list(d_SR$Line[d_SR$Supervisor.PI == "Gonzalez"],
                                        d_SR$Line[d_SR$Supervisor.PI == "Pasyukova"],
                                        d_SR$Line[d_SR$Supervisor.PI == "Onder"]))

write(intersect_Line_SR, file ="Starvation/intersect_Line_SR.txt", sep = "\t")

intersect_Pop_SR  <- Reduce(intersect, list(d_SR$Population[d_SR$Supervisor.PI == "Gonzalez"],
                                        d_SR$Population[d_SR$Supervisor.PI == "Pasyukova"],
                                        d_SR$Line[d_SR$Supervisor.PI == "Onder"]))
write(intersect_Pop_SR, file ="Starvation/intersect_Pop_SR.txt", sep = "\t")

```

There are `r length(intersect_Pop_SR) ` populations and `r length(intersect_Line_SR) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 


```{r}
SR_fitted <- combineFitted(labs = rep(c("Gonzalez", "Onder", "Pasyukova"), 2), sex = rep(c("F", "M"), each = 3), models = list(SR_F_lmer_Gonzalez, SR_F_lmer_Onder, SR_F_lmer_Pasyukova, SR_M_lmer_Gonzalez, SR_M_lmer_Onder, SR_M_lmer_Pasyukova))

p_SR_F_lab_cor <- function() scatterPlotMatrix(SR_fitted, sex = "F")
p_SR_M_lab_cor <- function() scatterPlotMatrix(SR_fitted, sex = "M")
```

```{r p_SR_F_lab_cor, fig.height = 8, fig.width = 8}
p_SR_F_lab_cor()
```

```{r p_SR_M_lab_cor, fig.height = 8, fig.width = 8}
p_SR_M_lab_cor()
```

```{r}
pdf(file="Starvation/p_SR_F_lab_cor.pdf", width=8, height=8)
p_SR_F_lab_cor()
invisible(dev.off())
```

```{r}
pdf(file="Starvation/p_SR_M_lab_cor.pdf", width=8, height=8)
p_SR_M_lab_cor()
invisible(dev.off())
```





## Pigmentation


```{r}
dir.create(file.path("Pigmentation"), showWarnings = FALSE)
```



_For a detailed description of tables, plots, linear models and outputs, please refer [here](#anchor) _


### Contributors  

Abbott Lab : Jessica Abbott, Qinyang Li, Shahzad Khan

Gibert Lab :Cristina Vieira, Laurence Mouton, Natacha Kremer, Sonia Martinez, Camille Mermet, Patricia Gibert

Schmidt Lab : Amy Goldfischer, Paul Schmidt 

### Data Reformatting

```{r d_Pgm}
d_Pgm <- read.csv("MasterSheets_Oct21_git/PGM_MasterSheet_Jan22.csv")
```

```{r}
str(d_Pgm)
```


```{r}
d_Pgm$Supervisor.PI <- as.factor(d_Pgm$Supervisor.PI)
d_Pgm$Diet <- as.factor(d_Pgm$Diet)
d_Pgm$Batch <- as.factor(d_Pgm$Batch)
d_Pgm$Population_Lat <- factor(d_Pgm$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_Pgm$Population_Lon <- factor(d_Pgm$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_Pgm$Population_Alt <- factor(d_Pgm$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_Pgm$Line <- as.factor(d_Pgm$Line)
d_Pgm$AreaT4 <- as.numeric(d_Pgm$AreaT4)
d_Pgm$AreaT5 <- as.numeric(d_Pgm$AreaT5)
d_Pgm$AreaT6 <- as.numeric(d_Pgm$AreaT6)
d_Pgm$PercT4 <- as.numeric(d_Pgm$PercT4)
d_Pgm$PercT6 <- as.numeric(d_Pgm$PercT6)
d_Pgm$TotalArea <- as.numeric(d_Pgm$TotalArea)
d_Pgm$TotalBlack <- as.numeric(d_Pgm$TotalBlack)
```

```{r}
str(d_Pgm)
```

```{r d_Pgm2}
d_Pgm2 <- read.csv("MasterSheets_Oct21_git/PGM2_MasterSheet_Oct21.csv")
```

```{r}
str(d_Pgm2)
```

```{r}
d_Pgm2$Supervisor.PI <- as.factor(d_Pgm2$Supervisor.PI)
d_Pgm2$Diet <- as.factor(d_Pgm2$Diet)
d_Pgm2$Batch <- as.factor(d_Pgm2$Batch)
d_Pgm2$Population_Lat <- factor(d_Pgm2$Population, levels= c("YE","RE","GI","MU","MA","UM","KA","VA","AK"))
d_Pgm2$Population_Lon <- factor(d_Pgm2$Population, levels= c("RE","GI","KA","MU","MA","AK","UM","YE","VA"))
d_Pgm2$Population_Alt <- factor(d_Pgm2$Population, levels= c("KA","AK","GI","RE","UM","VA","MU","MA","YE"))
d_Pgm2$Line <- as.factor(d_Pgm2$Line)
d_Pgm2$Tergite8 <- as.numeric(d_Pgm2$Tergite8)
d_Pgm2$Tergite9 <- as.numeric(d_Pgm2$Tergite9)
d_Pgm2$Tergite10 <- as.numeric(d_Pgm2$Tergite10)
d_Pgm2$Total <- as.numeric(d_Pgm2$Total)
```


```{r}
str(d_Pgm2)
```

### Descriptive Statistics


### _T4_


Descriptive statistics at the line level, with batch information :
```{r table_Pgm_Line_T4_wbatch}
table_Pgm_Line_T4_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population, Line) %>% summarise_at(vars(PercT4), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Pigmentation/table_Pgm_PercT4_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm_Line_T4_wbatch, options = list(pageLength = 10)) 
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm_Line_T4_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population, Line) %>% summarise_at(vars(PercT4), list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, SE = std_err, CV = coef_var, Mode = estimate_mode)), file = "Pigmentation/table_Pgm_PercT4_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm_Line_T4_wobatch}
DT::datatable(table_Pgm_Line_T4_wobatch, options = list(pageLength = 10)) 
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm_Pop_T4_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(PercT4), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T4_wbatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T4_wbatch}
DT::datatable(table_Pgm_Pop_T4_wbatch, options = list(pageLength = 10)) 
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm_Pop_T4_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(PercT4), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T4_wobatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T4_wobatch}
DT::datatable(table_Pgm_Pop_T4_wobatch, options = list(pageLength = 10))
```


### _T5_

Descriptive statistics at the line level, with batch information :
```{r table_Pgm_Line_T5_wbatch}
table_Pgm_Line_T5_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(PercT5), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_PercT5_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm_Line_T5_wbatch, options = list(pageLength = 10)) 
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm_Line_T5_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(PercT5), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_PercT5_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm_Line_T5_wobatch}
DT::datatable(table_Pgm_Line_T5_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm_Pop_T5_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(PercT5), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T5_wbatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T5_wbatch}
DT::datatable(table_Pgm_Pop_T5_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm_Pop_T5_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(PercT5), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T5_wobatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T5_wobatch}
DT::datatable(table_Pgm_Pop_T5_wobatch, options = list(pageLength = 10))
```


### _T6_

Descriptive statistics at the line level, with batch information :
```{r table_Pgm_Line_T6_wbatch}
table_Pgm_Line_T6_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(PercT6), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_PercT6_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm_Line_T6_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm_Line_T6_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(PercT6), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_PercT6_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm_Line_T6_wobatch}
DT::datatable(table_Pgm_Line_T6_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm_Pop_T6_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(PercT6), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T6_wbatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T6_wbatch}
DT::datatable(table_Pgm_Pop_T6_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm_Pop_T6_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(PercT6), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_T6_wobatch.csv", row.names = T)

```

```{r table_Pgm_Pop_T6_wobatch}
DT::datatable(table_Pgm_Pop_T6_wobatch, options = list(pageLength = 10))
```

### _Total_

Descriptive statistics at the line level, with batch information :
```{r table_Pgm_Line_TotalPerc_wbatch}
table_Pgm_Line_TotalPerc_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(TotalPerc), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_TotalPerc_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm_Line_TotalPerc_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm_Line_TotalPerc_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(TotalPerc), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm_TotalPerc_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm_Line_TotalPerc_wobatch}
DT::datatable(table_Pgm_Line_TotalPerc_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm_Pop_TotalPerc_wbatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(TotalPerc), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_TotalPerc_wbatch.csv", row.names = T)

```

```{r table_Pgm_Pop_TotalPerc_wbatch}
DT::datatable(table_Pgm_Pop_TotalPerc_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm_Pop_TotalPerc_wobatch <- write.csv(d_Pgm %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(TotalPerc), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm_Pop_TotalPerc_wobatch.csv", row.names = T)

```

```{r table_Pgm_Pop_TotalPerc_wobatch}
DT::datatable(table_Pgm_Pop_TotalPerc_wobatch, options = list(pageLength = 10))
```

### _T8_

Descriptive statistics at the line level, with batch information :
```{r table_Pgm2_Line_Tergite8_wbatch}
table_Pgm2_Line_Tergite8_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(Tergite8), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite8_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm2_Line_Tergite8_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm2_Line_Tergite8_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(Tergite8), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite8_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm2_Line_Tergite8_wobatch}
DT::datatable(table_Pgm2_Line_Tergite8_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm2_Pop_Tergite8_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(Tergite8), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite8_wbatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite8_wbatch}
DT::datatable(table_Pgm2_Pop_Tergite8_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm2_Pop_Tergite8_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(Tergite8), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite8_wobatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite8_wobatch}
DT::datatable(table_Pgm2_Pop_Tergite8_wobatch, options = list(pageLength = 10))
```

### _T9_

Descriptive statistics at the line level, with batch information :
```{r table_Pgm2_Line_Tergite9_wbatch}
table_Pgm2_Line_Tergite9_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(Tergite9), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite9_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm2_Line_Tergite9_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm2_Line_Tergite9_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(Tergite9), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite9_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm2_Line_Tergite9_wobatch}
DT::datatable(table_Pgm2_Line_Tergite9_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm2_Pop_Tergite9_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(Tergite9), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite9_wbatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite9_wbatch}
DT::datatable(table_Pgm2_Pop_Tergite9_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm2_Pop_Tergite9_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(Tergite9), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite9_wobatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite9_wobatch}
DT::datatable(table_Pgm2_Pop_Tergite9_wobatch, options = list(pageLength = 10))
```

### _T10_


Descriptive statistics at the line level, with batch information :
```{r table_Pgm2_Line_Tergite10_wbatch}
table_Pgm2_Line_Tergite10_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(Tergite10), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite10_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm2_Line_Tergite10_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm2_Line_Tergite10_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(Tergite10), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Tergite10_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm2_Line_Tergite10_wobatch}
DT::datatable(table_Pgm2_Line_Tergite10_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm2_Pop_Tergite10_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(Tergite10), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite10_wbatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite10_wbatch}
DT::datatable(table_Pgm2_Pop_Tergite10_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm2_Pop_Tergite10_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(Tergite10), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Tergite10_wobatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Tergite10_wobatch}
DT::datatable(table_Pgm2_Pop_Tergite10_wobatch, options = list(pageLength = 10))
```

### _Total2_


Descriptive statistics at the line level, with batch information :
```{r table_Pgm2_Line_Total_wbatch}
table_Pgm2_Line_Total_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population, Line) %>% 
                                    summarise_at(vars(Total), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Total_Line_wbatch.csv", row.names = T)
```

```{r}
DT::datatable(table_Pgm2_Line_Total_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the line level, without batch information :
```{r}
table_Pgm2_Line_Total_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population, Line) %>% 
                                    summarise_at(vars(Total), 
                                                 list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                      SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                            file = "Pigmentation/table_Pgm2_Total_Line_wobatch.csv", row.names = T)
```

```{r table_Pgm2_Line_Total_wobatch}
DT::datatable(table_Pgm2_Line_Total_wobatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, with batch information :
```{r}
table_Pgm2_Pop_Total_wbatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Batch, Population) %>% 
                                   summarise_at(vars(Total), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Total_wbatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Total_wbatch}
DT::datatable(table_Pgm2_Pop_Total_wbatch, options = list(pageLength = 10))
```

Descriptive statistics at the population level, without batch information :
```{r}
table_Pgm2_Pop_Total_wobatch <- write.csv(d_Pgm2 %>% group_by(Supervisor.PI, Population) %>% 
                                   summarise_at(vars(Total), 
                                                list(Mean = mean, SD= sd, Median = median, Min = min, Max = max, 
                                                     SE = std_err, CV = coef_var, Mode = estimate_mode)), 
                           file = "Pigmentation/table_Pgm2_Pop_Total_wobatch.csv", row.names = T)

```

```{r table_Pgm2_Pop_Total_wobatch}
DT::datatable(table_Pgm2_Pop_Total_wobatch, options = list(pageLength = 10))
```


#### Overview 

### Plots and Linear Models by Lab  

#### Abbott Lab

_PercT4_

```{r Pgm_lmer_Abbott_PercT4}
Pgm_lmer_Abbott_PercT4 <- lmer(PercT4 ~ -1 + Population + (1|Line:Population), 
                               data = (subset(d_Pgm,Supervisor.PI=='Abbott')))
capture.output(summary(Pgm_lmer_Abbott_PercT4),file = "Pigmentation/Pgm_lmer_Abbott_PercT4_sum.txt")
capture.output(anova(Pgm_lmer_Abbott_PercT4),file = "Pigmentation/Pgm_lmer_Abbott_PercT4.txt")

```

```{r}
anova(Pgm_lmer_Abbott_PercT4)
```

```{r}
summary(Pgm_lmer_Abbott_PercT4)
```


```{r p_Pgm_Abbott_PercT4}

p_Pgm_Abbott_PercT4 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT4, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT4", x="Population", y = "PercT4") + ylim(c(min(d_Pgm$PercT4) , max(d_Pgm$PercT4)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT4.pdf",width=8, height=5)
p_Pgm_Abbott_PercT4
dev.off()
```


```{r p_Pgm_pop_Abbott_PercT4}

p_Pgm_pop_Abbott_PercT4 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT4, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT4", x="Population", y = "PercT4") + ylim(c(min(d_Pgm$PercT4) , max(d_Pgm$PercT4)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT4.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT4
dev.off()
```



_PercT5_

```{r Pgm_lmer_Abbott_PercT5}
Pgm_lmer_Abbott_PercT5 <- lmer(PercT5 ~ -1 + Population  + (1|Line:Population) , data = (subset(d_Pgm,Supervisor.PI=='Abbott')))
capture.output(summary(Pgm_lmer_Abbott_PercT5),file = "Pigmentation/Pgm_lmer_Abbott_PercT5_sum.txt")
capture.output(anova(Pgm_lmer_Abbott_PercT5),file = "Pigmentation/Pgm_lmer_Abbott_PercT5.txt")

```

```{r}
anova(Pgm_lmer_Abbott_PercT5)
```

```{r}
summary(Pgm_lmer_Abbott_PercT5)
```


```{r p_Pgm_Abbott_PercT5}

p_Pgm_Abbott_PercT5 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT5, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT5", x="Population", y = "PercT5") + ylim(c(min(d_Pgm$PercT5) , max(d_Pgm$PercT5)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT5.pdf",width=8, height=5)
p_Pgm_Abbott_PercT5
dev.off()
```


```{r p_Pgm_pop_Abbott_PercT5}

p_Pgm_pop_Abbott_PercT5 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT5, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT5", x="Population", y = "PercT5") + ylim(c(min(d_Pgm$PercT5) , max(d_Pgm$PercT5)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT5.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT5
dev.off()
```


_PercT6_

```{r Pgm_lmer_Abbott_PercT6}
Pgm_lmer_Abbott_PercT6 <- lmer(PercT6 ~ -1 + Population  + (1|Line:Population) , data = (subset(d_Pgm,Supervisor.PI=='Abbott')))
capture.output(summary(Pgm_lmer_Abbott_PercT6),file = "Pigmentation/Pgm_lmer_Abbott_PercT6_sum.txt")
capture.output(anova(Pgm_lmer_Abbott_PercT6),file = "Pigmentation/Pgm_lmer_Abbott_PercT6.txt")

```

```{r}
anova(Pgm_lmer_Abbott_PercT6)
```

```{r}
summary(Pgm_lmer_Abbott_PercT6)
```


```{r p_Pgm_Abbott_PercT6}

p_Pgm_Abbott_PercT6 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT6, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_PercT6", x="Population", y = "PercT6") + ylim(c(min(d_Pgm$PercT6) , max(d_Pgm$PercT6)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Abbott_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_PercT6.pdf",width=8, height=5)
p_Pgm_Abbott_PercT6
dev.off()
```


```{r p_Pgm_pop_Abbott_PercT6}

p_Pgm_pop_Abbott_PercT6 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=PercT6, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_PercT6", x="Population", y = "PercT6") + ylim(c(min(d_Pgm$PercT6) , max(d_Pgm$PercT6)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_PercT6.pdf",width=8, height=5)
p_Pgm_pop_Abbott_PercT6
dev.off()
```


_TotalPerc_

```{r Pgm_lmer_Abbott_TotalPerc}
Pgm_lmer_Abbott_TotalPerc <- lmer(TotalPerc ~ -1 + Population  + (1|Line:Population)  , data = (subset(d_Pgm,Supervisor.PI=='Abbott')))
capture.output(summary(Pgm_lmer_Abbott_TotalPerc),file = "Pigmentation/Pgm_lmer_Abbott_TotalPerc_sum.txt")
capture.output(anova(Pgm_lmer_Abbott_TotalPerc),file = "Pigmentation/Pgm_lmer_Abbott_TotalPerc.txt")

```

```{r}
anova(Pgm_lmer_Abbott_TotalPerc)
```

```{r}
summary(Pgm_lmer_Abbott_TotalPerc)
```


```{r p_Pgm_Abbott_TotalPerc}

p_Pgm_Abbott_TotalPerc <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=TotalPerc, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Abbott_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(d_Pgm$TotalPerc) , max(d_Pgm$TotalPerc)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Abbott_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Abbott_TotalPerc.pdf",width=8, height=5)
p_Pgm_Abbott_TotalPerc
dev.off()
```


```{r p_Pgm_pop_Abbott_TotalPerc}

p_Pgm_pop_Abbott_TotalPerc <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Abbott')), aes(x=Population_Lat, y=TotalPerc, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Abbott_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(d_Pgm$TotalPerc) , max(d_Pgm$TotalPerc)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Abbott_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Abbott_TotalPerc.pdf",width=8, height=5)
p_Pgm_pop_Abbott_TotalPerc
dev.off()
```


#### Gibert Lab 


_PercT4_

```{r Pgm_lmer_Gibert_PercT4}
Pgm_lmer_Gibert_PercT4 <- lmer(PercT4 ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch), data = (subset(d_Pgm,Supervisor.PI=='Gibert')))
capture.output(summary(Pgm_lmer_Gibert_PercT4),file = "Pigmentation/Pgm_lmer_Gibert_PercT4_sum.txt")
capture.output(anova(Pgm_lmer_Gibert_PercT4),file = "Pigmentation/Pgm_lmer_Gibert_PercT4.txt")

```

```{r}
anova(Pgm_lmer_Gibert_PercT4)
```

```{r}
summary(Pgm_lmer_Gibert_PercT4)
```


```{r p_Pgm_Gibert_PercT4}

p_Pgm_Gibert_PercT4 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT4, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT4", x="Population", y = "PercT4") + ylim(c(min(d_Pgm$PercT4) , max(d_Pgm$PercT4)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT4.pdf",width=8, height=5)
p_Pgm_Gibert_PercT4
dev.off()
```


```{r p_Pgm_pop_Gibert_PercT4}

p_Pgm_pop_Gibert_PercT4 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT4, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT4", x="Population", y = "PercT4") + ylim(c(min(d_Pgm$PercT4) , max(d_Pgm$PercT4)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT4
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT4.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT4
dev.off()
```



_PercT5_

```{r Pgm_lmer_Gibert_PercT5}
Pgm_lmer_Gibert_PercT5 <- lmer(PercT5 ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch), data = (subset(d_Pgm,Supervisor.PI=='Gibert')))
capture.output(summary(Pgm_lmer_Gibert_PercT5),file = "Pigmentation/Pgm_lmer_Gibert_PercT5_sum.txt")
capture.output(anova(Pgm_lmer_Gibert_PercT5),file = "Pigmentation/Pgm_lmer_Gibert_PercT5.txt")

```

```{r}
anova(Pgm_lmer_Gibert_PercT5)
```

```{r}
summary(Pgm_lmer_Gibert_PercT5)
```


```{r p_Pgm_Gibert_PercT5}

p_Pgm_Gibert_PercT5 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT5, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT5", x="Population", y = "PercT5") + ylim(c(min(d_Pgm$PercT5) , max(d_Pgm$PercT5)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT5.pdf",width=8, height=5)
p_Pgm_Gibert_PercT5
dev.off()
```


```{r p_Pgm_pop_Gibert_PercT5}

p_Pgm_pop_Gibert_PercT5 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT5, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT5", x="Population", y = "PercT5") + ylim(c(min(d_Pgm$PercT5) , max(d_Pgm$PercT5)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT5
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT5.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT5
dev.off()
```


_PercT6_

```{r Pgm_lmer_Gibert_PercT6}
Pgm_lmer_Gibert_PercT6 <- lmer(PercT6 ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch), data = (subset(d_Pgm,Supervisor.PI=='Gibert')))
capture.output(summary(Pgm_lmer_Gibert_PercT6),file = "Pigmentation/Pgm_lmer_Gibert_PercT6_sum.txt")
capture.output(anova(Pgm_lmer_Gibert_PercT6),file = "Pigmentation/Pgm_lmer_Gibert_PercT6.txt")

```

```{r}
anova(Pgm_lmer_Gibert_PercT6)
```

```{r}
summary(Pgm_lmer_Gibert_PercT6)
```


```{r p_Pgm_Gibert_PercT6}

p_Pgm_Gibert_PercT6 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT6, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_PercT6", x="Population", y = "PercT6") + ylim(c(min(d_Pgm$PercT6) , max(d_Pgm$PercT6)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Gibert_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_PercT6.pdf",width=8, height=5)
p_Pgm_Gibert_PercT6
dev.off()
```


```{r p_Pgm_pop_Gibert_PercT6}

p_Pgm_pop_Gibert_PercT6 <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=PercT6, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_PercT6", x="Population", y = "PercT6") + ylim(c(min(d_Pgm$PercT6) , max(d_Pgm$PercT6)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_PercT6
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_PercT6.pdf",width=8, height=5)
p_Pgm_pop_Gibert_PercT6
dev.off()
```


_TotalPerc_

```{r Pgm_lmer_Gibert_TotalPerc}
Pgm_lmer_Gibert_TotalPerc <- lmer(TotalPerc ~ -1 + Population  + (1|Line:Population) +
                                    (1|Batch), data = (subset(d_Pgm,Supervisor.PI=='Gibert')))
capture.output(summary(Pgm_lmer_Gibert_TotalPerc),file = "Pigmentation/Pgm_lmer_Gibert_TotalPerc_sum.txt")
capture.output(anova(Pgm_lmer_Gibert_TotalPerc),file = "Pigmentation/Pgm_lmer_Gibert_TotalPerc.txt")

```

```{r}
anova(Pgm_lmer_Gibert_TotalPerc)
```

```{r}
summary(Pgm_lmer_Gibert_TotalPerc)
```


```{r p_Pgm_Gibert_TotalPerc}

p_Pgm_Gibert_TotalPerc <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=TotalPerc, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_Gibert_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(d_Pgm$TotalPerc) , max(d_Pgm$TotalPerc)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_Gibert_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_Gibert_TotalPerc.pdf",width=8, height=5)
p_Pgm_Gibert_TotalPerc
dev.off()
```


```{r p_Pgm_pop_Gibert_TotalPerc}

p_Pgm_pop_Gibert_TotalPerc <- ggplot(data = (subset(d_Pgm,Supervisor.PI=='Gibert')), aes(x=Population_Lat, y=TotalPerc, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm_pop_Gibert_TotalPerc", x="Population", y = "TotalPerc") + ylim(c(min(d_Pgm$TotalPerc) , max(d_Pgm$TotalPerc)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm_pop_Gibert_TotalPerc
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm_pop_Gibert_TotalPerc.pdf",width=8, height=5)
p_Pgm_pop_Gibert_TotalPerc
dev.off()
```


#### Schmidt Lab


_Tergite8_

```{r Pgm2_lmer_Schmidt_Tergite8}
Pgm2_lmer_Schmidt_Tergite8 <- lmer(Tergite8 ~ -1 + Population  + (1|Line:Population), data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')))
capture.output(summary(Pgm2_lmer_Schmidt_Tergite8),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite8_sum.txt")
capture.output(anova(Pgm2_lmer_Schmidt_Tergite8),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite8.txt")

```

```{r}
anova(Pgm2_lmer_Schmidt_Tergite8)
```

```{r}
summary(Pgm2_lmer_Schmidt_Tergite8)
```


```{r p_Pgm2_Schmidt_Tergite8}

p_Pgm2_Schmidt_Tergite8 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite8, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_Schmidt_Tergite8", x="Population", y = "Tergite8") + ylim(c(min(d_Pgm2$Tergite8) , max(d_Pgm2$Tergite8)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_Schmidt_Tergite8
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_Schmidt_Tergite8.pdf",width=8, height=5)
p_Pgm2_Schmidt_Tergite8
dev.off()
```


```{r p_Pgm2_pop_Schmidt_Tergite8}

p_Pgm2_pop_Schmidt_Tergite8 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite8, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_pop_Schmidt_Tergite8", x="Population", y = "Tergite8") + ylim(c(min(d_Pgm2$Tergite8) , max(d_Pgm2$Tergite8)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_pop_Schmidt_Tergite8
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_pop_Schmidt_Tergite8.pdf",width=8, height=5)
p_Pgm2_pop_Schmidt_Tergite8
dev.off()
```



_Tergite9_

```{r Pgm2_lmer_Schmidt_Tergite9}
Pgm2_lmer_Schmidt_Tergite9 <- lmer(Tergite9 ~ -1 + Population  + (1|Line:Population) , data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')))
capture.output(summary(Pgm2_lmer_Schmidt_Tergite9),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite9_sum.txt")
capture.output(anova(Pgm2_lmer_Schmidt_Tergite9),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite9.txt")

```

```{r}
anova(Pgm2_lmer_Schmidt_Tergite9)
```

```{r}
summary(Pgm2_lmer_Schmidt_Tergite9)
```


```{r p_Pgm2_Schmidt_Tergite9}

p_Pgm2_Schmidt_Tergite9 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite9, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_Schmidt_Tergite9", x="Population", y = "Tergite9") + ylim(c(min(d_Pgm2$Tergite9) , max(d_Pgm2$Tergite9)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_Schmidt_Tergite9
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_Schmidt_Tergite9.pdf",width=8, height=5)
p_Pgm2_Schmidt_Tergite9
dev.off()
```


```{r p_Pgm2_pop_Schmidt_Tergite9}

p_Pgm2_pop_Schmidt_Tergite9 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite9, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_pop_Schmidt_Tergite9", x="Population", y = "Tergite9") + ylim(c(min(d_Pgm2$Tergite9) , max(d_Pgm2$Tergite9)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_pop_Schmidt_Tergite9
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_pop_Schmidt_Tergite9.pdf",width=8, height=5)
p_Pgm2_pop_Schmidt_Tergite9
dev.off()
```


_Tergite10_

```{r Pgm2_lmer_Schmidt_Tergite10}
Pgm2_lmer_Schmidt_Tergite10 <- lmer(Tergite10 ~ -1 + Population  + (1|Line:Population), data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')))
capture.output(summary(Pgm2_lmer_Schmidt_Tergite10),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite10_sum.txt")
capture.output(anova(Pgm2_lmer_Schmidt_Tergite10),file = "Pigmentation/Pgm2_lmer_Schmidt_Tergite10.txt")

```

```{r}
anova(Pgm2_lmer_Schmidt_Tergite10)
```

```{r}
summary(Pgm2_lmer_Schmidt_Tergite10)
```


```{r p_Pgm2_Schmidt_Tergite10}

p_Pgm2_Schmidt_Tergite10 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite10, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_Schmidt_Tergite10", x="Population", y = "Tergite10") + ylim(c(min(d_Pgm2$Tergite10) , max(d_Pgm2$Tergite10)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_Schmidt_Tergite10
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_Schmidt_Tergite10.pdf",width=8, height=5)
p_Pgm2_Schmidt_Tergite10
dev.off()
```


```{r p_Pgm2_pop_Schmidt_Tergite10}

p_Pgm2_pop_Schmidt_Tergite10 <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Tergite10, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_pop_Schmidt_Tergite10", x="Population", y = "Tergite10") + ylim(c(min(d_Pgm2$Tergite10) , max(d_Pgm2$Tergite10)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_pop_Schmidt_Tergite10
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_pop_Schmidt_Tergite10.pdf",width=8, height=5)
p_Pgm2_pop_Schmidt_Tergite10
dev.off()
```


_Total_

```{r Pgm2_lmer_Schmidt_Total}
Pgm2_lmer_Schmidt_Total <- lmer(Total ~ -1 + Population  + (1|Line:Population), data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')))
capture.output(summary(Pgm2_lmer_Schmidt_Total),file = "Pigmentation/Pgm2_lmer_Schmidt_Total_sum.txt")
capture.output(anova(Pgm2_lmer_Schmidt_Total),file = "Pigmentation/Pgm2_lmer_Schmidt_Total.txt")

```

```{r}
anova(Pgm2_lmer_Schmidt_Total)
```

```{r}
summary(Pgm2_lmer_Schmidt_Total)
```


```{r p_Pgm2_Schmidt_Total}

p_Pgm2_Schmidt_Total <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Total, fill=Batch)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_Schmidt_Total", x="Population", y = "Total") + ylim(c(min(d_Pgm2$Total) , max(d_Pgm2$Total)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_Schmidt_Total
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_Schmidt_Total.pdf",width=8, height=5)
p_Pgm2_Schmidt_Total
dev.off()
```


```{r p_Pgm2_pop_Schmidt_Total}

p_Pgm2_pop_Schmidt_Total <- ggplot(data = (subset(d_Pgm2,Supervisor.PI=='Schmidt')), aes(x=Population_Lat, y=Total, fill=Population)) + 
        geom_boxplot(outlier.shape = NA, notch=FALSE) + 
        labs(title="p_Pgm2_pop_Schmidt_Total", x="Population", y = "Total") + ylim(c(min(d_Pgm2$Total) , max(d_Pgm2$Total)))+ droseu_theme
```

```{r echo=FALSE}
p_Pgm2_pop_Schmidt_Total
```

```{r echo=FALSE}
pdf(file="Pigmentation/p_Pgm2_pop_Schmidt_Total.pdf",width=8, height=5)
p_Pgm2_pop_Schmidt_Total
dev.off()
```





### Lab correlations


```{r intersect_Pgm}

intersect_Line_Pgm  <- Reduce(intersect, list(d_Pgm$Line[d_Pgm$Supervisor.PI == "Abbott"],
                                         d_Pgm2$Line[d_Pgm2$Supervisor.PI == "Schmidt"],
                                         d_Pgm$Line[d_Pgm$Supervisor.PI == "Gibert"]))

write(intersect_Line_Pgm, file ="Pigmentation/intersect_Line_Pgm.txt", sep = "\t")


intersect_Pop_Pgm  <- Reduce(intersect, list(d_Pgm$Population[d_Pgm$Supervisor.PI == "Abbott"],
                                         d_Pgm2$Population[d_Pgm2$Supervisor.PI == "Schmidt"],
                                         d_Pgm$Population[d_Pgm$Supervisor.PI == "Gibert"]))

write(intersect_Pop_Pgm, file ="Pigmentation/intersect_Pop_Pgm", sep = "\t")

```

There are `r length(intersect_Pop_Pgm) ` populations and `r length(intersect_Line_Pgm) ` isofemale lines that have been phenotyped across the labs. Please refer to tables named intersect_Trait_level (i.e. intersect_Via_pop) for details. 



# Results II : Meta-Analyses

## with Diet 
## with Wolbachia

### Diapause


```{r}
# get the effects in the right shape
Dia_effects <- Dia_fitted %>%
  dplyr::select(-Value) %>%
  mutate(Population = factor(Population, levels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK")),
         Lab = as.factor(Lab),
         V = SE^2,
         Study = paste(Population, Lab, sep = "_")) %>%
  relocate(Population, Sex, Lab, Study) %>%
  arrange(Population) %>% 
  dplyr::rename(Y = Estimate)
```

## Females
```{r}
# run the analysis
Dia_F_meta <- metaAnalysisRandomModel(Dia_effects %>% filter(Sex == "F"))
```



```{r}

p_Dia_F_meta_SE <- Dia_F_meta$summary_effects_random %>% 
  dplyr::select(Population, Mstar, SEMstar) %>% 
  distinct() %>%
  ggplot(aes(x = Mstar, y = 1:length(Population), color = Population)) +
  theme_bw() +
  geom_point(size = 4, shape = 15) +
  #scale_color_manual(values = pops$by_lat$Color, guide = "none") +
  geom_errorbarh(aes(xmax = Mstar + SEMstar, xmin = Mstar - SEMstar), height = 0) +
  scale_y_continuous(name = "Population", breaks = 1:9, 
                     labels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK")) +
  labs(x = "Proportion diapause", title = "Pop. summary effect with SE") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  annotate("text", x = -Inf, y = Inf, label = sprintf("italic(Q) == %.4g", Dia_F_meta$Qtest_het$Q), 
           hjust=-0.2, vjust=3.5, parse = T) +
  annotate("text", x = -Inf, y = Inf, label = sprintf("italic(p) == %.4g", Dia_F_meta$Qtest_het$p), 
           hjust=-0.2, vjust=5, parse = T) +
  theme(legend.position = "none")


p_Dia_F_meta_CI <- Dia_F_meta$summary_effects_random %>% 
  dplyr::select(Population, Mstar, ULMstar, LLMstar) %>% 
  distinct() %>%
  ggplot(aes(x = Mstar, y = 1:length(Population), color = Population)) +
  theme_bw() +
  geom_point(size = 4, shape = 15) +
  #scale_color_manual(values = pops$by_lat$Color, guide = "none") +
  geom_errorbarh(aes(xmax = ULMstar, xmin = LLMstar), height = 0) +
  scale_y_continuous(name = "Population", breaks = 1:9, 
                     labels = c("YE","RE","GI","MU","MA","UM","KA","VA","AK")) +
  labs(x = "Proportion diapause", title = "Pop. summary effect with 95% CI") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  annotate("text", x = -Inf, y = Inf, label = sprintf("italic(Q) == %.4g", Dia_F_meta$Qtest_het$Q), 
           hjust=-0.2, vjust=3.5, parse = T) +
  annotate("text", x = -Inf, y = Inf, label = sprintf("italic(p) == %.4g", Dia_F_meta$Qtest_het$p), 
           hjust=-0.2, vjust=5, parse = T) +
  theme(legend.position = "none")


```


```{r, fig.width=8, fig.height=5}
ggarrange(p_Dia_F_meta_SE, p_Dia_F_meta_CI)
```




### Starvation resistance 

# Results III : Trait Correlations _tbd_

## Stress related traits
## Temperature related traits
## Size related traits

# Results III : Qst - Fst  _tbd_

# Results IV : Environmental Variables  _tbd_

# Results V : Heritability  _tbd_